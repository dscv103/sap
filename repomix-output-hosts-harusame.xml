This file is a merged representation of the entire codebase, combined into a single document by Repomix.
The content has been processed where security check has been disabled.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Security check has been disabled - content may contain sensitive information
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
bin/
  hey.d/
    build.janet
    gc.janet
    hook.janet
    info.janet
    ops.janet
    path.janet
    profile.janet
    pull.janet
    reload.janet
    repl.janet
    swap.janet
    sync.janet
    vars.janet
  autoclicker.zsh
  backup.zsh
  hey
  lsiommu.zsh
  optimize.zsh
  qr.zsh
  termcolors.sh
  when.zsh
  ytdl.zsh
config/
  beets/
    config.yaml
  blender/
    config/
      bookmarks.txt
  bspwm/
    bin/
      focus
      osd
      presel
      resize
      subtract-presel
      swap
      xst-scratch
    hooks/
      idle.zsh
      reload.zsh
    bspwmrc
  docker/
    aliases.zsh
  emacs/
    aliases.zsh
  foot/
    foot.ini
  gimp/
    menurc
  git/
    aliases.zsh
    attributes
    config
    ignore
  hypr/
    bin/
      osd.d/
        brightness.zsh
        toggle.zsh
        volume.zsh
      scratch.d/
        emacs
        term
      export-env.zsh
      get-activeworkspace.sh
      get-font.zsh
      get-window.zsh
      lock.zsh
      open-term.zsh
      osd.zsh
      picker.zsh
      play-sound.zsh
      quitactive.zsh
      screencast.zsh
      screendraw.zsh
      screenshot.zsh
      set-monitors.zsh
      slurp.zsh
      toggle-zoom.zsh
    hooks/
      all.zsh
      battery.zsh
      gamemode.zsh
      idle.zsh
    hyprland.conf
  ncmpcpp/
    aliases.zsh
    bindings
    config
  rofi/
    bin/
      appmenu.sh
      audiomenu.janet
      bookmarkmenu.janet
      calcmenu.sh
      emojimenu.sh
      filemenu.sh
      mountmenu.janet
      powermenu.zsh
      read.zsh
      vaultmenu.janet
      wifimenu.janet
      windowmenu.sh
    config.rasi
  secrets/
    secrets.nix
  sxhkd/
    sxhkdrc
  tmux/
    bin/
      swap-pane.zsh
    aliases.zsh
    tmux.conf
  waybar/
    config
  zsh/
    completions/
      _hey
    .zshrc
    aliases.zsh
    completion.zsh
    keybinds.zsh
hosts/
  harusame/
    secrets/
      secrets.nix
    default.nix
    README.org
  ramen/
    secrets/
      secrets.nix
    default.nix
    README.org
  udon/
    bin/
      set-monitors.zsh
    rofi/
      sources/
        displays.rb
    secrets/
      secrets.nix
    default.nix
    README.org
lib/
  hey/
    cmd.janet
    init.janet
    lib.janet
    rofi-blocks.janet
    rofi.janet
    sys.janet
    vars.janet
  zsh/
    hey.abort
    hey.cache
    hey.do
    hey.echo
    hey.error
    hey.requires
    hey.start
    hey.warn
  attrs.nix
  debug.nix
  default.nix
  modules.nix
  nixos.nix
  options.nix
  pkgs.nix
modules/
  desktop/
    apps/
      godot.nix
      libreoffice.nix
      lutris.nix
      rofi.nix
      spotify.nix
      steam.nix
      teamviewer.nix
      thunar.nix
      ue.nix
      unity3d.nix
      virtualbox.nix
    browsers/
      brave.nix
      default.nix
      librewolf.nix
    media/
      cad.nix
      daw.nix
      graphics.nix
      music.nix
      video.nix
    term/
      default.nix
      foot.nix
      st.nix
    bspwm.nix
    default.nix
    hyprland.nix
  dev/
    cc.nix
    clojure.nix
    common-lisp.nix
    default.nix
    java.nix
    lua.nix
    node.nix
    python.nix
    ruby.nix
    rust.nix
    scala.nix
    shell.nix
  editors/
    default.nix
    emacs.nix
    vim.nix
  profiles/
    hardware/
      cpu/
        amd.nix
        intel.nix
      gpu/
        nvidia.nix
      pc/
        laptop.nix
      wacom/
        cintiq.nix
      audio.nix
      bluetooth.nix
      ergodox.nix
      hidpi.nix
      printer.nix
      razer.nix
      scanner.nix
      ssd.nix
      wifi.nix
    network/
      ca.nix
      dk.nix
      wg0.nix
    platform/
      linode.nix
    role/
      server.nix
      vm.nix
      workstation.nix
    user/
      hlissner.nix
    default.nix
  services/
    calibre.nix
    cgit.nix
    discourse.nix
    docker.nix
    dunst.nix
    fail2ban.nix
    gitea.nix
    hypridle.nix
    jellyfin.nix
    mpd.nix
    nginx.nix
    printing.nix
    prometheus.nix
    ssh.nix
    swayidle.nix
    syncthing.nix
    transmission.nix
    vaultwarden.nix
    waybar.nix
    wlsunset.nix
    ydotool.nix
  shell/
    adl.nix
    direnv.nix
    git.nix
    gnupg.nix
    tmux.nix
    vaultwarden.nix
    zsh.nix
  system/
    fs.nix
    utils.nix
  themes/
    autumnal/
      config/
        inkscape/
          default-template.svg
        librewolf/
          userstyles/
            stylus-2020-02-11.json
          userChrome.css
        polybar/
          modules/
            bluetooth
            redshift
          config
          run.sh
        rofi/
          icons/
            linux.svg
            nixos.svg
            windows.svg
          themes/
            appmenu.rasi
            audiomenu.rasi
            bookmarkmenu.rasi
            calcmenu.rasi
            devmenu.rasi
            emojimenu.rasi
            filemenu.rasi
            modal.rasi
            powermenu.rasi
            timemenu.rasi
            topmenu.rasi
            vaultmenu.rasi
            wifimenu.rasi
            windowmenu.rasi
          config.rasi
        spicetify/
          user.css
        waybar/
          style.css
        zsh/
          prompt.zsh
        bspwmrc
        tmux.conf
        Xresources
      bspwm.nix
      default.nix
      hyprland.nix
      README.md
    default.nix
  virt/
    lxd.nix
    qemu.nix
  agenix.nix
  hey.nix
  home.nix
  security.nix
  xdg.nix
packages/
  rofi-blocks/
    0001-Patch-plugindir-to-output.patch
    default.nix
test/
  hey/
    mock.d/
      sub.d/
        deeper.d/
          .docs
        .docs
      vars.zsh
    glob.janet
    hey.janet
    lib.janet
    vars.janet
    zsh.janet
.editorconfig
.gitignore
default.nix
flake.lock
flake.nix
install.zsh
LICENSE
project.janet
README.md
shell.nix
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="bin/hey.d/build.janet">
#!/usr/bin/env janet
# TODO
#
# SYNOPSIS:
#   build ...

(use hey)
(use hey/cmd)

(defn- build-vm [type & args]
  (echo :g "> Building an VM of this flake...")
  (hey sync -- ,;args ,(string "build-" type)))

(defn- build-iso [& args]
  (echo :g "> Building an ISO for this host...")
  (do? $ nix build
       ,(string/format "%s#nixosConfigurations.%s.config.system.build.isoImage"
                       (path :home) (flake :host))
       --profile ,(path :profile)
       --print-out-paths))

(defn- build-hey [&opt all?]
  (os/cd (path :home))
  # Build hey out of tree, in case $DOTFILES_HOME is in the nix-store (and
  # therefore read-only).
  (with-envvars ["HEYBUILDDEPS" (if all? "1")]
    (echof :g "> Building & deploying bin/hey%s..." (if all? " and dependencies" ""))
    (do? $ jpm run deploy ,;(opts (if (debug?) "--verbose")))
    (echo :check "Done!")))

(defcmd build [_ cmd & args]
  (case* cmd
    "iso" ((cmdfn [all? -a] (build-iso all?)) ;args)
    ["vm" "vm-with-bootloader"] (build-vm cmd)
    (if (or (nil? cmd) (string/has-prefix? "-" cmd))
      (build-hey cmd ;args)
      (abort "Unknown build command: %s" cmd))))
</file>

<file path="bin/hey.d/gc.janet">
#!/usr/bin/env janet
# Garbage collect and optimize the nix store.
#
# SYNOPSIS:
#   gc [-a|--all] [--system] [-d]
#
# OPTIONS:
#   -a
#     GC both the user and system profiles.
#   -s
#     Only GC the system profile.
#   -d
#     Delete old profiles as well.

(use hey)
(use hey/cmd)
(use sh)

(defcmd gc [_ &opts
            all? -a
            system? -s
            delete-old? -d]
  (when (or all? system?)
    (echo :g "> Cleaning your system profile...")
    (do? $ sudo nix-collect-garbage ,;(opts delete-old?))
    (try
      (when delete-old?
        # nix-collect-garbage is a Nix tool, not a NixOS tool. It won't delete
        # old boot entries until you do a nixos-rebuild (which means we'll
        # always have 2 boot entries at any time); reloading the current
        # environment deletes them immediately.
        (echo :g "> Deleting left-over boot entries...")
        (let [profile (path :profile)]
          (do? $ sudo nix-env --delete-generations old --profile ,profile)
          (do? $ sudo ,(string profile "/bin/switch-to-configuration") switch)))
      ([err fib]
       (propagate err fib)))

    (echo :g "> Optimizing the nix store...")
    (do? $ nix-store --optimise))

  (when (or all? (not system?))
    (echo :g "> Running GC on user profiles...")
    (do? $ nix-collect-garbage ,;(opts delete-old?)))

  (echo :check "Done!"))
</file>

<file path="bin/hey.d/hook.janet">
#!/usr/bin/env janet
# Trigger an event.
#
# Hooks are stored in $DOTFILES_HOME/config/$WM/bin/hook.d/*.zsh.
#
# SYNOPSIS:
#   hook HOOK [ARGS...]
#
# RECOGNIZED HOOKS:
#   on-startup
#   on-idle [--{dim,dpms,lock,sleep,resume}]
#   on-sleep
#   on-wakeup
#   on-lock
#   on-unlock
#   on-battery [charging|discharging|*] [ARGS...]
#   on-discarging

(use hey)
(use hey/cmd)
(import hey/vars)

(def- *vars* (vars/new (:dir vars/temp :hook)))

(defn- hooks [hook args &opt global?]
  (let [wmdir (path (if global? :wm :wm*) "hooks")]
    (each f [(resolve wmdir "all" (string "--" hook) ;args)
             (resolve wmdir hook ;args)
             (resolve (path :host "hooks") hook ;args)
             ;(map |[$ ;args]
                   (or (ignore-errors
                        (path/files-in (path :data "hooks.d" (string hook ".d"))))
                       []))]
      (when (and f (path/executable? (first f)))
        (yield f)))))

(defcmd hook [_ hook & args &opts global? -g force? -f verbose? -v]
  (let [hash [hook ;args]]
    (unless hook
      (abort "No hook specified"))
    (when (and (not force?) (deep= (:get *vars* :last) hash))
      (abort "Redundant hook triggered: %q" hash))
    (os/with-lock (path :runtime "hook.lock")  # don't clobber hooks
      (defer (unless (dryrun?) (:set *vars* :last hash))
        (var c 0)
        (each cmd (coro (hooks hook args global?))
          (log "Hook: %s" (path/abbrev (first cmd)))
          (echof :g "Running %s..." (path/basename (first cmd)))
          (do? $? ,;cmd)
          (++ c))
        (echof :pass "Triggered %d hook(s) for: %q" c hash)))))
</file>

<file path="bin/hey.d/info.janet">
#!/usr/bin/env janet
# TODO
#
# SYNOPSIS:
#   info [-r] [KEYS...]
#   info [-r] ip [-w|-l]
#   info [user/repo|https://url/to/git/repo]

(use hey)
(use hey/cmd)
(use sh)

(defn- ip [wan? & args]
  (if wan?
    ($<_ dig +short "myip.opendns.com" "@resolver1.opendns.com")
    (get (string/split " " ($<_ ip -o -4 route show to default)) 8)))

(defn- repo [url]
  (do? $ nix-prefetch-git --quiet ,url))

(defcmd info [_ & args &opts raw? -r wan? -w]
  (let [format (if raw? :raw :json)]
    (var cmd (or (first args) ""))
    (cond (= cmd "ip")
          (echo format (ip wan? ;(slice args 1)))

          (peg/match '(* "http" (? "s") "://") cmd)
          (repo cmd)

          (set cmd (peg/match {:seg '(capture (some (+ :w (set "_-.@"))))
                               :main '(* :seg "/" :seg)}
                              cmd))
          (repo (string "https://github.com/" (in cmd 0) "/" (in cmd 1)))

          (echo format (flake/info ;(map keyword args))))))
</file>

<file path="bin/hey.d/ops.janet">
#!/usr/bin/env janet
# Operate on remote HeyOS-powed hosts.
#
# SYNOPSIS:
#   opts COMMAND [ARGS...]

(use hey)
(use hey/cmd)

# Build flake locally then push it to a remote system.
# [REMOTE...] [-b BUILDER]
(defn- push [])

# Deploy SSH keys from a Bitwarden server.
# [REMOTE...] [-r|--rekey]
(defn- push-keys [])

# Receive keys from stdin (sent via push-keys).
(defn- absorb-keys [])

# Start SSH session on remote.
(defn- ssh [])

# Push and sync flake on remote host.
(defn- sync [])


(defcmd ops [_ & args]
  (not-implemented ;args))
</file>

<file path="bin/hey.d/path.janet">
#!/usr/bin/env janet
# Prints a path to a subarea of my dotfiles.
#
# SYNOPSIS:
#   path [-e] [-a] [AREA] [SEGMENTS...]
#
# OPTIONS:
#   -e
#     Return nothing if resulting path doesn't exist.
#   -d, -f
#     Return nothing if resulting path isn't a directory or file (respectively).
#   -a
#     Abbreviate $HOME/ to ~/ in resulting path.
#
# VALID AREAS:
#   home           $DOTFILES_HOME
#   bin            $DOTFILES_HOME/bin
#   cache          $XDG_CACHE_HOME/hey
#   config         $XDG_CONFIG_HOME/hey
#   data           $XDG_DATA_HOME/hey
#   hosts          $DOTFILES_HOME/hosts
#   host           {hosts}/$HOST/
#   lib            $DOTFILES_HOME/lib
#   modules        $DOTFILES_HOME/modules
#   runtime        $XDG_RUNTIME_DIR/hey
#   state          $XDG_STATE_HOME/hey
#   themes         {modules}/themes
#   theme          {themes}/{THEME}
#   wm             $DOTFILES_HOME/config/{WM}/
#   wm*            $XDG_CONFIG_HOME/{WM}/
#   xdg DIR        $XDG_{DIR}_HOME

(use hey)
(use hey/cmd)

(defn- path-1 [&opt area & args]
  (try (cond (not= area "xdg")
             (path (keyword (or area :home)) ;args)
             (not (get args 1))
             (error "Argument required")
             (path/xdg (keyword (string/ascii-lower (in args 1)))
                       ;(slice args 2)))
       ([err] (abort "%s" err))))

(defcmd path [_ area & args
              &opts
              exists? [-e -f -d]
              abbrev? -a]
  (let [path (path-1 area ;args)]
    (cond (case exists?
            "-e" (not (path/exists? path))
            "-f" (not (path/file? path))
            "-d" (not (path/directory? path)))
          (exit 1)

          abbrev?
          (echo (path/abbrev path))

          (echo path))))
</file>

<file path="bin/hey.d/profile.janet">
#!/usr/bin/env janet
# Operate on the nixos profile.
#
# SUBCOMMANDS:
#   rm -- Remove a system generation.
#   ls -- List all system generations.
#
# SYNOPSIS
#   profile
#   profile ls
#   profile rm [GEN]
#   profile diff FROM [TO]
#
# EXAMPLES:
#   hey rm 1042
#     Remove system generation 1042.
#   hey rm -1
#     Remove the last generation (before the current one).

(use hey)
(use hey/cmd)
(import hey/vars)

(def- *vars* (vars/new (:dir vars/temp :profile)))

(defn- generations [&opt reload?]
  (:cache *vars* :generations
    |(json/decode ($<_ nixos-rebuild list-generations --json)
                  :keywords true)
    reload?))

(defn- generation-at [idx &opt reload?]
  (let [gens (generations reload?)]
    (cond (= idx 0) (find |(get $ :current) gens)
          (< idx 0) (in gens (+ (length gens) idx))
          (find |(= idx (get $ :generation)) gens))))

(defn- generation-file [gen &opt exists?]
  (let [path (string/format "%s-%d-link"
                            (path :profile)
                            (get gen :generation))]
    (when (or (not exists?) (path/exists? path))
      path)))

(defn- rm [idx &opt reload?]
  (os/with-lock (path :runtime "profile-rm.lock")
    (if-let [gen (generation-at idx reload?)]
      (do? $ sudo nix-env
           --delete-generations
           --profile ,(path :profile)
           ,(get gen :generation))
      (abort "No system generation: %q" idx))))

(defn- diff [&opt from to]
  (let [from (generation-at (if from (scan-number from) 0))
        to   (generation-at (if to   (scan-number to)   0))
        afile (path :runtime "profile.diff.a")
        bfile (path :runtime "profile.diff.b")]
    (spit afile ($< nix-store -q --references ,(generation-file from) | sort))
    (spit bfile ($< nix-store -q --references ,(generation-file to) | sort))
    (echo :r ;(map |(string "-" $) ($<_ comm -23 ,afile ,bfile)))
    (echo :g ;(map |(string "+" $) ($<_ comm -23 ,bfile ,afile)))))


(defcmd profile [_ cmd & args &opts
                 reload? -r
                 user? [-u --user]]
  (case* cmd
    "ls" (echo :json (generations reload?))
    "rm" (each g args (rm (scan-number g) reload?))
    "diff" (diff ;args)
    (echo (path (if user? :profile* :profile)))))
</file>

<file path="bin/hey.d/pull.janet">
#!/usr/bin/env janet
# Update one of (or all) HeyOS's inputs.
#
# SYNOPSIS:
#   pull
#   pull [INPUTS]...
#   pull -o [INPUT@REV|INPUT=FLAKE_URI]...
#
# EXAMPLES:
#   hey pull
#     Update all flakes:
#   hey pull waybar 'hypr*'
#     Pull only specific inputs (globs are recognized):
#   hey pull -o waybar@0b6476da32d181ee6b2cabdc5205a46a90521a75 ...
#   hey pull -o waybar=github:aForkOf/Waybar ...
#     A more concise command for repinning inputs.

(use hey)
(use hey/cmd)
(import hey/glob)

(var- *metadata* nil)

(defn metadata []
  (unless *metadata*
    (set *metadata*
         (json/decode ($<_ nix flake metadata --json ,(path :home))
                      :keywords true)))
  *metadata*)

(defcmd pull [_ & args &opts override? [-o --override]]
  (cond
    (empty? args)
    (do
      (echo :g "> Updating all inputs...")
      (do? $ nix flake update --flake ,(path :home) --impure))

    override?
    (let [flake-args @[]]
      (each arg args
        (cond (peg/match '(* :w+ "=") arg)
              (let [[name val] (string/split "=" arg 0 2)]
                (array/push flake-args ["--override-input" name val]))
              (peg/match '(* :w+ "@") arg)
              (let [[name rev] (string/split "@" arg 0 2)
                    input (get-in (metadata) [:locks :nodes (keyword name) :original])]
                (array/push
                 flake-args ["--override-input"
                             name (string/format "%s:%s/%s/%s"
                                                 (input :type)
                                                 (input :owner)
                                                 (input :repo)
                                                 rev)]))
              (abort "Malformed input spec: %s" arg)))
      (when (empty? flake-args)
        (abort "No flakes to override"))
      (do? $ nix flake update --refresh ,;(flatten flake-args) ,(path :home)))

    (let [inputs (keys (get-in (metadata) [:locks :nodes :root :inputs]))
          targets @{}]
      (each m args
        (var negated? (string/has-prefix? "!" m))
        (var match (if negated? (string/slice (string m) 1) (string m)))
        (each i inputs
          (var match? (glob/match* match i))
          (when (if negated? (not match?) match?)
            (put targets (string i) true))))
      (when (empty? targets)
        (abort "No matching inputs"))
      (echo :g "> Updating matching inputs:")
      (eachk t targets (echof "  - %s" t))
      (do? $ nix flake update --flake ,(path :home) --impure ,;(keys targets)))))
</file>

<file path="bin/hey.d/reload.janet">
#!/usr/bin/env janet
# Reload running services.
#
# SYNOPSIS:
#   reload [-w|--wm] [-n|--nixos]
#
# DESCRIPTION:
#   TODO
#
# OPTIONS:
#   TODO

(use hey)
(use hey/cmd)
(import hey/sys)

(defcmd reload [_]
  (echof :g "Reloading %s..." (os/getenv "XDG_CURRENT_DESKTOP"))
  (when (hey! hook reload -f -v)
    (sys/notify "Finished reloading system" :icon 'checkmark :sound 'notify))
  (echo :check "Done!"))
</file>

<file path="bin/hey.d/repl.janet">
#!/usr/bin/env janet
# Open a nix or janet repl with this flake preloaded.
#
# SYNOPSIS:
#   repl [FLAKES...]
#
# OPTIONS:
#   -j
#     Start a Janet REPL instead.
#

(use hey)
(use hey/cmd)

(defcmd repl [_ & args &opts
              janet? -j
              nixdev? -d]
  (os/setenv "HEYENV" (flake/json))
  (cond janet?
        (do (echo :g "Starting Janet REPL (w/ HeyLib preloaded)...")
            (do? $ janet
                 -l hey
                 -l hey/cmd
                 -e "(import hey/vars)"
                 -e "(import hey/glob)"
                 -e "(import hey/sys)"
                 -p -r ,;args))

        nixdev?
        (do (echo :g "Starting nix-develop REPL (w/ flake preloaded)...")
            (do? $ nix develop ,(path :home) ,;args))

        (do (echo :g "Starting nix REPL (w/ flake preloaded)...")
            (do? $ nix repl
                 --extra-experimental-features "flakes repl-flake"
                 --impure
                 ,(path :home)
                 ,;args))))
</file>

<file path="bin/hey.d/swap.janet">
#!/usr/bin/env janet
# Swap nix-store symlinks with mutable copies (and back)
#
# SYNOPSIS:
#   swap [-u] [-f] FILES...
#   swap [-l|--list]
#   swap [--reset]
#
# DESCRIPTION:
#   The purpose is so you can have copies of your dotfiles that can be modified
#   in place (so you can iterate on them quickly instead of 'hey re'ing between
#   changes). Run again to restore the old link(s).
#
#   WARNING: backup your copies before unswapping them, or they will be
#   destroyed when restored!
#
# OPTIONS:
#   -f
#     Don't ask for confirmation; overwrite files as needed.
#   -u
#     Unswap the targeted files instead of trying to swap them.
#   -l, --ls
#     List all known swapped files.
#   --reset
#     Unswap all known swapped files.

(use hey)
(use hey/cmd)

(def- *store* (delay (path :data "swap")))
(def- *ext* ".swapped")
(def- *swapped* ".swapped")

(defn- list []
  (if (path/file? (*store*))
    (filter |(path/file? (string $ *ext*)) (unmarshal (string/chomp (slurp (*store*)))))
    @[]))

(defn- save [swapped]
  (spit (*store*) (marshal swapped)))

(defn- each-file [& paths]
  (each path paths
    (case (os/stat path :mode)
      nil (echof :err "Skipping %s (does not exist)" path)
      :directory (each-file ;(path/files-in path))
      :file (yield path))))

(defn- swap [paths &opt force?]
  (when (empty? paths)
    (abort "Nothing to swap"))
  (let [swapped (list)
        new-swapped @[;swapped]
        force (if force? ["-f"] [])]
    (each path (coro (each-file ;paths))
      (log 2 "Trying to swap %s" path)
      (let [spath (string path *ext*)]
        (cond (path/exists? spath)
              (echof :warn "Already swapped: %s" path)
              (not (path/symlink? path))
              (echof :err "Skipping %s (not a nix-store symlink)" path)
              (do (echof :pass "Swapping %s" path)
                  (do? $ mv ,;force ,path ,spath)
                  (do? $ cp ,;force ,spath ,path)
                  (do? $ chmod u+rw ,path)
                  (array/push new-swapped (os/realpath path))))))
    (if (or (dryrun?)
            (deep= swapped new-swapped))
      (exit 1)
      (save new-swapped))))

(defn- unswap [paths &opt force?]
  (when (empty? paths)
    (abort "Nothing to unswap"))
  (let [removed @[]
        force (if force? ["-f"] [])]
    (each path (coro (each-file ;paths))
      (log 2 "Trying to unswap %s" path)
      (let [swapfile (string path *ext*)]
        (if (not (path/exists? swapfile))
          (echof :warn "File not swapped: %s" path)
          (do (echof :pass "Unswapping %s" path)
              (do? $ mv ,;force ,swapfile ,path)
              (array/push removed path)))))
    (if (or (dryrun?)
            (empty? removed))
      (exit 1)
      (let [swapped (list)]
        (each p removed (array/remove-elt swapped p))
        (save swapped)))))

(defcmd swap [_ & targets &opts
              unswap? -u
              force? -f
              list? [-l --list]
              reset? --reset]
  (os/with-lock (string (*store*) ".lock")
    (cond list? (echo ;(list))
          reset? (unswap (list) force?)
          (empty? targets) (abort "Nothing to swap")
          (if unswap?
            (unswap targets force?)
            (swap targets force?)))))
</file>

<file path="bin/hey.d/sync.janet">
#!/usr/bin/env janet
# TODO
#
# SYNOPSIS:
#   sync [...]
#   sync --rollback [GENERATION]

(use hey)
(use hey/cmd)

(defcmd sync [_ cmd & args &opts fast? --fast host [--host name]]
  (when (= (flake :host) "nixos")
    (abort "HOST is 'nixos'. Did you forget to change it?"))

  (unless (empty? (hey swap --list))
    (abort "There are swapped files among your dotfiles!"))

  (os/setenv "HEYENV" (flake/json))
  (log "HEYENV=%s" (os/getenv "HEYENV"))

  (case* cmd
    "rollback"
    (if (empty? args)
      (array/push args "--rollback" "switch")
      (do (do? $? sudo nix-env
               --switch-generation ,(in args 0)
               --profile ,(path :profile))
          (break)))
    ["check" "ch"]
    (do? $? nix flake check --impure
         --no-warn-dirty
         --no-use-registries
         --no-write-lock-file
         --no-update-lock-file
         ,(path :home))
    (do? $? sudo --preserve-env=HEYENV nixos-rebuild
         --show-trace
         --impure
         --flake ,(string (path :home) "#" (or host (flake :host)))
         ,;(opts fast?)
         ,;(opts (or cmd "switch"))
         ,;args)))
</file>

<file path="bin/hey.d/vars.janet">
#!/usr/bin/env janet
# TODO
#
# SYNOPSIS:
#   vars [get|set|ls] ...

(use hey)
(use hey/cmd)
(import hey/vars)

(defcmd vars [_ cmd & args &opts global? -g]
  (echo ;(case cmd
          "get" [(vars/get (first args) global?)]
          "set" [(vars/set (in args 0) (get args 1) global?)]
          nil   (vars/list global?))))
</file>

<file path="bin/autoclicker.zsh">
#!/usr/bin/env zsh
# Cookie clicker didn't stand a chance.

if (( $+commands[xdotool] )); then
  _click() {
    xdotool mousedown 1
    sleep 0.01
    xdotool mouseup 1
    sleep 0.01
  }
elif (( $+commands[ydotool] )); then
  _click() {
    ydotool click --repeat=30 --next-delay=30 0xC0
  }
else
  hey.error "No input backend available (xdotool or ydotool)"
  exit 1
fi

while true; do
  _click
done
</file>

<file path="bin/backup.zsh">
#!/usr/bin/env zsh
# Push or pull projects to my NAS.
#
# I switch between workstations for different workloads. Timing issues make
# automated solutions (like dropbox, syncthing, or rclone/rsyncing on a cronjob)
# unreliable and opaque, so I opt for a script to sync with my NAS, for other
# systems to pull form.
#
# The expectation is I'd `hey .projects push` on one machine, then `hey
# .projects pull` on the next (then push+pull later, again).
#
# SYNOPSIS:
#   $0 backup [push|pull]

function rcp {
  rsync -azPJ \
    --include=.git/ \
    --filter=':- .gitignore' \
    --filter=":- $XDG_CONFIG_HOME/git/ignore" \
    --delete \
    --delete-after \
    "$@"
}

if ! mountpoint -q /media/nas; then
  >&2 echo "/media/nas isn't a mount point"
  exit 1
fi

local -A dst=()
dst[$HOME/.secrets/]=/media/nas/secrets/
dst[$HOME/projects/]=/media/nas/projects/

case "$1" in
  ''|push)
    hey.echo -c green "> Backing up projects to NAS..."
    for from to in ${(kv)dst}; do
      hey.do rcp "$from" "$to"
    done
    ;;
  pull)
    hey.echo -c green "> Pulling from NAS..."
    for to from in ${(kv)dst}; do
      hey.do rcp "$from" "$to"
    done
    ;;
  *)
    hey.error "Push or pull? That is the question..."
    exit 1
    ;;
esac

hey.echo -c green "✓ Done"
</file>

<file path="bin/hey">
#!/usr/bin/env janet
# A helper for common NixOS operations.
#
# I envy the user story for Guix's CLI; Nix's does not spark joy, in my humble
# opinion. This script exists to abstract my more common NixOS workflows, like
# rebuilding (nixos-rebuild), cleaning up (nix-collect-garbage), managing the
# system profile (rollback or diffing), updating flakes, and dotfile management
# (and then some).
#
# SYNOPSIS:
#   hey [-?|-??|-???|-!] [-h|--help] COMMAND [ARGS...]
#
# OPTIONS:
#   -!           -- Do a dry run. WARNING: It's up to called scripts to obey!
#   -?,-??,-???  -- Enable debug (verbose) mode.
#   -h,--help    -- Display the documentation embedded in a target script's
#                   header.
#
# COMMANDS:
#   - build|b    -- Build nix images or recompile bin/hey
#   - exec       -- Dispatch to $DOTFILES_HOME/{,hosts/$HOST,config/$WM}/bin/shim.d $PATH
#   - get|set    -- Alias for hey vars {get,set} ...
#   - gc         -- Run garbage collection on the user's/system's profile
#   - help|h     -- Display documentation for the command
#   - hook       -- Trigger scripts associated with an event
#   - host       -- Dispatch to $DOTFILES_HOME/hosts/$HOST/bin
#   - info       -- Display information about current system (JSON)
#   - path       -- Display path to area of my dotfiles
#   - profile    -- Manage or analyze a system or user nix profile
#   - pull       -- Update flake inputs
#   - reload     -- Run reload hooks
#   - repl       -- Open a Janet, Nix, or nix-develop REPL
#   - swap       -- Swap nix-store symlinks with copies (and back)
#   - sync|s     -- Rebuild this flake (using nixos-rebuild)
#   - test       -- Run Hey and/or Nix test suites
#   - which      -- Print out the script's path (with arguments) w/o executing it
#   - wm         -- Dispatch to $DOTFILES_HOME/config/$WM/bin
#   - vars       -- Get or set session or persistent state in userspace.
#   - @*         -- Dispatch to $DOTFILES_HOME/config/${1#@}/bin
#   - .*         -- Execute first script found under host, wm, or $DOTFILES_HOME/bin.

(use hey)
(use hey/cmd)

(import ./hey.d/build)
(import ./hey.d/gc)
(import ./hey.d/hook)
(import ./hey.d/info)
(import ./hey.d/ops)
(import ./hey.d/path)
(import ./hey.d/profile)
(import ./hey.d/pull)
(import ./hey.d/reload)
(import ./hey.d/repl)
(import ./hey.d/swap)
(import ./hey.d/sync)
(import ./hey.d/vars)

(defn main [_ & args]
  (dispatch [[:build :b]    (cmd 'build)
             [:get :set]    |[:eval (cmd 'vars) ;$&]
             :gc            (cmd 'gc)
             :hook          (cmd 'hook)
             :host          |[:exec (path (keyword $0) "bin") ;$&]
             :info          (cmd 'info)
             :ops           (cmd 'ops)
             :path          (cmd 'path)
             [:profile :pr] (cmd 'profile)
             :pull          (cmd 'pull)
             [:reload :re]  (cmd 'reload)
             :repl          (cmd 'repl)
             [:swap :sw]    (cmd 'swap)
             [:sync :s]     (cmd 'sync)
             :test          |[:exec "judge" (path :home "test/hey") ;(slice $& 1)]
             :theme         |[:exec (path (keyword $0) "bin") ;$&]
             :vars          (cmd 'vars)
             :wm            |[:exec (path (keyword $0) "bin") ;$&]
             :exec          |[:exec (or (path/find $1)
                                        (abort "%s: command not found" $1))
                                    ;$&]
             '(+ "./" "/")  |[:exec ;$&]
             '(* ".")       |[:exec ;(or (resolve [(path :host "bin")
                                                   (path :wm "bin")
                                                   (path :bin)]
                                                  (slice $0 1) ;$&)
                                         (abort "%s: command not found" $0))]
             '(* "@")       |[:exec (path :config (slice $0 1) :bin) ;$&]]
            ;args))
</file>

<file path="bin/lsiommu.zsh">
#!/usr/bin/env zsh
# List IOMMU groups for this system.
#
# DEPENDENCIES:
#   lspci    (pkgs.pciutils)

for d in /sys/kernel/iommu_groups/*/devices/*; do
  n=${d#*/iommu_groups/*}
  n=${n%%/*}
  printf 'IOMMU Group %s ' "$n"
  lspci -nns "${d##*/}"
done
</file>

<file path="bin/optimize.zsh">
#!/usr/bin/env zsh
# Optimize images and PDF files (losslessly by default).
#
# SYNOPSIS:
#   optimize [-lh] FILES|DIRS...
#
# EXAMPLES:
#   optimize image.jpg image.png image.gif
#   optimize directory_of_images/
#   optimize directory_of_images/*.png
#
# DEPENDENCIES:
#   bc
#   PNGs: optipng, pngquant (lossy)
#   JPGs: jpegtran, jpegoptim (lossy)
#   GIFs: gifsicle
#   PDFs: ghostscript
#
#   All absent dependencies (except for bc) are auto-installed with
#   cached-nix-shell on demand, if needed.
#
# OPTIONS:
#  -l
#    Enable lossy compression.
#  -L
#    *Only* do lossy compression.

.filesize() { stat --printf="%s" "$1"; }

hey.requires bc
zparseopts -E -D -F -- l=lossy L=lossyonly o:=outdir || exit 1
# TODO: Support -o
[[ $lossyonly ]] && lossy=( -l )
for file in $@; do
  if [[ -d $file ]]; then
    hey.log "Traversing directory: $file..."
    ${0:a} $file/*
  elif [[ -f $file ]]; then
    local pre_size=$(.filesize "$file")
    local mimetype=$(file ${file} -b --mime-type)
    hey.log "Processing file: $file ($mimetype) @ $pre_size..."
    case $mimetype in
      image/png)
        [[ $lossy ]] && hey.do -! pngquant -f --ext .png --quality 90-98 $file
        [[ $lossyonly ]] || hey.do -! optipng -nc -nb -o7 $file
        ;;
      image/gif)
        hey.do -! gifsicle --batch --optimize=3 "$file"
        ;;
      image/jpeg)
        [[ $lossy ]] && hey.do -! jpegoptim --max=90 "$file"
        [[ $lossyonly ]] || hey.do -! -p mozjpeg jpegtran -copy none -optimize -progressive -outfile "$file" "$file"
        ;;
      application/pdf)
        # Adapted from Alfred Klomp's shrinkpdf script
        # <http://alfredklomp.com/programming/shrinkpdf/>
        local dpi=72
        local compfile="${${file// /_}/.pdf/.compressed.pdf}"
        hey.requires gs
        hey.do gs -q -dNOPAUSE -dBATCH -dSAFER \
          -sDEVICE=pdfwrite \
          -dPDFSETTINGS=/ebook \
          -dCompatibilityLevel=1.4 \
          -dMonoImageResolution=$dpi \
          -dMonoImageDownsampleType=/Bicubic \
          -dGrayImageResolution=$dpi \
          -dGrayImageDownsampleType=/Bicubic \
          -dColorImageResolution=$dpi \
          -dColorImageDownsampleType=/Bicubic \
          -sOutputFile="$compfile" \
          "$file" && mv -f "$compfile" "$file"
        ;;
      *)
        hey.warn "Unrecognized file type: $mimetype"
        ;;
    esac
    local post_size=$(.filesize "$file")
    local perc=$(echo "((${pre_size} - ${post_size}) / ${pre_size}) * 100" | bc -l)
    printf "* %s: %d => %d (%.2f%% reduction)\n" "$file" "$pre_size" "$post_size" "$perc"
  fi
done
</file>

<file path="bin/qr.zsh">
#!/usr/bin/env zsh
# Create a QR code from FILE or stdin.
#
# SYNOPSIS:
#   hey .qr FILE
#   echo TEXT | hey .qr

cat $@ | hey.do -! -p libqrencode qrencode -t ansiutf8
</file>

<file path="bin/termcolors.sh">
#!/usr/bin/env dash

awk 'BEGIN{
    s="/\\/\\/\\/\\/\\"; s=s s s s s s s s;
    for (colnum = 0; colnum<77; colnum++) {
        r = 255-(colnum*255/76);
        g = (colnum*510/76);
        b = (colnum*255/76);
        if (g>255) g = 510-g;
        printf "\033[48;2;%d;%d;%dm", r,g,b;
        printf "\033[38;2;%d;%d;%dm", 255-r,255-g,255-b;
        printf "%s\033[0m", substr(s,colnum+1,1);
    }
    printf "\n";
}'
</file>

<file path="bin/when.zsh">
#!/usr/bin/env zsh
# Show the duration since/until $1 in a human readable format.
#
# For example: 4h 25m 55s. If given a file, its mtime is used.
#
# SYNOPSIS:
#   when DATETIME
#
# EXAMPLES:
#   hey .when 2005-05-15
#     -19y 23d 8hr 31min
#   hey .when 70sec
#     3hr 38min
#
# DEPENDENCIES:
#   timedatectl
#   dateadd, datediff (in nixpkgs.dateutils)

_read_arg() {
  if [[ "$1" =~ ^[a-zA-Z+-] ]]; then
    echo "$1"
  else
    # If given a file, give time since last modification
    [[ -e "$1" ]] && arg=reference || arg=date
    date --$arg="$1" +"%Y-%m-%dT%H:%M:%S"
  fi
}

_tz() {
  timedatectl show | grep Timezone= | cut -d= -f2
}

main() {
  local -a args=()
  for arg in $@; do
    args+=$(_read_arg "$arg")
  done
  if [[ $1 == [+-]* ]] || (( $# == 1 )); then
    args=( now ${args[@]} )
  fi
  if [[ ${args[2]} = [+-]* ]]; then
    dateadd --zone="$(_tz)" "${args[@]}"
  else
    result="$(hey.do -! -p dateutils datediff -f "%y:%m:%d:%H:%M" "${args[@]}")"
    parts=( ${(@s/:/)result} )
    (( parts[1] == 0 )) || echo -n "${parts[1]}y "
    (( parts[2] == 0 )) || echo -n "${parts[2]}m "
    (( parts[3] == 0 )) || echo -n "${parts[3]}d "
    (( parts[4] == 0 )) || echo -n "${parts[4]}hr "
    (( parts[5] == 0 )) || echo -n "${parts[5]}min "
    echo
  fi
}

if (( $# == 0 )); then
  hey.error -h "Time argument required"
  exit 1
fi

main $@
</file>

<file path="bin/ytdl.zsh">
#!/usr/bin/env zsh

hey.requires yt-dlp

yt-dlp --newline \
    --ignore-config \
    --no-playlist \
    -o "%(title).200s-%(id)s.%(ext)s" \
    --output-na-placeholder "NA" \
    -P ./ \
    -f bestaudio \
    --extract-audio \
    --audio-quality 0 \
    --audio-format mp3 \
    --embed-thumbnail \
    --compat-options 2022 \
    --progress-template "download:[download] downloaded_bytes:%(progress.downloaded_bytes)s ETA:%(progress.eta)s total_bytes_estimate:%(progress.total_bytes_estimate)s total_bytes:%(progress.total_bytes)s progress.speed:%(progress.speed)s filename:%(progress.filename)s" \
    "$@"
</file>

<file path="config/beets/config.yaml">
plugins: inline convert duplicates edit export fetchart lastgenre thumbnails playlist

directory: ~/music
library: ~/music/library.db
convert:
  auto: yes
  dest: ~/music/converted
paths:
  default: library/$albumartist/$album%aunique{}/$track $title
  singleton: library/Unsorted/$artist/$title
  comp: compilations/$album%aunique{}/$track $title
</file>

<file path="config/blender/config/bookmarks.txt">
[Bookmarks]
/home/hlissner/projects/assets/
/home/hlissner/projects/
!projects/3d
/home/hlissner/projects/oneshot/3d/
[Recent]
/home/hlissner/downloads/
/home/hlissner/Downloads/
/home/hlissner/projects/oneshot/3d/1903-111/
/home/hlissner/projects/assets/models/
/home/hlissner/projects/oneshot/3d/elizabeth111/
/home/hlissner/projects/assets/
</file>

<file path="config/bspwm/bin/focus">
#!/usr/bin/env bash

# Script: bspc-focus
# Author: Henrik Lissner
# Usage:
#   bspc-focus [-m] (west|south|north|east)
#   bspc-focus south
#   bspc-focus -m west
#
# Focus the next window in direction. If -m is supplied, jump to the next
# monitor in that direction.
#
# The behavior of the base 'bspc node -f' is odd when crossing screens. It will
# focus the last selected window on that screen, rather than the window on the
# connecting edge, which is unintuitive.

set -e

leap=
if [[ $1 == -m ]]; then
    leap=1; shift
fi
dir=$1
opposite=

case $dir in
  west)  opposite=east  ;;
  east)  opposite=west  ;;
  north) opposite=north ;;
  south) opposite=south ;;
  *) >&2 echo "Not a valid direction: $dir"
     exit 1
esac

if [[ -n $leap ]]; then
  # jump to monitor in direction
  bspc monitor -f "$dir"
else
  # jump to window in direction (unless at edge of last monitor)
  if ! bspc node -f "$dir.local"; then
    if [[ $(bspc query -M -m "$dir") ]]; then
      bspc monitor -f "$dir"
      # Ensure we start at the edge of the window we arrived from
      while bspc node -f "$opposite.local"; do :; done
    fi
  fi
fi
</file>

<file path="config/bspwm/bin/osd">
#!/usr/bin/env zsh
#
# An all-in-one audio, microphone, and brightness control script, tied into
# Dunst to produce slick on-screen-displays.
#
#   osd {master,capture,brightness} {toggle,up,down}

DEVICE="default"
INTERVAL="${3:-10}"
BAR_CHAR="─"
BAR_CHARMAX=47

_notify() {
    if [[ "$2" -eq 0 ]]; then
        bar=""
        rest=$(seq  -s "$BAR_CHAR" "$(( BAR_CHARMAX - 2 ))" | sed 's/[0-9]//g')
    elif [[ "$2" -eq 100 ]]; then
        bar=$(seq  -s "$BAR_CHAR" "$(( BAR_CHARMAX - 2 ))" | sed 's/[0-9]//g')
        rest=""
    else
        val="$2"
        barrem=$(echo "(1.0 - ($val / 100)) * $BAR_CHARMAX" | bc -l)
        barrem=$(echo "$barrem - 1" | bc)
        barlen=$(echo "$BAR_CHARMAX - $barrem" | bc)
        bar=$(seq  -s "$BAR_CHAR" "$barlen" | sed 's/[0-9]//g')
        rest=$(seq -s "$BAR_CHAR" "$barrem" | sed 's/[0-9]//g')
    fi
    dunstify -h string:x-dunst-stack-tag:osd \
             -h int:transient:1 \
             -u low \
             -i "$1" \
             -h "int:value:$2" \
             --timeout=1750 \
             -r 2593 \
             -- "$3" "<tt>${bar}<span foreground=\"#5B6268\">${rest}</span></tt>"
}


__error() {
    >&2 echo "$1"
    exit 1
}

__adjust_audio() {
    case "$2" in
        up)     amixer -D "$DEVICE" set "$1" "${INTERVAL}%+" unmute ;;
        down)   amixer -D "$DEVICE" set "$1" "${INTERVAL}%-" unmute ;;
        toggle) amixer -D "$DEVICE" set "$1" toggle ;;
        *)    __error "Invalid $1 command: $2" ;;
    esac

    label=
    case "$1" in
      Master)  iconPrefix="volume-level" ;;
      Capture) iconPrefix="microphone-sensitivity" ;;
    esac
    # Is default device muted now?
    if amixer sget "$1" | grep '%' | grep -oE '[^ ]+$' | grep '\[off\]' >/dev/null; then
        _notify "${iconPrefix}-muted" 0 "$label"
    else
        volume=$(amixer sget "$1" | grep 'Right:' | awk -F'[][]' '{ print $2 }' | tr -d "%")
        if [ "$volume" -le 1 ]; then
            _notify "${iconPrefix}-muted" 0 "$label"
        elif [ "$volume" -le 20 ]; then
            _notify "${iconPrefix}-low" "$volume" "$label"
        elif [ "$volume" -le 60 ]; then
            _notify "${iconPrefix}-medium" "$volume" "$label"
        else
            _notify "${iconPrefix}-high" "$volume" "$label"
        fi
    fi
}


_adjust_master()  { __adjust_audio Master "$1" "$2"; }

_adjust_capture() { __adjust_audio Capture "$1" "$2"; }

_adjust_brightness() {
    case "$1" in
        up)   light -A "$INTERVAL" ;;
        down) light -U "$INTERVAL" ;;
        *) __error "Invalid brightness command: $1" ;;
    esac
    level="$(light)"
    iconPrefix="notification-display-brightness"
    icon="${iconPrefix}-full"
    if [ "$level" -le 1 ]; then
        icon="${iconPrefix}-off"
    elif [ "$level" -le 20 ]; then
        icon="${iconPrefix}-low"
    elif [ "$level" -le 60 ]; then
        icon="${iconPrefix}-medium"
    fi
    _notify "$icon" "$level" "LCD"
}

case $1 in
    master|capture|brightness) "_adjust_$1" "$2" ;;
    *) __error "Invalid command: $1" ;;
esac
</file>

<file path="config/bspwm/bin/presel">
#!/usr/bin/env cached-nix-shell
#! nix-shell -i zsh -p jshon

# Script: bspc-presel
# Author: Henrik Lissner
# Usage:
#   bspc-presel RATIO
#   bspc-presel 0.2
#
# Wrote this to invert the ratio on east/south-bound preselections. In English
# that means bspc node -p 0.2 should resize the preselection to 20%, whether or
# not it's on the west or east side of the window (or north or south side),
# which isn't the case by default.
#
# NOTE: We use zsh for this because bash chokes on float arithmetic.

ratio="$1"
case "$(bspc query -T -n focused | jshon -e presel -e splitDir | tr -d \")" in
  west|north) bspc node -o $ratio ;;
  east|south) bspc node -o $(( 1.0 - ratio )) ;;
esac
</file>

<file path="config/bspwm/bin/resize">
#!/usr/bin/env bash

direction="$1"
sense="$2"
increment="${3:-20}"
if [ "$sense" = "+" ]; then
	countersense="-"
else
	countersense="+"
fi

# First we try to resize using the bottom/right borders. If this fails (e.g.
# tiled) we fall back to top/left.
if [ "$direction" = "x" ]; then
	bspc node --resize "right" "${sense}${increment}" "0" ||
	bspc node --resize "left" "${countersense}${increment}" "0"
else
	bspc node --resize "bottom" "0" "${sense}${increment}" ||
	bspc node --resize "top" "0" "${countersense}${increment}"
fi
</file>

<file path="config/bspwm/bin/subtract-presel">
#!/usr/bin/env cached-nix-shell
#! nix-shell -i zsh -p jshon wmutils-core

# Script: bspc-subtract-presel
# Author: Henrik Lissner (w/ credit to @Chrysostomus)
# Usage:
#   bspc-resize-to-presel
#
# (Adapted from Chrysostomus/bspwm-scripts/bin/resizetopresel.sh)
#
# This script resizes the current window by "subtracting" the bspwm preselection
# on the current node. In English, that means this will reduce the window's
# width by 20%:
#
#   bspc node -p east -o 0.2 && bspc-subtract-presel
#
# NOTE: We use zsh for this because bash chokes on float arithmetic.

# Check if the brother node is a receptacle
if [[ $(bspc query -T -n @brother/ | jshon -e client) = null ]]; then
  # Yep, it's a receptacle. Get the real dimensions
  eval $(grep "window_gap" ~/.config/bspwm/rc.d/theme | tr -cd [0-9])
  # Get orientation
  wattr xywh $(pfw) | read focused_x focused_y focused_width focused_height
  receptacle_y=$(bspc query -T -n @brother/ | jshon -e rectangle -e y)
  if [[ "$focused_y" -eq "$receptacle_y" ]]; then
    receptacle_width=$(bspc query -T -n @brother/ | jshon -e rectangle -e width)
    receptacle_x=$(bspc query -T -n @brother/ | jshon -e rectangle -e x)
    # receptacle and window have the same height, so they are side by side
    if [[ receptacle_x -gt focused_x ]]; then
      echo "receptacle is right of the window"
      # get the true window dimension
      true_dim=$(( receptacle_width + gap ))
      # kill the repectacle
      for i in $(bspc query -N -n .leaf.!window.local); do bspc node $i -k; done
      # resize the window
      bspc node @east -r -$true_dim || bspc node @west -r +$true_dim
    else
        echo "receptacle is left of the window"
        # get the true window dimension
        true_dim=$(( receptacle_width + gap ))
        # kill the repectacle
        for i in $(bspc query -N -n .leaf.!window.local); do bspc node $i -k; done
        # resize the window
        bspc node @west -r +$true_dim || bspc node @east -r -$true_dim
    fi
  else
      receptacle_height=$(bspc query -T -n @brother/ | jshon -e rectangle -e height)
      # width is necessarily equal if height is not, because the nodes are
      # brothers Window are on the top of each other
      if [[ receptacle_y -gt focused_y ]]; then
        echo "receptacle is below the window"
        # get the true window dimension
        true_dim=$(( receptacle_height + gap))
        # kill the repectacle
        for i in $(bspc query -N -n .leaf.!window.local); do bspc node $i -k; done
        # resize the window
        bspc node @south -r -$true_dim || bspc node @north -r +$true_dim
      else
          echo "receptacle is above the window"
          # get the true window dimension
          true_dim=$(( receptacle_height + gap))
          # kill the repectacle
          for i in $(bspc query -N -n .leaf.!window.local); do bspc node $i -k; done
          # resize the window
          bspc node @north -r +$true_dim || bspc node @south -r -$true_dim
      fi
  fi
  echo $true_dim
  exit 0
fi

# If the focused window is not preselected, do nothing
[[ "$(bspc query -T -n focused | jshon -e presel)" == null ]] && exit 0

dir=$(bspc query -T -n focused | jshon -e presel -e splitDir | tr -d \")
ratio=$(bspc query -T -n focused | jshon -e presel -e splitRatio)
case "$dir" in
  west)
    cur=$(bspc query -T -n focused | jshon -e rectangle -e width)
    bspc node @west -r +$((${cur}*${ratio})) || \
        bspc node @east -r -$((${cur}*${ratio}))
    ;;
  east)
    cur=$(bspc query -T -n focused | jshon -e rectangle -e width)
    bspc node @east -r -$((${cur}*(1.0-${ratio}))) || \
        bspc node @west -r +$((${cur}*${ratio}))
    ;;

  north)
    cur=$(bspc query -T -n focused | jshon -e rectangle -e height)
    bspc node @north -r +$((${cur}*${ratio})) || \
        bspc node @south -r -$((${cur}*${ratio}))
    ;;
  south)
    cur=$(bspc query -T -n focused | jshon -e rectangle -e height)
    bspc node @south -r -$(( ${cur} * (1.0 - ${ratio}) )) || \
        bspc node @north -r +$(( ${cur} * ${ratio} ))
esac

bspc node -p cancel
</file>

<file path="config/bspwm/bin/swap">
#!/usr/bin/env bash

# Script: bspc-swap
# Author: Henrik Lissner
# Usage:
#   bspc-swap [-m] (west|south|north|east)
#   bspc-swap south
#   bspc-swap -m west
#
# Swaps current window with the window in a direction. If -m is set, move window
# to the next monitor in that direction.
#
# The behavior of the base 'bspc node -s' is odd when crossing screens. It will
# swaps with the last selected window on that screen, rather than the window on
# the connecting edge, which is unintuitive.

set -e

leap=
if [[ $1 == -m ]]; then
    leap=1
    dir=$2
else
    dir=$1
fi

case $dir in west|south|north|east) ;;
    *) >&2 echo "Not a valid direction: $dir"
        exit 1
esac

if [[ -n $leap ]]; then
    # move window to monitor in direction
    old_id=$(bspc query -N -n focused)
    if [[ $(bspc query -M -m "$dir") ]]; then
        bspc node -m "$dir"
        bspc node -f "$old_id"
    fi
else
    # move window in direction
    old_id=$(bspc query -N -n focused)
    if bspc node -s "$dir.local"; then
        bspc node -f "$old_id"
    elif [[ -n $(bspc query -M -m "$dir") ]]; then
        bspc node -m "$dir"
        bspc node -f "$old_id"
    fi
fi
</file>

<file path="config/bspwm/bin/xst-scratch">
#!/usr/bin/env bash
#
# Toggle a scratch terminal window. A scratch terminal is a disposable terminal
# for one-off, quick commands that don't warrant a dedicated terminal. However,
# tmux is used so that these scratch sessions persist until they are explicitly
# killed.
#
# Requires: xst, xdotool, tmux

SCRID=xst-scratch
focused=$(xdotool getactivewindow)
scratch=$(xdotool search --onlyvisible --classname $SCRID)
if [[ -n $scratch ]]; then
  if [[ $focused == $scratch ]]; then
    xdotool windowkill $scratch
  else
    xdotool windowactivate $scratch
  fi
else
  tmux new-session -d -s scratch -n "${1:-scratch}" $@
  tmux setw -t scratch automatic-rename off
  xst -t $SCRID -n $SCRID -c $SCRID \
      -f "$(xrdb -get st.scratch.font)" \
      -- tmux attach-session -t scratch
fi
</file>

<file path="config/bspwm/hooks/idle.zsh">
#!/usr/bin/env zsh
# React to various idle states.
#
# SYNOPSIS:
#   on-idle [--dim|--dpms|--lock|--sleep|--resume]
#
# SYNOPSIS:
#   Triggered when there's a change in idle state, by tools like hypridle,
#   swayidle, etc.

case $1 in
  --dim|'')
    sleep 0.2
    if (( $+commands[brightnessctl] )); then
      brightnessctl -m -s set 10
    else
      # A poor-man's dimmer, for non-laptops.
      # TODO
    fi
    ;;

  --dpms)
    sleep 0.2
    xset dpms force off
    ;;

  --lock)
    loginctl lock-session
    ;;

  --sleep)
    systemctl suspend
    ;;

  --resume)
    if (( $+commands[brightnessctl] )); then
      brightnessctl -m -r
    else
      # TODO
    fi
    sleep 1
    xset dpms force on
    ;;
esac
</file>

<file path="config/bspwm/hooks/reload.zsh">
#!/usr/bin/env zsh
# reload
#
# TODO

bspc wm -r
. $XDG_CONFIG_HOME/bspwm/bspwmrc

gpgconf --kill gpg-agent
</file>

<file path="config/bspwm/bspwmrc">
#!/usr/bin/env bash

MONITORS=( $(xrandr --listactivemonitors | grep -E '^ [0-9]+:' | cut -d' ' -f6 | sed 's/\n/ /') )
MONITOR="${MONITOR:-${MONITORS[0]}}"

# Only have workspaces for primary monitor
bspc monitor $MONITOR -d {1,2,3,4,5}
for mon in ${MONITORS[@]:1}; do
  bspc monitor $mon -d 0
done

bspc config remove_disabled_monitors true
bspc config remove_unplugged_monitors true


# Rules
bspc rule -r '*'

bspc rule -a 'polybar' layer=above
bspc rule -a Pinentry state=floating center=on
bspc rule -a Emacs split_ratio=0.28 state=tiled
bspc rule -a Firefox split_ratio=0.32
bspc rule -a Librewolf split_ratio=0.32
bspc rule -a feh state=fullscreen
bspc rule -a 'Emacs:org*' state=floating
bspc rule -a 'Emacs:scratch' state=floating
bspc rule -a 'Emacs:emacs-everywhere' state=floating sticky=on
bspc rule -a '*:xst-scratch' state=floating sticky=on border=off rectangle=2560x480+0+50 monitor=primary

export MONITOR="$MONITOR"
for file in $XDG_CONFIG_HOME/bspwm/rc.d/*; do
  source "$file"
done
</file>

<file path="config/docker/aliases.zsh">
alias dk=docker
alias dkc=docker-compose
alias dkm=docker-machine
alias dkl='dk logs'
alias dkcl='dkc logs'

dkclr() {
  dk stop $(docker ps -a -q)
  dk rm $(docker ps -a -q)
}

dke() {
  dk exec -it "$1" "${@:1}"
}
</file>

<file path="config/emacs/aliases.zsh">
#!/usr/bin/env zsh

e()     { pgrep emacs && emacsclient -n "$@" || emacs -nw "$@" }
ediff() { emacs -nw --eval "(ediff-files \"$1\" \"$2\")"; }
eman()  { emacs -nw --eval "(switch-to-buffer (man \"$1\"))"; }
ekill() { emacsclient --eval '(kill-emacs)'; }
</file>

<file path="config/foot/foot.ini">
# config/foot/foot.ini
# Comon settings for the foot terminal. Additional settings are set by themes.

[main]
notify=notify-send -a ${app-id} -i ${app-id} ${title} ${body}

[scrollback]
lines=10000

[key-bindings]
</file>

<file path="config/gimp/menurc">
; gimp-2.10 GtkAccelMap rc-file         -*- scheme -*-
; this file is an automated accelerator map dump
;
; (gtk_accel_path "<Actions>/file/file-menu" "")
; (gtk_accel_path "<Actions>/tools/tools-opacity-set-to-default" "")
; (gtk_accel_path "<Actions>/context/context-background-value-decrease" "")
; (gtk_accel_path "<Actions>/vectors/vectors-color-tag-brown" "")
; (gtk_accel_path "<Actions>/tools/tools-opacity-increase-skip" "<Primary>greater")
(gtk_accel_path "<Actions>/tools/tools-vector" "p")
; (gtk_accel_path "<Actions>/view/view-scroll-left" "")
; (gtk_accel_path "<Actions>/vectors/vectors-color-tag-orange" "")
; (gtk_accel_path "<Actions>/tools/tools-airbrush-rate-increase" "")
; (gtk_accel_path "<Actions>/tools/tools-spacing-set-to-default" "")
; (gtk_accel_path "<Actions>/view/view-show-statusbar" "")
; (gtk_accel_path "<Actions>/layers/layers-opacity-transparent" "")
; (gtk_accel_path "<Actions>/image/image-convert-u8" "")
; (gtk_accel_path "<Actions>/view/view-zoom-8-1-accel" "KP_4")
; (gtk_accel_path "<Actions>/context/context-background-value-set" "")
; (gtk_accel_path "<Actions>/context/context-paint-mode-menu" "")
; (gtk_accel_path "<Actions>/filters/filters-motion-blur-linear" "")
; (gtk_accel_path "<Actions>/filters/filters-gegl-graph" "")
; (gtk_accel_path "<Actions>/context/context-brush-select-set" "")
; (gtk_accel_path "<Actions>/edit/edit-copy" "<Primary>c")
; (gtk_accel_path "<Actions>/context/context-brush-shape-circle" "")
; (gtk_accel_path "<Actions>/windows/windows-display-0001" "")
(gtk_accel_path "<Actions>/plug-in/plug_in_bump_map" "<Primary><Shift>m")
; (gtk_accel_path "<Actions>/vectors/vectors-lock-content" "")
; (gtk_accel_path "<Actions>/context/context-opacity-opaque" "")
; (gtk_accel_path "<Actions>/view/view-color-management-menu" "")
; (gtk_accel_path "<Actions>/filters/filters-spherize" "")
; (gtk_accel_path "<Actions>/channels/channels-new-last-values" "")
; (gtk_accel_path "<Actions>/vectors/vectors-merge-visible" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-spheredesigner" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-slide" "")
; (gtk_accel_path "<Actions>/filters/filters-curves" "")
; (gtk_accel_path "<Actions>/channels/channels-lock-position" "")
; (gtk_accel_path "<Actions>/context/context-brush-menu" "")
; (gtk_accel_path "<Actions>/context/context-foreground-blue-decrease" "")
; (gtk_accel_path "<Actions>/context/context-colors-menu" "")
; (gtk_accel_path "<Actions>/edit/edit-undo-clear" "")
; (gtk_accel_path "<Actions>/context/context-gradient-select-first" "")
; (gtk_accel_path "<Actions>/layers/layers-color-tag-brown" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-imagemap" "")
; (gtk_accel_path "<Actions>/filters/filters-recent-menu" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-map-object" "")
; (gtk_accel_path "<Actions>/layers/layers-text-along-vectors" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-symmetry" "")
; (gtk_accel_path "<Actions>/view/view-zoom-revert" "grave")
; (gtk_accel_path "<Actions>/plug-in/plug-in-script-fu-console" "")
; (gtk_accel_path "<Actions>/filters/filters-plasma" "")
; (gtk_accel_path "<Actions>/view/view-color-management-enable" "")
(gtk_accel_path "<Actions>/dialogs/dialogs-undo-history" "<Shift>F9")
; (gtk_accel_path "<Actions>/edit/edit-cut" "<Primary>x")
; (gtk_accel_path "<Actions>/context/context-foreground-value-increase-skip" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-addborder" "")
; (gtk_accel_path "<Actions>/view/view-display-intent-absolute-colorimetric" "")
; (gtk_accel_path "<Actions>/file/file-export-to" "")
; (gtk_accel_path "<Actions>/vectors/vectors-color-tag-menu" "")
; (gtk_accel_path "<Actions>/context/context-background-red-decrease" "")
; (gtk_accel_path "<Actions>/tools/tools-airbrush-rate-maximum" "")
; (gtk_accel_path "<Actions>/tools/tools-operation" "")
; (gtk_accel_path "<Actions>/view/view-fullscreen" "F11")
; (gtk_accel_path "<Actions>/tools/tools-spacing-minimum" "")
; (gtk_accel_path "<Actions>/context/context-brush-radius-decrease-skip" "")
; (gtk_accel_path "<Actions>/view/view-zoom-2-1" "2")
(gtk_accel_path "<Actions>/dialogs/dialogs-brushes" "")
; (gtk_accel_path "<Actions>/context/context-foreground-blue-maximum" "")
; (gtk_accel_path "<Actions>/context/context-foreground-red-increase" "")
; (gtk_accel_path "<Actions>/view/view-snap-to-vectors" "")
(gtk_accel_path "<Actions>/image/image-properties" "F8")
; (gtk_accel_path "<Actions>/drawable/drawable-rotate-270" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-predator" "")
; (gtk_accel_path "<Actions>/tools/tools-hardness-increase-percent" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-colorify" "")
(gtk_accel_path "<Actions>/view/view-show-grid" "<Primary><Alt>apostrophe")
; (gtk_accel_path "<Actions>/image/image-color-management-enabled" "")
; (gtk_accel_path "<Actions>/tools/tools-angle-increase" "")
; (gtk_accel_path "<Actions>/vectors/vectors-color-tag-violet" "")
; (gtk_accel_path "<Actions>/context/context-background-saturation-decrease-skip" "")
; (gtk_accel_path "<Actions>/layers/layers-composite-mode-union" "")
; (gtk_accel_path "<Actions>/channels/channels-color-tag-blue" "")
; (gtk_accel_path "<Actions>/windows/windows-dialogs-menu" "")
; (gtk_accel_path "<Actions>/tools/tools-gegl" "")
; (gtk_accel_path "<Actions>/tool-options/tool-options-reset" "")
; (gtk_accel_path "<Actions>/layers/layers-delete" "")
; (gtk_accel_path "<Actions>/view/view-display-intent-menu" "")
; (gtk_accel_path "<Actions>/vectors/vectors-edit" "")
; (gtk_accel_path "<Actions>/filters/filters-illusion" "")
; (gtk_accel_path "<Actions>/context/context-colormap-foreground-previous" "")
; (gtk_accel_path "<Actions>/layers/layers-lock-content" "")
; (gtk_accel_path "<Actions>/file/file-create-menu" "")
(gtk_accel_path "<Actions>/plug-in/plug_in_iwarp" "<Primary><Shift>x")
; (gtk_accel_path "<Actions>/tools/tools-spacing-decrease-skip" "")
; (gtk_accel_path "<Actions>/filters/filters-dropshadow" "")
; (gtk_accel_path "<Actions>/layers/layers-alpha-selection-add" "")
; (gtk_accel_path "<Actions>/context/context-background-green-increase" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-make-brush-rectangular-feathered" "")
; (gtk_accel_path "<Actions>/patterns/patterns-delete" "")
; (gtk_accel_path "<Actions>/context/context-brush-radius-menu" "")
(gtk_accel_path "<Actions>/view/view-scroll-page-right" "<Primary>Page_Down")
; (gtk_accel_path "<Actions>/layers/layers-blend-space-menu" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-histogram" "")
; (gtk_accel_path "<Actions>/layers/layers-opacity-opaque" "")
; (gtk_accel_path "<Actions>/context/context-background-saturation-increase" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-dynamics-editor" "")
; (gtk_accel_path "<Actions>/layers/layers-composite-space-menu" "")
(gtk_accel_path "<Actions>/file/file-revert" "F12")
; (gtk_accel_path "<Actions>/filters/filters-fattal-2002" "")
; (gtk_accel_path "<Actions>/tools/tools-color-average-radius-set" "")
; (gtk_accel_path "<Actions>/filters/filters-distorts-menu" "")
(gtk_accel_path "<Actions>/tools/tools-fuzzy-select" "w")
; (gtk_accel_path "<Actions>/documents/documents-reload-previews" "")
; (gtk_accel_path "<Actions>/debug/debug-show-image-graph" "")
; (gtk_accel_path "<Actions>/brushes/brushes-show-in-file-manager" "")
; (gtk_accel_path "<Actions>/context/context-brush-angle-maximum" "")
; (gtk_accel_path "<Actions>/view/view-zoom-selection" "")
(gtk_accel_path "<Actions>/tools/tools-cage" "")
; (gtk_accel_path "<Actions>/file/file-open-location" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-blur" "")
; (gtk_accel_path "<Actions>/layers/layers-opacity-decrease" "")
; (gtk_accel_path "<Actions>/context/context-foreground-hue-decrease-skip" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-oilify" "")
(gtk_accel_path "<Actions>/layers/layers-mask-add" "<Alt>o")
; (gtk_accel_path "<Actions>/filters/filters-diffraction-patterns" "")
; (gtk_accel_path "<Actions>/image/image-convert-rgb" "")
; (gtk_accel_path "<Actions>/tools/tools-spacing-decrease-percent" "")
; (gtk_accel_path "<Actions>/context/context-gradient-select-last" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-emboss" "")
; (gtk_accel_path "<Actions>/file/file-create-template" "")
; (gtk_accel_path "<Actions>/vectors/vectors-color-tag-yellow" "")
; (gtk_accel_path "<Actions>/layers/layers-preserve-transparency" "")
; (gtk_accel_path "<Actions>/dockable/dockable-view-type-grid" "")
; (gtk_accel_path "<Actions>/view/view-navigation-window" "")
; (gtk_accel_path "<Actions>/windows/windows-tabs-position-bottom" "")
; (gtk_accel_path "<Actions>/context/context-brush-angle-set" "")
; (gtk_accel_path "<Actions>/documents/documents-raise-or-open" "")
; (gtk_accel_path "<Actions>/context/context-background-blue-decrease" "")
; (gtk_accel_path "<Actions>/context/context-foreground-green-set" "")
(gtk_accel_path "<Actions>/tools/tools-levels" "<Primary>l")
; (gtk_accel_path "<Actions>/plug-in/plug-in-script-fu-server" "")
; (gtk_accel_path "<Actions>/dock/dock-move-to-screen-menu" "")
; (gtk_accel_path "<Actions>/windows/windows-tabs-position-right" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-line-nova" "")
; (gtk_accel_path "<Actions>/layers/layers-color-tag-blue" "")
; (gtk_accel_path "<Actions>/tools/tools-object-1-set" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-indexed-palette" "")
; (gtk_accel_path "<Actions>/channels/channels-new" "")
; (gtk_accel_path "<Actions>/edit/edit-named-paste" "")
; (gtk_accel_path "<Actions>/tools/tools-hardness-minimum" "")
; (gtk_accel_path "<Actions>/plug-in/color-decode-ycocg" "")
; (gtk_accel_path "<Actions>/filters/filters-menu" "")
; (gtk_accel_path "<Actions>/tools/tools-opacity-set" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-toolbox" "<Primary>b")
; (gtk_accel_path "<Actions>/plug-in/gimp-help-using-fileformats" "")
; (gtk_accel_path "<Actions>/edit/edit-strong-redo" "<Primary><Shift>y")
; (gtk_accel_path "<Actions>/filters/filters-alien-map" "")
; (gtk_accel_path "<Actions>/plug-in/gimp-online-bugs-features" "")
; (gtk_accel_path "<Actions>/tools/tools-object-2-last" "")
; (gtk_accel_path "<Actions>/tools/tools-paintbrush-force-set" "")
; (gtk_accel_path "<Actions>/vectors/vectors-linked" "")
; (gtk_accel_path "<Actions>/filters/filters-gaussian-blur-selective" "")
; (gtk_accel_path "<Actions>/filters/filters-unsharp-mask" "")
; (gtk_accel_path "<Actions>/fonts/fonts-refresh" "")
; (gtk_accel_path "<Actions>/file/file-open-recent-menu" "")
; (gtk_accel_path "<Actions>/tools/tools-hardness-decrease" "")
; (gtk_accel_path "<Actions>/layers/layers-mask-show" "")
; (gtk_accel_path "<Actions>/view/view-softproof-intent-absolute-colorimetric" "")
; (gtk_accel_path "<Actions>/brushes/brushes-open-as-image" "")
; (gtk_accel_path "<Actions>/plug-in/python-fu-palette-offset" "")
; (gtk_accel_path "<Actions>/tools/tools-angle-decrease" "")
; (gtk_accel_path "<Actions>/context/context-background-blue-set" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-normalize" "")
; (gtk_accel_path "<Actions>/tools/tools-opacity-increase-percent" "")
; (gtk_accel_path "<Actions>/context/context-background-value-decrease-skip" "")
; (gtk_accel_path "<Actions>/patterns/patterns-new" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-spinning-globe" "")
; (gtk_accel_path "<Actions>/windows/windows-menu" "")
; (gtk_accel_path "<Actions>/tools/tools-object-1-first" "")
; (gtk_accel_path "<Actions>/image/image-flip-horizontal" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-sharpen" "")
; (gtk_accel_path "<Actions>/tools/tools-force-decrease-percent" "")
; (gtk_accel_path "<Actions>/context/context-brush-hardness-set" "")
; (gtk_accel_path "<Actions>/select/select-stroke-last-values" "")
; (gtk_accel_path "<Actions>/filters/filters-long-shadow" "")
; (gtk_accel_path "<Actions>/context/context-brush-radius-increase-percent" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-animationoptimize-diff" "")
; (gtk_accel_path "<Actions>/tools/tools-perspective-clone" "")
; (gtk_accel_path "<Actions>/image/colors-auto-menu" "")
; (gtk_accel_path "<Actions>/vectors/vectors-selection-to-vectors-advanced" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-unsharp-mask" "")
; (gtk_accel_path "<Actions>/context/context-background-saturation-decrease" "")
(gtk_accel_path "<Actions>/tools/tools-rect-select" "m")
; (gtk_accel_path "<Actions>/tools/tools-angle-set-to-default" "")
; (gtk_accel_path "<Actions>/view/view-zoom-in-skip" "")
; (gtk_accel_path "<Actions>/filters/filters-semi-flatten" "")
; (gtk_accel_path "<Actions>/tools/tools-opacity-maximum" "")
; (gtk_accel_path "<Actions>/dockable/dockable-tab-style-preview-name" "")
; (gtk_accel_path "<Actions>/plug-in/python-fu-palette-sort" "")
; (gtk_accel_path "<Actions>/tools/tools-airbrush-flow-decrease" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-dog" "")
; (gtk_accel_path "<Actions>/edit/edit-paste-as-new-layer" "")
; (gtk_accel_path "<Actions>/channels/channels-visible" "")
; (gtk_accel_path "<Actions>/debug/debug-mem-profile" "")
; (gtk_accel_path "<Actions>/context/context-foreground-hue-maximum" "")
; (gtk_accel_path "<Actions>/tool-options/tool-options-restore-preset-menu" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-undo-history" "")
; (gtk_accel_path "<Actions>/tools/tools-paintbrush-hardness-set" "")
; (gtk_accel_path "<Actions>/filters/filters-stretch-contrast" "")
; (gtk_accel_path "<Actions>/filters/filters-color-to-alpha" "")
; (gtk_accel_path "<Actions>/context/context-brush-aspect-maximum" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-templates" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-ripply-anim" "")
(gtk_accel_path "<Actions>/view/view-show-menubar" "<Shift>f")
; (gtk_accel_path "<Actions>/filters/filters-web-menu" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-cursor" "")
; (gtk_accel_path "<Actions>/filters/filters-exposure" "")
; (gtk_accel_path "<Actions>/tools/tools-spacing-increase" "")
; (gtk_accel_path "<Actions>/tools/tools-foreground-select-brush-size-set" "")
; (gtk_accel_path "<Actions>/context/context-background-hue-decrease-skip" "")
; (gtk_accel_path "<Actions>/select/select-shrink" "")
; (gtk_accel_path "<Actions>/view/view-scroll-horizontal" "")
; (gtk_accel_path "<Actions>/select/select-fill-last-values" "")
; (gtk_accel_path "<Actions>/image/image-resize-to-selection" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-tile-blur" "")
; (gtk_accel_path "<Actions>/filters/filters-color-temperature" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-paste-as-pattern" "")
; (gtk_accel_path "<Actions>/tools/tools-paintbrush-aspect-ratio-set" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-gfig" "")
; (gtk_accel_path "<Actions>/context/context-foreground-hue-set" "")
; (gtk_accel_path "<Actions>/tools/tools-gradient" "g")
(gtk_accel_path "<Actions>/select/select-none" "<Primary>d")
; (gtk_accel_path "<Actions>/edit/edit-named-cut" "")
; (gtk_accel_path "<Actions>/context/context-palette-select-set" "")
; (gtk_accel_path "<Actions>/channels/channels-select-next" "")
; (gtk_accel_path "<Actions>/image/image-precision-menu" "")
; (gtk_accel_path "<Actions>/layers/layers-mask-menu" "")
(gtk_accel_path "<Actions>/layers/layers-alpha-selection-replace" "<Alt>a")
; (gtk_accel_path "<Actions>/plug-in/gimp-palette-export-php" "")
; (gtk_accel_path "<Actions>/filters/filters-noise-hsv" "")
; (gtk_accel_path "<Actions>/filters/filters-noise-simplex" "")
; (gtk_accel_path "<Actions>/help/help-help" "F1")
; (gtk_accel_path "<Actions>/context/context-opacity-increase-skip" "")
; (gtk_accel_path "<Actions>/view/view-padding-color-light-check" "")
; (gtk_accel_path "<Actions>/context/context-brush-spikes-minimum" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-gflare" "")
; (gtk_accel_path "<Actions>/context/context-brush-aspect-set" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-zealouscrop" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-gradient-editor" "")
; (gtk_accel_path "<Actions>/tools/tools-color-menu" "")
; (gtk_accel_path "<Actions>/tools/tools-airbrush-flow-maximum" "")
; (gtk_accel_path "<Actions>/view/view-flip-horizontally" "")
; (gtk_accel_path "<Actions>/layers/layers-composite-mode-auto" "")
; (gtk_accel_path "<Actions>/plug-in/gimp-online-developer-web-site" "")
; (gtk_accel_path "<Actions>/dockable/dockable-tab-style-name" "")
(gtk_accel_path "<Actions>/plug-in/plug_in_gauss" "<Primary><Shift>b")
; (gtk_accel_path "<Actions>/vectors/vectors-raise-to-top" "")
(gtk_accel_path "<Actions>/view/view-scroll-page-left" "<Primary>Page_Up")
; (gtk_accel_path "<Actions>/tools/tools-threshold" "")
; (gtk_accel_path "<Actions>/filters/filters-threshold" "")
; (gtk_accel_path "<Actions>/tools/tools-airbrush-flow-set" "")
; (gtk_accel_path "<Actions>/context/context-brush-spacing-minimum" "")
(gtk_accel_path "<Actions>/drawable/drawable-invert" "<Primary>i")
(gtk_accel_path "<Actions>/layers/layers-select-bottom" "<Alt>braceleft")
; (gtk_accel_path "<Actions>/dockable/dockable-tab-style-preview" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-channels" "")
; (gtk_accel_path "<Actions>/channels/channels-color-tag-none" "")
(gtk_accel_path "<Actions>/tools/tools-paintbrush" "b")
; (gtk_accel_path "<Actions>/vectors/vectors-color-tag-gray" "")
; (gtk_accel_path "<Actions>/context/context-brush-spacing-increase-skip" "")
; (gtk_accel_path "<Actions>/vectors/vectors-stroke-last-values" "")
; (gtk_accel_path "<Actions>/view/view-show-sample-points" "")
; (gtk_accel_path "<Actions>/documents/documents-remove" "")
; (gtk_accel_path "<Actions>/dockable/dockable-preview-size-medium" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-colors" "")
; (gtk_accel_path "<Actions>/filters/filters-antialias" "")
; (gtk_accel_path "<Actions>/debug/debug-benchmark-projection" "")
; (gtk_accel_path "<Actions>/context/context-brush-spikes-decrease" "")
; (gtk_accel_path "<Actions>/filters/filters-noise-hurl" "")
; (gtk_accel_path "<Actions>/file/file-save-and-close" "")
(gtk_accel_path "<Actions>/dialogs/dialogs-document-history" "<Primary><Shift>h")
; (gtk_accel_path "<Actions>/context/context-opacity-set" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-blend-anim" "")
(gtk_accel_path "<Actions>/view/view-zoom-in" "<Primary>equal")
; (gtk_accel_path "<Actions>/plug-in/plug-in-smooth-palette" "")
; (gtk_accel_path "<Actions>/context/context-swatch-background-set" "")
; (gtk_accel_path "<Actions>/windows/windows-tab-position" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-error-console" "")
; (gtk_accel_path "<Actions>/view/view-rotate-15" "")
; (gtk_accel_path "<Actions>/view/view-zoom" "")
; (gtk_accel_path "<Actions>/view/view-scroll-top-border" "")
; (gtk_accel_path "<Actions>/layers/layers-new" "<Primary><Shift>n")
; (gtk_accel_path "<Actions>/plug-in/gimp-palette-export-java" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-burn-in-anim" "")
; (gtk_accel_path "<Actions>/context/context-foreground-blue-increase-skip" "")
; (gtk_accel_path "<Actions>/tools/tools-paint-menu" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-colormap-swap" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-mypaint-brushes" "")
; (gtk_accel_path "<Actions>/dockable/dockable-preview-size-menu" "")
; (gtk_accel_path "<Actions>/image/colors-menu" "")
; (gtk_accel_path "<Actions>/vectors/vectors-visible" "")
; (gtk_accel_path "<Actions>/vectors/vectors-lock-position" "")
(gtk_accel_path "<Actions>/image/image-flatten" "<Shift>i")
; (gtk_accel_path "<Actions>/tools/tools-spacing-decrease" "")
; (gtk_accel_path "<Actions>/filters/filters-dither" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-decompose-registered" "")
; (gtk_accel_path "<Actions>/channels/channels-selection-intersect" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-cartoon" "")
; (gtk_accel_path "<Actions>/view/view-softproof-intent-perceptual" "")
; (gtk_accel_path "<Actions>/tools/tools-offset" "")
(gtk_accel_path "<Actions>/edit/edit-clear" "")
; (gtk_accel_path "<Actions>/image/image-convert-float" "")
; (gtk_accel_path "<Actions>/view/view-scroll-down" "")
; (gtk_accel_path "<Actions>/context/context-foreground-green-increase" "")
; (gtk_accel_path "<Actions>/color-button/color-button-use-white" "")
; (gtk_accel_path "<Actions>/image/image-scale" "")
; (gtk_accel_path "<Actions>/tools/tools-aspect-increase-skip" "")
; (gtk_accel_path "<Actions>/context/context-colormap-background-previous" "")
; (gtk_accel_path "<Actions>/image/colors-info-menu" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-lic" "")
; (gtk_accel_path "<Actions>/context/context-background-value-increase" "")
(gtk_accel_path "<Actions>/dialogs/dialogs-channels" "<Shift>F7")
; (gtk_accel_path "<Actions>/filters/filters-component-extract" "")
; (gtk_accel_path "<Actions>/tools/tools-size-maximum" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-dashboard" "")
; (gtk_accel_path "<Actions>/vectors/vectors-select-previous" "")
; (gtk_accel_path "<Actions>/layers/layers-mode-menu" "")
; (gtk_accel_path "<Actions>/filters/filters-render-nature-menu" "")
; (gtk_accel_path "<Actions>/layers/layers-color-tag-none" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-gradients" "<Primary>g")
; (gtk_accel_path "<Actions>/tools/tools-heal" "h")
; (gtk_accel_path "<Actions>/view/view-scroll-right" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-cursor" "")
; (gtk_accel_path "<Actions>/context/context-foreground-saturation-minimum" "")
; (gtk_accel_path "<Actions>/context/context-background-red-maximum" "")
; (gtk_accel_path "<Actions>/context/context-brush-spikes-menu" "")
; (gtk_accel_path "<Actions>/filters/filters-recent-10" "")
; (gtk_accel_path "<Actions>/plug-in/file-gif-save2" "")
; (gtk_accel_path "<Actions>/drawable/drawable-flip-horizontal" "")
; (gtk_accel_path "<Actions>/layers/layers-merge-group" "")
; (gtk_accel_path "<Actions>/color-button/color-button-use-background" "")
; (gtk_accel_path "<Actions>/file/file-open" "<Primary>o")
; (gtk_accel_path "<Actions>/plug-in/script-fu-font-map" "")
; (gtk_accel_path "<Actions>/plug-in/python-fu-console" "")
; (gtk_accel_path "<Actions>/tools/tools-transform-preview-opacity-set" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-histogram" "")
; (gtk_accel_path "<Actions>/view/view-rotate-set-absolute" "")
; (gtk_accel_path "<Actions>/layers/layers-mask-apply" "")
; (gtk_accel_path "<Actions>/context/context-brush-radius-increase-less" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-brush-editor" "")
; (gtk_accel_path "<Actions>/context/context-background-saturation-maximum" "")
; (gtk_accel_path "<Actions>/context/context-foreground-blue-increase" "")
; (gtk_accel_path "<Actions>/context/context-palette-select-next" "")
(gtk_accel_path "<Actions>/layers/layers-duplicate" "<Primary>j")
; (gtk_accel_path "<Actions>/context/context-palette-foreground-next-skip" "")
; (gtk_accel_path "<Actions>/layers/layers-mask-selection-add" "")
(gtk_accel_path "<Actions>/tools/tools-dodge-burn" "o")
; (gtk_accel_path "<Actions>/edit/edit-copy-visible" "<Primary><Shift>c")
; (gtk_accel_path "<Actions>/brushes/brushes-duplicate" "")
(gtk_accel_path "<Actions>/layers/layers-select-previous" "<Alt>bracketright")
; (gtk_accel_path "<Actions>/tools/tools-angle-maximum" "")
; (gtk_accel_path "<Actions>/dockable/dockable-lock-tab" "")
; (gtk_accel_path "<Actions>/context/context-foreground-value-minimum" "")
; (gtk_accel_path "<Actions>/file/file-close-all" "<Primary><Shift>w")
; (gtk_accel_path "<Actions>/dialogs/dialogs-sample-points" "")
; (gtk_accel_path "<Actions>/layers/layers-opacity-menu" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-metadata-editor" "")
; (gtk_accel_path "<Actions>/tools/tools-angle-increase-percent" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-drop-shadow" "")
; (gtk_accel_path "<Actions>/filters/filters-render-menu" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-jigsaw" "")
; (gtk_accel_path "<Actions>/dockable/dockable-tab-style-menu" "")
(gtk_accel_path "<Actions>/context/context-brush-hardness-decrease-skip" "braceleft")
; (gtk_accel_path "<Actions>/plug-in/file-pdf-load" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-guides-from-selection" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-selection-to-brush" "")
; (gtk_accel_path "<Actions>/layers/layers-blend-space-rgb-linear" "")
; (gtk_accel_path "<Actions>/context/context-background-blue-maximum" "")
; (gtk_accel_path "<Actions>/tools/tools-zoom" "z")
; (gtk_accel_path "<Actions>/context/context-swatch-foreground-previous-skip" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-checkerboard" "")
; (gtk_accel_path "<Actions>/context/context-background-red-increase" "")
; (gtk_accel_path "<Actions>/dockable/dockable-popup" "")
; (gtk_accel_path "<Actions>/dockable/dockable-preview-size-extra-small" "")
; (gtk_accel_path "<Actions>/filters/filters-render-clouds-menu" "")
; (gtk_accel_path "<Actions>/context/context-palette-foreground-first" "")
; (gtk_accel_path "<Actions>/view/view-zoom-4-1" "3")
; (gtk_accel_path "<Actions>/channels/channels-duplicate" "")
; (gtk_accel_path "<Actions>/tools/tools-object-2-set" "")
; (gtk_accel_path "<Actions>/context/context-brush-aspect-menu" "")
; (gtk_accel_path "<Actions>/context/context-brush-radius-increase" "")
; (gtk_accel_path "<Actions>/view/view-display-black-point-compensation" "")
; (gtk_accel_path "<Actions>/tools/tools-size-decrease" "bracketleft")
(gtk_accel_path "<Actions>/dialogs/dialogs-colors" "F6")
; (gtk_accel_path "<Actions>/context/context-swatch-background-next" "")
; (gtk_accel_path "<Actions>/filters/filters-edge" "")
(gtk_accel_path "<Actions>/image/image-rotate-180" "8")
; (gtk_accel_path "<Actions>/image/image-new" "<Primary>n")
; (gtk_accel_path "<Actions>/tool-options/tool-options-delete-preset-menu" "")
; (gtk_accel_path "<Actions>/tools/tools-ink-blob-size-set" "")
; (gtk_accel_path "<Actions>/filters/filters-value-propagate" "")
; (gtk_accel_path "<Actions>/image/image-color-profile-assign" "")
; (gtk_accel_path "<Actions>/layers/layers-composite-space-rgb-perceptual" "")
; (gtk_accel_path "<Actions>/context/context-foreground-green-decrease" "")
; (gtk_accel_path "<Actions>/layers/layers-scale" "")
; (gtk_accel_path "<Actions>/layers/layers-transparency-menu" "")
; (gtk_accel_path "<Actions>/layers/layers-alpha-remove" "")
; (gtk_accel_path "<Actions>/context/context-pattern-select-set" "")
; (gtk_accel_path "<Actions>/filters/filters-image-gradient" "")
; (gtk_accel_path "<Actions>/select/select-all" "<Primary>a")
; (gtk_accel_path "<Actions>/plug-in/plug-in-filter-pack" "")
; (gtk_accel_path "<Actions>/context/context-brush-hardness-maximum" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-recompose" "")
; (gtk_accel_path "<Actions>/view/view-zoom-menu" "")
; (gtk_accel_path "<Actions>/image/image-convert-u16" "")
; (gtk_accel_path "<Actions>/filters/filters-kaleidoscope" "")
; (gtk_accel_path "<Actions>/context/context-colormap-foreground-previous-skip" "")
; (gtk_accel_path "<Actions>/view/view-snap-to-grid" "")
; (gtk_accel_path "<Actions>/vectors/vectors-fill" "")
; (gtk_accel_path "<Actions>/view/view-color-management-reset" "")
; (gtk_accel_path "<Actions>/context/context-background-green-set" "")
; (gtk_accel_path "<Actions>/tools/tools-force-maximum" "")
; (gtk_accel_path "<Actions>/context/context-foreground-saturation-increase" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-device-status" "")
; (gtk_accel_path "<Actions>/edit/edit-named-copy" "")
; (gtk_accel_path "<Actions>/filters/filters-video-degradation" "")
; (gtk_accel_path "<Actions>/edit/edit-paste-as-new-layer-in-place" "")
(gtk_accel_path "<Actions>/drawable/drawable-desaturate" "<Primary><Shift>u")
; (gtk_accel_path "<Actions>/layers/layers-resize" "")
; (gtk_accel_path "<Actions>/layers/layers-blend-space-rgb-perceptual" "")
; (gtk_accel_path "<Actions>/layers/layers-stack-menu" "")
; (gtk_accel_path "<Actions>/dockable/dockable-show-button-bar" "")
; (gtk_accel_path "<Actions>/view/view-zoom-fill" "")
; (gtk_accel_path "<Actions>/filters/filters-stretch-contrast-hsv" "")
; (gtk_accel_path "<Actions>/view/view-padding-color-prefs" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-depth-merge" "")
; (gtk_accel_path "<Actions>/tools/tools-opacity-decrease-skip" "<Primary>less")
; (gtk_accel_path "<Actions>/plug-in/plug-in-guillotine" "")
; (gtk_accel_path "<Actions>/windows/windows-tabs-position-left" "")
; (gtk_accel_path "<Actions>/documents/documents-recreate-preview" "")
; (gtk_accel_path "<Actions>/layers/layers-opacity-increase" "")
; (gtk_accel_path "<Actions>/image/colors-tone-mapping-menu" "")
; (gtk_accel_path "<Actions>/tools/tools-size-set" "")
; (gtk_accel_path "<Actions>/context/context-brush-angle-increase-skip" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-fonts" "")
; (gtk_accel_path "<Actions>/channels/channels-linked" "")
; (gtk_accel_path "<Actions>/dockable/dockable-preview-size-gigantic" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-difference-clouds" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-dbbrowser" "")
; (gtk_accel_path "<Actions>/plug-in/color-decode-ycocg-scaled" "")
; (gtk_accel_path "<Actions>/context/context-background-hue-set" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-align-layers" "")
; (gtk_accel_path "<Actions>/context/context-background-blue-increase" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-palettes" "")
; (gtk_accel_path "<Actions>/filters/filters-hue-chroma" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-blinds" "")
; (gtk_accel_path "<Actions>/dockable/dockable-preview-size-enormous" "")
; (gtk_accel_path "<Actions>/channels/channels-lock-content" "")
(gtk_accel_path "<Actions>/tools/tools-color-picker" "i")
; (gtk_accel_path "<Actions>/context/context-paint-mode-next" "")
(gtk_accel_path "<Actions>/tools/tools-clone" "s")
; (gtk_accel_path "<Actions>/plug-in/script-fu-make-brush-elliptical-feathered" "")
; (gtk_accel_path "<Actions>/context/context-background-value-minimum" "")
; (gtk_accel_path "<Actions>/drawable/drawable-linked" "")
; (gtk_accel_path "<Actions>/select/select-sharpen" "")
; (gtk_accel_path "<Actions>/filters/filters-noise-cie-lch" "")
; (gtk_accel_path "<Actions>/context/context-colormap-foreground-next" "")
; (gtk_accel_path "<Actions>/view/view-zoom-4-1-accel" "KP_3")
; (gtk_accel_path "<Actions>/edit/edit-undo" "<Primary>z")
(gtk_accel_path "<Actions>/plug-in/tiny_fu_refresh" "<Primary><Shift><Alt>t")
; (gtk_accel_path "<Actions>/plug-in/script-fu-paste-as-brush" "")
(gtk_accel_path "<Actions>/file/file-save-a-copy" "<Primary><Alt>s")
; (gtk_accel_path "<Actions>/filters/filters-edge-detect-menu" "")
; (gtk_accel_path "<Actions>/vectors/vectors-selection-replace" "")
; (gtk_accel_path "<Actions>/filters/filters-invert-perceptual" "")
; (gtk_accel_path "<Actions>/vectors/vectors-color-tag-blue" "")
; (gtk_accel_path "<Actions>/channels/channels-edit-attributes" "")
; (gtk_accel_path "<Actions>/vectors/vectors-delete" "")
; (gtk_accel_path "<Actions>/file/file-show-in-file-manager" "<Primary><Alt>f")
; (gtk_accel_path "<Actions>/context/context-swatch-background-previous-skip" "")
; (gtk_accel_path "<Actions>/windows/windows-tabs-position-top" "")
; (gtk_accel_path "<Actions>/context/context-brush-radius-decrease" "")
; (gtk_accel_path "<Actions>/filters/filters-light-shadow-menu" "")
(gtk_accel_path "<Actions>/layers/layers-mode-previous" "underscore")
; (gtk_accel_path "<Actions>/vectors/vectors-export" "")
; (gtk_accel_path "<Actions>/tools/tools-hardness-increase" "")
; (gtk_accel_path "<Actions>/tools/tools-value-2-decrease" "")
; (gtk_accel_path "<Actions>/tools/tools-size-increase-percent" "")
; (gtk_accel_path "<Actions>/view/view-zoom-16-1-accel" "KP_5")
; (gtk_accel_path "<Actions>/filters/filters-deinterlace" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-compose" "")
; (gtk_accel_path "<Actions>/context/context-colors-swap" "x")
; (gtk_accel_path "<Actions>/context/context-foreground-value-decrease-skip" "")
; (gtk_accel_path "<Actions>/drawable/drawable-lock-position" "")
; (gtk_accel_path "<Actions>/context/context-palette-background-first" "")
; (gtk_accel_path "<Actions>/select/select-grow" "")
; (gtk_accel_path "<Actions>/filters/filters-invert-linear" "")
; (gtk_accel_path "<Actions>/filters/filters-recent-09" "")
; (gtk_accel_path "<Actions>/help/help-context-help" "<Shift>F1")
; (gtk_accel_path "<Actions>/documents/documents-remove-dangling" "")
; (gtk_accel_path "<Actions>/tools/tools-opacity-decrease-percent" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-gimpressionist" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-images" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-selection-rounded-rectangle" "")
; (gtk_accel_path "<Actions>/filters/filters-recent-08" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-navigation" "")
(gtk_accel_path "<Actions>/dialogs/dialogs-tool-options" "F5")
; (gtk_accel_path "<Actions>/plug-in/script-fu-grid-system" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-vectors" "")
; (gtk_accel_path "<Actions>/view/view-zoom-in-accel" "KP_Add")
; (gtk_accel_path "<Actions>/context/context-colormap-background-previous-skip" "")
; (gtk_accel_path "<Actions>/context/context-colormap-foreground-first" "")
(gtk_accel_path "<Actions>/dialogs/dialogs-palettes" "<Primary><Shift>l")
; (gtk_accel_path "<Actions>/tools/tools-unified-transform" "<Shift>t")
; (gtk_accel_path "<Actions>/file/file-quit" "<Primary>q")
; (gtk_accel_path "<Actions>/context/context-foreground-saturation-decrease" "")
; (gtk_accel_path "<Actions>/image/image-menubar" "")
; (gtk_accel_path "<Actions>/dockable/dockable-tab-style-icon" "")
; (gtk_accel_path "<Actions>/filters/filters-recent-07" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-circuit" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-make-brush-rectangular" "")
(gtk_accel_path "<Actions>/tools/tools-curves" "<Primary>m")
; (gtk_accel_path "<Actions>/plug-in/script-fu-erase-rows" "")
; (gtk_accel_path "<Actions>/filters/filters-noise-pick" "")
(gtk_accel_path "<Actions>/tools/tools-ellipse-select" "<Shift>m")
; (gtk_accel_path "<Actions>/file/file-export-as" "<Primary><Shift>e")
; (gtk_accel_path "<Actions>/layers/layers-color-tag-red" "")
; (gtk_accel_path "<Actions>/view/view-scroll-center" "<Shift>j")
; (gtk_accel_path "<Actions>/image/image-popup" "")
; (gtk_accel_path "<Actions>/filters/filters-recent-06" "")
; (gtk_accel_path "<Actions>/tools/tools-airbrush-flow-increase" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-toolbox" "<Primary>b")
; (gtk_accel_path "<Actions>/view/view-scroll-bottom-border" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-palettemap" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-softglow" "")
; (gtk_accel_path "<Actions>/context/context-pattern-select-previous" "")
; (gtk_accel_path "<Actions>/edit/edit-menu" "")
; (gtk_accel_path "<Actions>/filters/filters-recent-05" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-wavelet-decompose" "")
; (gtk_accel_path "<Actions>/image/image-color-profile-convert" "")
; (gtk_accel_path "<Actions>/context/context-palette-select-last" "")
; (gtk_accel_path "<Actions>/filters/filters-recent-04" "")
(gtk_accel_path "<Actions>/view/view-scroll-page-down" "Page_Down")
; (gtk_accel_path "<Actions>/context/context-foreground-value-increase" "")
; (gtk_accel_path "<Actions>/image/image-convert-linear" "")
(gtk_accel_path "<Actions>/tools/tools-hue-saturation" "<Primary>u")
; (gtk_accel_path "<Actions>/view/view-zoom-out-accel" "KP_Subtract")
; (gtk_accel_path "<Actions>/brushes/brushes-edit" "")
; (gtk_accel_path "<Actions>/image/image-crop-to-selection" "")
; (gtk_accel_path "<Actions>/context/context-brush-radius-maximum" "")
; (gtk_accel_path "<Actions>/filters/filters-oilify" "")
; (gtk_accel_path "<Actions>/layers/layers-opacity-increase-skip" "")
(gtk_accel_path "<Actions>/plug-in/script_fu_refresh" "<Primary><Shift><Alt>r")
; (gtk_accel_path "<Actions>/windows/windows-docks-menu" "")
; (gtk_accel_path "<Actions>/filters/filters-emboss" "")
; (gtk_accel_path "<Actions>/dockable/dockable-menu" "")
; (gtk_accel_path "<Actions>/filters/filters-recent-03" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-qbist" "")
(gtk_accel_path "<Actions>/layers/layers-lower" "<Primary>bracketleft")
(gtk_accel_path "<Actions>/tools/tools-align" "")
; (gtk_accel_path "<Actions>/context/context-brush-aspect-increase-skip" "")
; (gtk_accel_path "<Actions>/tools/tools-handle-transform" "<Shift>l")
; (gtk_accel_path "<Actions>/layers/layers-new-group" "")
; (gtk_accel_path "<Actions>/filters/filters-waves" "")
; (gtk_accel_path "<Actions>/context/context-opacity-menu" "")
; (gtk_accel_path "<Actions>/filters/filters-recent-02" "")
; (gtk_accel_path "<Actions>/layers/layers-crop-to-content" "")
; (gtk_accel_path "<Actions>/filters/filters-whirl-pinch" "")
; (gtk_accel_path "<Actions>/filters/filters-render-pattern-menu" "")
(gtk_accel_path "<Actions>/tools/tools-measure" "u")
; (gtk_accel_path "<Actions>/dockable/dialogs-tool-presets" "")
; (gtk_accel_path "<Actions>/tools/tools-aspect-maximum" "")
(gtk_accel_path "<Actions>/tools/tools-flip" "f")
; (gtk_accel_path "<Actions>/tools/tools-airbrush-rate-minimum" "")
; (gtk_accel_path "<Actions>/help/help-menu" "")
; (gtk_accel_path "<Actions>/filters/filters-recent-01" "")
; (gtk_accel_path "<Actions>/image/image-color-profile-save" "")
; (gtk_accel_path "<Actions>/filters/filters-median-blur" "")
; (gtk_accel_path "<Actions>/vectors/vectors-paste" "")
; (gtk_accel_path "<Actions>/context/context-foreground-blue-minimum" "")
; (gtk_accel_path "<Actions>/filters/filters-apply-canvas" "")
; (gtk_accel_path "<Actions>/drawable/drawable-levels-stretch" "")
; (gtk_accel_path "<Actions>/plug-in/file-png-save2" "")
; (gtk_accel_path "<Actions>/filters/filters-difference-of-gaussians" "")
; (gtk_accel_path "<Actions>/tools/tools-angle-increase-skip" "")
; (gtk_accel_path "<Actions>/context/context-swatch-background-last" "")
(gtk_accel_path "<Actions>/tools/tools-move" "v")
(gtk_accel_path "<Actions>/tools/tools-convolve" "r")
; (gtk_accel_path "<Actions>/tools/tools-airbrush-flow-increase-skip" "")
; (gtk_accel_path "<Actions>/context/context-foreground-saturation-increase-skip" "")
; (gtk_accel_path "<Actions>/channels/channels-color-tag-green" "")
; (gtk_accel_path "<Actions>/tools/tools-aspect-decrease-percent" "")
; (gtk_accel_path "<Actions>/plug-in/gimp-help-using-photography" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-dashboard" "")
; (gtk_accel_path "<Actions>/layers/layers-crop-to-selection" "")
; (gtk_accel_path "<Actions>/layers/layers-mask-selection-subtract" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-guides-remove" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-palette-editor" "")
; (gtk_accel_path "<Actions>/filters/filters-channel-mixer" "")
; (gtk_accel_path "<Actions>/images/images-raise-views" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-waves-anim" "")
; (gtk_accel_path "<Actions>/context/context-foreground-green-maximum" "")
; (gtk_accel_path "<Actions>/view/view-menu" "")
; (gtk_accel_path "<Actions>/view/view-dot-for-dot" "")
; (gtk_accel_path "<Actions>/context/context-gradient-select-set" "")
; (gtk_accel_path "<Actions>/dockable/dockable-close-tab" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-dynamics-editor" "")
; (gtk_accel_path "<Actions>/plug-in/python-fu-palette-to-gradient-repeating" "")
; (gtk_accel_path "<Actions>/vectors/vectors-selection-intersect" "")
; (gtk_accel_path "<Actions>/vectors/vectors-stroke" "")
; (gtk_accel_path "<Actions>/filters/filters-little-planet" "")
; (gtk_accel_path "<Actions>/context/context-pattern-menu" "")
; (gtk_accel_path "<Actions>/plug-in/python-fu-palette-to-gradient" "")
(gtk_accel_path "<Actions>/view/view-show-rulers" "<Primary>r")
; (gtk_accel_path "<Actions>/context/context-brush-spikes-increase" "")
(gtk_accel_path "<Actions>/view/view-snap-to-guides" "<Primary>semicolon")
; (gtk_accel_path "<Actions>/layers/layers-alpha-selection-subtract" "")
; (gtk_accel_path "<Actions>/channels/channels-select-top" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-sota-chrome-it" "")
; (gtk_accel_path "<Actions>/view/view-move-to-screen-:0.0" "")
; (gtk_accel_path "<Actions>/plug-in/gimp-palette-export-python" "")
; (gtk_accel_path "<Actions>/context/context-swatch-foreground-next" "0")
; (gtk_accel_path "<Actions>/select/selection-popup" "")
; (gtk_accel_path "<Actions>/brushes/brushes-refresh" "")
(gtk_accel_path "<Actions>/edit/edit-paste-into" "<Primary><Shift>v")
; (gtk_accel_path "<Actions>/tools/tools-opacity-decrease" "less")
; (gtk_accel_path "<Actions>/context/context-brush-angle-minimum" "")
; (gtk_accel_path "<Actions>/tools/tools-aspect-increase" "")
; (gtk_accel_path "<Actions>/context/context-brush-spikes-maximum" "")
; (gtk_accel_path "<Actions>/filters/filters-generic-menu" "")
; (gtk_accel_path "<Actions>/tools/tools-aspect-set" "")
; (gtk_accel_path "<Actions>/fonts/fonts-popup" "")
; (gtk_accel_path "<Actions>/layers/layers-popup" "")
; (gtk_accel_path "<Actions>/image/image-resize-to-layers" "")
; (gtk_accel_path "<Actions>/context/context-foreground-green-increase-skip" "")
; (gtk_accel_path "<Actions>/tools/tools-magnify" "")
; (gtk_accel_path "<Actions>/vectors/vectors-selection-to-vectors-short" "")
; (gtk_accel_path "<Actions>/windows/windows-use-single-window-mode" "")
; (gtk_accel_path "<Actions>/channels/channels-lower-to-bottom" "")
; (gtk_accel_path "<Actions>/context/context-colormap-background-first" "")
(gtk_accel_path "<Actions>/edit/edit-fill-pattern" "")
; (gtk_accel_path "<Actions>/context/context-paint-mode-first" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-reverse-layers" "")
; (gtk_accel_path "<Actions>/dockable/dockable-preview-size-extra-large" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-indexed-palette" "")
; (gtk_accel_path "<Actions>/context/context-brush-spikes-set" "")
; (gtk_accel_path "<Actions>/vectors/vectors-new-last-values" "")
; (gtk_accel_path "<Actions>/tools/tools-object-2-previous" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-retinex" "")
; (gtk_accel_path "<Actions>/context/context-swatch-foreground-previous" "9")
; (gtk_accel_path "<Actions>/context/context-foreground-value-decrease" "")
; (gtk_accel_path "<Actions>/context/context-brush-select-first" "")
; (gtk_accel_path "<Actions>/context/context-swatch-foreground-next-skip" "")
; (gtk_accel_path "<Actions>/tools/tools-force-increase-skip" "")
; (gtk_accel_path "<Actions>/dockable/dockable-detach-tab" "")
(gtk_accel_path "<Actions>/image/image-print-size" "<Primary>p")
; (gtk_accel_path "<Actions>/filters/filters-fractal-trace" "")
; (gtk_accel_path "<Actions>/filters/filters-panorama-projection" "")
; (gtk_accel_path "<Actions>/context/context-paint-mode-last" "")
; (gtk_accel_path "<Actions>/image/colors-components-menu" "")
; (gtk_accel_path "<Actions>/plug-in/file_print_gimp" "")
; (gtk_accel_path "<Actions>/context/context-colormap-foreground-last" "")
(gtk_accel_path "<Actions>/view/view-zoom-out" "<Primary>minus")
; (gtk_accel_path "<Actions>/plug-in/plug-in-colormap-remap" "")
; (gtk_accel_path "<Actions>/context/context-palette-background-next-skip" "")
; (gtk_accel_path "<Actions>/tools/tools-force-decrease" "")
; (gtk_accel_path "<Actions>/context/context-background-hue-maximum" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-mail-image" "")
; (gtk_accel_path "<Actions>/filters/filters-mantiuk-2006" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-small-tiles" "")
; (gtk_accel_path "<Actions>/layers/layers-composite-mode-clip-to-layer" "")
; (gtk_accel_path "<Actions>/filters/filters-noise-menu" "")
; (gtk_accel_path "<Actions>/layers/layers-mask-disable" "")
; (gtk_accel_path "<Actions>/tools/tools-brightness-contrast" "")
; (gtk_accel_path "<Actions>/context/context-brush-spikes-increase-skip" "")
; (gtk_accel_path "<Actions>/context/context-palette-select-previous" "")
; (gtk_accel_path "<Actions>/filters/filters-erode" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-clothify" "")
; (gtk_accel_path "<Actions>/context/context-pattern-select-first" "")
; (gtk_accel_path "<Actions>/layers/layers-transform-menu" "")
; (gtk_accel_path "<Actions>/tools/tools-spacing-increase-percent" "")
; (gtk_accel_path "<Actions>/select/select-border" "")
; (gtk_accel_path "<Actions>/vectors/vectors-color-tag-none" "")
; (gtk_accel_path "<Actions>/edit/edit-paste-into-in-place" "")
; (gtk_accel_path "<Actions>/layers/layers-new-last-values" "")
; (gtk_accel_path "<Actions>/context/context-opacity-transparent" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-animationoptimize" "")
; (gtk_accel_path "<Actions>/context/context-colormap-background-next" "")
; (gtk_accel_path "<Actions>/layers/layers-blend-space-auto" "")
; (gtk_accel_path "<Actions>/plug-in/file-pdf-save-multi" "")
; (gtk_accel_path "<Actions>/layers/layers-merge-layers" "")
; (gtk_accel_path "<Actions>/layers/layers-composite-space-auto" "")
; (gtk_accel_path "<Actions>/context/context-opacity-decrease-skip" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-buffers" "")
; (gtk_accel_path "<Actions>/tools/tools-perspective" "<Shift>p")
; (gtk_accel_path "<Actions>/context/context-foreground-red-increase-skip" "")
; (gtk_accel_path "<Actions>/context/context-colormap-foreground-set" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-copy-visible" "")
; (gtk_accel_path "<Actions>/filters/filters-high-pass" "")
; (gtk_accel_path "<Actions>/layers/layers-composite-mode-clip-to-backdrop" "")
; (gtk_accel_path "<Actions>/tools/tools-menu" "")
; (gtk_accel_path "<Actions>/context/context-background-green-maximum" "")
; (gtk_accel_path "<Actions>/filters/filters-brightness-contrast" "")
; (gtk_accel_path "<Actions>/filters/filters-shadows-highlights" "")
; (gtk_accel_path "<Actions>/filters/filters-threshold-alpha" "")
; (gtk_accel_path "<Actions>/channels/channels-color-tag-brown" "")
; (gtk_accel_path "<Actions>/patterns/patterns-popup" "")
; (gtk_accel_path "<Actions>/filters/filters-desaturate" "")
; (gtk_accel_path "<Actions>/context/context-palette-foreground-previous" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-nlfilt" "")
; (gtk_accel_path "<Actions>/plug-in/gimp-palette-export-text" "")
; (gtk_accel_path "<Actions>/context/context-palette-foreground-set" "")
; (gtk_accel_path "<Actions>/tools/tools-paintbrush-spacing-set" "")
; (gtk_accel_path "<Actions>/filters/filters-offset" "<Primary><Shift>o")
; (gtk_accel_path "<Actions>/filters/filters-softglow" "")
; (gtk_accel_path "<Actions>/vectors/vectors-select-top" "")
; (gtk_accel_path "<Actions>/context/context-brush-shape-square" "")
; (gtk_accel_path "<Actions>/qmask/qmask-toggle" "")
; (gtk_accel_path "<Actions>/tools/tools-opacity-minimum" "")
; (gtk_accel_path "<Actions>/channels/channels-raise-to-top" "")
; (gtk_accel_path "<Actions>/filters/filters-reinhard-2005" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-fractal-trace" "")
; (gtk_accel_path "<Actions>/view/view-zoom-2-1-accel" "KP_2")
; (gtk_accel_path "<Actions>/context/context-foreground-hue-minimum" "")
; (gtk_accel_path "<Actions>/tools/tools-aspect-decrease" "")
; (gtk_accel_path "<Actions>/tools/tools-angle-decrease-percent" "")
; (gtk_accel_path "<Actions>/tools/tools-mypaint-brush-radius-set" "")
; (gtk_accel_path "<Actions>/context/context-brush-spacing-decrease-skip" "")
; (gtk_accel_path "<Actions>/vectors/vectors-lower" "")
; (gtk_accel_path "<Actions>/context/context-brush-aspect-minimum" "")
; (gtk_accel_path "<Actions>/context/context-tool-select-first" "")
; (gtk_accel_path "<Actions>/layers/layers-mask-delete" "")
; (gtk_accel_path "<Actions>/context/context-background-green-increase-skip" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-ccanalyze" "")
; (gtk_accel_path "<Actions>/filters/filters-artistic-menu" "")
; (gtk_accel_path "<Actions>/select/select-flood" "")
; (gtk_accel_path "<Actions>/tools/tools-hardness-set-to-default" "")
(gtk_accel_path "<Actions>/tools/tools-bucket-fill" "<Shift>g")
; (gtk_accel_path "<Actions>/tools/tools-angle-set" "")
; (gtk_accel_path "<Actions>/tools/tools-ink-blob-aspect-set" "")
; (gtk_accel_path "<Actions>/tools/tools-size-increase" "bracketright")
; (gtk_accel_path "<Actions>/tools/tools-force-increase-percent" "")
; (gtk_accel_path "<Actions>/image/image-color-management-menu" "")
; (gtk_accel_path "<Actions>/channels/channels-selection-replace" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-layers" "<Primary>l")
(gtk_accel_path "<Actions>/view/view-zoom-fit-in" "<Primary>0")
; (gtk_accel_path "<Actions>/brushes/brushes-delete" "")
; (gtk_accel_path "<Actions>/filters/filters-repeat" "<Primary>f")
; (gtk_accel_path "<Actions>/filters/filters-maze" "")
; (gtk_accel_path "<Actions>/context/context-brush-shape-menu" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-palette-editor" "")
; (gtk_accel_path "<Actions>/context/context-colors-default" "d")
; (gtk_accel_path "<Actions>/drawable/drawable-flip-vertical" "")
; (gtk_accel_path "<Actions>/filters/filters-color-balance" "")
; (gtk_accel_path "<Actions>/tools/tools-size-set-to-default" "backslash")
(gtk_accel_path "<Actions>/layers/layers-raise-to-top" "<Primary>braceright")
; (gtk_accel_path "<Actions>/context/context-foreground-blue-decrease-skip" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-gradmap" "")
; (gtk_accel_path "<Actions>/filters/filters-checkerboard" "")
; (gtk_accel_path "<Actions>/image/image-convert-grayscale" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-fuzzy-border" "")
; (gtk_accel_path "<Actions>/filters/filters-tile-paper" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-selection-editor" "")
; (gtk_accel_path "<Actions>/layers/layers-edit" "")
; (gtk_accel_path "<Actions>/image/colors-desaturate-menu" "")
; (gtk_accel_path "<Actions>/layers/layers-flatten-image" "")
; (gtk_accel_path "<Actions>/tools/tools-airbrush-rate-increase-skip" "")
; (gtk_accel_path "<Actions>/channels/channels-select-bottom" "")
(gtk_accel_path "<Actions>/dialogs/dialogs-preferences" "<Primary>k")
; (gtk_accel_path "<Actions>/plug-in/plug-in-animationplay" "")
; (gtk_accel_path "<Actions>/context/context-brush-angle-menu" "")
; (gtk_accel_path "<Actions>/tools/tools-airbrush-flow-minimum" "")
; (gtk_accel_path "<Actions>/view/view-rotate-menu" "")
; (gtk_accel_path "<Actions>/vectors/vectors-import" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-xach-effect" "")
; (gtk_accel_path "<Actions>/view/view-rotate-345" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-decompose" "")
; (gtk_accel_path "<Actions>/plug-in/gimp-palette-export-css" "")
; (gtk_accel_path "<Actions>/filters/filters-color-exchange" "")
; (gtk_accel_path "<Actions>/tools/tools-warp-effect-size-set" "")
; (gtk_accel_path "<Actions>/view/view-display-intent-perceptual" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-navigation" "")
; (gtk_accel_path "<Actions>/dock/dock-open-display" "")
; (gtk_accel_path "<Actions>/context/context-paint-mode-previous" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-hot" "")
; (gtk_accel_path "<Actions>/tools/tools-aspect-decrease-skip" "")
; (gtk_accel_path "<Actions>/view/view-zoom-out-skip" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-keyboard-shortcuts" "")
; (gtk_accel_path "<Actions>/view/view-zoom-maximum" "")
; (gtk_accel_path "<Actions>/dockable/dockable-preview-size-tiny" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-input-devices" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-document-history" "")
; (gtk_accel_path "<Actions>/quick-mask/quick-mask-invert-on" "")
; (gtk_accel_path "<Actions>/context/context-swatch-foreground-first" "")
(gtk_accel_path "<Actions>/file/file-export" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-set-cmap" "")
; (gtk_accel_path "<Actions>/layers/layers-text-discard" "")
; (gtk_accel_path "<Actions>/context/context-foreground-red-maximum" "")
; (gtk_accel_path "<Actions>/filters/filters-render-noise-menu" "")
; (gtk_accel_path "<Actions>/context/context-font-select-next" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-guide-new-percent" "")
; (gtk_accel_path "<Actions>/view/view-show-scrollbars" "")
; (gtk_accel_path "<Actions>/channels/channels-delete" "")
; (gtk_accel_path "<Actions>/view/view-zoom-fit-to" "")
; (gtk_accel_path "<Actions>/image/image-flip-vertical" "")
; (gtk_accel_path "<Actions>/layers/layers-opacity-set" "")
; (gtk_accel_path "<Actions>/context/context-menu" "")
; (gtk_accel_path "<Actions>/vectors/vectors-popup" "")
; (gtk_accel_path "<Actions>/image/image-convert-half" "")
; (gtk_accel_path "<Actions>/view/view-flip-vertically" "")
; (gtk_accel_path "<Actions>/file/file-overwrite" "")
; (gtk_accel_path "<Actions>/context/context-background-red-increase-skip" "")
; (gtk_accel_path "<Actions>/tools/tools-size-increase-skip" "<Shift>bracketright")
; (gtk_accel_path "<Actions>/image/image-rotate-90" "")
; (gtk_accel_path "<Actions>/filters/filters-edge-sobel" "")
(gtk_accel_path "<Actions>/edit/edit-fill-bg" "<Primary>BackSpace")
; (gtk_accel_path "<Actions>/context/context-palette-menu" "")
; (gtk_accel_path "<Actions>/layers/layers-properties-menu" "")
(gtk_accel_path "<Actions>/layers/layers-mode-next" "plus")
; (gtk_accel_path "<Actions>/context/context-foreground-hue-increase" "")
(gtk_accel_path "<Actions>/select/select-invert" "<Primary><Shift>i")
(gtk_accel_path "<Actions>/tools/tools-iscissors" "")
; (gtk_accel_path "<Actions>/file/file-save-as" "<Primary><Shift>s")
; (gtk_accel_path "<Actions>/context/context-swatch-foreground-last" "")
; (gtk_accel_path "<Actions>/context/context-palette-background-next" "")
(gtk_accel_path "<Actions>/image/image-rotate-270" "7")
; (gtk_accel_path "<Actions>/context/context-brush-hardness-menu" "")
(gtk_accel_path "<Actions>/tools/tools-warp" "")
; (gtk_accel_path "<Actions>/context/context-brush-radius-decrease-less" "")
; (gtk_accel_path "<Actions>/quick-mask/quick-mask-popup" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-sparkle" "")
; (gtk_accel_path "<Actions>/vectors/vectors-selection-subtract" "")
; (gtk_accel_path "<Actions>/filters/filters-combine-menu" "")
(gtk_accel_path "<Actions>/layers/layers-raise" "<Primary>bracketright")
; (gtk_accel_path "<Actions>/edit/edit-strong-undo" "<Primary><Shift>z")
; (gtk_accel_path "<Actions>/context/context-colormap-foreground-next-skip" "")
; (gtk_accel_path "<Actions>/context/context-brush-aspect-increase" "")
; (gtk_accel_path "<Actions>/filters/filters-invert-value" "")
; (gtk_accel_path "<Actions>/tools/tools-value-2-increase" "")
; (gtk_accel_path "<Actions>/context/context-foreground-blue-set" "")
; (gtk_accel_path "<Actions>/filters/filters-bump-map" "")
; (gtk_accel_path "<Actions>/plug-in/file-gih-save-internal" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-old-photo" "")
; (gtk_accel_path "<Actions>/context/context-background-blue-increase-skip" "")
(gtk_accel_path "<Actions>/tools/tools-desaturate" "<Primary><Shift>u")
; (gtk_accel_path "<Actions>/patterns/patterns-edit" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-module-dialog" "")
; (gtk_accel_path "<Actions>/image/image-configure-grid" "")
; (gtk_accel_path "<Actions>/context/context-tool-menu" "")
; (gtk_accel_path "<Actions>/view/view-zoom-1-1-accel" "KP_1")
; (gtk_accel_path "<Actions>/filters/filters-noise-spread" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-round-corners" "")
; (gtk_accel_path "<Actions>/tools/tools-hardness-increase-skip" "")
; (gtk_accel_path "<Actions>/select/select-save" "")
; (gtk_accel_path "<Actions>/context/context-background-saturation-set" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-guide-new" "")
; (gtk_accel_path "<Actions>/tools/tools-size-minimum" "")
; (gtk_accel_path "<Actions>/tools/tools-hardness-decrease-percent" "")
; (gtk_accel_path "<Actions>/plug-in/gimp-help-concepts-paths" "")
; (gtk_accel_path "<Actions>/vectors/vectors-select-next" "")
; (gtk_accel_path "<Actions>/filters/filters-gaussian-blur" "")
; (gtk_accel_path "<Actions>/tools/tools-text" "t")
; (gtk_accel_path "<Actions>/view/view-rotate-180" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-screenshot" "")
(gtk_accel_path "<Actions>/plug-in/plug_in_c_astretch" "<Primary><Shift><Alt>l")
; (gtk_accel_path "<Actions>/plug-in/gimp-online-wiki" "")
; (gtk_accel_path "<Actions>/filters/filters-noise-solid" "")
; (gtk_accel_path "<Actions>/file/file-open-as-layers" "<Primary><Alt>o")
; (gtk_accel_path "<Actions>/context/context-background-red-minimum" "")
; (gtk_accel_path "<Actions>/layers/layers-text-to-vectors" "")
; (gtk_accel_path "<Actions>/filters/filters-noise-cell" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-refresh" "")
(gtk_accel_path "<Actions>/quick-mask/quick-mask-toggle" "q")
; (gtk_accel_path "<Actions>/vectors/vectors-fill-last-values" "")
; (gtk_accel_path "<Actions>/documents/documents-popup" "")
; (gtk_accel_path "<Actions>/view/view-padding-color-menu" "")
(gtk_accel_path "<Actions>/tools/tools-smudge" "")
; (gtk_accel_path "<Actions>/context/context-font-menu" "")
; (gtk_accel_path "<Actions>/tools/tools-mypaint-brush-hardness-set" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-pagecurl" "")
(gtk_accel_path "<Actions>/dialogs/dialogs-layers" "F7")
; (gtk_accel_path "<Actions>/context/context-colormap-background-last" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-selection-to-image" "")
; (gtk_accel_path "<Actions>/channels/channels-selection-add" "")
; (gtk_accel_path "<Actions>/context/context-palette-select-first" "")
; (gtk_accel_path "<Actions>/layers/layers-lock-position" "")
; (gtk_accel_path "<Actions>/tools/tools-object-1-next" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-device-status" "")
; (gtk_accel_path "<Actions>/view/view-scroll-vertical" "")
(gtk_accel_path "<Actions>/view/view-show-selection" "<Primary>h")
; (gtk_accel_path "<Actions>/plug-in/plug-in-borderaverage" "")
; (gtk_accel_path "<Actions>/color-button/color-button-use-foreground" "")
; (gtk_accel_path "<Actions>/filters/filters-photocopy" "")
; (gtk_accel_path "<Actions>/channels/channels-color-tag-orange" "")
; (gtk_accel_path "<Actions>/tools/tools-ink-blob-angle-set" "")
; (gtk_accel_path "<Actions>/context/context-background-saturation-minimum" "")
; (gtk_accel_path "<Actions>/layers/layers-lock-alpha" "")
; (gtk_accel_path "<Actions>/tools/tools-transform-menu" "")
; (gtk_accel_path "<Actions>/tools/tools-spacing-maximum" "")
; (gtk_accel_path "<Actions>/view/view-padding-color-theme" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-gradient-example" "")
; (gtk_accel_path "<Actions>/filters/filters-color-rotate" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-dynamics" "")
; (gtk_accel_path "<Actions>/patterns/patterns-copy-location" "")
; (gtk_accel_path "<Actions>/plug-in/gimp-online-roadmap" "")
; (gtk_accel_path "<Actions>/filters/filters-vignette" "")
; (gtk_accel_path "<Actions>/filters/filters-edge-neon" "")
(gtk_accel_path "<Actions>/plug-in/plug_in_colortoalpha" "<Primary><Shift>a")
; (gtk_accel_path "<Actions>/filters/filters-apply-lens" "")
; (gtk_accel_path "<Actions>/tools/tools-angle-minimum" "")
; (gtk_accel_path "<Actions>/tools/tools-ink" "k")
; (gtk_accel_path "<Actions>/tools/tools-airbrush-rate-set" "")
; (gtk_accel_path "<Actions>/layers/layers-mask-add-button" "")
; (gtk_accel_path "<Actions>/layers/layers-color-tag-orange" "")
; (gtk_accel_path "<Actions>/plug-in/python-fu-gradient-save-as-css" "")
; (gtk_accel_path "<Actions>/view/view-display-filters" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-coffee-stain" "")
; (gtk_accel_path "<Actions>/context/context-swatch-background-first" "")
; (gtk_accel_path "<Actions>/layers/layers-composite-mode-intersection" "")
; (gtk_accel_path "<Actions>/filters/filters-noise-rgb" "")
; (gtk_accel_path "<Actions>/context/context-foreground-hue-decrease" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-tile" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-despeckle" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-about" "")
(gtk_accel_path "<Actions>/plug-in/plug-in-c-astretch" "<Primary><Shift><Alt>l")
; (gtk_accel_path "<Actions>/tools/tools-spacing-set" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-templates" "")
; (gtk_accel_path "<Actions>/tools/tools-object-2-first" "")
; (gtk_accel_path "<Actions>/context/context-background-blue-minimum" "")
; (gtk_accel_path "<Actions>/documents/documents-file-open-dialog" "")
; (gtk_accel_path "<Actions>/quick-mask/quick-mask-invert-off" "")
; (gtk_accel_path "<Actions>/filters/filters-tile-seamless" "")
; (gtk_accel_path "<Actions>/filters/filters-red-eye-removal" "")
(gtk_accel_path "<Actions>/layers/layers-resize-to-image" "<Alt>y")
; (gtk_accel_path "<Actions>/filters/filters-lens-flare" "")
; (gtk_accel_path "<Actions>/filters/filters-render-fractals-menu" "")
; (gtk_accel_path "<Actions>/context/context-brush-angle-decrease-skip" "")
; (gtk_accel_path "<Actions>/plug-in/gimp-help-using-web" "")
(gtk_accel_path "<Actions>/dialogs/dialogs-vectors" "F9")
; (gtk_accel_path "<Actions>/view/view-color-management-softproof" "")
; (gtk_accel_path "<Actions>/edit/edit-buffer-menu" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-make-brush-elliptical" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-grid" "")
; (gtk_accel_path "<Actions>/plug-in/file-pdf-save" "")
; (gtk_accel_path "<Actions>/filters/filters-color-enhance" "")
; (gtk_accel_path "<Actions>/plug-in/file-png-save" "")
; (gtk_accel_path "<Actions>/view/view-padding-color-custom" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-weave" "")
; (gtk_accel_path "<Actions>/filters/filters-blur-menu" "")
; (gtk_accel_path "<Actions>/context/context-brush-aspect-decrease" "")
; (gtk_accel_path "<Actions>/tools/tools-paintbrush-angle-set" "")
; (gtk_accel_path "<Actions>/context/context-pattern-select-next" "")
; (gtk_accel_path "<Actions>/channels/channels-lower" "")
; (gtk_accel_path "<Actions>/view/view-rotate-other" "")
; (gtk_accel_path "<Actions>/context/context-brush-hardness-minimum" "")
; (gtk_accel_path "<Actions>/filters/filters-mosaic" "")
; (gtk_accel_path "<Actions>/patterns/patterns-show-in-file-manager" "")
; (gtk_accel_path "<Actions>/debug/debug-menu" "")
; (gtk_accel_path "<Actions>/context/context-brush-radius-increase-skip" "")
; (gtk_accel_path "<Actions>/view/view-softproof-black-point-compensation" "")
; (gtk_accel_path "<Actions>/select/select-menu" "")
; (gtk_accel_path "<Actions>/color-button/color-button-use-black" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-sample-colorize" "")
(gtk_accel_path "<Actions>/file/file-open-recent-10" "")
(gtk_accel_path "<Actions>/tools/tools-by-color-select" "")
; (gtk_accel_path "<Actions>/context/context-palette-background-previous" "")
; (gtk_accel_path "<Actions>/tools/tools-force-minimum" "")
; (gtk_accel_path "<Actions>/channels/channels-color-tag-violet" "")
; (gtk_accel_path "<Actions>/context/context-swatch-background-next-skip" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-brush-editor" "")
; (gtk_accel_path "<Actions>/plug-in/gimp-help-using-simpleobjects" "")
; (gtk_accel_path "<Actions>/filters/filters-recursive-transform" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-add-bevel" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-dynamics" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-curve-bend" "")
; (gtk_accel_path "<Actions>/context/context-background-saturation-increase-skip" "")
(gtk_accel_path "<Actions>/view/view-scroll-page-up" "Page_Up")
; (gtk_accel_path "<Actions>/filters/filters-convolution-matrix" "")
; (gtk_accel_path "<Actions>/tools/tools-pencil" "n")
; (gtk_accel_path "<Actions>/filters/filters-levels" "")
; (gtk_accel_path "<Actions>/layers/layers-color-tag-violet" "")
; (gtk_accel_path "<Actions>/tools/tools-opacity-increase" "greater")
; (gtk_accel_path "<Actions>/context/context-brush-radius-decrease-percent" "")
; (gtk_accel_path "<Actions>/context/context-foreground-red-set" "")
; (gtk_accel_path "<Actions>/select/select-fill" "")
; (gtk_accel_path "<Actions>/filters/filters-colorize" "")
; (gtk_accel_path "<Actions>/view/view-padding-color-dark-check" "")
; (gtk_accel_path "<Actions>/tools/tools-hardness-maximum" "")
; (gtk_accel_path "<Actions>/tool-options/tool-options-save-new-preset" "")
; (gtk_accel_path "<Actions>/tools/tools-spacing-increase-skip" "")
; (gtk_accel_path "<Actions>/context/context-gradient-select-previous" "")
; (gtk_accel_path "<Actions>/layers/layers-new-from-visible" "")
(gtk_accel_path "<Actions>/tools/tools-crop" "c")
; (gtk_accel_path "<Actions>/plug-in/plug-in-flame" "")
; (gtk_accel_path "<Actions>/images/images-popup" "")
; (gtk_accel_path "<Actions>/dockable/dockable-view-type-list" "")
; (gtk_accel_path "<Actions>/context/context-font-select-last" "")
; (gtk_accel_path "<Actions>/vectors/vectors-new" "")
; (gtk_accel_path "<Actions>/tool-options/tool-options-popup" "")
; (gtk_accel_path "<Actions>/filters/filters-posterize" "")
; (gtk_accel_path "<Actions>/channels/channels-color-tag-menu" "")
; (gtk_accel_path "<Actions>/filters/filters-slic" "")
; (gtk_accel_path "<Actions>/view/view-rotate-reset" "exclam")
; (gtk_accel_path "<Actions>/filters/filters-shift" "")
; (gtk_accel_path "<Actions>/drawable/drawable-rotate-90" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-lighting" "")
; (gtk_accel_path "<Actions>/tools/tools-mypaint-brush" "y")
; (gtk_accel_path "<Actions>/layers/layers-mode-last" "")
; (gtk_accel_path "<Actions>/filters/filters-saturation" "")
(gtk_accel_path "<Actions>/layers/layers-merge-down" "<Primary>e")
; (gtk_accel_path "<Actions>/dialogs/dialogs-tips" "")
; (gtk_accel_path "<Actions>/tools/tools-warp-effect-hardness-set" "")
; (gtk_accel_path "<Actions>/layers/layers-alpha-add" "")
; (gtk_accel_path "<Actions>/filters/filters-map-menu" "")
; (gtk_accel_path "<Actions>/context/context-palette-foreground-previous-skip" "")
; (gtk_accel_path "<Actions>/context/context-tool-select-set" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-color-enhance" "")
; (gtk_accel_path "<Actions>/filters/filters-dilate" "")
; (gtk_accel_path "<Actions>/context/context-palette-background-last" "")
; (gtk_accel_path "<Actions>/image/image-mode-menu" "")
; (gtk_accel_path "<Actions>/vectors/vectors-selection-to-vectors" "")
; (gtk_accel_path "<Actions>/vectors/vectors-raise" "")
; (gtk_accel_path "<Actions>/edit/edit-named-copy-visible" "")
; (gtk_accel_path "<Actions>/dockable/dockable-preview-size-small" "")
; (gtk_accel_path "<Actions>/drawable/drawable-rotate-180" "")
; (gtk_accel_path "<Actions>/filters/filters-decor-menu" "")
; (gtk_accel_path "<Actions>/layers/layers-composite-mode-menu" "")
; (gtk_accel_path "<Actions>/tools/tools-airbrush-rate-decrease" "")
; (gtk_accel_path "<Actions>/image/image-convert-gamma" "")
; (gtk_accel_path "<Actions>/context/context-foreground-hue-increase-skip" "")
; (gtk_accel_path "<Actions>/view/view-zoom-16-1" "5")
; (gtk_accel_path "<Actions>/tools/tools-force-increase" "")
; (gtk_accel_path "<Actions>/layers/layers-alpha-selection-intersect" "")
; (gtk_accel_path "<Actions>/image/image-guides-menu" "")
; (gtk_accel_path "<Actions>/channels/channels-color-tag-yellow" "")
(gtk_accel_path "<Actions>/context/context-brush-select-next" "period")
; (gtk_accel_path "<Actions>/channels/channels-popup" "")
(gtk_accel_path "<Actions>/plug-in/plug-in-iwarp" "<Primary><Shift>x")
; (gtk_accel_path "<Actions>/filters/filters-waterpixels" "")
; (gtk_accel_path "<Actions>/context/context-brush-spacing-increase" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-brushes" "<Primary><Shift>b")
(gtk_accel_path "<Actions>/layers/layers-select-next" "<Alt>bracketleft")
; (gtk_accel_path "<Actions>/tools/tools-rotate-arbitrary" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-action-search" "slash")
; (gtk_accel_path "<Actions>/layers/layers-opacity-decrease-skip" "")
; (gtk_accel_path "<Actions>/plug-in/gimp-help-concepts-usage" "")
; (gtk_accel_path "<Actions>/debug/debug-dump-keyboard-shortcuts" "")
; (gtk_accel_path "<Actions>/image/image-color-profile-discard" "")
; (gtk_accel_path "<Actions>/layers/layers-color-tag-yellow" "")
; (gtk_accel_path "<Actions>/context/context-brush-aspect-decrease-skip" "")
; (gtk_accel_path "<Actions>/dock/dock-move-to-screen-:0.0" "")
; (gtk_accel_path "<Actions>/filters/filters-animation-menu" "")
; (gtk_accel_path "<Actions>/filters/filters-noise-reduction" "")
(gtk_accel_path "<Actions>/dialogs/dialogs-gradients" "<Primary><Shift>g")
; (gtk_accel_path "<Actions>/tools/tools-object-1-previous" "")
(gtk_accel_path "<Actions>/image/image-duplicate" "")
; (gtk_accel_path "<Actions>/documents/documents-show-in-file-manager" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-patterns" "<Primary><Shift>p")
; (gtk_accel_path "<Actions>/view/view-scroll-right-border" "")
; (gtk_accel_path "<Actions>/edit/edit-paste" "<Primary>v")
; (gtk_accel_path "<Actions>/context/context-palette-foreground-next" "")
; (gtk_accel_path "<Actions>/channels/channels-color-tag-red" "")
; (gtk_accel_path "<Actions>/filters/filters-mono-mixer" "")
; (gtk_accel_path "<Actions>/context/context-font-select-set" "")
; (gtk_accel_path "<Actions>/patterns/patterns-duplicate" "")
; (gtk_accel_path "<Actions>/filters/filters-spiral" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-unit-editor" "")
; (gtk_accel_path "<Actions>/tools/tools-angle-decrease-skip" "")
; (gtk_accel_path "<Actions>/tools/tools-airbrush-flow-decrease-skip" "")
; (gtk_accel_path "<Actions>/vectors/vectors-select-bottom" "")
; (gtk_accel_path "<Actions>/context/context-foreground-value-set" "")
; (gtk_accel_path "<Actions>/debug/debug-dump-items" "")
; (gtk_accel_path "<Actions>/view/view-scroll-up" "")
; (gtk_accel_path "<Actions>/plug-in/gimp-help-using-selections" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-cml-explorer" "")
; (gtk_accel_path "<Actions>/select/select-stroke" "")
; (gtk_accel_path "<Actions>/context/context-foreground-saturation-decrease-skip" "")
; (gtk_accel_path "<Actions>/tool-options/tool-options-reset-all" "")
; (gtk_accel_path "<Actions>/drawable/drawable-visible" "")
; (gtk_accel_path "<Actions>/image/image-metadata-menu" "")
; (gtk_accel_path "<Actions>/channels/channels-select-previous" "")
; (gtk_accel_path "<Actions>/context/context-brush-angle-increase" "")
; (gtk_accel_path "<Actions>/filters/filters-snn-mean" "")
; (gtk_accel_path "<Actions>/tools/tools-hardness-set" "")
; (gtk_accel_path "<Actions>/layers/layers-color-tag-menu" "")
; (gtk_accel_path "<Actions>/tools/tools-object-1-last" "")
; (gtk_accel_path "<Actions>/context/context-background-value-increase-skip" "")
; (gtk_accel_path "<Actions>/plug-in/python-fu-histogram-export" "")
; (gtk_accel_path "<Actions>/view/view-display-intent-relative-colorimetric" "")
; (gtk_accel_path "<Actions>/tools/tools-aspect-set-to-default" "")
; (gtk_accel_path "<Actions>/filters/filters-supernova" "")
; (gtk_accel_path "<Actions>/image/image-transform-menu" "")
(gtk_accel_path "<Actions>/view/view-shrink-wrap" "")
; (gtk_accel_path "<Actions>/images/images-delete" "")
; (gtk_accel_path "<Actions>/context/context-swatch-foreground-set" "")
; (gtk_accel_path "<Actions>/plug-in/file-pat-save-internal" "")
; (gtk_accel_path "<Actions>/context/context-foreground-red-decrease" "")
; (gtk_accel_path "<Actions>/view/view-zoom-8-1" "4")
; (gtk_accel_path "<Actions>/context/context-brush-hardness-increase" "")
; (gtk_accel_path "<Actions>/filters/filters-sepia" "")
; (gtk_accel_path "<Actions>/debug/debug-dump-attached-data" "")
; (gtk_accel_path "<Actions>/context/context-brush-radius-minimum" "")
; (gtk_accel_path "<Actions>/context/context-foreground-saturation-set" "")
; (gtk_accel_path "<Actions>/view/view-softproof-gamut-check" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-images" "")
; (gtk_accel_path "<Actions>/layers/layers-mask-selection-intersect" "")
; (gtk_accel_path "<Actions>/plug-in/file-print-gtk" "")
; (gtk_accel_path "<Actions>/filters/filters-reshow" "<Primary><Shift>f")
; (gtk_accel_path "<Actions>/dialogs/dialogs-gradient-editor" "")
; (gtk_accel_path "<Actions>/view/view-move-to-screen-menu" "")
; (gtk_accel_path "<Actions>/documents/documents-copy-location" "")
; (gtk_accel_path "<Actions>/view/view-open-display" "")
; (gtk_accel_path "<Actions>/layers/layers-linked" "")
; (gtk_accel_path "<Actions>/plug-in/file-tiff-save2" "")
; (gtk_accel_path "<Actions>/tool-options/tool-options-save-preset-menu" "")
; (gtk_accel_path "<Actions>/context/context-brush-spacing-maximum" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-buffers" "")
; (gtk_accel_path "<Actions>/file/file-copy-location" "")
; (gtk_accel_path "<Actions>/tools/tools-color-balance" "")
; (gtk_accel_path "<Actions>/layers/layers-menu" "")
; (gtk_accel_path "<Actions>/tools/tools-aspect-minimum" "")
; (gtk_accel_path "<Actions>/context/context-foreground-green-decrease-skip" "")
; (gtk_accel_path "<Actions>/context/context-palette-background-previous-skip" "")
(gtk_accel_path "<Actions>/edit/edit-paste-as-new-image" "")
; (gtk_accel_path "<Actions>/filters/filters-stress" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-patterns" "<Primary><Shift>p")
; (gtk_accel_path "<Actions>/filters/filters-edge-laplace" "")
; (gtk_accel_path "<Actions>/context/context-background-green-decrease" "")
; (gtk_accel_path "<Actions>/view/view-rotate-90" "")
; (gtk_accel_path "<Actions>/plug-in/color-decode-alpha-exp" "")
; (gtk_accel_path "<Actions>/context/context-brush-spacing-decrease" "")
; (gtk_accel_path "<Actions>/tool-options/tool-options-edit-preset-menu" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-ifscompose" "")
; (gtk_accel_path "<Actions>/context/context-background-hue-increase-skip" "")
; (gtk_accel_path "<Actions>/filters/filters-ripple" "")
(gtk_accel_path "<Actions>/tools/tools-airbrush" "j")
; (gtk_accel_path "<Actions>/view/view-softproof-intent-menu" "")
; (gtk_accel_path "<Actions>/filters/filters-sinus" "")
; (gtk_accel_path "<Actions>/filters/filters-c2g" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-metadata-viewer" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-neon" "")
; (gtk_accel_path "<Actions>/view/view-close" "<Primary>w")
; (gtk_accel_path "<Actions>/layers/layers-edit-text" "")
; (gtk_accel_path "<Actions>/context/context-brush-shape-diamond" "")
; (gtk_accel_path "<Actions>/tools/tools-force-decrease-skip" "")
; (gtk_accel_path "<Actions>/plug-in/gimp-online-main-web-site" "")
; (gtk_accel_path "<Actions>/vectors/vectors-edit-attributes" "")
; (gtk_accel_path "<Actions>/context/context-opacity-increase" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-tool-options" "")
; (gtk_accel_path "<Actions>/context/context-brush-spacing-set" "")
; (gtk_accel_path "<Actions>/context/context-pattern-select-last" "")
; (gtk_accel_path "<Actions>/filters/filters-distance-map" "")
(gtk_accel_path "<Actions>/tools/tools-free-select" "l")
; (gtk_accel_path "<Actions>/context/context-foreground-green-minimum" "")
; (gtk_accel_path "<Actions>/file/file-open-recent-09" "<Primary>9")
; (gtk_accel_path "<Actions>/dockable/dialogs-fonts" "")
; (gtk_accel_path "<Actions>/context/context-tool-select-next" "")
(gtk_accel_path "<Actions>/layers/layers-select-top" "<Alt>braceright")
; (gtk_accel_path "<Actions>/channels/channels-selection-subtract" "")
; (gtk_accel_path "<Actions>/file/file-open-recent-08" "<Primary>8")
; (gtk_accel_path "<Actions>/context/context-background-hue-increase" "")
; (gtk_accel_path "<Actions>/context/context-colormap-background-next-skip" "")
; (gtk_accel_path "<Actions>/tools/tools-paint-brush-size-increase" "")
; (gtk_accel_path "<Actions>/context/context-brush-spikes-decrease-skip" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-mypaint-brushes" "")
; (gtk_accel_path "<Actions>/context/context-font-select-previous" "")
; (gtk_accel_path "<Actions>/file/file-open-recent-07" "<Primary>7")
; (gtk_accel_path "<Actions>/plug-in/plug-in-film" "")
(gtk_accel_path "<Actions>/layers/layers-anchor" "<Alt>h")
; (gtk_accel_path "<Actions>/view/view-new" "")
(gtk_accel_path "<Actions>/edit/edit-redo" "")
; (gtk_accel_path "<Actions>/context/context-brush-angle-decrease" "")
; (gtk_accel_path "<Actions>/file/file-open-recent-06" "<Primary>6")
; (gtk_accel_path "<Actions>/images/images-new-view" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-goat-exercise" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-reset-all" "")
; (gtk_accel_path "<Actions>/plug-in/file-gbr-save-internal" "")
; (gtk_accel_path "<Actions>/edit/edit-paste-in-place" "<Primary><Alt>v")
; (gtk_accel_path "<Actions>/view/view-info-window" "")
; (gtk_accel_path "<Actions>/vectors/vectors-selection-add" "")
; (gtk_accel_path "<Actions>/tools/tools-aspect-increase-percent" "")
; (gtk_accel_path "<Actions>/drawable/drawable-lock-content" "")
; (gtk_accel_path "<Actions>/layers/layers-edit-attributes" "")
; (gtk_accel_path "<Actions>/file/file-open-recent-05" "<Primary>5")
; (gtk_accel_path "<Actions>/plug-in/gimp-help-using-docks" "")
; (gtk_accel_path "<Actions>/filters/filters-hue-saturation" "")
; (gtk_accel_path "<Actions>/context/context-foreground-red-decrease-skip" "")
; (gtk_accel_path "<Actions>/filters/filters-lens-distortion" "")
; (gtk_accel_path "<Actions>/image/image-convert-indexed" "")
; (gtk_accel_path "<Actions>/filters/filters-tile-glass" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-lava" "")
; (gtk_accel_path "<Actions>/file/file-open-recent-04" "<Primary>4")
; (gtk_accel_path "<Actions>/dock/dock-auto-follow-active" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-spyrogimp" "")
; (gtk_accel_path "<Actions>/patterns/patterns-open-as-image" "")
; (gtk_accel_path "<Actions>/context/context-foreground-saturation-maximum" "")
; (gtk_accel_path "<Actions>/image/colors-map-menu" "")
; (gtk_accel_path "<Actions>/context/context-brush-radius-set" "")
; (gtk_accel_path "<Actions>/file/file-open-recent-03" "<Primary>3")
; (gtk_accel_path "<Actions>/context/context-brush-hardness-decrease" "")
; (gtk_accel_path "<Actions>/windows/windows-show-display-previous" "<Shift><Alt>Tab")
; (gtk_accel_path "<Actions>/view/view-softproof-intent-relative-colorimetric" "")
; (gtk_accel_path "<Actions>/tools/tools-force-set-to-default" "")
; (gtk_accel_path "<Actions>/file/file-open-recent-02" "<Primary>2")
; (gtk_accel_path "<Actions>/drawable/drawable-equalize" "")
; (gtk_accel_path "<Actions>/context/context-font-select-first" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-animationunoptimize" "")
; (gtk_accel_path "<Actions>/layers/layers-mask-selection-replace" "")
; (gtk_accel_path "<Actions>/plug-in/python-fu-foggify" "")
; (gtk_accel_path "<Actions>/patterns/patterns-refresh" "")
; (gtk_accel_path "<Actions>/file/file-open-recent-01" "<Primary>1")
; (gtk_accel_path "<Actions>/image/image-crop-to-content" "")
; (gtk_accel_path "<Actions>/filters/filters-polar-coordinates" "")
; (gtk_accel_path "<Actions>/brushes/brushes-new" "")
; (gtk_accel_path "<Actions>/context/context-background-hue-minimum" "")
(gtk_accel_path "<Actions>/tools/tools-rotate" "")
; (gtk_accel_path "<Actions>/image/image-convert-double" "")
; (gtk_accel_path "<Actions>/view/view-zoom-1-8" "<Shift>4")
; (gtk_accel_path "<Actions>/context/context-background-green-decrease-skip" "")
(gtk_accel_path "<Actions>/edit/edit-fill-fg" "<Alt>BackSpace")
(gtk_accel_path "<Actions>/tools/tools-scale" "<Primary>t")
; (gtk_accel_path "<Actions>/context/context-brush-select-last" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-distress-selection" "")
; (gtk_accel_path "<Actions>/edit/undo-popup" "")
; (gtk_accel_path "<Actions>/layers/layers-mode-first" "")
; (gtk_accel_path "<Actions>/view/view-zoom-1-16" "<Shift>5")
; (gtk_accel_path "<Actions>/dockable/dockable-add-tab-menu" "")
; (gtk_accel_path "<Actions>/context/context-tool-select-previous" "")
; (gtk_accel_path "<Actions>/channels/channels-color-tag-gray" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-error-console" "")
; (gtk_accel_path "<Actions>/context/context-foreground-value-maximum" "")
; (gtk_accel_path "<Actions>/channels/channels-raise" "")
; (gtk_accel_path "<Actions>/context/context-background-red-set" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-perspective-shadow" "")
; (gtk_accel_path "<Actions>/context/context-opacity-decrease" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-newsprint" "")
; (gtk_accel_path "<Actions>/filters/filters-cubism" "")
; (gtk_accel_path "<Actions>/filters/filters-motion-blur-circular" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-max-rgb" "")
; (gtk_accel_path "<Actions>/context/context-gradient-menu" "")
; (gtk_accel_path "<Actions>/plug-in/gimp-online-docs-web-site" "")
; (gtk_accel_path "<Actions>/vectors/vectors-color-tag-green" "")
; (gtk_accel_path "<Actions>/vectors/vectors-copy" "")
; (gtk_accel_path "<Actions>/view/view-zoom-1-4" "<Shift>3")
; (gtk_accel_path "<Actions>/image/image-resize" "")
; (gtk_accel_path "<Actions>/context/context-palette-foreground-last" "")
; (gtk_accel_path "<Actions>/filters/filters-pixelize" "")
; (gtk_accel_path "<Actions>/dock/dock-close" "")
; (gtk_accel_path "<Actions>/tools/tools-airbrush-rate-decrease-skip" "")
; (gtk_accel_path "<Actions>/tools/tools-shear" "<Shift>h")
; (gtk_accel_path "<Actions>/context/context-background-green-minimum" "")
; (gtk_accel_path "<Actions>/view/view-snap-to-canvas" "")
; (gtk_accel_path "<Actions>/view/view-scroll-left-border" "")
; (gtk_accel_path "<Actions>/plug-in/python-fu-slice" "")
; (gtk_accel_path "<Actions>/windows/windows-show-display-next" "<Alt>Tab")
; (gtk_accel_path "<Actions>/windows/windows-hide-docks" "Tab")
; (gtk_accel_path "<Actions>/view/view-show-layer-boundary" "")
; (gtk_accel_path "<Actions>/file/file-save" "<Primary>s")
; (gtk_accel_path "<Actions>/layers/layers-composite-space-rgb-linear" "")
; (gtk_accel_path "<Actions>/tools/tools-paint-brush-size-decrease" "")
; (gtk_accel_path "<Actions>/context/context-background-hue-decrease" "")
; (gtk_accel_path "<Actions>/brushes/brushes-copy-location" "")
; (gtk_accel_path "<Actions>/filters/filters-noise-slur" "")
; (gtk_accel_path "<Actions>/view/view-zoom-1-2" "<Shift>2")
; (gtk_accel_path "<Actions>/image/image-menu" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-photocopy" "")
; (gtk_accel_path "<Actions>/tools/tools-blend" "")
; (gtk_accel_path "<Actions>/edit/edit-paste-as-menu" "")
; (gtk_accel_path "<Actions>/tools/tools-select-menu" "")
(gtk_accel_path "<Actions>/view/view-zoom-1-1" "<Primary><Alt>0")
; (gtk_accel_path "<Actions>/plug-in/plug-in-warp" "")
; (gtk_accel_path "<Actions>/dockable/dockable-preview-size-huge" "")
; (gtk_accel_path "<Actions>/dockable/dockable-tab-style-automatic" "")
; (gtk_accel_path "<Actions>/layers/layers-mask-edit" "")
; (gtk_accel_path "<Actions>/windows/windows-show-tabs" "")
; (gtk_accel_path "<Actions>/layers/layers-mask-add-last-values" "")
; (gtk_accel_path "<Actions>/plug-in/file-raw-save" "")
(gtk_accel_path "<Actions>/image/image-merge-layers" "")
; (gtk_accel_path "<Actions>/filters/filters-noise-perlin" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-destripe" "")
; (gtk_accel_path "<Actions>/dockable/dockable-tab-style-icon-name" "")
; (gtk_accel_path "<Actions>/dockable/dockable-preview-size-large" "")
; (gtk_accel_path "<Actions>/layers/layers-color-tag-green" "")
; (gtk_accel_path "<Actions>/context/context-background-red-decrease-skip" "")
; (gtk_accel_path "<Actions>/tools/tools-size-decrease-skip" "<Shift>bracketleft")
; (gtk_accel_path "<Actions>/dockable/dialogs-selection-editor" "")
; (gtk_accel_path "<Actions>/quick-mask/quick-mask-configure" "")
; (gtk_accel_path "<Actions>/filters/filters-cartoon" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-fractalexplorer" "")
; (gtk_accel_path "<Actions>/view/view-softproof-profile" "")
; (gtk_accel_path "<Actions>/view/view-rotate-270" "")
; (gtk_accel_path "<Actions>/vectors/vectors-lower-to-bottom" "")
; (gtk_accel_path "<Actions>/context/context-colormap-background-set" "")
; (gtk_accel_path "<Actions>/layers/layers-color-tag-gray" "")
; (gtk_accel_path "<Actions>/tools/tools-paintbrush-size-set" "")
; (gtk_accel_path "<Actions>/brushes/brushes-popup" "")
; (gtk_accel_path "<Actions>/dock/dock-show-image-menu" "")
(gtk_accel_path "<Actions>/context/context-brush-hardness-increase-skip" "braceright")
; (gtk_accel_path "<Actions>/plug-in/script-fu-selection-to-pattern" "")
; (gtk_accel_path "<Actions>/documents/documents-clear" "")
; (gtk_accel_path "<Actions>/plug-in/script-fu-carve-it" "")
; (gtk_accel_path "<Actions>/plug-in/plug-in-plug-in-details" "")
(gtk_accel_path "<Actions>/context/context-brush-select-previous" "comma")
; (gtk_accel_path "<Actions>/context/context-palette-background-set" "")
(gtk_accel_path "<Actions>/tools/tools-eraser" "e")
(gtk_accel_path "<Actions>/select/select-float" "")
; (gtk_accel_path "<Actions>/context/context-gradient-select-next" "")
; (gtk_accel_path "<Actions>/filters/filters-grid" "")
; (gtk_accel_path "<Actions>/tools/tools-size-decrease-percent" "")
; (gtk_accel_path "<Actions>/layers/layers-visible" "")
; (gtk_accel_path "<Actions>/documents/documents-open" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-sample-points" "")
; (gtk_accel_path "<Actions>/context/context-background-blue-decrease-skip" "")
; (gtk_accel_path "<Actions>/view/view-softproof-intent-saturation" "")
; (gtk_accel_path "<Actions>/view/view-zoom-minimum" "")
; (gtk_accel_path "<Actions>/filters/filters-rgb-clip" "")
; (gtk_accel_path "<Actions>/tools/tools-hardness-decrease-skip" "")
(gtk_accel_path "<Actions>/windows/windows-display-0009" "<Alt>9")
; (gtk_accel_path "<Actions>/context/context-background-value-maximum" "")
(gtk_accel_path "<Actions>/layers/layers-lower-to-bottom" "<Primary>braceleft")
; (gtk_accel_path "<Actions>/tools/tools-force-set" "")
; (gtk_accel_path "<Actions>/filters/filters-wind" "")
; (gtk_accel_path "<Actions>/context/context-foreground-red-minimum" "")
; (gtk_accel_path "<Actions>/filters/filters-displace" "")
; (gtk_accel_path "<Actions>/debug/debug-dump-managers" "")
; (gtk_accel_path "<Actions>/context/context-tool-select-last" "")
(gtk_accel_path "<Actions>/windows/windows-display-0008" "<Alt>8")
; (gtk_accel_path "<Actions>/filters/filters-enhance-menu" "")
; (gtk_accel_path "<Actions>/vectors/vectors-duplicate" "")
; (gtk_accel_path "<Actions>/filters/filters-engrave" "")
; (gtk_accel_path "<Actions>/vectors/vectors-selection-from-vectors" "<Shift>v")
; (gtk_accel_path "<Actions>/tools/tools-object-2-next" "")
(gtk_accel_path "<Actions>/view/view-show-guides" "<Primary>apostrophe")
; (gtk_accel_path "<Actions>/vectors/vectors-color-tag-red" "")
; (gtk_accel_path "<Actions>/view/view-zoom-other" "")
(gtk_accel_path "<Actions>/windows/windows-display-0007" "<Alt>7")
; (gtk_accel_path "<Actions>/image/image-convert-u32" "")
; (gtk_accel_path "<Actions>/dockable/dialogs-symmetry" "")
; (gtk_accel_path "<Actions>/context/context-swatch-background-previous" "")
(gtk_accel_path "<Actions>/select/select-feather" "<Primary><Shift>d")
; (gtk_accel_path "<Actions>/filters/filters-motion-blur-zoom" "")
; (gtk_accel_path "<Actions>/dialogs/dialogs-tool-presets" "")
(gtk_accel_path "<Actions>/windows/windows-display-0006" "<Alt>1")
; (gtk_accel_path "<Actions>/view/view-display-intent-saturation" "")
; (gtk_accel_path "<Actions>/tools/tools-foreground-select" "")
</file>

<file path="config/git/aliases.zsh">
#!/usr/bin/env zsh

g() { [[ $# = 0 ]] && git status --short . || git $*; }

alias cdd='cd `git rev-parse --show-toplevel`'
alias git='noglob git'
alias ga='git add'
alias gap='git add --patch'
alias gb='git branch -av'
alias gop='git open'
alias gbl='git blame'
alias gc='git commit'
alias gcm='git commit -m'
alias gca='git commit --amend'
alias gcf='git commit --fixup'
alias gcl='git clone'
alias gco='git checkout'
alias gcoo='git checkout --'
alias gf='git fetch'
alias gi='git init'
alias gl='git log --graph --pretty="format:%C(yellow)%h%Creset %C(red)%G?%Creset%C(green)%d%Creset %s %Cblue(%cr) %C(bold blue)<%aN>%Creset"'
alias gll='git log --pretty="format:%C(yellow)%h%Creset %C(red)%G?%Creset%C(green)%d%Creset %s %Cblue(%cr) %C(bold blue)<%aN>%Creset"'
alias gL='gl --stat'
alias gp='git push'
alias gpl='git pull --rebase --autostash'
alias gs='git status --short .'
alias gss='git status'
alias gst='git stash'
alias gr='git reset HEAD'
alias gv='git rev-parse'

# fzf
if (( $+commands[fzf] )); then
  __git_log () {
    # format str implies:
    #  --abbrev-commit
    #  --decorate
    git log \
      --color=always \
      --graph \
      --all \
      --date=short \
      --format="%C(bold blue)%h%C(reset) %C(green)%ad%C(reset) | %C(white)%s %C(red)[%an] %C(bold yellow)%d"
  }

  _fzf_complete_git() {
    ARGS="$@"

    # these are commands I commonly call on commit hashes.
    # cp->cherry-pick, co->checkout

    if [[ $ARGS == 'git cp'* || \
          $ARGS == 'git cherry-pick'* || \
          $ARGS == 'git co'* || \
          $ARGS == 'git checkout'* || \
          $ARGS == 'git reset'* || \
          $ARGS == 'git show'* || \
          $ARGS == 'git log'* ]]; then
      _fzf_complete "--reverse --multi" "$@" < <(__git_log)
    else
      eval "zle ${fzf_default_completion:-expand-or-complete}"
    fi
  }

  _fzf_complete_git_post() {
    sed -e 's/^[^a-z0-9]*//' | awk '{print $1}'
  }
fi
</file>

<file path="config/git/attributes">
*.lisp  diff=lisp
*.el    diff=lisp
*.org   diff=org
</file>

<file path="config/git/config">
[user]
	name = Henrik Lissner
	email = git@henrik.io
	signingKey = FA1FADD9440B688CAA75A057B60957CA074D39A3
[commit]
	gpgSign = true
[tag]
	gpgSign = true
[core]
	whitespace = trailing-space
[init]
	defaultBranch = main
[github]
	user = hlissner
[gitlab]
	user = hlissner
[push]
	autoSquash = true
[push]
	default = current
	gpgSign = if-asked
[pull]
	rebase = true
[alias]
	unadd = reset HEAD
	# data analysis
	ranked-authors = !git authors | sort | uniq -c | sort -n
	emails = !git log --format="%aE" | sort -u
	email-domains = !git log --format="%aE" | awk -F'@' '{print $2}' | sort -u
[filter "lfs"]
	required = true
	smudge = git-lfs smudge -- %f
	process = git-lfs filter-process
	clean = git-lfs clean -- %f
[diff "lisp"]
	xfuncname = "^(((;;;+ )|\\(|([ \t]+\\(((cl-|el-patch-)?def(un|var|macro|method|custom)|gb/))).*)$"
[diff "org"]
	xfuncname = "^(\\*+ +.*)$"
[credential "https://github.com"]
	helper =
	helper = !gh auth git-credential
[credential "https://gist.github.com"]
	helper =
	helper = !gh auth git-credential
</file>

<file path="config/git/ignore">
# For emacs:
*~
*.*~
\#*
.\#*

# For vim:
*.swp
.*.sw[a-z]
*.un~
.netrwhist

# OS generated files #
######################
.DS_Store?
.DS_Store
.CFUserTextEncoding
.Trash
.Xauthority
thumbs.db
Thumbs.db
Icon?

# Code stuffs #
###############
.ccls-cache/
.sass-cache/
__pycache__/

# Compiled thangs #
###################
*.class
*.exe
*.o
*.pyc
*.elc
</file>

<file path="config/hypr/bin/osd.d/brightness.zsh">
#!/usr/bin/env zsh
# Display brightness controller with an OSD popup.
#
# SYNOPSIS:
#   brightness [[+/-]LEVEL]
#
# DESCRIPTION:
#   Manipulate the screen's brightness level via brightnessctl, then follow up
#   with a chirp and OSD popup.

hey.requires brightnessctl

local sound=
if (( $(brightnessctl max) <= 1 )); then
  hey.error "This display doesn't support brightness control"
  exit 1
fi

case $1 in
  +*) sound=brightness-up ;;
  -*) sound=brightness-down ;;
  *) hey.abort -c $1 ;;
esac

IFS=, read _ _ _ state _ <<(hey.do brightnessctl set "${${1/-}/+}%-${1[1]}" -m)

hey .osd display \
  -s "$sound" \
  -p "${state%%%}" \
  -a lcd \
  "" -
</file>

<file path="config/hypr/bin/osd.d/toggle.zsh">
#!/usr/bin/env zsh
# Display a toggle OSD.
#
# TODO

hey .osd display \
  -p "${${1//--on/100}//--off/0}" \
  -a indicator \
  -s blip \
  ${@:2}
</file>

<file path="config/hypr/bin/osd.d/volume.zsh">
#!/usr/bin/env zsh
# Volume level controller with an OSD popup.
#
# SYNOPSIS:
#   volume [-i|-o|-p] [[+/-]LEVEL|toggle]
#
# DESCRIPTION:
#   Manipulate input or output volume levels via pamixer, or the volume of any
#   player controllable via playerctl, then follow up with an OSD popup.
#
#   Requires a notification program like mako that supports progress bars.
#
# OPTIONS:
#   -i
#     Affect microphone levels.
#   -o
#     Affect sound output levels.
#   -p
#     Affect any players controllable via playerctl (mainly spotify). Does not
#     support toggle.

zparseopts -E -D -- {o,i}=dev p:=player

case $1 in
  toggle) sound=volume-toggle ;;
  +*)     sound=volume-up     ;;
  -*)     sound=volume-down   ;;

  *) hey.abort $1 ;;
esac

if [[ $player ]]; then
  hey.requires playerctl
  case ${player[2]} in
    spotify) icon="" ;;
    # TODO: Add ncmpcpp/mpd/mpc?
    *) icon=""
  esac
  case $1 in
    toggle) hey.abort "Cannot toggle the player's volume" ;;
    +*) hey.do playerctl -p "${player[2]}" volume $(( ${1#+} / 100.0 ))+ ;;
    -*) hey.do playerctl -p "${player[2]}" volume $(( ${1#-} / 100.0 ))- ;;
  esac
  state=$(playerctl -p "${player[2]}" volume)
  if [[ -z $state ]]; then
    hey.error "Could not read volume from player: ${player[2]}"
    exit 1
  fi
  state=$(( state * 100.0 ))
  app=vol
else
  case $dev in
    -i)
      hey.requires pamixer
      case $1 in
        toggle) hey.do pamixer --default-source -t ;;
        +*)     hey.do pamixer --default-source -i ${1#+}+ ;;
        -*)     hey.do pamixer --default-source -d ${1#-}- ;;
      esac
      state=$(pamixer --default-source --get-volume)
      if [[ $(pamixer --default-source --get-mute) == true ]] || (( state <= 1 )); then
        state=0
        icon=""
      elif (( state > 1 )); then
        icon=""
      fi
      app=mic
      ;;
    -o|'')
      hey.requires pamixer
      case $1 in
        toggle) hey.do pamixer -t ;;
        +*)     hey.do pamixer -i ${1#+} ;;
        -*)     hey.do pamixer -d ${1#-} ;;
      esac
      state=$(pamixer --get-volume)
      if [[ $(pamixer --get-mute) == true ]] || (( state <= 1 )); then
        state=0
        icon=""
      elif (( state > 1 )); then
        icon=""
      fi
      app=vol
      ;;
  esac
fi

hey .osd display \
  -p "$state" \
  -a "$app" \
  -s "$sound" \
  "$icon" "$state"
</file>

<file path="config/hypr/bin/scratch.d/emacs">
#!/usr/bin/env zsh

emacs --eval '(doom-big-font-mode +1)'
</file>

<file path="config/hypr/bin/scratch.d/term">
#!/usr/bin/env zsh
#
# TODO

hey .open-term -t scratch-term -o colors.alpha=0.8 -o main.pad=12x12 &
sleep 0.1

hyprctl dispatch cyclenext
</file>

<file path="config/hypr/bin/export-env.zsh">
#!/usr/bin/env zsh
# Propagate envvars to systemd or tmux.
#
# SYNOPSIS:
#   export-env [systemd|tmux] [ENVVARS...]
#
# DESCRIPTION:
#   Propagate ENVVARS to an external tool (like systemd or tmux). If ENNVARS are
#   omitted, a set of sensible envvars are exported. If given -a or --all, the
#   whole environment is exported (dangerous!).
#
# SUBCOMMANDS:
#   tmux         import to tmux server
#   system       import to systemd and dbus user session
#
# OPTIONS:
#   -a, --all
#     Export the whole environment, rather than just a select few.

zparseopts -E -D -F -- {a,-all}=all || exit 1

local -a _envs
if (( $# > 1 )); then
  _envs=( ${@:2} )
elif [[ $all ]]; then
  _envs=( $(env | cut -d= -f 1 | grep -vE '^_') )
else
  _envs=(
    # display
    WAYLAND_DISPLAY
    DISPLAY
    # xdg
    USERNAME
    XDG_BACKEND
    XDG_CURRENT_DESKTOP
    XDG_SESSION_TYPE
    XDG_SESSION_ID
    XDG_SESSION_CLASS
    XDG_SESSION_DESKTOP
    XDG_SEAT
    XDG_VTNR
    # bspwm
    BSPWM_SOCKET
    # hyprland
    HYPRLAND_CMD
    HYPRLAND_INSTANCE_SIGNATURE
    # sway
    SWAYSOCK
    # misc
    XCURSOR_THEME
    XCURSOR_SIZE
    GTK_THEME
    # toolkit
    _JAVA_AWT_WM_NONREPARENTING
    QT_QPA_PLATFORM
    QT_WAYLAND_DISABLE_WINDOWDECORATION
    GRIM_DEFAULT_DIR
    # ssh
    SSH_AUTH_SOCK
  )
fi

for v in "${_envs[@]}"; do
  if [[ -n ${(P)v} ]]; then
    hey.log "$v = ${(P)v}"
  fi
done
main() {
  case $1 in
    systemd)
      systemctl --user import-environment "${_envs[@]}"
      echo "Exported to systemd: ${_envs[@]}"
      # Not necessary for dbus-broker, which simply uses the systemd environment
      if (( $+commands[dbus-update-activation-environment] )); then
        dbus-update-activation-environment --systemd "${_envs[@]}"
        echo "Exported to dbus"
      fi
      ;;
    tmux)
      for v in "${_envs[@]}"; do
        if [[ -n ${(P)v} ]]; then
          tmux setenv -g "$v" "${(P)v}"
        fi
      done
      echo "Exported to tmux"
      ;;
    *)
      hey.error -D "$ZSH_ARGZERO" -c "$1"
      exit 1
      ;;
  esac
}

main $@
</file>

<file path="config/hypr/bin/get-activeworkspace.sh">
#!/usr/bin/env dash
# Retrieve the { id:, name: } of the (truly) active workspace.
#
# SYNOPSIS:
#   get-activeworkspace [JQ_ARGS...]
#
# DESCRIPTION.
#   Retrieve the { id:, name: } of the (truly) active workspace (does not ignore
#   special workspaces like `hyprctl activeworkspace` does).
#
#   Any arguments are passed to jq.

hyprctl monitors -j \
    | jq -r ".[] | select(.focused)
                 | if .specialWorkspace.id != 0
                   then .specialWorkspace
                   else .activeWorkspace end | ${@:-.}"
</file>

<file path="config/hypr/bin/get-font.zsh">
#!/usr/bin/env zsh
# Return the primary terminal font.
#
# SYNOPSIS:
#   get-font [--xft|-c|-s|-n]
#
# DESCRIPTION:
#   TODO

local font="$(hey info theme fonts terminal | jq -r '. | "\(.name);\(.size)"')"
local fontname="${font/;*/}"
local fontsize="${font/*;/}"

zparseopts -E -D -F -- {c,n,s,-xft}=opts || exit 1
if [[ -z $opts ]]; then
  echo "${fontname}:size=${fontsize}"
else
  case ${opts[1]} in
    *--xft*) echo "$fontname-$fontsize" ;;
    *-c*) echo "$fontname,$fontsize" ;;
    *-n*) echo $fontname ;;
    *-s*) echo $fontsize ;;
  esac
fi
</file>

<file path="config/hypr/bin/get-window.zsh">
#!/usr/bin/env zsh
# Select a window with slurp and get it's hyprctl metadata.
#
# SYNOPSIS:
#   get-window [-w]
#
# DESCRIPTION:
#   TODO

main() {
  local hypr_tree=$(hyprctl clients -j)

  local cond_str
  for id in $(hyprctl monitors -j | jq '.[] | .activeWorkspace.id'); do
    cond_str="${cond_str}${cond_str:+ or }.workspace.id == $id"
  done

  if [[ -z "$1" ]]; then
    local prefix="/tmp/hypr.get-window"
    local out_file=$prefix.tmp
    local error_file=$prefix.err
    echo "$hypr_tree" | jq -r ".[] | select($cond_str)" \
                      | jq -r ".at,.size" | jq -s "add" | jq '_nwise(4)' \
                      | jq -r '"\(.[0]),\(.[1]) \(.[2])x\(.[3])"' \
                      | slurp -r > $out_file 2> $error_file &
    PID=$!
    wait $PID

    local error=$(cat $error_file)
    rm -f $error_file

    local selection=$(cat $out_file)
    rm -f $out_file

    [ -n "$error" ] && main  # invalid box format: null,null nullxnull
  else
    selection=$1
  fi

  if [[ -z "$selection" ]]; then
    hey.error "No selection"
    exit 1
  fi

  local x=$(echo "$selection" | awk -F'[, x]' '{print $1}')
  local y=$(echo "$selection" | awk -F'[, x]' '{print $2}')
  local w=$(echo "$selection" | awk -F'[, x]' '{print $3}')
  local h=$(echo "$selection" | awk -F'[, x]' '{print $4}')

  # Find the window matching the selection
  echo "$hypr_tree" | jq -r ".[] | select(($cond_str) and
                                          .at[0] == $x and .at[1] == $y and
                                          .size[0] == $w and .size[1] == $h)"
}

main "$@"
</file>

<file path="config/hypr/bin/lock.zsh">
#!/usr/bin/env zsh
# Launch hyprlock.
#
# SYNOPSIS:
#  lock [OPTIONS]
#
# DESCRIPTION:
#   A wrapper around hyprlock that is able to modify its settings on a per-call
#   basis, for specialized use-cases.
#
# OPTIONS:
#   --bg IMAGE
#   --bg-color COLOR
#   --no-blur
#   --brightness FLOAT
#   --no-fade-{in,out}

if (( $# > 0 )); then
  local tmpfile=$(hey path runtime hyprlock.tmp.conf)
  trap "rm -f '$tmpfile'" EXIT

  zparseopts -D -- -no-fade-in=fadein \
                   -no-fade-out=fadeout \
                   -grace:=grace \
                   -bg:=bg \
                   -bg-color:=bgcolor \
                   -no-blur=blur \
                   -brightness:=brightness

  local monitor=
  cat <<EOF >"$tmpfile"
    source = ~/.config/hypr/hyprlock.conf
    general {
      ${fadein:+no_fade_in = true}
      ${fadeout:+no_fade_out = true}
      ${grace:+grace = ${grace[2]}}
    }
EOF

  # hyprlock breaks trying to take screenshots on nvidia machines, so I gotta
  # shim support in myself.
  #
  # @see hyprwm/hyprlock#59
  if [[ ${bg[2]} == screenshot ]]; then
    local -a files=( -l 0 )
    for m in $(hyprctl monitors -j | jq -r '.[].name'); do
      files+="/tmp/hyprlock.$m.png"
      echo "Taking ${files[-1]}"
      hey.do -! grim -l 0 -o "$m" "${files[-1]}" &
      cat <<EOF >>"$tmpfile"
        background {
          monitor = $m
          path = ${files[-1]}
          ${bgcolor:+color = ${bgcolor[2]}}
          ${blur:+blur_passes = 0}
          ${brightness:+brightness = ${brightness[2]}}
        }
EOF
    done
    echo waiting
    while pidof -s grim >/dev/null; do sleep 0.25; done
    trap "rm -f ${files[*]}" EXIT
  else
    cat <<EOF >>"$tmpfile"
      background {
        monitor =
        ${bg:+path = ${bg[2]}}
        ${bgcolor:+color = ${bgcolor[2]}}
        ${blur:+blur_passes = 0}
        ${brightness:+brightness = ${brightness[2]}}
      }
EOF
  fi

  hey.log -3 "$tmpfile"

  exec hyprlock -c "$tmpfile" $@
fi

exec hyprlock $@
</file>

<file path="config/hypr/bin/open-term.zsh">
#!/usr/bin/env zsh
# Open a foot terminal.
#
# SYNOPSIS:
#   open-term [TITLE] [COMMAND] [ARGS...]
#
# DESCRIPTION:
#   Opens a foot terminal with a new Tmux session. If opened from a special
#   (Hypr) workspace, a larger font and lower opacity is used.

zparseopts -E -D -F -- o+:=opts \
                       {t,-title}:=title \
                       {f,-font}:=font \
                       {F,-font-adjust}:=font_offset || exit 1

local offset=$(( ${font_offset[2]:-0} ))
local idx=${@[(i)(--)]}
local -a footopts=( ${@[1,$idx-1]} )
local -a tmuxopts=( ${@[$idx+1,-1]} )

if [[ "$(hey .get-activeworkspace .name)" == special:* ]]; then
  offset=$(( offset + 1 ))
fi

if [[ $title ]]; then
  footopts=( -T "${title[2]}" ${footopts[@]} )
  tmuxopts=( new -A -s "${title[2]}" ${tmuxopts[@]} )
elif (( ${#tmuxopts} )); then
  tmuxopts=( -c "${tmuxopts[@]}" )
fi

if [[ -z "$font" ]]; then
  font=( -f "$(hey info theme fonts terminal | jq -r '. | "\(.name):size=\(.size)"')" )
fi

fontname="${font[2]%%:*}"
fontsize="${${font[2]//*:*size=}%%:*}"
footopts+=( -o "main.font=${fontname}:size=$(( fontsize + offset ))" ${opts[@]} )

hey.do foot "${footopts[@]}" -- tmux ${tmuxopts[@]}
</file>

<file path="config/hypr/bin/osd.zsh">
#!/usr/bin/env zsh
# Show an on-screen display (w/ volume/brightness control)
#
# SYNOPSIS:
#   osd COMMAND [ARGS...]
#
# DESCRIPTION:
#   Presents an on-screen display to indicate the status of some feature,
#   typically screen brightness and volume control. Can also be used as a more
#   general OSD display command.
#
# DEPENDENCIES:
#   notify-send
#
# OPTIONAL DEPENDENCIES:
#   pamixer, playerctl   -- for osd.d/volume.zsh
#   brightnessctl        -- for osd.d/brightness.zsh

hey.osd.display() {
  zparseopts -E -D -F -- \
    p:=value P=stay a:=app s:=sound {u,t,i}:=pass h+:=hints \
    || return 1
  local p=${value[2]:-0}
  local a=${app[2]:-hey}
  hey.do notify-send \
      -a OSD \
      ${pass[@]} \
      ${hints[@]} \
      ${stay:+--expire-time=999999999} \
      -h string:x-canonical-private-synchronous:osd \
      -h string:category:$a \
      -h "int:value:${value[2]:-0}" \
      "${${@:2}:--}" "<span alpha='$(printf "%d" $(( p >= 80 ? 100 : p + 20 )))%'>$1</span>"
  [[ -n $sound ]] && hey .play-sound -v 0.7 "${sound[2]}"
}

case $1 in
  display) hey.osd.display ${@:2} ;;

  *) hey.abort "Unknown command: $1" ;;
esac
</file>

<file path="config/hypr/bin/picker.zsh">
#!/usr/bin/env zsh
# Use hyprpicker to grab the color on screen.
#
# SYNOPSIS:
#   picker [FMT]
#
# DESCRIPTION:
#   A thin wrapper around hyprpicker to emit notifications and sounds, so I have
#   more feedback when I use it.

main() {
  hey.requires hyprpicker
  local clr=$(hyprpicker -f"${1:-hex}" -a)
  [[ -z "$clr" ]] && return 1
  hey.do notify-send \
    -a hey.picker \
    -h string:x-canonical-private-synchronous:osd \
    "Copied to clipboard" \
    "$clr"
  hey .play-sound blip
}

main $@
</file>

<file path="config/hypr/bin/play-sound.zsh">
#!/usr/bin/env zsh
# Plays a notification sound.
#
# SYNPOSIS:
#   play-sound NAME
#
# DESCRIPTION:
#   TODO

if (( $# == 0 )); then
  hey.error "Name of sound required"
  exit 2
fi

local dir=$(hey path theme sounds)
if [[ "$1" == "ls" ]]; then
  ls -l "$dir"
else
  [[ $(makoctl mode) == dnd ]] && return
  hey.requires play
  zparseopts -E -D -F -- v:=volume || exit 1
  local file=$(echo "$dir"/$1.{ogg,wav,mp3}(-.N[1]))
  if [[ -z $file ]]; then
    hey.error "Unrecognized sound: $1"
    exit 1
  fi
  hey.do play -q $volume $file &
fi
</file>

<file path="config/hypr/bin/quitactive.zsh">
#!/usr/bin/env zsh
# Kill the selected window.
#
# SYNOPSIS:
#   quitactive
#
# DESCRIPTION:
#   Unlike the closewindow (or killactive) dispatchers, this actually tries to
#   elegantly (but immediately) kill the target application window.

local pid=$(hyprctl activewindow -j | jq .pid)
[[ $pid ]] && kill -SIGTERM "$pid"
</file>

<file path="config/hypr/bin/screencast.zsh">
#!/usr/bin/env zsh
# Record a region of the screen to clipboard.
#
# SYNOPSIS:
#   screencast [webm|mp4|gif] [X,Y WxH]
#
# DESCRIPTION:
#   Prompts the user to select a region, window, or monitor to begin recording
#   with wf-recorder. Produces a webm by default, but can also produce mp4' or
#   gifs
#
# DEPENDENCIES:
#   wf-recorder, ffmpeg, gifsicle*
#
#   * Is auto-installed with cached-nix-shell when needed.

.notify() {
  hey.do notify-send \
    -a hey.screencast \
    -h string:x-canonical-private-synchronous:osd \
    -h string:category:preview \
    $@
}

main() {
  hey.requires wf-recorder ffmpeg

  local prefix=$(hey path runtime screencast)
  local livefile=$prefix.live
  local thumbfile=$prefix.thumb.png
  local file
  local -a opts=()
  if [[ -f "$livefile" ]]; then
    pkill -SIGINT wf-recorder
    return
  fi
  case "${1:-webm}" in
    webm)
      file="$prefix.webm"
      opts+=( --audio -x yuv420p -c libvpx -C libvorbis )
      ;;
    mp4)
      file="$prefix.mp4"
      opts+=( --audio -x yuv420p )
      wf-recorder -g "$1" --audio --file="$file" &
      ;;
    gif)
      file="$prefix.gif"
      opts+=( --codec gif )
      ;;
    *) hey.abort "Unknown format: $1" ;;
  esac
  rm -f "$file"
  touch "$livefile"
  trap "rm -f '$thumbfile' '$livefile'" EXIT SIGINT SIGTERM
  local geom="$(hey .slurp ${2:-region})"
  [[ -z "$geom" ]] && exit 1
  hey .osd toggle --on -P "" "Recording started"
  if wf-recorder -g "$geom" ${opts[@]} --file="$file"; then
    sleep 0.1
    hey .osd toggle --off "" "Recording ended"
    hey.do ffmpeg -y -i "$file" -frames:v 1 "$thumbfile"
    if [[ $1 == gif ]]; then
      .notify -i "$thumbfile" -u low "Optimizing gif" "This may take a while..."
      hey.do -! gifsicle --optimize=3 "$file"
    fi
    echo "file://$file" | wl-copy -t text/uri-list
    .notify -i "$thumbfile" "Ended recording" "Sent uri to clipboard"
  fi
}

main $@
</file>

<file path="config/hypr/bin/screendraw.zsh">
#!/usr/bin/env zsh
# Toggle drawing on the screen.
#
# SYNOPSIS:
#   screendraw
#
# DESCRIPTION:
#   Temporarily launches gromit-mpx, enabling you to draw on the screen. Also
#   includes OSD indicators.
#
# DEPENDENCIES:
#   gromit-mpx

#
#   There
#           can only
#
#
#                        be
#
#                              one.
#
if pidof gromit-mpx >/dev/null; then
  pkill gromit-mpx
  exit
fi

# gromit-mpx lacks CLI options to configure it, but I insist on using it as a
# one-shot on-demand tool, so...
local inifile=$XDG_CONFIG_HOME/gromit-mpx.ini
cat >$inifile <<-EOF
  [General]
  ShowIntroOnStartup=false
EOF

local cfgfile=$XDG_CONFIG_HOME/gromit-mpx.cfg
cat >$cfgfile <<EOF
  "red Pen" = PEN (size=5 color="red");
  "blue Pen" = "red Pen" (color="blue");
  "yellow Pen" = "red Pen" (color="yellow");
  "green Marker" = PEN (size=6 color="green" arrowsize=1);

  "Eraser" = ERASER (size = 75);

  "default" = "red Pen";
  "default"[SHIFT] = "blue Pen";
  "default"[CONTROL] = "yellow Pen";
  "default"[2] = "green Marker";
  "default"[Button3] = "Eraser";
EOF
trap "rm -f '$cfgfile' '$inifile'" EXIT

hey .osd toggle --on -P "" "Screen draw on"
hyprctl keyword decoration:dim_inactive false
# Wayland backend is unreliable on hyprland.
GDK_BACKEND=x11 hey.do gromit-mpx --active
hyprctl keyword decoration:dim_inactive true
hey .osd toggle --off "" "Screen draw off"
</file>

<file path="config/hypr/bin/screenshot.zsh">
#!/usr/bin/env zsh
# Capture (and edit) a screenshot to clibpoard.
#
# SYNOPSIS:
#   screen-capture [-e] [-o|--optimize] [-f FILE] [region|window|output]
#
# DESCRIPTION:
#   Captures a screenshot, optionally piping it through swappy, then optimizing
#   it with pngquant, before writing it to the clipboard (or to FILE). Also
#   notifies you once it's complete (with the screenshot as the notification
#   icon).
#
# OPTIONS:
#   -o, --optimize
#     Run pngquant on resulting png.
#   -s, --swappy
#     After capturing the image, invoke swappy on it (for quick editing).
#   -f FILE
#     Write the resulting file to FILE rather than to the clipboard.

main() {
  hey.requires hyprshot ${swappy:+swappy}
  if pidof -s hyprshot >/dev/null; then
    hey.error "Hyprshot already running. Aborting..."
    exit 0
  fi

  zparseopts -E -D -F -- {s,-swappy}=swappy f:=dest c:=countdown {o,-optimize}=optimize || return 1
  local file="${dest[2]:-$(hey path runtime screencapture.png)}"
  hey.do hyprshot --silent --mode "${1:-region}" -o "$(dirname $file)" -f "$(basename $file)"

  # It seems hyprshot exits before it's done writing the file...
  local timer=0.0
  while [[ ! -s "$file" ]]; do
    if (( timer >= 3.0 )); then
      echo "File not created at $file" >&2
      return 1
    fi
    sleep 0.1
    timer+=0.1
  done

  [[ $dest ]] || trap "rm -f '$file'" EXIT
  if [[ $swappy ]]; then
    hey.do swappy -f "$file" -o "$file" || return 1

    # Provide some feedback that the process is progressing as intended.
    hey .play-sound blip
  fi
  if [[ $optimize ]]; then
    hey.do -o pngquant -f --ext .png --quality 90-95 "$file"
  fi
  wl-copy --type image/png <"$file"
  hey.do notify-send \
    -a hey.screenshot \
    -i $file \
    -h string:x-canonical-private-synchronous:osd \
    -h string:category:preview \
    "Sent screenshot to ${dest[2]:-clipboard}"
  hey .play-sound blip
}

main $@
</file>

<file path="config/hypr/bin/set-monitors.zsh">
#!/usr/bin/env zsh
# Enable given monitors and disable the rest.
#
# Why not just use the monitor= directives in hyprland.conf? Because it has
# issues with setting default modes for monitors that I want to be disabled at
# startup (like the TV connected to my system).
#
# SYNOPSIS:
#   set-monitors [--on|--off] [OUTPUTS...]
#   set-monitors HDMI-A-1
#
# OPTIONS:
#   --on
#     Only activate the given displays (i.e. don't disable the rest).
#   --off
#     Only deactivate the given displays (i.e. don't enable the rest).

hypr.is-monitor-on() {
  local state=$(hyprctl monitors all -j | jq -r --arg m "$1" '.[] | select(.name == $m) | .disabled')
  hey.log -3 "${0} '$1' == '$state'"
  [[ "$state" == false ]]
}

hypr.set-layout() {
  hey.log -3 "${0} $@"
  zparseopts -E -D -K -- {-on,-off}=mode || exit 1
  local -a to_enable=()
  local -a to_disable=( $(hyprctl monitors all -j | jq -r '.[] | select(.name | test("^Unknown") | not) | .name') )
  for mon in $@; do to_enable+=$mon; done
  to_disable=( ${to_disable:|to_enable} )

  local -a commands=()
  if [[ ${mode[1]} != --off ]]; then
    hey.log -2 "${0} enable: [ ${to_enable[@]} ]"
    for mon in ${to_enable[@]}; do
      commands+=( "${monitors[$mon]}" )
    done
  fi
  if [[ ${mode[1]} != --on ]]; then
    hey.log -2 "${0} disable: [ ${to_disable[@]} ]"
    for mon in ${to_disable[@]}; do
      commands+=( "$mon,disable" )
    done
  fi
  hey.do hyprctl --batch \
    keyword monitor ${(j. \; keyword monitor .)commands} >/dev/null
  [[ -n "$to_enable" ]] && sleep 0.25  # wait for settings to take effect
  for mon in ${to_enable[@]}; do
    # For some reason, hyprctl struggles to turn on some displays the first
    # time, so wlr-randr is needed.
    local output=${mon/,*/}
    if ! hypr.is-monitor-on "$output"; then
      hey.log -3 "wlr-randr: $output"
      hey.do wlr-randr --output "$output" --on
    fi
  done
}

declare -gxA monitors
for m in $(hey info hypr monitors | jq -r '.[] | "\(.output),\(.mode),\(.position),\(.scale)"' 2>/dev/null); do
  hey.log -3 "Found rule: $m"
  monitors[${m/,*/}]=$m
done
if (( $#monitors == 0 )); then
  hey.error "No monitor rules found! Is hey.info.hypr.monitors set?"
  exit 1
fi
hypr.set-layout $@
</file>

<file path="config/hypr/bin/slurp.zsh">
#!/usr/bin/env zsh
# Select a monitor, region, or window with slurp.
#
# SYNOPSIS:
#   slurp [output|region|window] [...]
#
# DESCRIPTION:
#   Extends slurp to more closely mirror slop's interface. Passes all arguments
#   to slurp.

case $1 in
  '') slurp $@ ;;

  output)
    slurp -o ${@:2}
    ;;
  region)
    slurp ${@:2}
    ;;
  window)
    local cond_str
    for id in $(hyprctl -i 0 monitors -j | jq '.[] | .activeWorkspace.id'); do
      cond_str="${cond_str}${cond_str:+ or }.workspace.id == $id"
    done
    hyprctl clients -j | jq -r ".[] | select($cond_str) | .at,.size" \
                       | jq -s "add | _nwise(4)" \
                       | jq -r '"\(.[0]),\(.[1]) \(.[2])x\(.[3])"' \
                       | slurp -r ${@:2}
    ;;
esac
</file>

<file path="config/hypr/bin/toggle-zoom.zsh">
#!/usr/bin/env zsh
# Toggle screen zoom.
#
# SYNOPSIS:
#   toggle-zoom [SCALE]
#
# DESCRIPTION:
#   When you gotta see, but things are too dang small. Or you want to point out
#   something to someone. Who knows.
#
#   SCALE defaults to 2.0 if omitted.

local scale="${1:-2.0}"
local zoom=$(( $(hyprctl getoption -j cursor:zoom_factor | jq -r .float) ))
zoom=$(( zoom == 1.0 ? zoom * scale : 1.0 ))
exec hyprctl keyword cursor:zoom_factor "$zoom"
</file>

<file path="config/hypr/hooks/all.zsh">
#!/usr/bin/env zsh
# Fallback event handler for uncaught hooks.
#
# SYNOPSIS:
#   TODO
#
# DESCRIPTION:
#   TODO

# case $1 in
#   Nada
# esac
</file>

<file path="config/hypr/hooks/battery.zsh">
#!/usr/bin/env zsh
# React to changes in the battery's state.
#
# SYNOPSIS:
#   on-battery --discharging
#   on-battery --charging
#   on-battery [--low|--normal|--high|--full|--critical|--poll] STATUS CHARGE REMAINING
#
# DESCRIPTION:
#   TODO

case $1 in
  --discharging)
    hyprctl --batch \
      keyword decoration:blur:enabled false \; \
      keyword decoration:shadow:enabled false

    if (( $+commands[brightnessctl] )); then
      if (( ($(brightnessctl get) / $(brightnessctl max).0) > 0.2 )); then
        brightnessctl -m -s set 20%
      fi
    fi
    hey .osd toggle --off "" "Disconnected from power"
    ;;

  --charging)
    hyprctl --batch \
      keyword decoration:blur:enabled true \; \
      keyword decoration:shadow:enabled true

    if (( $+commands[brightnessctl] )); then
      brightnessctl -m -r
    fi
    hey .osd toggle --on "" "Reconnected to power"
    ;;

  --critical)
    hey .osd display \
      -a toggle \
      -s battery-low \
      -p 100 \
      -u critical \
      "" "$remaining"
    ;;

  # Intentionally no-op
  --low) ;;
  --normal) ;;
  --high) ;;
  --full) ;;

  --poll)
    local status=$1
    local charge=$2
    local remaining=$3

    local laststate=$(hey get hypr.hook.on-battery.state)
    local state=

    if (( charge < 10 )); then
      state=critical
      echo 10
    elif (( charge < 25 )); then
      state=low
      echo 30
    elif (( charge < 50 )); then
      state=normal
      echo 1m
    elif (( charge <= 98 )); then
      state=high
      echo 5m
    else
      state=full
      echo 10m
    fi

    if [[ $state != $laststate ]]; then
      hey hook battery --$state "$charge" "$remaining" >/dev/null
      hey set hypr.hook.on-battery.state "$state"
    fi
    ;;
esac
</file>

<file path="config/hypr/hooks/gamemode.zsh">
#!/usr/bin/env zsh
# Display notifications about gamemode's state.
#
# SYNOPSIS:
#   on-gamemode 1
#   on-gamemode 0
#
# DESCRIPTION:
#   Display a notification indicating the status of gamemode. This ought to be
#   triggered by gamemode's start/end hooks.
#
#   @see modules/desktop/apps/steam.nix.

_osd() {
  hey .osd toggle "${${3//0/--off}//1/--on}" "$1" "$2"
}

local icon=
case $1 in
  --on)
    echo "Started gamemode..."
    hey.do hyprctl --batch \
      keyword decoration:blur:enabled 0 \; \
      keyword decoration:shadow:enabled 0 \; \
      keyword general:allow_tearing 1 \; \
      keyword animations:enabled 0 \; \
      keyword misc:vrr 1
    _osd "$icon" "Gamemode started" 1
    makoctl mode -s dnd
    ;;
  --off)
    echo "Stopped gamemode..."
    hey.do hyprctl --batch \
      keyword decoration:blur:enabled 1 \; \
      keyword decoration:shadow:enabled 1 \; \
      keyword general:allow_tearing 0 \; \
      keyword animations:enabled 1 \; \
      keyword misc:vrr 0
    makoctl mode -s default
    _osd "$icon" "Gamemode ended" 0
    sleep 1
    systemctl stop --user gamemoded.service
    ;;
esac
</file>

<file path="config/hypr/hooks/idle.zsh">
#!/usr/bin/env zsh
# React to various idle states.
#
# SYNOPSIS:
#   idle [--on|--off] [dpms|lock|sleep]
#
# SYNOPSIS:
#   Triggered when there's a change in idle state. Requires a tool like
#   hypridle, swayidle, etc to call it.

case $2 in
  '')
    case $1 in
      --on)
        sleep 0.2
        if (( $+commands[brightnessctl] )); then
          brightnessctl -m -s set 10
        else
          # A poor man's screen dimmer
          hey set hypr.hook.last-shader "$(hyprshade current)"
          hyprshade on screen-dim
        fi
        ;;
      --off)
        if (( $+commands[brightnessctl] )); then
          brightnessctl -m -r
        else
          local sh="$(hey get hypr.hook.last-shader)"
          if [[ -n "$sh" ]]; then
            hyprshade on "$sh"
          else
            hyprshade off
          fi
        fi
        ;;
    esac
    ;;

  dpms)
    sleep 0.2
    case $1 in
      --on)
        hyprctl dispatch dpms off
        ;;
      --off)
        hyprctl dispatch dpms on
        ;;
    esac
    ;;

  lock)
    case $1 in
      --on) ;;
      --off) ;;
    esac
    ;;

  sleep)
    case $1 in
      --on)
        playerctl -a pause &
        hey .play-sound shutdown
        # With nvidia cards, hyprlock suffers from redraw issues (making it
        # appear like it's frozen). This helps a little:
        hyprctl --batch \
          keyword decoration:blur:enabled 0 \; \
          keyword general:allow_tearing 1 \; \
          keyword animations:enabled 0 \; \
          keyword misc:vrr 1
        if ! pidof hyprlock >/dev/null; then
          {
            hey .lock --immediate
            sleep 1
            hey .play-sound startup
          } &
        fi
        sleep 3
      ;;
      --off)
        {
          hyprctl --batch \
            keyword decoration:blur:enabled 1 \; \
            keyword general:allow_tearing 0 \; \
            keyword animations:enabled 1 \; \
            keyword misc:vrr 0
          sleep 1
          hyprctl dispatch dpms on
        } &
        ;;
    esac
    ;;
esac
</file>

<file path="config/hypr/hyprland.conf">
# .config/hypr/hyprland.conf
# Common settings for hyprland.

# Additional settings are set by nixos themes which generate this file:
source = ~/.config/hypr/hyprland.pre.conf


#
#-- Keywords
# See https://wiki.hyprland.org/Configuring/Keywords/
# See https://wiki.hyprland.org/Configuring/Variables/
input {
    kb_layout = us
    kb_variant =
    kb_model =
    kb_options = compose:ralt
    kb_rules =
    follow_mouse = 2
    touchpad {
        natural_scroll = no
    }
    sensitivity = 0 # -1.0 - 1.0, 0 means no modification.
}

# See https://wiki.hyprland.org/Configuring/Variables/ for more
general {
    gaps_in = 0
    gaps_out = 0
    border_size = 0
    no_focus_fallback = true
    layout = master
    allow_tearing = false
}

# Obnoxious.
ecosystem {
   no_update_news = true;
   no_donation_nag = true;
}

# See https://wiki.hyprland.org/Configuring/Variables/ for more
decoration {
}

# See https://wiki.hyprland.org/Configuring/Animations/ for more
animations {
    enabled = yes
    bezier = myBezier, 0.05, 0.9, 0.1, 1.0
    animation = layers, 1, 3, default, fade
    animation = windows, 1, 5, myBezier, slide
    animation = border, 0
    # animation = borderangle, 1, 8, default
    animation = fade, 1, 4, default
    animation = workspaces, 1, 4, default, slidevert
    animation = specialWorkspace, 1, 5, default, slidefadevert -100%
}

# See https://wiki.hyprland.org/Configuring/Dwindle-Layout/ for more
dwindle {
    pseudotile = yes # master switch for pseudotiling. Enabling is bound to mainMod + P in the keybinds section below
    preserve_split = yes # you probably want this
}

# See https://wiki.hyprland.org/Configuring/Master-Layout/ for more
master {
    new_status = master
    mfact = 0.65
}

# See https://wiki.hyprland.org/Configuring/Variables/ for more
gestures {
    workspace_swipe = off
}

# See https://wiki.hyprland.org/Configuring/Variables/ for more
misc {
    background_color = rgb(000000)
    force_default_wallpaper = 0 # Set to 0 to disable the anime mascot wallpapers
    disable_hyprland_logo = true
    disable_autoreload = true
    disable_splash_rendering = true
    key_press_enables_dpms = true
}

cursor {
    hide_on_key_press = false
    enable_hyprcursor = true
    zoom_rigid = true
}


#
#-- Layer rules
layerrule = blur, notifications
# Invisible margins/padding will get blurred too; ignorezero fixes this.
layerrule = ignorealpha 0.3, notifications


#
#-- Workspace rules
workspace=special:term,gapsin:6,gapsout:15,on-created-empty:[float] hey .scratch term
workspace=special:pad,gapsin:6,gapsout:80 160 80 160


#
#-- Window rules
# See https://wiki.hyprland.org/Configuring/Window-Rules/ for more
# Avoid fullscreen, so we can see through the window to what's underneath
# windowrulev2 = float,initialtitle:^(swayimg:)
# windowrulev2 = maximize,initialtitle:^(swayimg:)

windowrulev2 = float,class:^(emacs-floating)$

windowrulev2 = float, class:^(Gromit-mpx)$
windowrulev2 = suppressevents fullscreen maximize, class:^(Gromit-mpx)$
windowrulev2 = noblur, class:^(Gromit-mpx)$
windowrulev2 = nomaxsize, class:^(Gromit-mpx)$
windowrulev2 = noanim, class:^(Gromit-mpx)$
windowrulev2 = noshadow, class:^(Gromit-mpx)$

# Steam windows should float, and disable as much eye-candy in them as possible
# (otherwise it flickers/glitches a lot).
windowrulev2 = float,title:^(Steam )
windowrulev2 = float,class:^(steam)$,title:^(Friends List)$
windowrulev2 = minsize 1 1, class:^(steam)$
windowrulev2 = noanim,   class:^(steam)$
windowrulev2 = nodim,    class:^(steam)$
windowrulev2 = noblur,   class:^(steam)$
windowrulev2 = noshadow, class:^(steam)$
windowrulev2 = noborder, class:^(steam)$
windowrulev2 = immediate, class:^(steam)$

windowrulev2 = idleinhibit fullscreen, fullscreen:1


#
#-- Keybindings
# See https://wiki.hyprland.org/Configuring/Binds/ for more
$prefix = SUPER

bind = $prefix, Space, exec, hey @rofi appmenu
bind = $prefix, R, exec, hey reload --wm
bind = $prefix SHIFT, R, exec, hey reload
bind = $prefix, Return, exec, hey .open-term
bind = $prefix SHIFT, Return, exec, foot

bind = $prefix, C, exec, hey @rofi calcmenu
bind = $prefix, P, exec, hey @rofi vaultmenu
bind = $prefix SHIFT, P, exec, hey @rofi vaultmenu -l

# Dismiss notifications
bind = $prefix, Escape, exec, makoctl dismiss
bind = $prefix SHIFT, Escape, exec, makoctl dismiss --all

# Layout management
bind = $prefix, F, togglefloating,
bind = $prefix SHIFT, F, fullscreen,
bind = $prefix, O, focuscurrentorlast,
bind = $prefix, TAB, layoutmsg, swapwithmaster
bind = $prefix SHIFT, TAB, layoutmsg, addmaster
bind = $prefix SHIFT CONTROL, TAB, layoutmsg, removemaster
bind = $prefix, Left, layoutmsg, orientationleft
bind = $prefix, Right, layoutmsg, orientationright
bind = $prefix, up, layoutmsg, orientationtop
bind = $prefix, down, layoutmsg, orientationbottom
bind = $prefix SHIFT, down, layoutmsg, orientationcenter

# Scratchpads
bind = $prefix, grave, togglespecialworkspace, term
bind = $prefix, S, togglespecialworkspace, pad
bind = $prefix SHIFT, S, movetoworkspacesilent, special:pad

# Zoom feature
bindlt = $prefix, Z, exec, hey .toggle-zoom
bindlt = $prefix SHIFT, Z, exec, hey .toggle-zoom 3.0

# Draw on the screen (for screencasting and demos)
bind = $prefix, D, exec, hey .screendraw
# Screen capture/recording
bind = , Print, exec, hey .screenshot
bind = SHIFT, Print, exec, hey .screenshot --swappy
bind = SHIFT CONTROL, Print, exec, hey .screencast webm
# Modal: SCREENSHOT submap
bind = $prefix, Print, exec, hey .play-sound blip
bind = $prefix, Print, submap, 
submap = 
bind = $prefix, W, exec, hey .screenshot window
bind = $prefix, M, exec, hey .screenshot output
bind = $prefix SHIFT, W, exec, hey .screenshot --swappy window
bind = $prefix SHIFT, M, exec, hey .screenshot --swappy output
bind = $prefix SHIFT CONTROL, W, exec, hey .screencast webm window
bind = $prefix SHIFT CONTROL, M, exec, hey .screencast webm output
bindit = $prefix, SUPER_L, submap, reset
bind = , escape, submap, reset
bind = , catchall, exec, hey .play-sound blip
submap = reset

# Modal: QUIT/session submap
bind = $prefix, Q, exec, hey .play-sound blip
bind = $prefix, Q, submap, 
submap = 
bind = $prefix, Q, killactive,
bind = $prefix, Q, submap, reset
bind = $prefix, K, exec, hey .quitactive
bind = $prefix, K, submap, reset
bind = $prefix SHIFT, Q, exec, hey @rofi powermenu,
bind = $prefix SHIFT, Q, submap, reset
bind = $prefix, L, exec, hey .lock
bind = $prefix, L, submap, reset
bind = $prefix SHIFT, D, dpms, off
bind = $prefix SHIFT, D, submap, reset
bindit = $prefix, SUPER_L, submap, reset
bind = , escape, submap, reset
submap = reset


#
#-- One-off window management keybinds

# For navigating focus and moving windows short distances
bind = $prefix, H, movefocus, l
bind = $prefix, L, movefocus, r
bind = $prefix, K, movefocus, u
bind = $prefix, J, movefocus, d
bind = $prefix SHIFT, H, movewindow, l
bind = $prefix SHIFT, L, movewindow, r
bind = $prefix SHIFT, K, movewindow, u
bind = $prefix SHIFT, J, movewindow, d
bind = $prefix SHIFT CTRL, H, movewindow, mon:l
bind = $prefix SHIFT CTRL, L, movewindow, mon:r
bind = $prefix SHIFT CTRL, K, movewindow, mon:u
bind = $prefix SHIFT CTRL, J, movewindow, mon:d
bind = $prefix CTRL, H, focusmonitor, l
bind = $prefix CTRL, L, focusmonitor, r
bind = $prefix CTRL, K, focusmonitor, u
bind = $prefix CTRL, J, focusmonitor, d

# Switch workspaces with mainMod + [0-9]
bind = $prefix, 1, workspace, 1
bind = $prefix, 2, workspace, 2
bind = $prefix, 3, workspace, 3
bind = $prefix, 4, workspace, 4
bind = $prefix, 5, workspace, 5
bind = $prefix, 6, workspace, 6
bind = $prefix, 7, workspace, 7
bind = $prefix, 8, workspace, 8
bind = $prefix, 9, workspace, 9

# Move active window to a workspace with mainMod + SHIFT + [0-9]
bind = $prefix SHIFT, 1, movetoworkspace, 1
bind = $prefix SHIFT, 2, movetoworkspace, 2
bind = $prefix SHIFT, 3, movetoworkspace, 3
bind = $prefix SHIFT, 4, movetoworkspace, 4
bind = $prefix SHIFT, 5, movetoworkspace, 5
bind = $prefix SHIFT, 6, movetoworkspace, 6
bind = $prefix SHIFT, 7, movetoworkspace, 7
bind = $prefix SHIFT, 8, movetoworkspace, 8
bind = $prefix SHIFT, 9, movetoworkspace, 9


#
#-- Batch window management submap

bind = $prefix, W, exec, hey .play-sound blip
bind = $prefix, W, submap, 
submap = 
binde = SHIFT, Q, killactive,
binde = , H, movefocus, l
binde = , J, movefocus, d
binde = , K, movefocus, u
binde = , L, movefocus, r
binde = CONTROL, H, focusmonitor, l
binde = CONTROL, J, focusmonitor, d
binde = CONTROL, K, focusmonitor, u
binde = CONTROL, L, focusmonitor, r
bind = SHIFT, H, movewindow, l
bind = SHIFT, J, movewindow, d
bind = SHIFT, K, movewindow, u
bind = SHIFT, L, movewindow, r
bind = SHIFT CTRL, H, movewindow, mon:l
bind = SHIFT CTRL, L, movewindow, mon:r
bind = SHIFT CTRL, K, movewindow, mon:u
bind = SHIFT CTRL, J, movewindow, mon:d
binde = ALT, H, resizeactive, -20 0
binde = ALT, J, resizeactive, 0 20
binde = ALT, K, resizeactive, 0 -20
binde = ALT, L, resizeactive, 20 0
bind = , 1, workspace, 1
bind = , 2, workspace, 2
bind = , 3, workspace, 3
bind = , 4, workspace, 4
bind = , 5, workspace, 5
bind = , 6, workspace, 6
bind = , 7, workspace, 7
bind = , 8, workspace, 8
bind = , 9, workspace, 9
bind = SHIFT, 1, movetoworkspacesilent, 1
bind = SHIFT, 2, movetoworkspacesilent, 2
bind = SHIFT, 3, movetoworkspacesilent, 3
bind = SHIFT, 4, movetoworkspacesilent, 4
bind = SHIFT, 5, movetoworkspacesilent, 5
bind = SHIFT, 6, movetoworkspacesilent, 6
bind = SHIFT, 7, movetoworkspacesilent, 7
bind = SHIFT, 8, movetoworkspacesilent, 8
bind = SHIFT, 9, movetoworkspacesilent, 9
bindit = $prefix, SUPER_L, submap, reset
bind = , escape, submap, reset
bind = , catchall, exec, hey .play-sound blip
submap = reset

# Move/resize windows with mainMod + LMB/RMB and dragging
bindm = $prefix, mouse:272, movewindow
bindm = $prefix, mouse:273, resizewindow


# -- Function keys --
$inc = 10
bind = , XF86MonBrightnessUp,         exec, hey .osd brightness +$inc
bind = , XF86MonBrightnessDown,       exec, hey .osd brightness -$inc
bind = , XF86AudioRaiseVolume,        exec, hey .osd volume -o +$inc
bind = , XF86AudioLowerVolume,        exec, hey .osd volume -o -$inc
bind = , XF86AudioMute,               exec, hey .osd volume -o toggle
bind = SHIFT, XF86AudioRaiseVolume,   exec, hey .osd volume -i +$inc
bind = SHIFT, XF86AudioLowerVolume,   exec, hey .osd volume -i -$inc
bind = SHIFT, XF86AudioMute,          exec, hey .osd volume -i toggle
# bind = CONTROL, XF86AudioRaiseVolume, exec, hey .osd volume -p spotify +$inc
# bind = CONTROL, XF86AudioLowerVolume, exec, hey .osd volume -p spotify -$inc
# bind = CONTROL, XF86AudioMute,        exec, hey .osd volume -p spotify toggle
# bind = , XF86AudioPlay,               exec, playerctl -p spotify play-pause
# bind = , XF86AudioPause,              exec, playerctl -p spotify play-pause
# bind = , XF86AudioNext,               exec, playerctl -p spotify next
# bind = , XF86AudioPrev,               exec, playerctl -p spotify previous
# bind = SHIFT, XF86AudioNext,          exec, playerctl -p spotify position 5+
# bind = SHIFT, XF86AudioPrev,          exec, playerctl -p spotify position 5-

# Auto-generated by my nixos config...
source = ~/.config/hypr/hyprland.post.conf
</file>

<file path="config/ncmpcpp/aliases.zsh">
alias rate=mpd-rate
alias mpcs='mpc search any'
alias mpcsp='mpc searchplay any'
</file>

<file path="config/ncmpcpp/bindings">
def_key "k"
  scroll_up

def_key "j"
  scroll_down

def_key "K"
  select_item
  scroll_up

def_key "J"
  select_item
  scroll_down

def_key "h"
  previous_column

def_key "l"
  next_column

def_key "L"
  show_lyrics

def_key "up"
  volume_up

def_key "down"
  volume_down

#def_key "right"
#  next_column
#
#def_key "left"
#  previous_column
#
#def_key "mouse"
#  mouse_event
#
#def_key "up"
#  scroll_up
#
#def_key "shift-up"
#  select_item
#  scroll_up
#
#def_key "down"
#  scroll_down
#
#def_key "shift-down"
#  select_item
#  scroll_down
#
#def_key "["
#  scroll_up_album
#
#def_key "]"
#  scroll_down_album
#
#def_key "{"
#  scroll_up_artist
#
#def_key "}"
#  scroll_down_artist
#
#def_key "page_up"
#  page_up
#
#def_key "page_down"
#  page_down
#
#def_key "home"
#  move_home
#
#def_key "end"
#  move_end
#
#def_key "insert"
#  select_item
#
#def_key "enter"
#  enter_directory
#
#def_key "enter"
#  toggle_output
#
#def_key "enter"
#  run_action
#
#def_key "enter"
#  play_item
#
#def_key "space"
#  add_item_to_playlist
#
#def_key "space"
#  toggle_lyrics_update_on_song_change
#
#def_key "space"
#  toggle_visualization_type
#
#def_key "delete"
#  delete_playlist_items
#
#def_key "delete"
#  delete_browser_items
#
#def_key "delete"
#  delete_stored_playlist
#
#def_key "right"
#  next_column
#
#def_key "right"
#  slave_screen
#
#def_key "right"
#  volume_up
#
#def_key "+"
#  volume_up
#
#def_key "left"
#  previous_column
#
#def_key "left"
#  master_screen
#
#def_key "left"
#  volume_down
#
#def_key "-"
#  volume_down
#
#def_key ":"
#  execute_command
#
#def_key "tab"
#  next_screen
#
#def_key "shift-tab"
#  previous_screen
#
#def_key "f1"
#  show_help
#
#def_key "1"
#  show_playlist
#
#def_key "2"
#  show_browser
#
#def_key "2"
#  change_browse_mode
#
#def_key "3"
#  show_search_engine
#
#def_key "3"
#  reset_search_engine
#
#def_key "4"
#  show_media_library
#
#def_key "4"
#  toggle_media_library_columns_mode
#
#def_key "5"
#  show_playlist_editor
#
#def_key "6"
#  show_tag_editor
#
#def_key "7"
#  show_outputs
#
#def_key "8"
#  show_visualizer
#
#def_key "="
#  show_clock
#
#def_key "@"
#  show_server_info
#
#def_key "s"
#  stop
#
#def_key "p"
#  pause
#
#def_key ">"
#  next
#
#def_key "<"
#  previous
#
#def_key "ctrl-h"
#  jump_to_parent_directory
#
#def_key "ctrl-h"
#  replay_song
#
#def_key "backspace"
#  jump_to_parent_directory
#
#def_key "backspace"
#  replay_song
#
#def_key "f"
#  seek_forward
#
#def_key "b"
#  seek_backward
#
#def_key "r"
#  toggle_repeat
#
#def_key "z"
#  toggle_random
#
#def_key "y"
#  save_tag_changes
#
#def_key "y"
#  start_searching
#
#def_key "y"
#  toggle_single
#
#def_key "R"
#  toggle_consume
#
#def_key "Y"
#  toggle_replay_gain_mode
#
#def_key "T"
#  toggle_add_mode
#
#def_key "|"
#  toggle_mouse
#
#def_key "#"
#  toggle_bitrate_visibility
#
#def_key "Z"
#  shuffle
#
#def_key "x"
#  toggle_crossfade
#
#def_key "X"
#  set_crossfade
#
#def_key "u"
#  update_database
#
#def_key "ctrl-s"
#  sort_playlist
#
#def_key "ctrl-s"
#  toggle_browser_sort_mode
#
#def_key "ctrl-s"
#  toggle_media_library_sort_mode
#
#def_key "ctrl-r"
#  reverse_playlist
#
#def_key "ctrl-_"
#  select_found_items
#
#def_key "/"
#  find
#
#def_key "/"
#  find_item_forward
#
#def_key "?"
#  find
#
#def_key "?"
#  find_item_backward
#
#def_key "."
#  next_found_item
#
#def_key ","
#  previous_found_item
#
#def_key "w"
#  toggle_find_mode
#
#def_key "e"
#  edit_song
#
#def_key "e"
#  edit_library_tag
#
#def_key "e"
#  edit_library_album
#
#def_key "e"
#  edit_directory_name
#
#def_key "e"
#  edit_playlist_name
#
#def_key "e"
#  edit_lyrics
#
#def_key "i"
#  show_song_info
#
#def_key "I"
#  show_artist_info
#
#def_key "g"
#  jump_to_position_in_song
#
#def_key "l"
#  show_lyrics
#
#def_key "ctrl-v"
#  select_range
#
#def_key "v"
#  reverse_selection
#
#def_key "V"
#  remove_selection
#
#def_key "B"
#  select_album
#
#def_key "a"
#  add_selected_items
#
#def_key "c"
#  clear_playlist
#
#def_key "c"
#  clear_main_playlist
#
#def_key "C"
#  crop_playlist
#
#def_key "C"
#  crop_main_playlist
#
#def_key "m"
#  move_sort_order_up
#
#def_key "m"
#  move_selected_items_up
#
#def_key "m"
#  set_visualizer_sample_multiplier
#
#def_key "n"
#  move_sort_order_down
#
#def_key "n"
#  move_selected_items_down
#
#def_key "M"
#  move_selected_items_to
#
#def_key "A"
#  add
#
#def_key "S"
#  save_playlist
#
#def_key "o"
#  jump_to_playing_song
#
#def_key "G"
#  jump_to_browser
#
#def_key "G"
#  jump_to_playlist_editor
#
#def_key "~"
#  jump_to_media_library
#
#def_key "E"
#  jump_to_tag_editor
#
#def_key "U"
#  toggle_playing_song_centering
#
#def_key "P"
#  toggle_display_mode
#
#def_key "\\"
#  toggle_interface
#
#def_key "!"
#  toggle_separators_between_albums
#
#def_key "L"
#  toggle_lyrics_fetcher
#
#def_key "F"
#  toggle_fetching_lyrics_in_background
#
#def_key "ctrl-l"
#  toggle_screen_lock
#
#def_key "`"
#  toggle_library_tag_type
#
#def_key "`"
#  refetch_lyrics
#
#def_key "`"
#  add_random_items
#
#def_key "ctrl-p"
#  set_selected_items_priority
#
#def_key "q"
#  quit
#
</file>

<file path="config/ncmpcpp/config">
##### directories ######
ncmpcpp_directory = ~/.config/ncmpcpp

## Directory for storing downloaded lyrics.
lyrics_directory = ~/music/lyrics

##### connection settings #####
mpd_host = "~/music/mpd.sock"
#mpd_host = "127.0.0.1"
#mpd_port = 6600
#mpd_connection_timeout = 5

## Needed for tag editor and file operations to work.
mpd_music_dir = ~/music
mpd_crossfade_time = 5

##### music visualizer #####
##
## Note: In order to make music visualizer work you'll
## need to use mpd fifo output, whose format parameter
## has to be set to 44100:16:1 for mono visualization
## or 44100:16:2 for stereo visualization. Example
## configuration (it has to be put into mpd.conf):
##
## audio_output {
##        type            "fifo"
##        name            "Visualizer feed"
##        path            "/tmp/mpd.fifo"
##        format          "44100:16:2"
## }
##
#visualizer_fifo_path = /tmp/mpd.fifo

##
## Note: Below parameter is needed for ncmpcpp
## to determine which output provides data for
## visualizer and thus allow syncing between
## visualization and sound as currently there
## are some problems with it.
##
#visualizer_output_name = Visualizer feed

##
## If you set format to 44100:16:2, make it 'yes'.
##
visualizer_in_stereo = no

##
## Multiply received samples by given value. Very
## useful for proper visualization of quiet music.
##
#visualizer_sample_multiplier = 1.0

##
## Note: Below parameter defines how often ncmpcpp
## has to "synchronize" visualizer and audio outputs.
## 30 seconds is optimal value, but if you experience
## synchronization problems, set it to lower value.
## Keep in mind that sane values start with >=10.
##
#visualizer_sync_interval = 30

##
## Note: To enable spectrum frequency visualization
## you need to compile ncmpcpp with fftw3 support.
##
#
## Available values: spectrum, wave, wave_filled, ellipse.
visualizer_type = spectrum
## Alternative subset of 256 colors for terminals that support it.
#visualizer_color = 41, 83, 119, 155, 185, 215, 209, 203, 197, 161
visualizer_color = blue, cyan, green, yellow, magenta, red
#visualizer_look = ●▮
#
##### system encoding #####
##
## ncmpcpp should detect your charset encoding
## but if it failed to do so, you can specify
## charset encoding you are using here.
##
## Note: You can see whether your ncmpcpp build
## supports charset detection by checking output
## of `ncmpcpp --version`.
##
## Note: Since MPD uses UTF-8 by default, setting
## this option makes sense only if your encoding
## is different.
##
#system_encoding = ""
#
##### delays #####
#
## Time of inactivity (in seconds) after playlist
## highlighting will be disabled (0 = always on).
##
#playlist_disable_highlight_delay = 5
#
## Defines how long messages are supposed to be visible.
##
message_delay_time = 2
#
##### song format #####
##
## For a song format you can use:
##
## %l - length
## %f - filename
## %D - directory
## %a - artist
## %A - album artist
## %t - title
## %b - album
## %y - date
## %n - track number (01/12 -> 01)
## %N - full track info (01/12 -> 01/12)
## %g - genre
## %c - composer
## %p - performer
## %d - disc
## %C - comment
## %P - priority
## $R - begin right alignment
##
## If you want to make sure that a part of the format is displayed
## only when certain tags are present, you can archieve it by
## grouping them with brackets, e.g. '{%a - %t}' will be evaluated
## to 'ARTIST - TITLE' if both tags are present or '' otherwise.
## It is also possible to define a list of alternatives by providing
## several groups and separating them with '|', e.g. '{%t}|{%f}'
## will be evaluated to 'TITLE' or 'FILENAME' if the former is not
## present.
##
## Note: If you want to set limit on maximal length of a tag, just
## put the appropriate number between % and character that defines
## tag type, e.g. to make album take max. 20 terminal cells, use '%20b'.
##
## In addition, formats support markers used for text attributes.
## They are followed by character '$'. After that you can put:
##
## - 0 - default window color (discards all other colors)
## - 1 - black
## - 2 - red
## - 3 - green
## - 4 - yellow
## - 5 - blue
## - 6 - magenta
## - 7 - cyan
## - 8 - white
## - 9 - end of current color
## - b - bold text
## - u - underline text
## - r - reverse colors
## - a - use alternative character set
##
## If you don't want to use a non-color attribute anymore, just put it
## again, but this time insert character '/' between '$' and attribute
## character, e.g. {$b%t$/b}|{$r%f$/r} will display bolded title tag
## or filename with reversed colors.
##
## If you want to use 256 colors and/or background colors in formats
## (the naming scheme is described below in section about color
## definitions), it can be done with the syntax $(COLOR), e.g. to set
## the artist tag to one of the non-standard colors and make it have
## yellow background, you need to write $(197_yellow)%a$(end). Note
## that for standard colors this is interchangable with attributes
## listed above.
##
## Note: colors can be nested.
##
#
# song_list_format = {%a }$2%t$9 %C $R{%b }$2%25l$9
#song_list_format = {{$5%a$9 }{$7%A$9 }}{%n }$(16)%t$(end) $R{$8%l$9}
# song_status_format = {{%a{ $3%b{ (%y)}$9} }{$8%t$9}}|{%f}
#song_library_format = {%n - }{%t}|{%f}
song_list_format                      = "{$2%a$9} {$5%t$9} $R {$3%b$3} $9({$9%l$9})"
song_library_format = "%n %t"
song_status_format = "$b{$6%a$9 $1|$9} {$7%t$9} $1|$9 {$2%b$9} $1|$9 {$6%y$9} $1|$9"
#
#
#alternative_header_first_line_format = $b$1$aqqu$/a$9 {%t}|{%f} $1$atqq$/a$9$/b
#alternative_header_second_line_format = {{$4$b%a$/b$9}{ - $7%b$9}{ ($4%y$9)}}|{%D}
#
now_playing_prefix = "$(3_236)> "
now_playing_suffix = $0
#
#browser_playlist_prefix = "$2playlist$9 "
#
selected_item_prefix = "$(6_237)+ "
selected_item_suffix = $9
#
# modified_item_prefix = $3> $9
#
##
## Note: attributes are not supported for the following variables.
##
#song_window_title_format = {%a - }{%t}|{%f}
##
## Note: Below variables are used for sorting songs in browser.
## The sort mode determines how songs are sorted, and can be used
## in combination with a sort format to specify a custom sorting format.
## Available values for browser_sort_mode are "name", "mtime", "format"
## and "noop".
##
#
#browser_sort_mode = name
#browser_sort_format = {%a - }{%t}|{%f} {(%l)}
#
##### columns settings #####
##
## syntax of song columns list format is "column column etc."
##
## - syntax for each column is:
##
## (width of the column)[color of the column]{displayed tag}
##
## Note: Width is by default in %, if you want a column to
## have fixed size, add 'f' after the value, e.g. (10)[white]{a}
## will be the column that take 10% of screen (so the real width
## will depend on actual screen size), whereas (10f)[white]{a}
## will take 10 terminal cells, no matter how wide the screen is.
##
## - color is optional (if you want the default one,
##   leave the field empty).
##
## Note: You can give a column additional attributes by putting appropriate
## character after displayed tag character. Available attributes are:
##
## - r - column will be right aligned
## - E - if tag is empty, empty tag marker won't be displayed
##
## You can also:
##
## - give a column custom name by putting it after attributes,
##   separated with character ':', e.g. {lr:Length} gives you
##   right aligned column of lengths named "Length".
##
## - define sequence of tags, that have to be displayed in case
##   predecessor is empty in a way similar to the one in classic
##   song format, i.e. using '|' character, e.g. {a|c|p:Owner}
##   creates column named "Owner" that tries to display artist
##   tag and then composer and performer if previous ones are
##   not available.
##
song_columns_list_format = (3f)[241]{NEr:#} (8f)[5]{l} (22)[6]{a|A:Artist} (40)[9]{t|f:Title} (30)[13]{b}
#
##### various settings #####
#
##
## Note: Custom command that will be executed each
## time song changes. Useful for notifications etc.
##
execute_on_song_change = "mpd-notify-song"
#playlist_show_mpd_host = no
playlist_show_remaining_time = yes
playlist_shorten_total_times = yes
#playlist_separate_albums = no
#
##
## Note: Possible display modes: classic, columns.
##
playlist_display_mode = classic
browser_display_mode = columns
#search_engine_display_mode = classic
#playlist_editor_display_mode = classic
discard_colors_if_item_is_selected = yes
incremental_seeking = yes
seek_time = 2
volume_change_step = 10
#autocenter_mode = no
#centered_cursor = no
#
##
## Note: You can specify third character which will
## be used to build 'empty' part of progressbar.
##
progressbar_look = "─╼ "
#progressbar_boldness
progressbar_color = 1
progressbar_elapsed_color = 4
#
## Available values: database, playlist.
##
#default_place_to_search_in = database
#
## Available values: classic, alternative.
##
user_interface = alternative
#data_fetching_delay = yes
#
## Available values: artist, album_artist, date, genre, composer, performer.
##
#media_library_primary_tag = artist
#
## Available values: wrapped, normal.
##
#default_find_mode = wrapped
#default_tag_editor_pattern = %n - %t
header_visibility = yes
statusbar_visibility = yes
titles_visibility = no
#header_text_scrolling = yes
#cyclic_scrolling = no
#lines_scrolled = 2
#follow_now_playing_lyrics = no
#fetch_lyrics_for_current_song_in_background = no
#store_lyrics_in_song_dir = no
#generate_win32_compatible_filenames = yes
allow_for_physical_item_deletion = yes
#
##
## Note: If you set this variable, ncmpcpp will try to
## get info from last.fm in language you set and if it
## fails, it will fall back to english. Otherwise it will
## use english the first time.
##
## Note: Language has to be expressed as an ISO 639 alpha-2 code.
##
#lastfm_preferred_language = en
#show_hidden_files_in_local_browser = no
#
##
## How shall screen switcher work?
##
## - "previous" - switch between the current and previous screen.
## - "screen1,...,screenN" - switch between given sequence of screens.
##
## Screens available for use: help, playlist, browser, search_engine,
## media_library, playlist_editor, tag_editor, outputs, visualizer, clock.
##
#screen_switcher_mode = playlist, browser
#
##
## Note: You can define startup screen
## by choosing screen from the list above.
##
#startup_screen = playlist
#
##
## Note: You can define startup slave screen
## by choosing screen from the list above or
## an empty value for no slave screen.
##
#startup_slave_screen = ""
#startup_slave_screen_focus = no
#
##
## Default width of locked screen (in %).
## Acceptable values are from 20 to 80.
##
#
#locked_screen_width_part = 50
#ask_for_locked_screen_width_part = yes
jump_to_now_playing_song_at_start = yes
#ask_before_clearing_playlists = yes
#clock_display_seconds = no
#display_volume_level = no
#display_bitrate = yes
display_remaining_time = no
#
## Available values: none, basic, extended, perl.
##
#regular_expressions = perl
#
##
## Note: If below is enabled, ncmpcpp will ignore leading
## "The" word while sorting items in browser, tags in
## media library, etc.
##
#ignore_leading_the = no
#block_search_constraints_change_if_items_found = yes
#mouse_support = yes
#mouse_list_scroll_whole_page = yes
empty_tag_marker = <empty>
#tags_separator = " | "
tag_editor_extended_numeration = yes
#media_library_sort_by_mtime = no
enable_window_title = yes
#
##
## Note: You can choose default search mode for search
## engine. Available modes are:
##
## - 1 - use mpd built-in searching (no regexes, pattern matching)
## - 2 - use ncmpcpp searching (pattern matching with support for regexes,
##       but if your mpd is on a remote machine, downloading big database
##       to process it can take a while
## - 3 - match only exact values (this mode uses mpd function for searching
##       in database and local one for searching in current playlist)
##
search_engine_default_search_mode = 2
external_editor = vim

## Note: set to yes if external editor is a console application.
use_console_editor = yes

##### colors definitions #####
##
## It is possible to set a background color by setting a color
## value "<foreground>_<background>", e.g. red_black will set
## foregound color to red and background color to black.
##
## In addition, for terminals that support 256 colors it
## is possible to set one of them by using a number in range
## [1, 256] instead of color name, e.g. numerical value
## corresponding to red_black is 2_1. To find out if the
## terminal supports 256 colors, run ncmpcpp and check out
## the bottom of the help screen for list of available colors
## and their numerical values.
##
## Note: due to technical limitations of ncurses, if 256 colors
## are used, it is possible to either use only the colors with
## default background color, or all pairs from 1_1 up to 254_127,
## depending on the ncurses version used.
##
colors_enabled = yes
empty_tag_color = 13
header_window_color = 241
volume_color = 239
state_line_color = 13
state_flags_color = 13
main_window_color = green
color1 = white
color2 = blue
# main_window_highlight_color = yellow
statusbar_color = 13
statusbar_time_color = 6
player_state_color = 14
alternative_ui_separator_color = 2
current_item_prefix = $(9_238)
current_item_suffix = $(end)
# active_column_color = red
window_border_color = 13
active_window_border = 13
</file>

<file path="config/rofi/bin/appmenu.sh">
#!/usr/bin/env dash
# Launch an application with Rofi.
#
# SYNOPSIS:
#   appmenu

rofi \
  -show drun \
  -modi drun,run \
  -theme appmenu.rasi \
  $@
</file>

<file path="config/rofi/bin/audiomenu.janet">
#!/usr/bin/env janet
# Change the default output or input audio device via Rofi.
#
# SYNOPSIS:
#   audiomenu

(use hey)
(use hey/cmd)
(import hey/sys)
(import hey/rofi)

(defn- dev-icon [dev &opt fallback]
  (or (get-in dev [:properties :api.bluez5.icon])
      fallback))

(defn set-default-input [dev]
  (when (do? $? pactl set-default-source ,(get dev :name))
    (sys/notify (get dev :description)
                :title "Default input device changed"
                :icon (dev-icon dev "audio-input-microphone")
                :sound "notify")))

(defn set-default-output [dev]
  (when (do? $? pactl set-default-sink ,(get dev :name))
    (sys/notify (get dev :description)
                :title "Default output device changed"
                :icon (dev-icon dev "audio-speakers")
                :sound "notify")))

(defn- audio-devices [type]
  (let [devs @{}]
    (each dev (json/decode ($<_ pactl -f json list ,(symbol type)) :keywords true)
      (put devs (get dev :name) dev))
    devs))

(defn- show-audio-menu []
  (let [default-output ($<_ pactl get-default-sink)
        default-input  ($<_ pactl get-default-source)
        inputs  (audio-devices :sources)
        outputs (audio-devices :sinks)]
    (rofi/chain [r :theme "audiomenu"
                 :message (fmt "<b>Default output:</b>\t%s\n<b>Default input:</b>\t%s"
                               (or (get-in outputs [default-output :description]) "n/a")
                               (or (get-in inputs  [default-input  :description]) "n/a"))]
      (eachp [name dev] outputs
        (unless (= name default-output)
          (:add r (fmt "<b>Output</b>\t%s"
                       (get dev :description))
                :icon (dev-icon dev "audio-speakers")
                :data |(set-default-output dev))))
      (eachp [name dev] inputs
        (unless (= name default-input)
          (:add r (fmt "<b>Input</b>\t%s"
                       (get dev :description))
                :icon (dev-icon dev "audio-input-microphone")
                :data |(set-default-input dev)))))))

(defmain [_ & args]
  (show-audio-menu))
</file>

<file path="config/rofi/bin/bookmarkmenu.janet">
#!/usr/bin/env janet
# Open a Firefox bookmark via Rofi.
#
# SYNOPSIS:
#   bookmarkmenu [-r|--reload] [--profile PROFILE]

(use hey)
(use hey/cmd)
(import hey/rofi)
(import hey/vars)
(import sqlite3 :as sql)

(defn- profile-dir [&opt profile]
  (some (fn [dir]
          (def dir (path/join dir ".mozilla" "librewolf"))
          (when (path/directory? dir)
            (def file (path/join dir "profiles.ini"))
            (when (path/file? file)
              (var profile profile)
              (unless profile
                (with [f (file/open file :r)]
                  (each l (file/lines f)
                    (when (string/has-prefix? "Path=" l)
                      (set profile (get (string/split "=" l 0 2) 1))
                      (break)))))
              (when path
                (path/join dir (string/chomp profile))))))
        (filter truthy? [(os/getenv "XDG_FAKE_HOME") (os/getenv "HOME")])))

(defn- db [profile file &opt reload?]
  # Copy the sqlite database to get around locks. Fortunately, FF's dbs are
  # small enough that this is inexpensive. A more ideal alternative would be to
  # open the DB connection in immutable mode, but the janet sqlite3 lib doesn't
  # give us a way to do so.
  (def profile (profile-dir profile))
  (def copy (path :runtime (fmt "browsermenu.%s-%s"
                                (path/basename profile)
                                (path/basename file))))
  (try (do
         (when (or reload? (not (path/file? copy)))
           ($? cp -f ,;(opts (debug?) "-v") ,(path/join profile file) ,copy)
           ($? chmod ,;(opts (debug?) "-v") 400 ,copy))
         (sql/open copy))
       ([err fib]
        (ignore-errors (os/rm copy))
        (propagate err fib))))

(def- *vars*  (vars/new (:dir vars/global :rofi :bookmarkmenu)))
(def- *icons* (vars/new (:dir *vars* :icons) true))

(defn- icon-file [data]
  (when data
    (let [key (string (hash data))]
      (:cache *icons* key |data)
      (:file *icons* key))))

(defn bookmarks [profile &opt reload?]
  (:cache *vars* :bookmarks
    |(with [dbbk (db profile "places.sqlite" reload?)]
       (let [res (sql/eval dbbk `
                   SELECT mb.id, mb.parent, mb.type, mb.title, mp.url FROM moz_bookmarks mb
                   LEFT JOIN moz_places mp ON mb.fk = mp.id
                   WHERE mb.type = 1 AND mb.title<>''
                   ORDER BY mp.frecency DESC
                 `)]
         (with [dbfav (db profile "favicons.sqlite" reload?)]
           (eachp [i v] res
             (def {:title title :parent parent :type type :url url} v)
             (when url
               (def favs (sql/eval dbfav (fmt `
                           SELECT max(ic.data) AS data FROM moz_pages_w_icons pg, moz_icons_to_pages rel, moz_icons ic
                           WHERE pg.id = rel.page_id AND ic.id=rel.icon_id AND (pg.page_url="%s" OR pg.page_url LIKE '%%%s%%')
                           LIMIT 1
                         ` url (first (string/split "/" (peg/replace '(* "http" (? "s") "://" (? "www.")) "" url) 0 2)))))
               (unless (empty? favs)
                 (put res i (struct ;(kvs v) :favicon (icon-file (get (first favs) :data))))))))
         res))
    reload?))

(defn- open-url [result]
  (when result
    (echof "Opening: %s" (get result :url))
    (os/spawn ["xdg-open" (get result :url)] :pd)))

(defn select-bookmark [&opt profile reload?]
  (rofi/chain [r :theme "bookmarkmenu"]
    (let [bookmarks (bookmarks profile reload?)]
      (:add r "<b>Reload bookmarks</b> ->"
            :icon "reload"
            :data (fn [] (select-bookmark profile true)))
      (:div r)
      (each e bookmarks
        (def title (rofi/escape (e :title)))
        (def url (rofi/escape (e :url)))
        (:add r (if (empty? title)
                  (fmt "<b>%s</b>" url)
                  (fmt "<b>%s</b> <span alpha='50%%' size='x-small'>%s</span>" title url))
              :icon (or (e :favicon) "link")
              :data e)))))

(defmain [_ &opts
          profile [--profile name]
          reload? [-r --reload]]
  (open-url (select-bookmark profile reload?)))
</file>

<file path="config/rofi/bin/calcmenu.sh">
#!/usr/bin/env dash
# Launch a rofi-powered calculator.
#
# SYNOPSIS:
#   calcmenu

rofi \
  -show calc \
  -modi calc \
  -theme calcmenu \
  $@
</file>

<file path="config/rofi/bin/emojimenu.sh">
#!/usr/bin/env dash
# Emoji menu.
#
# TODO

rofimoji --selector-args="-theme emojimenu" $@
</file>

<file path="config/rofi/bin/filemenu.sh">
#!/usr/bin/env dash
# Open a rofi-based file-browser.
#
# SYNOPSIS:
#   TODO

rofi \
  -modi file-browser-extended \
  -show file-browser-extended \
  -file-browser-path-sep "/" \
  -theme filemenu.rasi \
  $@
</file>

<file path="config/rofi/bin/mountmenu.janet">
#!/usr/bin/env janet
# Mount/unmount your removable storage drives.
#
# Requires udisks. Uses udisksctl to manage devices.
#
# SYNOPSIS:
#   mountmenu

(use hey)
(use hey/cmd)
(import hey/sys)
(import hey/rofi)
(import hey/vars)

(defn- removable-devices []
  (-?>> (get (json/decode
              ($<_ lsblk --json -po "tran,name,type,size,mountpoint,label,vendor,model,fstype")
              :keywords true)
             :blockdevices)
        (filter |(= (get $ :tran) "usb"))
        (map |(get $ :children []))
        flatten))

(def- *vars* (vars/new (:dir vars/temp :rofi :mountmenu)))
# TODO: untested!
(defn- handle-luks [dev]
  (not-implemented :handle-luks dev)
  (def mounts (:get *vars* :mounts))
  (try
    (if (dev :mountpoint)
      (let [mp (get mounts (dev :name))]
        (unless mp
          (abort "%s is not mounted" (dev :name)))
        ($<_ udisksctl umount -b ,mp)
        ($<_ udisksctl lock -b ,(dev :name))
        (put mounts (dev :name) nil)
        (:set *vars* :mounts mounts)
        true)
      (do
        (when-let [pass (rofi/read :placeholder "Passphrase" :password true)
                   passfile (path :runtime "mountmenu-pass")]
          (with-umask 8r077
            (defer (os/rm passfile)
              (spit (path :runtime "mountmenu-pass") pass)
              (def buf @"")
              (unless (do? $? udisksctl unlock -b ,(dev :name) --key-file ,passfile > ,buf)
                (abort "Failed to unlock %s" (dev :name)))
              (def mp (peg/match '(* "Unlocked " (capture :w+) " as " (capture :w+) ".") buf))
              (unless mp # FIXME
                (abort "Failed to extract mount point from: %s" buf))
              (unless (do? $? udisksctl mount -b ,mp)
                (abort "Failed to mount %s: %s" mp buf))
              (put mounts (dev :name) mp)
              (:set *vars* :mounts mounts)
              true)))))
    ([err fib]
     (if (= (first err) :error)
       (do
         (when-let [mp (get mounts (dev :name))]
           (do? $? udisksctl unmount -b ,mp))
         (do? $? udisksctl lock -b ,(dev :name))
         (rofi/error err))
       (propagate err fib)))))

(defn- handle-part [dev]
  (let [op (if (dev :mountpoint) :unmount :mount)]
    (echof "Trying to %s %s" op (or (dev :mountpoint) (dev :name)))
    (do? $? udisksctl ,op -b ,(dev :name))))

(defn- handle [dev]
  (unless dev (abort "Aborted"))
  (when (case (dev :type)
          "part" (handle-part dev)
          "crypto_LUKS" (handle-luks dev)
          (abort "Unknown device type (%s) for %s" (dev :type) (dev :name)))
    (sys/notify (if (dev :mountpoint)
                  (fmt "Unmounted %s from %s" (dev :name) (dev :mountpoint))
                  (fmt "Mounted %s to %s"
                       (dev :name)
                       (get (find |(= (get $ :name) (dev :name)) (removable-devices))
                            :mountpoint)))
                :icon "drive-harddisk"
                :sound "blip"
                :id 9413)))

(defmain [_ & args]
  (rofi/with [rofi :theme "devmenu"]
    (:add rofi "Test"))
  # (let [devs (removable-devices)]
  #   (if (empty? devs)
  #     (rofi/error "No mountable filesystems found")
  #     (handle
  #      (rofi/with [rofi :theme "devmenu"]
  #        (each m devs
  #          (def mp (m :mountpoint))
  #          (:add rofi (fmt "<b>%-26s</b> %-8s %-14s%s"
  #                          (peg/replace '(* "/dev/") "" (string (m :name)))
  #                          (or (m :size) "")
  #                          (or (m :fstype) "")
  #                          (if (m :label) (fmt " <span alpha=\"50%%\">%s</span>" (m :label)) ""))
  #                :icon (if mp "checkbox-checked-symbolic" "checkbox-symbolic")
  #                :data m))))))
  )
</file>

<file path="config/rofi/bin/powermenu.zsh">
#!/usr/bin/env zsh
# Control the system's power state.
#
# SYNOPSIS:
#   TODO

.rofi() {
  rofi -dmenu -i -theme powermenu.rasi $@
  if (( $? > 0 )); then
    hey.error "Nothing selected. Aborting..."
    exit 1
  fi
}

rofi.powermenu.dpms() {
  sleep 0.2
  if (( $+commands[hyprctl] )); then
    hey.do hyprctl dispatch dpms off
  elif (( $+commands[xset] )); then
    hey.do xset dpms force off
  else
    notify-send "Unexpected error" "No known method to sleep monitors" -i system-error
    exit 1
  fi
}

rofi.powermenu.lock()     { hey.do loginctl lock-session; }

rofi.powermenu.suspend()  { hey.do systemctl suspend; }

rofi.powermenu.reboot()   { hey.do systemctl reboot; }

rofi.powermenu.poweroff() { hey.do systemctl poweroff; }

rofi.powermenu.reboot-into() {
  local entries=$(bootctl list --json=short)
  IFS=$'\n' local -a lines=( $(jq -r '.[] | (.id+";"+.title+";"+.version)' <<<$entries) )
  local i=$(for line in ${lines[@]}; do
              IFS=\; read id title version <<<"$line"
              title=${title:-$id}
              [[ $version ]] && title="$title ($version)"
              echo -e "$title\0icon\x1ffolder\x1fmeta\x1f$id"
            done | .rofi -format d)
  hey.log "Rebooting into: ${lines[$i]}"
  hey.do systemctl reboot --boot-loader-entry \
    $(jq -r --arg id "${lines[$i]/;*}" '.[] | select(.id == $id) | .id' <<<$entries)
}

local cmds=(
  "Turn off displays;system-config-display;rofi.powermenu.dpms"
  "Lock session;system-lock-screen;rofi.powermenu.lock"
  "Suspend;system-suspend;rofi.powermenu.suspend"
  "Reboot;system-reboot;rofi.powermenu.reboot"
  "Reboot into...;system-log-out;rofi.powermenu.reboot-into"
  "Power off;system-shutdown;rofi.powermenu.poweroff"
)

local i=$(for item in ${(k)cmds}; do
            IFS=\; read title icon cmd <<<"$item"
            echo -e "$title\0icon\x1f$icon"
          done | .rofi -format d)
${cmds[$i]/*;/}
</file>

<file path="config/rofi/bin/read.zsh">
#!/usr/bin/env zsh
# Read input using Rofi.

zparseopts -E -D -F -- P:=placeholder I:=icon -password=secret || exit 1
hey.do rofi \
  -dmenu -lines 1 \
  -theme-str 'mainbox{children:[inputbar,message];}' \
  ${icon[2]:+-theme-str "icon{filename:\"${icon[2]}\";}"} \
  ${placeholder[2]:+-theme-str "entry{placeholder:\"${placeholder:1}\";}"} \
  ${secret:+-password}
</file>

<file path="config/rofi/bin/vaultmenu.janet">
#!/usr/bin/env janet
# Manage and insert from bitwarden.
#
# SYNOPSIS:
#   vaultmenu
#
# DESCRIPTION:
#   TODO

(use hey)
(use hey/cmd)
(import hey/rofi)
(import hey/vars)
(import hey/sys)

(def- *vars* (vars/new (:dir vars/temp :rofi :vaultmenu)))
(def- *webvault-url* "https://vault.home.lissner.net")
(def- *data-dir* (path :runtime "vaultwarden.d"))
(os/mkdir *data-dir*)

(defmacro- bw [& args]
  (tuple '$<_ 'bw '--nointeraction '--session '(unquote (session-key))
         ;args))

(defmacro- bw? [& args]
  (tuple '$? 'bw '--nointeraction '--session '(unquote (session-key))
         ;args))

(defn- session-key [&opt reload?]
  (:cache *vars* :sesskey
    |(if-let [p (rofi/read :password true
                           :placeholder "Enter master password..."
                           :message "Vault is locked."
                           :icon "lock")]
       (let [pfile (path :runtime "vaultmenu.tmp")]
         (defer (os/rm pfile)
           (spit pfile p)
           ($<_ bw unlock --nointeraction --passwordfile ,pfile --raw)))
       (abort "Aborted"))
    reload?))

(defn- unlock! []
  (unless (bw? unlock --check)
    (:set *vars* :sesskey nil)))

(defn- items [&opt reload?]
  (:cache *vars* :items |(json/decode (bw list items) :keywords true)
          reload?))

(defn do-copy [item field str &opt secret?]
  (when (sys/yank str :once secret?)
    (sys/notify (fmt "From: '%s'" (item :name))
                :title (fmt "Copied '%s' to clipboard" field)
                :icon "clipboard"
                :sound "notify")))

(defn do-copy-attachment [item att]
  (let [type (case* (path/ext (att :fileName))
                    ["png" "jpg" "jpeg" "gif" "svg"] "text/uri-list"
                    "text/plain")
        tmpfile (path/join *data-dir* (string "att." (att :fileName)))
        error @""]
    (sys/notify "Fetching attachment..." :urgency "low" :sound "blip")
    (unlock!)
    (defer (ignore-errors (os/rm tmpfile))
      (if (bw? get attachment ,(att :id) --itemid ,(item :id) --output ,tmpfile > [stderr error])
        (do
          (sys/yank-file tmpfile type)
          (sys/notify (fmt "From: '%s'" (item :name))
                      :title (fmt "Copied attachment '%s' to clipboard" (att :fileName))
                      :icon "clipboard"
                      :sound "notify"))
        (sys/notify (string error)
                    :title (fmt "Error fetching attachment: %s" (att :fileName))
                    :icon "error"
                    :sound "notify-critical")))))

(defn do-generate [type]
  (sys/notify (fmt "Generating %s..." type) :urgency "low" :sound "blip")
  (when-let [gen (case type
                   :passphrase (bw generate -p -uln --words 5)
                   :username (fmt "%s@login.henrik.io" (bw generate -uln --length 8))
                   (abort "Unknown generator: %s" type))]
    (sys/yank gen)
    (sys/notify gen
                :title (fmt "Copied %s to clipboard" type)
                :icon "clipboard"
                :sound "notify")))


(defn view-item [item]
  (:set *vars* :lastitem (item :id))
  (rofi/chain [rofi
               :theme "vaultmenu"
               :placeholder (fmt "Search %s..."
                                 (case (item :type)
                                   1 "login fields"
                                   2 "note"
                                   3 "card details"
                                   4 "identity"
                                   "entries"))]
    (:add rofi "<b>Open in webvault</b> ->"
          :icon "link"
          :data (fn [] ($ xdg-open ,(fmt "%s/#/vault?itemId=%s" *webvault-url* (item :id)))))
    (when (get-in item [:login :username])
      (:add rofi (fmt "<b>Username:</b> %s" (get-in item [:login :username]))
            :icon "identity"
            :data (fn [] (do-copy item "username" (get-in item [:login :username])))))
    (when (get-in item [:login :password])
      (:add rofi (fmt "<b>Password:</b> %s" (string/repeat "*" (length (get-in item [:login :password]))))
            :icon "lock"
            :data (fn [] (do-copy item "password" (get-in item [:login :password]) true))))
    (when (get-in item [:login :totp])
      (:add rofi "<b>Generate OTP code</b>"
            :icon "clock"
            :data (fn []
                    (unlock!)
                    (do-copy item "OTP code" (bw get totp ,(item :id))))))
    (when (get item :notes)
      (:add rofi (fmt "<b>Notes:</b> %s" (get item :notes))
            :icon "x-shape-text"
            :data (fn [] (do-copy item "notes" (get item :notes)))))
    (each field (get item :fields [])
      (:add rofi (fmt "<b>%s:</b> %s" (field :name)
                      (if (= (field :type) 1)
                        (string/repeat "*" (length (field :value)))
                        (field :value)))
            :icon "text-field"
            :data (fn [] (do-copy item (field :name) (field :value) (= (field :type) 1)))))
    (when (get :item :attachments)
      (:div rofi))
    (each att (get item :attachments [])
      (:add rofi (fmt "<b>Attachment:</b> %s (%s)"
                      (get att :fileName)
                      (get att :sizeName))
            :icon "pin"
            :data (fn [] (do-copy-attachment item att))))))

(def- *deleted-fid* "d7717d3d-95a2-4adf-9afe-869f808455da")
(defn list-items [&opt reload?]
  (let [items (items reload?)]
    (rofi/chain [rofi :theme "vaultmenu"]
      (:add rofi "Open Webvault"
            :icon "reload"
            :data (fn [] ($ xdg-open ,*webvault-url*)))
      (:add rofi "Sync Vault"
            :icon "reload"
            :data (fn [] (list-items true)))
      (:add rofi "Generate a username"
            :icon "username-copy"
            :data (fn [] (do-generate :username)))
      (:add rofi "Generate a passphrase"
            :icon "password-copy"
            :data (fn [] (do-generate :passphrase)))
      (:div rofi)
      (each item items
        (unless (= (item :folderId) *deleted-fid*)
          (:add rofi (fmt "<b>%s</b> %s <span size='small' alpha='50%%'>%s</span>"
                          (case (item :type)
                            1 "Login:"
                            2 "Note:"
                            3 "Card:"
                            4 "Identity:"
                            "Unknown:")
                          (get item :name "")
                          (get-in item [:login :username] ""))
                # TODO: Favicon lib
                :icon (case (item :type)
                        1 "lock"
                        2 "x-shape-text"
                        3 "account-types-credit-card"
                        4 "identity"
                        "<span color='white'>?</span>")
                :data (fn [] (view-item item))))))))

(defmain [_ & args &opts reload? -r resume? -l]
  (when resume?
    (when-let [items (items reload?)
               id (:get *vars* :lastitem)]
      (if-let [item (find |(= (get $ :id) id) items)]
        (do (view-item item)
            (exit 0))
        (echo "No item to resume. Starting from scratch..."))))
  (list-items reload?))
</file>

<file path="config/rofi/bin/wifimenu.janet">
#!/usr/bin/env janet
# Open a wifi menu.
#
# Manage your wifi connection via Rofi, but unlike all the other Rofi wifi
# scripts out there, this one doesn't depend on NetworkManager! Just good ol'
# wpa_cli and wpa_supplicant (for those networking.useNetworkd fanatics out
# there, like me).
#
# SYNOPSIS:
#   wifimenu [--rescan]

(use hey)
(use hey/cmd)
(import hey/sys)
(import hey/rofi)

(defn- known-networks []
  (map (fn [l]
         (let [[id ssid bssid flags] (string/split "\t" l)]
           {:id id
            :ssid ssid
            :bssid bssid
            :flags flags}))
       (slice (string/split "\n" ($<_ wpa_cli list_networks)) 2)))

(defn- scan-results [&opt rescan?]
  # REVIEW: I'm not using the wpa_supplicant sockets because the Janet net lib
  #   has issues with datagram sockets.
  # TODO: Add lock file
  (when rescan?
    (echo "Rescanning...")
    (with [c (os/spawn ["wpa_cli"] :p {:in :pipe :out :pipe})]
      (ev/write (c :in) "SCAN\n")
      (var buf @"")
      (while (ev/read (c :out) 4096 buf)
        (when (string/find "<3>CTRL-EVENT-SCAN-RESULTS " buf)
          (break))
        (ev/sleep 0.2)
        # TODO: Add timeout
        )))
  (let [ssids @{}
        known (map |(get $ :ssid) (known-networks))
        current (some (fn [line]
                        (let [[_ ssid _ flags] (string/split "\t" line)]
                          (when (string/find "[CURRENT]" flags)
                            ssid)))
                      (slice (string/split "\n" ($<_ wpa_cli list_networks)) 2))]
    (each ssid (slice (string/split "\n" ($<_ wpa_cli scan_results)) 2)
      (var [mac freq sig flags ssid] (string/split "\t" ssid))
      (when ssid
        (set ssid (string/trim (peg/replace-all (peg! '(* "\\x" (between 1 2 :d))) "" ssid)))
        (unless (= ssid "")
          (put ssids ssid
               @{:ssid ssid
                 :mac mac
                 :freq (case (-?> freq (scan-number) (/ 1000) (math/trunc))
                         2 "2.4ghz"
                         5 "5ghz"
                         "???")
                 :sig (or (scan-number sig) -100)
                 :flags flags
                 :known (and (index-of ssid known) true)
                 :current (= current ssid)}))))
    ssids))

(defn- current-ap [&opt results]
  (find (fn [ap] (get ap :current)) (or results (scan-results))))

# TODO
(defn connect [ap]
  (not-implemented :connect ap))

# TODO
(defn disconnect [ap]
  (not-implemented :disconnect ap))

# TODO
(defn connect-direct []
  (not-implemented :connect-direct))

(defn- add-network [rofi ap]
  (let [sig (ap :sig)]
    (:add rofi (fmt "%s %s <span size='small' alpha='50%%'>[%s]%s</span>"
                    (if (ap :current)
                      "<b>Disconnect:</b>"
                      "<b>Connect:</b>")
                    (rofi/escape (ap :ssid))
                    (ap :freq)
                    (ap :flags))
          :icon (cond (> sig -50) "network-wireless-signal-excellent"
                      (> sig -60) "network-wireless-signal-good"
                      (> sig -70) "network-wireless-signal-ok"
                      (> sig -80) "network-wireless-signal-low"
                      "network-wireless-signal-none")
          :data (fn [] (if (ap :current)
                         (disconnect ap)
                         (connect ap))))))

(defn- select-ap [&opt rescan?]
  (rofi/chain [rofi :theme "wifimenu"]
    # TODO: Turn on/off radio
    (:add rofi "<b>Rescan networks</b> <span alpha='40%%'>-></span>"
          :icon "search-symbolic"
          :data (fn [] (select-ap true)))
    (:add rofi (fmt "<b>Connect to SSID directly</b> <span alpha='40%%'>-></span>")
          :icon "text-editor-symbolic"
          :data (fn [] (connect-direct))) # TODO
    (let [results (sort (values (scan-results rescan?))
                        (fn [a b] (> (get a :sig) (get b :sig))))]
      (when-let [ap (current-ap results)]
        (take! 1 results)
        (add-network rofi ap))
      (:div rofi)
      (if (empty? results)
        (:add rofi "<span alpha='40%%'>No networks found...</span>"
              :icon "cross"
              :nonselectable true)
        (each ap results
          (unless (ap :current)
            (add-network rofi ap)))))))

(defmain [_ & args &opts rescan? [-r --rescan]]
  (unless (path/find "wpa_cli")
    (abort "wpa_cli not in your PATH"))
  (select-ap rescan?))
</file>

<file path="config/rofi/bin/windowmenu.sh">
#!/usr/bin/env dash

rofi \
  -markup \
  -show window \
  -modes window \
  -theme windowmenu \
  -theme-str "configuration{window-format: \"{c}\n{t}\";}"
</file>

<file path="config/rofi/config.rasi">
/** -*- mode: css -*- **/

configuration {
  /* Display rofi in the focused monitor */
  monitor: "primary";

  modi: "";
  /* modi: "drun,run,filebrowser,window"; */
  case-sensitive: false;
  cycle: false;
  filter: "";
  scroll-method: 1;
  normalize-match: false;
  show-icons: false;
  /* cache-dir: ;*/
  /* steal-focus: false; */
  /* dpi: -1;*/

  /*---------- Matching setting ----------*/
  matching: "normal";
  tokenize: true;  /* search terms separately, and in any order */

  /*---------- SSH settings ----------*/
  /* ssh-client: "ssh"; */
  /* ssh-command: "{terminal} -e {ssh-client} {host} [-p {port}]"; */
  /* parse-hosts: true; */
  /* parse-known-hosts: true; */

  /*---------- Run settings ----------*/
  /* run-command: "{cmd}"; */
  /* run-list-command: ""; */
  /* run-shell-command: "{terminal} -e {cmd}"; */

  /*---------- Window switcher settings ----------*/
  /* window-match-fields: "title,class,role,name,desktop"; */
  /* window-command: "wmctrl -i -R {window}"; */
  /* window-format: "{w} - {c} - {t:0}"; */
  /* window-thumbnail: false; */

  /*---------- Combi settings ----------*/
  /* combi-modi: "window,run";*/
  /* combi-hide-mode-prefix: false;*/
  /* combi-display-format: "{mode} {text}";*/

  /*---------- History and Sorting ----------*/
  disable-history: false;
  /* sorting-method: "normal"; */
  /* max-history-size: 25; */

  /*---------- Display setting ----------*/
  /* display-window: "Windows"; */
  /* display-windowcd: "Window CD"; */
  /* display-run: "Run"; */
  /* display-ssh: "SSH"; */
  /* display-drun: "Apps"; */
  /* display-combi: "Combi"; */
  /* display-keys: "Keys"; */
  /* display-filebrowser: "Files"; */

  /*---------- Misc setting ----------*/
  /* terminal: "rofi-sensible-terminal"; */
  /* sort: false; */
  /* threads: 0; */
  click-to-exit: true;
  /* ignored-prefixes: "";*/
  /* pid: "/run/user/1000/rofi.pid";*/

  /*---------- File browser settings ----------*/
  filebrowser {
    directories-first: true;
    sorting-method: "name";
  }

  /*---------- Other settings ----------*/
  /* timeout { */
  /*   action: "kb-cancel"; */
  /*   delay:  0; */
  /* } */

  /* Auto-select first item when modifying query */
  /* inputchange { */
  /*   action: "kb-row-first"; */
  /* } */

  /* Vim-esque C-j/C-k as up/down in rofi */
  kb-accept-entry: env(ROFI_KB_ACCEPT_ENTRY, "Return,Control+m,KP_Enter");
  kb-remove-to-eol: env(ROFI_KB_ACCEPT_ENTRY, "Return,Control+m,KP_Enter");
  kb-row-down: "Down,Control+n,Control+j";
  kb-row-up: "Up,Control+p,Control+k";

  /*
   * rofi-blocks doesn't recognize command-line -kb-* options, so I reimplement
   * external control through envvars:
   */
  kb-primary-paste:           env(ROFI_KB_PRIMARY_PASTE, "Control+V,Shift+Insert");
  kb-secondary-paste:         env(ROFI_KB_SECONDARY_PASTE, "Control+v,Insert");
  kb-clear-line:              env(ROFI_KB_CLEAR_LINE, "Control+w");
  kb-move-front:              env(ROFI_KB_MOVE_FRONT, "Control+a");
  kb-move-end:                env(ROFI_KB_MOVE_END, "Control+e");
  kb-move-word-back:          env(ROFI_KB_MOVE_WORD_BACK, "Alt+b,Control+Left");
  kb-move-word-forward:       env(ROFI_KB_MOVE_WORD_FORWARD, "Alt+f,Control+Right");
  kb-move-char-back:          env(ROFI_KB_MOVE_CHAR_BACK, "Left,Control+b");
  kb-move-char-forward:       env(ROFI_KB_MOVE_CHAR_FORWARD, "Right,Control+f");
  kb-remove-word-back:        env(ROFI_KB_REMOVE_WORD_BACK, "Control+Alt+h,Control+BackSpace");
  kb-remove-word-forward:     env(ROFI_KB_REMOVE_WORD_FORWARD, "Control+Alt+d");
  kb-remove-char-forward:     env(ROFI_KB_REMOVE_CHAR_FORWARD, "Delete,Control+d");
  kb-remove-char-back:        env(ROFI_KB_REMOVE_CHAR_BACK, "BackSpace,Shift+BackSpace,Control+h");
  kb-remove-to-eol:           env(ROFI_KB_REMOVE_TO_EOL, "");
  kb-remove-to-sol:           env(ROFI_KB_REMOVE_TO_SOL, "Control+u");
  kb-accept-entry:            env(ROFI_KB_ACCEPT_ENTRY, "Return,Control+m,KP_Enter");
  kb-accept-custom:           env(ROFI_KB_ACCEPT_CUSTOM, "Control+Return");
  kb-accept-custom-alt:       env(ROFI_KB_ACCEPT_CUSTOM_ALT, "Control+Shift+Return");
  kb-accept-alt:              env(ROFI_KB_ACCEPT_ALT, "Shift+Return");
  kb-delete-entry:            env(ROFI_KB_DELETE_ENTRY, "Shift+Delete");
  kb-mode-next:               env(ROFI_KB_MODE_NEXT, "Shift+Right,Control+Tab");
  kb-mode-previous:           env(ROFI_KB_MODE_PREVIOUS, "Shift+Left,Control+ISO_Left_Tab");
  kb-mode-complete:           env(ROFI_KB_MODE_COMPLETE, "Control+l");
  kb-row-left:                env(ROFI_KB_ROW_LEFT, "Control+Page_Up");
  kb-row-right:               env(ROFI_KB_ROW_RIGHT, "Control+Page_Down");
  kb-row-up:                  env(ROFI_KB_ROW_UP, "Up,Control+p,Control+k");
  kb-row-down:                env(ROFI_KB_ROW_DOWN, "Down,Control+n,Control+j");
  kb-row-tab:                 env(ROFI_KB_ROW_TAB, "");
  kb-element-next:            env(ROFI_KB_ELEMENT_NEXT, "Tab");
  kb-element-prev:            env(ROFI_KB_ELEMENT_PREV, "ISO_Left_Tab");
  kb-page-prev:               env(ROFI_KB_PAGE_PREV, "Page_Up");
  kb-page-next:               env(ROFI_KB_PAGE_NEXT, "Page_Down");
  kb-row-first:               env(ROFI_KB_ROW_FIRST, "Home,KP_Home");
  kb-row-last:                env(ROFI_KB_ROW_LAST, "End,KP_End");
  kb-row-select:              env(ROFI_KB_ROW_SELECT, "Control+space");
  kb-screenshot:              env(ROFI_KB_SCREENSHOT, "Alt+S");
  kb-ellipsize:               env(ROFI_KB_ELLIPSIZE, "Alt+period");
  kb-toggle-case-sensitivity: env(ROFI_KB_TOGGLE_CASE_SENSITIVITY, "grave,dead_grave");
  kb-toggle-sort:             env(ROFI_KB_TOGGLE_SORT, "Alt+grave");
  kb-cancel:                  env(ROFI_KB_CANCEL, "Escape,Control+g,Control+bracketleft");
  kb-custom-1:                env(ROFI_KB_CUSTOM_1, "Alt+1");
  kb-custom-2:                env(ROFI_KB_CUSTOM_2, "Alt+2");
  kb-custom-3:                env(ROFI_KB_CUSTOM_3, "Alt+3");
  kb-custom-4:                env(ROFI_KB_CUSTOM_4, "Alt+4");
  kb-custom-5:                env(ROFI_KB_CUSTOM_5, "Alt+5");
  kb-custom-6:                env(ROFI_KB_CUSTOM_6, "Alt+6");
  kb-custom-7:                env(ROFI_KB_CUSTOM_7, "Alt+7");
  kb-custom-8:                env(ROFI_KB_CUSTOM_8, "Alt+8");
  kb-custom-9:                env(ROFI_KB_CUSTOM_9, "Alt+9");
  kb-custom-10:               env(ROFI_KB_CUSTOM_10, "Alt+0");
  kb-custom-11:               env(ROFI_KB_CUSTOM_11, "Alt+exclam");
  kb-custom-12:               env(ROFI_KB_CUSTOM_12, "Alt+at");
  kb-custom-13:               env(ROFI_KB_CUSTOM_13, "Alt+numbersign");
  kb-custom-14:               env(ROFI_KB_CUSTOM_14, "Alt+dollar");
  kb-custom-15:               env(ROFI_KB_CUSTOM_15, "Alt+percent");
  kb-custom-16:               env(ROFI_KB_CUSTOM_16, "Alt+dead_circumflex");
  kb-custom-17:               env(ROFI_KB_CUSTOM_17, "Alt+ampersand");
  kb-custom-18:               env(ROFI_KB_CUSTOM_18, "Alt+asterisk");
  kb-custom-19:               env(ROFI_KB_CUSTOM_19, "Alt+parenleft");
  kb-select-1:                env(ROFI_KB_SELECT_1, "Super+1");
  kb-select-2:                env(ROFI_KB_SELECT_2, "Super+2");
  kb-select-3:                env(ROFI_KB_SELECT_3, "Super+3");
  kb-select-4:                env(ROFI_KB_SELECT_4, "Super+4");
  kb-select-5:                env(ROFI_KB_SELECT_5, "Super+5");
  kb-select-6:                env(ROFI_KB_SELECT_6, "Super+6");
  kb-select-7:                env(ROFI_KB_SELECT_7, "Super+7");
  kb-select-8:                env(ROFI_KB_SELECT_8, "Super+8");
  kb-select-9:                env(ROFI_KB_SELECT_9, "Super+9");
  kb-select-10:               env(ROFI_KB_SELECT_10, "Super+0");
  /* ml-row-left:                env(ROFI_ML_ROW_LEFT, "ScrollLeft"); */
  /* ml-row-right:               env(ROFI_ML_ROW_RIGHT, "ScrollRight"); */
  /* ml-row-up:                  env(ROFI_ML_ROW_UP, "ScrollUp"); */
  /* ml-row-down:                env(ROFI_ML_ROW_DOWN, "ScrollDown"); */
  /* me-select-entry:            env(ROFI_ME_SELECT_ENTRY, "MousePrimary"); */
  /* me-accept-entry:            env(ROFI_ME_ACCEPT_ENTRY, "MouseDPrimary"); */
  /* me-accept-custom:           env(ROFI_ME_ACCEPT_CUSTOM, "Control+MouseDPrimary"); */
}

/* Universal fixes and resets */
* {
  background-color: transparent;
  text-color: inherit;
}

window {
  enabled: true;
  anchor: env(ROFI_ANCHOR, north);
  location: north;
  x-offset: env(ROFI_X, 0);
  y-offset: env(ROFI_Y, 40%);
  transparency: "real";
  background-color: transparent;
}

/* Reset! */
window, mainbox {
  spacing: 0;
  padding: 0;
  margin: 0;
  border: 0;
  border-radius: 0;
  outline: 0;
}

mainbox {
  enabled: true;
  children: [ inputbar, message, listview, overlay ];
}

textbox { font: inherit; }

inputbar { children: [ icon, prompt, entry, num-filtered-rows ]; }

icon, icon-current-entry, prompt, num-filtered-rows {
  expand: false;
}

icon {
  filename: env(ROFI_ICON, "search-symbolic");
}

entry {
  placeholder: env(ROFI_PLACEHOLDER, "Search...");
  placeholder-markup: true;
  cursor: text;
  blink: true;
}

/* Import nix-generated files */
@import "./config.theme.rasi"
</file>

<file path="config/secrets/secrets.nix">
let key = "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIDTrNzqosWkwzuqVshaAi6vOXdd9zBGshSwDxzykXlgZ hlissner@global";
in {

}
</file>

<file path="config/sxhkd/sxhkdrc">
super + t
	bspc desktop -l next

super + w; super + b
	bspc window -s last

# Attach to a detached session. If none is available create a new one, rather
# than attach to one that is already attached to elsewhere.
super + Return
	xst -e bash -c "(tmux ls | grep -qEv 'attached|xst-scratch' && tmux at) || tmux" || /run/current-system/sw/bin/xterm
# Start a plain ol' terminal
super + ctrl + Return
	xst || /run/current-system/sw/bin/xterm
# Emergency console
super + ctrl + alt + Return
	/run/current-system/sw/bin/xterm bash

# Open a disposable, floating terminal window, for quick shell commands.
super + grave
	hey .xst-scratch

# Invoke emacs-everywhere at point.
super + e
    emacsclient --eval "(emacs-everywhere)"
super + ctrl + e
	emacsclient --eval "(open-scratch-frame)"

# Rofi commands
super + space
	hey @rofi menu

super + Tab
	hey @rofi window.menu

super + equal
	hey @rofi menus/calc.rb

super + slash
	hey @rofi menus/file.rb ~

# screenshot region
Print
    hey @rofi menus/screen.rb --capture
# draw on the screen toggle
super + Print
    hey @rofi menus/screen.rb --record
# more comprehensive screen{cap,cast,draw} menu
super + ctrl + Print
    hey @rofi menus/screen.rb
# Toggle drawing on the screen
super + d
    hey @rofi menus/screen.rb --draw

# TODO
# super + i
# 	hey @rofi menus/insert.rb

# super + c
# 	hey @rofi menus/paste.rb -c

# super + v
# 	hey @rofi menus/paste.rb

# super + p
# 	hey @rofi menus/vaultwarden.rb

# super + shift + p
# 	hey @rofi menus/vaultwarden.rb -r

super + Escape
    dunstctl close

super + shift + r
    hey reload
	pkill -USR1 -x sxhkd; notify-send "Reloaded sxhkd"

# Switch clock with system stats while Meta is down
@Super_L
	hey theme polybar run 0

Super_L
	hey theme polybar run 1


#
##

# Toggle fullscreen
super + w; super + f
	bspc node -t ~fullscreen

# Toggle floating
super + w; super + t
	bspc node -t ~floating

# Focus window directionally; w/ ctrl = move by monitor
super + {_,ctrl +}{h,j,k,l}
	hey .focus {_,-m }{west,south,north,east}

# Swap windows directionally; w/ ctrl = across monitors
super + shift + {_,ctrl +}{h,j,k,l}
	hey .swap {_,-m }{west,south,north,east}

# Resize or contract a window i3-style
super + alt + {h,j,k,l}
	hey .resize {x -, y +, y -, x +} 40
super + alt + ctrl + {h,j,k,l}
	hey .resize {x -, y +, y -, x +} 160


#
##

# Regular "quit app"
super + q; super + q
    bspc node -c

# Force kill app
super + q; super + k
    bspc node -k


#
## Desktops

# Switch to numbered desktop
super + {1-9,0}
	bspc desktop -f {1-9,10};

# On shift = move current node to numbered desktop
super + shift + {1-9,0}
	bspc node -d {1-9,10};


#
## Media keys

XF86MonBrightnessUp
	hey .osd brightness up
XF86MonBrightnessDown
	hey .osd brightness down

XF86AudioMute
	hey .osd master toggle
XF86AudioRaiseVolume
	hey .osd master up
XF86AudioLowerVolume
	hey .osd master down

super + XF86AudioMute
	hey .osd capture toggle
super + XF86AudioRaiseVolume
	hey .osd capture up
super + XF86AudioLowerVolume
	hey .osd capture down

# XF86Audio{Play,Pause}
# 	playerctl -p spotify play-pause
# XF86AudioNext
# 	playerctl -p spotify next
# XF86AudioPrev
# 	playerctl -p spotify previous
# super + XF86AudioNext
# 	playerctl -p spotify position 5+
# super + XF86AudioPrev
# 	playerctl -p spotify position 5-
</file>

<file path="config/tmux/bin/swap-pane.zsh">
#!/usr/bin/env zsh
# Swap the current pane with an adjacent one.
#
# SYNOPSIS:
#   swap-pane [up|down|left|right|master]
#
# DESCRIPTION:
#   TODO

local target
case $1 in
  up) target="U" ;;
  down) target="D" ;;
  left) target="L" ;;
  right) target="R" ;;
  master) target="M" ;;
  *) exit 1 ;;
esac

local src_pane=$(tmux display-message -p "#P")
hey.do tmux select-pane -${target}

local dst_pane=$(tmux display-message -p "#P")
hey.do tmux select-pane -t${src_pane}

[[ "$target" == M ]] && dst_pane=0
hey.do tmux swap-pane -s"$src_pane" -t"$dst_pane"
hey.do tmux select-pane -t"$dst_pane"
</file>

<file path="config/tmux/aliases.zsh">
#!/usr/bin/env zsh

alias ta='tmux attach'
alias tl='tmux ls'

if [[ -n $TMUX ]]; then # From inside tmux
  alias tf='tmux find-window'
  # Detach all other clients to this session
  alias mine='tmux detach -a'
  # Send command to other tmux window
  tt() {
    tmux send-keys -t .+ C-u && \
      tmux set-buffer "$*" && \
      tmux paste-buffer -t .+ && \
      tmux send-keys -t .+ Enter;
  }
  # Create new session (from inside one)
  tn() {
    local name="${1:-`basename $PWD`}"
    TMUX= tmux new-session -d -s "$name"
    tmux switch-client -t "$name"
    tmux display-message "Session #S created"
  }
else # From outside tmux
  # Start grouped session so I can be in two different windows in one session
  tdup() { tmux new-session -t "${1:-`tmux display-message -p '#S'`}"; }
fi
</file>

<file path="config/tmux/tmux.conf">
# tmux.conf
########################################

setw -g automatic-rename on      # rename window after current program
set  -g renumber-windows on      # renumber windows when one is closed
# Zero-based indexing is fine in programming languages, but not so much in a
# multiplexer when zero is on the other side of the keyboard.
set  -g base-index 1
setw -g pane-base-index 1
# display tmux messages longer
set  -g display-time 1500
set  -g display-panes-time 800
# Address vim-mode switching delay (http://superuser.com/a/252717/65504)
set  -s escape-time   40
set -sg repeat-time   600
set  -g history-limit 50000
# Update status-{left,right} more often (default: 15)
set  -g status-interval 5
# Rather than constraining window size to the maximum size of any client
# connected to the *session*, constrain window size to the maximum size of any
# client connected to *that window*. Much more reasonable.
setw -g aggressive-resize off
# For terminals that support them, propagate these events to programs that
# understand them.
set  -s focus-events on
# Enable mouse + mouse wheel
set  -g mouse on
# Transparent status bar, by default
set  -g status-style bg=default

########################################
# Keybinds                             #
########################################

# Rebind prefix to C-c. Press twice to send literal C-c.
unbind C-b
set -g prefix C-c
bind C-c send-prefix
bind C-b display-message

# Vi-style keybinds
set -g status-keys vi
set -g mode-keys   vi

bind c new-window      -c "#{pane_current_path}"
bind v split-window -h -c "#{pane_current_path}"
bind s split-window -v -c "#{pane_current_path}"

bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R
bind H run 'hey @tmux swap-pane left'
bind J run 'hey @tmux swap-pane down'
bind K run 'hey @tmux swap-pane up'
bind L run 'hey @tmux swap-pane right'
bind M run 'hey @tmux swap-pane master'

bind o resize-pane -Z
bind S choose-session
bind W choose-window
bind / choose-session
bind . choose-window

# bind = select-layout tiled
bind | select-layout even-horizontal
bind _ select-layout even-vertical

# Disable confirmation
bind x kill-pane
bind X kill-window
bind q kill-session
bind Q kill-server

# Smart pane switching with awareness of vim splits
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim='echo "#{pane_current_command}" | grep -iqE "(^|\/)g?(view|n?vim?x?)(diff)?$"'
bind -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"
bind -n C-\\ if-shell "$is_vim" "send-keys C-\\" "select-pane -l"
bind C-w last-pane
bind C-n next-window
bind C-p previous-window

bind = select-layout even-tiled     # balance-windows analogue (sort of)
bind - break-pane
bind _ join-pane

# reload config without killing server
bind r source-file /etc/tmux.conf \; display-message "  Config reloaded..".
bind ^r refresh-client


########################################
# Copy mode                            #
########################################

bind Enter copy-mode # enter copy mode
bind b list-buffers  # list paster buffers
bind B choose-buffer # choose which buffer to paste from
bind p paste-buffer  # paste from the top paste buffer
# bind P run "xclip -selection clipboard -o | tmux load-buffer - ; tmux paste-buffer"
bind P run "wl-paste | tmux load-buffer - ; tmux paste-buffer"

bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi Escape send-keys -X cancel
bind -T copy-mode-vi C-g send-keys -X cancel
bind -T copy-mode-vi H send-keys -X start-of-line
bind -T copy-mode-vi L send-keys -X end-of-line


########################################
# Local config                         #
########################################
if '[ -f ~/.config/tmux/tmux.local.conf ]' 'source-file ~/.config/tmux/tmux.local.conf'
</file>

<file path="config/waybar/config">
// config/waybar/config  -*- mode: js-json -*-
// Comon settings for the foot terminal. Additional settings are set by themes.

{}
</file>

<file path="config/zsh/completions/_hey">
#compdef _hey hey

function __list_commands {
  local -aU subcmds
  local line dir next help command
  dir="$1"
  # the parens after the glob contains "glob qualifiers" (see man zshexpn):
  # * executable
  # - follow symlinks
  # , "or" separator
  # / directories
  for file in "$dir"/*(-*,/); do
    command=${file:A:t:r}

    if [[ $file == _* || ! -x $file ]]; then
      continue
    elif [[ -d $file ]]; then
      [[ -n ${file:r}*(.xN[1]) ]] && continue
      [[ -f $file/.docs ]] && help=$(head -n1 $file/.docs)
    else
      help=$(head -n+2 $file | tail -n-1 | sed -e 's/^# //')
    fi

    subcmds+=("$command:\"$help\"")
  done

  _arguments -C ": :(($subcmds))" "*::arg:->args"

  case "$words[1]" in
    sync) __hey_sync ;;
    swap) __hey_swap ;;
  esac


  next="$dir/${line[1]}"
  if [[ ! -z $line[1] && -d "$next" ]]; then
    __list_commands "$next"
  elif [[ ! -z $line[1] && -x "$next" ]]; then
    # You could imagine wanting to customize the '*:file:_files' fallback
    # at some point, but I'm not going to worry about that for now.
    _arguments -A '-*' \
      '--help[print help text]' \
      '--cat[print script contents]' \
      '--which[print script path]' \
      '--edit[open script for editing]' \
      '--really[suppress special argument handling]' \
      '*:file:_files'
  elif [[ ! -z $line[1] && ! -f "$next" ]]; then
    _arguments "--new[create a new script]"
  fi
}

function __hey_sync {
  if [[ $words[2] == -- ]]; then
    _nixos-rebuild $@
  else
    _arguments -C \
      '--fast[Rebuild the system config quickly]' \
      '(-t --theme)'{-t,--theme}'[Override the enabled theme]' \
      '(-p --profile)'{-p,--profile}'[Target a specific nixos profile]' \
      "*::arg:->args"
  fi
}

function __hey_swap {
  _alternative \
    'args:commands:((all\:"All files" ls\:"List swapped files"))' \
    'files:filename:_files'
  # _arguments -C \
  #   '-u[Unswap the files]' \
}

__list_commands ${DOTFILES_HOME}/bin/hey.d
</file>

<file path="config/zsh/.zshrc">
#!/usr/bin/env zsh

# Stop TRAMP (in Emacs) from hanging or term/shell from echoing back commands
if [[ $TERM == dumb || -n $INSIDE_EMACS ]]; then
  unsetopt zle prompt_cr prompt_subst
  whence -w precmd >/dev/null && unfunction precmd
  whence -w preexec >/dev/null && unfunction preexec
  PS1='$ '
fi

## Bootstrap interactive session
if [[ $TERM != dumb ]]; then
  # Don't call compinit too early. I'll do it myself, at the right time.
  export ZGEN_AUTOLOAD_COMPINIT=0

  ## ZSH configuration
  if (( $+commands[bat] )); then
    export MANPAGER="sh -c 'col -bx | bat -l man -p'"
    export MANROFFOPT='-c'
  fi

  # Treat these characters as part of a word.
  WORDCHARS='-*?[]~&.;!#$%^(){}<>'
  unsetopt BRACE_CCL        # Allow brace character class list expansion.
  setopt COMBINING_CHARS    # Combine zero-length punc chars (accents) with base char
  setopt RC_QUOTES          # Allow 'Henry''s Garage' instead of 'Henry'\''s Garage'
  setopt HASH_LIST_ALL
  unsetopt CORRECT_ALL
  unsetopt NOMATCH
  unsetopt MAIL_WARNING     # Don't print a warning message if a mail file has been accessed.
  unsetopt BEEP             # Hush now, quiet now.
  setopt IGNOREEOF
  ## Jobs
  setopt LONG_LIST_JOBS     # List jobs in the long format by default.
  setopt AUTO_RESUME        # Attempt to resume existing job before creating a new process.
  setopt NOTIFY             # Report status of background jobs immediately.
  unsetopt BG_NICE          # Don't run all background jobs at a lower priority.
  unsetopt HUP              # Don't kill jobs on shell exit.
  unsetopt CHECK_JOBS       # Don't report on jobs when shell exit.
  ## History
  HISTORY_SUBSTRING_SEARCH_PREFIXED=1
  HISTORY_SUBSTRING_SEARCH_FUZZY=1
  HISTSIZE=100000   # Max events to store in internal history.
  SAVEHIST=100000   # Max events to store in history file.
  setopt BANG_HIST                 # History expansions on '!'
  setopt EXTENDED_HISTORY          # Include start time in history records
  setopt APPEND_HISTORY            # Appends history to history file on exit
  setopt INC_APPEND_HISTORY        # Write to the history file immediately, not when the shell exits.
  setopt SHARE_HISTORY             # Share history between all sessions.
  setopt HIST_EXPIRE_DUPS_FIRST    # Expire a duplicate event first when trimming history.
  setopt HIST_IGNORE_DUPS          # Do not record an event that was just recorded again.
  setopt HIST_IGNORE_ALL_DUPS      # Remove old events if new event is a duplicate
  setopt HIST_FIND_NO_DUPS         # Do not display a previously found event.
  setopt HIST_IGNORE_SPACE         # Do not record an event starting with a space.
  setopt HIST_SAVE_NO_DUPS         # Do not write a duplicate event to the history file.
  setopt HIST_REDUCE_BLANKS        # Minimize unnecessary whitespace
  setopt HIST_VERIFY               # Do not execute immediately upon history expansion.
  setopt HIST_BEEP                 # Beep when accessing non-existent history.
  ## Directories
  DIRSTACKSIZE=9
  unsetopt AUTO_CD            # Implicit CD slows down plugins
  setopt AUTO_PUSHD           # Push the old directory onto the stack on cd.
  setopt PUSHD_IGNORE_DUPS    # Do not store duplicates in the stack.
  setopt PUSHD_SILENT         # Do not print the directory stack after pushd or popd.
  unsetopt PUSHD_TO_HOME      # Don't push to $HOME when no argument is given.
  setopt CDABLE_VARS          # Change directory to a path stored in a variable.
  setopt MULTIOS              # Write to multiple descriptors.
  unsetopt GLOB_DOTS
  unsetopt AUTO_NAME_DIRS     # Don't add variable-stored paths to ~ list

  ## Plugin configuration
  if (( $+commands[fd] )); then
    export FZF_DEFAULT_OPTS="--reverse --ansi"
    export FZF_DEFAULT_COMMAND="fd ."
    export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
    export FZF_ALT_C_COMMAND="fd -t d . $HOME"
  fi
  # zsh-vi-mode
  export ZVM_INIT_MODE=sourcing
  export ZVM_VI_ESCAPE_BINDKEY=^G
  export ZVM_LINE_INIT_MODE=i
  # zsh-autosuggest
  export ZSH_AUTOSUGGEST_MANUAL_REBIND=1

  ## Bootstrap zgenom
  export ZGEN_DIR="${ZGEN_DIR:-${XDG_DATA_HOME:-~/.local/share}/zgenom}"
  if [[ ! -d "$ZGEN_DIR" ]]; then
    # Use zgenom because zgen is no longer maintained
    echo "Installing jandamm/zgenom"
    git clone https://github.com/jandamm/zgenom "$ZGEN_DIR"
  fi

  source $ZGEN_DIR/zgenom.zsh
  zgenom autoupdate   # checks for updates every ~7 days
  if ! zgenom saved; then
    echo "Initializing zgenom"
    rm -frv $ZDOTDIR/*.zwc(N) \
            $ZDOTDIR/.*.zwc(N) \
            $XDG_CACHE_HOME/zsh \
            $ZGEN_INIT.zwc

    # Be extra careful about plugin load order, or subtle breakage can emerge.
    # This is the best order I've sussed out for these plugins.
    zgenom load junegunn/fzf shell
    zgenom load jeffreytse/zsh-vi-mode
    zgenom load zdharma-continuum/fast-syntax-highlighting
    zgenom load zsh-users/zsh-completions src
    zgenom load zsh-users/zsh-autosuggestions
    zgenom load dxrcy/zsh-history-substring-search
    zgenom load romkatv/powerlevel10k powerlevel10k
    zgenom load hlissner/zsh-autopair autopair.zsh

    zgenom save

    # Must be explicit because zgenom compile ignores nix-store symlinks
    zgenom compile \
      $ZDOTDIR/*(-.N) \
      $ZDOTDIR/.*(-.N) \
      $ZDOTDIR/completions/_*(-.N) \
      $DOTFILES_HOME/lib/zsh/*~*.zwc(.N)
  fi

  ## My dotfiles
  source $ZDOTDIR/completion.zsh
  source $ZDOTDIR/keybinds.zsh
  source $ZDOTDIR/aliases.zsh
  source $ZDOTDIR/extra.zshrc   # Auto-generated by nixos

  autopair-init

  # CD-able vars
  cfg=~/.config
fi
</file>

<file path="config/zsh/aliases.zsh">
alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'
alias -- -='cd -'

alias q=exit
alias clr=clear
alias sudo='sudo '
alias rm='rm -i'
alias mkdir='mkdir -pv'
alias wget='wget -c'
alias path='echo -e ${PATH//:/\\n}'
alias ports='netstat -tulanp'

alias reload='source /run/current-system/etc/set-environment'
alias mk=make
alias gurl='curl --compressed'

# An rsync that respects gitignore
function rcp {
  # -a = -rlptgoD
  #   -r = recursive
  #   -l = copy symlinks as symlinks
  #   -p = preserve permissions
  #   -t = preserve mtimes
  #   -g = preserve owning group
  #   -o = preserve owner
  # -z = use compression
  # -P = show progress on transferred file
  # -J = don't touch mtimes on symlinks (always errors)
  rsync -azPJ \
    --include=.git/ \
    --filter=':- .gitignore' \
    --filter=":- $XDG_CONFIG_HOME/git/ignore" \
    "$@"
}; compdef rcp=rsync
alias rcpd='rcp --delete --delete-after'
alias rcpu='rcp --chmod=go='
alias rcpdu='rcpd --chmod=go='

if (( $+commands[wl-copy] )); then
  alias y='wl-copy'
  alias p='wl-paste'
elif (( $+commands[xclip] )); then
  alias y='xclip -selection clipboard -in'
  alias p='xclip -selection clipboard -out'
fi

alias jc='journalctl -xe'
alias jcu='journalctl -xe -u'
alias sc=systemctl
alias scu='systemctl --user'
alias scur='systemctl --user restart'
alias scus='systemctl --user status'
alias ssc='sudo systemctl'
alias sscr='sudo systemctl restart'
alias sscs='sudo systemctl status'
alias rctl='sudo resolvectl'
alias nctl='sudo networkctl'
alias bctl='bluetoothctl'

alias nonet='systemd-run --user --property=PrivateNetwork=yes --same-dir --pty'

if (( $+commands[eza] )); then
  alias exa="eza --group-directories-first --git";
  alias l="eza -blF --icons";
  alias ll="eza -abghilmu";
  alias llm='ll --sort=modified'
  alias la="LC_COLLATE=C eza -ablF";
  alias tree='eza --tree'
fi

if (( $+commands[fasd] && $+commands[fzf] )); then
  # fuzzy completion with 'z' when called without args
  (( $+aliases[z] )) && unalias z
  function z {
    if (( $# > 0 )); then
      fasd_cd -d $@
    else
      local dir=$(fasd_cd -d -l 2>&1 | fzf --height 40% --nth 2.. --reverse --inline-info +s --tac --query "${*##-* }" | sed 's/^[0-9,.]* *//')
      [[ -n $dir ]] && cd $dir
    fi
  }
fi

if (( $+commands[udisksctl] )); then
  alias ud='udisksctl'
  alias udm='udisksctl mount -b'
  alias udu='udisksctl unmount -b'
  alias udl='udisksctl lock -b'
  alias udul='udisksctl unlock -b'
fi

if (( $+commands[nix] )); then
  alias n=nix
  alias ne=nix-env
  alias nf='nix flake'
  alias nfm='nix flake metadata'
  alias nfs='nix flake show'
  alias nr='nix repl'
  alias nrp='nix repl "<nixpkgs>"'
  alias ns='nix search'
  alias nsp='nix search nixpkgs'
fi

if (( $+commands[swayimg] )); then
  alias -s {jpg,jpeg,gif,png,svg}=swayimg
elif (( $+commands[feh] )); then
  alias -s {jpg,jpeg,gif,png,svg}=feh
fi

alias -s pdf='$BROWSER'
(( $+commands[mpv] )) && alias -s {mp4,avi,mkv,mov}='mpv --loop'
(( $+commands[xdg-open] )) && alias open=xdg-open
(( $+commands[img2sixel] )) && alias six=img2sixel

autoload -U zmv

function mkcd { mkdir "$1" && cd "$1"; }; compdef mkcd=mkdir

function zman { PAGER="less -g -I -s '+/^       "$1"'" man zshall; }
</file>

<file path="config/zsh/completion.zsh">
fpath+=( "${0:a:h}/completions" )

# Don't offer history completion; we have fzf, C-r, and
# zsh-history-substring-search for that.
ZSH_AUTOSUGGEST_STRATEGY=(completion)
ZSH_AUTOSUGGEST_BUFFER_MAX_SIZE=30

# Completion is slow. Use a cache! For the love of god, use a cache...
zstyle ':completion:*' use-cache on
zstyle ':completion:*' cache-path "$XDG_CACHE_HOME/zsh"

# Expand partial paths, e.g. cd f/b/z == cd foo/bar/baz (assuming no ambiguity)
zstyle ':completion:*:paths' path-completion yes

# Fix slow one-by-one character pasting when bracketed-paste-magic is on. See
# zsh-users/zsh-syntax-highlighting#295
zstyle ':bracketed-paste-magic' active-widgets '.self-*'

# Options
setopt COMPLETE_IN_WORD    # Complete from both ends of a word.
setopt EXTENDED_GLOB       # Use extended globbing syntax.
setopt PATH_DIRS           # Perform path search even on command names with slashes.
setopt AUTO_MENU           # Show completion menu on a successive tab press.
setopt AUTO_LIST           # Automatically list choices on ambiguous completion.
# setopt AUTO_PARAM_SLASH    # If completed parameter is a directory, add a trailing slash.
# setopt AUTO_PARAM_KEYS
unsetopt FLOW_CONTROL        # Redundant with tmux
unsetopt MENU_COMPLETE     # Do not autoselect the first completion entry.
unsetopt COMPLETE_ALIASES  # Disabling this enables completion for aliases
# unsetopt ALWAYS_TO_END     # Move cursor to the end of a completed word.
unsetopt CASE_GLOB

zstyle ':completion:*:default' list-colors ${(s.:.)LS_COLORS}

# Fuzzy match mistyped completions.
zstyle ':completion:*' completer _complete _match _approximate _list
zstyle ':completion:*' matcher-list 'm:{[:lower:]-}={[:upper:]_}' 'r:[[:ascii:]]||[[:ascii:]]=** r:|?=**'
zstyle ':completion:*:match:*' original only
zstyle ':completion:*:approximate:*' max-errors 1 numeric
# Increase the number of errors based on the length of the typed word.
zstyle -e ':completion:*:approximate:*' max-errors 'reply=($((($#PREFIX+$#SUFFIX)/3))numeric)'
# Don't complete unavailable commands.
zstyle ':completion:*:(functions|parameters)' ignored-patterns '(_*|.*|-*|+*|autosuggest-*|pre(cmd|exec))'
# Group matches and describe.
zstyle ':completion:*:corrections' format '%B%F{green}%d (errors: %e)%f%b'
zstyle ':completion:*:messages' format '%B%F{yellow}%d%f%b'
zstyle ':completion:*:warnings' format '%B%F{red}No such %d%f%b'
zstyle ':completion:*:errors' format '%B%F{red}No such %d%f%b'
zstyle ':completion:*:descriptions' format $'%{\e[35;1m%}%d%{\e[0m%}'
zstyle ':completion:*:default' list-prompt '%S%M matches%s'
# Omit parent and current directories from completion results when they are
# already named in the input.
zstyle ':completion:*:*:cd:*' ignore-parents parent pwd
# Merge multiple, consecutive slashes in paths
zstyle ':completion:*' squeeze-slashes true
# Don't wrap around when navigating to either end of history
zstyle ':completion:*:history-words' stop yes
zstyle ':completion:*:history-words' remove-all-dups yes
zstyle ':completion:*:history-words' list false
zstyle ':completion:*:history-words' menu yes
# Exclude internal/fake envvars
zstyle ':completion::*:(-command-|export):*' fake-parameters ${${${_comps[(I)-value-*]#*,}%%,*}:#-*-}
# Sory array completion candidates
zstyle ':completion:*:*:-subscript-:*' tag-order indexes parameters
# Complete hostnames from ssh files too
zstyle -e ':completion:*:hosts' hosts 'reply=(
  ${=${=${=${${(f)"$(cat {/etc/ssh_,~/.{config/,}ssh/known_}hosts(|2)(N) 2>/dev/null)"}%%[#| ]*}//\]:[0-9]*/ }//,/ }//\[/ }
  ${=${${${${(@M)${(f)"$(cat ~/.{config/,}ssh/config 2>/dev/null)"}:#Host *}#Host }:#*\**}:#*\?*}}
)'
# Don't complete uninteresting users
zstyle ':completion:*:users' ignored-patterns \
  adm amanda apache avahi beaglidx bin cacti canna clamav daemon \
  dbus distcache dovecot fax ftp games gdm gkrellmd gopher \
  hacluster haldaemon halt hsqldb ident junkbust ldap lp mail \
  mailman mailnull mldonkey mysql nagios \
  named netdump news nfsnobody nobody 'nixbld*' nscd ntp nut nx openvpn \
  operator pcap postfix postgres privoxy pulse pvm quagga radvd \
  rpc rpcuser rpm shutdown squid sshd sync 'systemd-*' uucp vcsa xfs '_*'
# ... unless we really want to.
zstyle '*' single-ignored show
# Ignore multiple entries.
zstyle ':completion:*:(rm|kill|diff):*' ignore-line other
zstyle ':completion:*:rm:*' file-patterns '*:all-files'
# PID completion for kill
zstyle ':completion:*:*:*:*:processes' command 'ps -u $LOGNAME -o pid,user,command -w'
zstyle ':completion:*:*:kill:*:processes' list-colors '=(#b) #([0-9]#) ([0-9a-z-]#)*=01;36=0=01'
zstyle ':completion:*:*:kill:*' menu yes select
zstyle ':completion:*:*:kill:*' force-list always
zstyle ':completion:*:*:kill:*' insert-ids single
# Man
zstyle ':completion:*:manuals' separate-sections true
zstyle ':completion:*:manuals.(^1*)' insert-sections true
# Media Players
zstyle ':completion:*:*:mpg123:*' file-patterns '*.(mp3|MP3):mp3\ files *(-/):directories'
zstyle ':completion:*:*:mpg321:*' file-patterns '*.(mp3|MP3):mp3\ files *(-/):directories'
zstyle ':completion:*:*:ogg123:*' file-patterns '*.(ogg|OGG|flac):ogg\ files *(-/):directories'
zstyle ':completion:*:*:mocp:*' file-patterns '*.(wav|WAV|mp3|MP3|ogg|OGG|flac):ogg\ files *(-/):directories'
# SSH/SCP/RSYNC
zstyle ':completion:*:(scp|rsync):*' tag-order 'hosts:-host:host hosts:-domain:domain hosts:-ipaddr:ip\ address *'
zstyle ':completion:*:(scp|rsync):*' group-order users files all-files hosts-domain hosts-host hosts-ipaddr
zstyle ':completion:*:ssh:*' tag-order 'hosts:-host:host hosts:-domain:domain hosts:-ipaddr:ip\ address *'
zstyle ':completion:*:ssh:*' group-order users hosts-domain hosts-host users hosts-ipaddr
zstyle ':completion:*:(ssh|scp|rsync):*:hosts-host' ignored-patterns '*(.|:)*' loopback ip6-loopback localhost ip6-localhost broadcasthost
zstyle ':completion:*:(ssh|scp|rsync):*:hosts-domain' ignored-patterns '<->.<->.<->.<->' '^[-[:alnum:]]##(.[-[:alnum:]]##)##' '*@*'
zstyle ':completion:*:(ssh|scp|rsync):*:hosts-ipaddr' ignored-patterns '^(<->.<->.<->.<->|(|::)([[:xdigit:].]##:(#c,2))##(|%*))' '127.0.0.<->' '255.255.255.255' '::1' 'fe80::*'

# Only generate the dump if it doesn't exist. `hey reload` will clear it. And
# yes, -d is necessary. compinit doesn't respect cache-path.
ZCOMPCACHE="$XDG_CACHE_HOME/zsh/zcompdump.$ZSH_VERSION"
if autoload -Uz compinit; then
  compinit -u -C -d "$ZCOMPCACHE"
  [[ ! -f "$ZCOMPCACHE.zwc" && -f $ZCOMPCACHE ]] && zcompile "$ZCOMPCACHE"
fi
</file>

<file path="config/zsh/keybinds.zsh">
# Other conveniences
bindkey -M viins '^a' beginning-of-line
bindkey -M viins '^d' push-line-or-edit

# Vanilla behavior is to move by characters
bindkey -M viins '^b' backward-word
bindkey -M viins '^f' forward-word

# Up arrow:
bindkey '\e[A' history-substring-search-up
bindkey '\eOA' history-substring-search-up
# Down arrow:
bindkey '\e[B' history-substring-search-down
bindkey '\eOB' history-substring-search-down

# C-z to toggle current process (background/foreground)
fancy-ctrl-z () {
  if [[ $#BUFFER -eq 0 ]]; then
    BUFFER="fg"
    zle accept-line
  else
    zle push-input
    zle clear-screen
  fi
}
zle -N fancy-ctrl-z
bindkey '^Z' fancy-ctrl-z

if (( $+commands[fzf] )); then
  bindkey '^R' fzf-history-widget
fi

# Omni-Completion
if (( $+commands[fasd] )); then
  bindkey -M viins '^x^f' fasd-complete-f  # C-x C-f to do fasd-complete-f (only files)
  bindkey -M viins '^x^d' fasd-complete-d  # C-x C-d to do fasd-complete-d (only directories)
fi

# Completing words in buffer in tmux
if [ -n "$TMUX" ]; then
  _tmux_pane_words() {
    local expl
    local -a w
    if [[ -z "$TMUX_PANE" ]]; then
      _message "not running inside tmux!"
      return 1
    fi
    w=( ${(u)=$(tmux capture-pane \; show-buffer \; delete-buffer)} )
    _wanted values expl 'words from current tmux pane' compadd -a w
  }

  zle -C tmux-pane-words-prefix   complete-word _generic
  zle -C tmux-pane-words-anywhere complete-word _generic

  bindkey -M viins '^x^n' tmux-pane-words-prefix
  bindkey -M viins '^x^o' tmux-pane-words-anywhere

  zstyle ':completion:tmux-pane-words-(prefix|anywhere):*' completer _tmux_pane_words
  zstyle ':completion:tmux-pane-words-(prefix|anywhere):*' ignore-line current
  zstyle ':completion:tmux-pane-words-anywhere:*' matcher-list 'b:=* m:{A-Za-z}={a-zA-Z}'
fi

# Vim's C-x C-l in zsh
history-beginning-search-backward-then-append() {
  zle history-beginning-search-backward
  zle vi-add-eol
}
zle -N history-beginning-search-backward-then-append
bindkey -M viins '^x^l' history-beginning-search-backward-then-append
</file>

<file path="hosts/harusame/secrets/secrets.nix">
let key = "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAVNMxUyrezww+kbOuIQqYevhfLw2G1x8SKJpH5uPvOM";
in {
  "wg0PrivateKey.age".publicKeys = [key];
}
</file>

<file path="hosts/harusame/default.nix">
# Harusame -- my workstation abroad

{ hey, lib, ... }:

with lib;
with builtins;
{
  system = "x86_64-linux";

  ## Dotfiles modules
  modules = {
    theme = {
      active = "autumnal";
      # wallpapers."*".path = ./wallpaper.png;
      fonts.terminal.size = 11.0;
    };
    xdg.ssh.enable = true;

    profiles = {
      role = "workstation";
      user = "hlissner";
      networks = [ "dk" "wg0" ];
      hardware = [
        "cpu/amd"
        "gpu/nvidia"
        "audio"
        "ssd"
        "ergodox"
        "bluetooth"
      ];
    };

    desktop = {
      hyprland = {
        enable = true;
        monitors = [
          { output = "DP-1";
            mode = "1920x1080@60";
            position = "0x0";
            primary = true; }
          { output = "HDMI-A-1";
            mode = "1920x1080@75";
            position = "1920x0"; }
        ];
      };
      term.default = "foot";
      term.foot.enable = true;

      apps.rofi.enable = true;
      apps.steam = {
        enable = true;
        libraryDir = "/media/games/SteamLibrary";
      };
      apps.libreoffice.enable = true;
      apps.godot.enable = true;
      browsers.default = "librewolf";
      browsers.librewolf.enable = true;
      media.cad.enable = true;
      media.daw.enable = true;
      media.graphics.enable = true;
      # media.music.enable = true;
      media.video.enable = true;
      media.video.capture.enable = true;
    };
    dev = {
      cc.enable = true;
    };
    editors = {
      default = "nvim";
      emacs.enable = true;
      vim.enable = true;
    };
    shell = {
      vaultwarden.enable = true;
      direnv.enable = true;
      git.enable = true;
      gnupg.enable = true;
      tmux.enable = true;
      zsh.enable = true;
    };
    services = {
      ssh.enable = true;
    };
    system = {
      utils.enable = true;
      fs.enable = true;
    };
    # virt.qemu.enable = true;
  };

  ## Local config
  config = { pkgs, ... }: {
    systemd.network.networks.wg0.address = [ "10.10.0.3/32" ];
  };

  ## Hardware config
  hardware = { ... }: {
    boot.supportedFilesystems = [ "ntfs" ];

    networking.interfaces.enp42s0.useDHCP = true;

    fileSystems = {
      "/" = {
        device = "/dev/disk/by-label/nixos";
        fsType = "ext4";
        options = [ "noatime" ];
      };
      "/boot" = {
        device = "/dev/disk/by-label/BOOT";
        fsType = "vfat";
      };
      "/home" = {
        device = "/dev/disk/by-label/home";
        fsType = "ext4";
        options = [ "noatime" ];
      };
      "/media/games" = {
        device = "/dev/disk/by-label/games";
        fsType = "ntfs";
        options = [ "defaults" "noauto" "nofail" "noatime" "nodev" "exec" "umask=000" "uid=1000" "gid=1000" "x-systemd.automount" ];
      };
    };
    swapDevices = [];
  };

  ## TODO: Declarative partitioning
  # storage = { ... }: {
  #   disk.sda = {
  #     device = "/dev/nvme0n1";
  #     type = "disk";
  #     content = {
  #       type = "table";
  #       format = "gpt";
  #       partitions = [
  #         {
  #           type = "partition";
  #           name = "ESP";
  #           start = "1MiB";
  #           end = "128MiB";
  #           bootable = true;
  #           content = {
  #             type = "filesystem";
  #             format = "vfat";
  #             mountpoint = "/boot";
  #           };
  #         }
  #         {
  #           name = "nixos";
  #           type = "partition";
  #           start = "128MiB";
  #           end = "200G";
  #           bootable = true;
  #           content = {
  #             type = "filesystem";
  #             format = "ext4";
  #             mountpoint = "/";
  #             options = [ "noatime" ];
  #           };
  #         }
  #         {
  #           name = "home";
  #           type = "partition";
  #           start = "200G";
  #           end = "-1G";
  #           bootable = true;
  #           content = {
  #             type = "filesystem";
  #             format = "ext4";
  #             mountpoint = "/home";
  #             options = [ "noatime" ];
  #           };
  #         }
  #         {
  #           name = "swap";
  #           type = "partition";
  #           start = "-1G";
  #           end = "100%";
  #           content.type = "swap";
  #         }
  #       ];
  #     };
  #   };

  #   nodev = {
  #     "/media/games" = {
  #       device = "/dev/disk/by-uuid/8C1EE27F1EE261A6";
  #       fsType = "ntfs";
  #       options = [ "uid=1000" "gid=100" "rw" "user" "exec" "umask=000" "nofail" "lowntfs-3g" ];
  #     };
  #   };
  # };
}
</file>

<file path="hosts/harusame/README.org">
#+title: Harusame
#+date:  February 27, 2022

* Overview
My mobile workstation. Comes with me when I travel somewhere I expect to stay
for more than 6 months. Dual boots Windows (for triple-A gaming) and NixOS (for
everything else), and shares a HDD between them.

** Specs
| CASE  | Be Quiet Pure Base 500 - Black          |
| CPU   | AMD Ryzen 5 5800X 6-core 12-thread      |
| MOBO  | MSI B550 PRO-VDH                        |
| COOL  | Be Quiet Pure Rock 2                    |
| GPU   | ASUS GeForce GTX 1660 Super             |
| RAM   | G.SKILL Ripjaws V Series 32GB (2x 16GB) |
| HDD   | Samsung 970 EVO Plus 1TB NVMe M2        |
| HDD   | WDC WD10 1TB platter drive              |
| HDD   | Intel 80GB SSD                          |
| KBD   | [[https://ergodox-ez.com/][ErgoDox-EZ]] (shared from Udon)           |
| MOUSE | Razer Mamba White Edition               |

* Filesystems
** /dev/nvme0n1: Samsung EVO+ 1TB (nixos, /home) :linux:
#+begin_src sh
parted /dev/nvme0n1 -- mklabel gpt
parted /dev/nvme0n1 -- mkpart ESP fat32 1MiB 512MiB
parted /dev/nvme0n1 -- mkpart primary 512MiB 400GiB
parted /dev/nvme0n1 -- mkpart primary 400GiB 100%
parted /dev/nvme0n1 -- set 1 boot on
mkfs.fat -F32 -n BOOT /dev/nvme0n1p1
mkfs.ext4 -L nixos /dev/nvme0n1p2
mkfs.ext4 -L home /dev/nvme0n1p3
#+END_SRC

** /dev/sda: Intel SSD 80gb (windows) :windows:
This NTFS drive is set up on the Windows side, and is never used on the Linux
side. A label isn't required, but makes it easier to mount if needed:
#+begin_src sh
$ ntfslabel /dev/sda windows
#+end_src

** /dev/sdb: WDC WD10 1TB (games) :windows:linux:
This NTFS drive is set up on the Windows side, and shared with the Linux side
(mostly to share my Steam library). It's dedicated hot-storage for games and
video recordings.

On the Linux side, it only needs a label set:
#+begin_src sh
$ ntfslabel /dev/sdb games
#+end_src

* Displays
I have two 27" displays for this system, a Samsung S27E391H and an MSI MD271PW.

To set them up the first time:
#+begin_src sh :results none
xrandr \
    --dpi 72 \
    --output DP-1 --mode 1920x1080 --rate 75 --pos 0x0 \
    --output HDMI-0 --mode 1920x1080 --rate 60 --pos 1920x0 --primary
# Then reload bspwm
~/.config/bspwm/bspwmrc
#+end_src
</file>

<file path="hosts/ramen/secrets/secrets.nix">
let key = "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAID2zHkQNfDBGNmqMJhitIS07ZGU6N6E3g/SnDkLMeLDN";
in {
  "wg0PrivateKey.age".publicKeys = [key];
}
</file>

<file path="hosts/ramen/default.nix">
# Ramen -- my laptop, for travel

{ hey, lib, ... }:

with lib;
with builtins;
{
  system = "x86_64-linux";

  imports = [
    hey.modules.nixos-hardware.dell-xps-13-9370
  ];

  ## Flake modules
  modules = {
    theme.active = "autumnal";
    xdg.ssh.enable = true;

    profiles = {
      role = "workstation";
      user = "hlissner";
      networks = [ "ca" "wg0" ];
      hardware = [
        "bluetooth"
        "wifi"
        "pc/laptop"
        "audio"
        "ssd"
      ];
    };

    desktop = {
      hyprland = rec {
        enable = true;
        monitors = [ { output = "eDP-1"; primary = true; } ];
        idle.time = 300;
        extraConfig = ''
          workspace=special:term,gapsin:3,gapsout:100,on-created-empty:hey .scratch term
          workspace=special:pad,gapsin:3,gapsout:40 80 40 80

          # trigger when the lid is up
          bindl=, switch:off:Lid Switch, exec, hyprctl dispatch dpms on
          # trigger when the lid is down
          bindl=, switch:on:Lid Switch, exec, hyprctl dispatch dpms off && hey .lock --no-fade-in --no-fade-out
        '';
      };

      apps.rofi.enable = true;
      term.default = "foot";
      term.foot.enable = true;

      browsers.default = "librewolf";
      browsers.librewolf.enable = true;
      media.cad.enable = true;
      media.daw.enable = true;
      media.graphics.enable = true;
      media.music.enable = true;
      media.video.enable = true;
      media.video.capture.enable = true;
      media.pdf.enable = true;
    };
    dev = {
      cc.enable = true;
    };
    editors = {
      default = "nvim";
      emacs.enable = true;
      vim.enable = true;
    };
    shell = {
      vaultwarden.enable = true;
      direnv.enable = true;
      git.enable = true;
      gnupg.enable = true;
      tmux.enable = true;
      zsh.enable = true;
    };
    services = {
      ssh.enable = true;
      # docker.enable = true;
    };
    system = {
      utils.enable = true;
      fs.enable = true;
    };
    virt.qemu.enable = true;
  };

  ## Local config
  config = { ... }: {
    systemd.network.networks.wg0.address = [ "10.10.0.2/32" ];
  };

  ## Hardware config
  hardware = { pkgs, ... }: {
    networking.wireless.interfaces = [ "wlp2s0" ];

    # If I want to sleep the system, I'll do it myself.
    services.logind.lidSwitch = "ignore";

    boot.initrd = {
      kernelModules = [ "dm-snapshot" ];
      luks.devices.home = {
        device = "/dev/nvme0n1p8";
        allowDiscards = true;
      };
    };

    # tlp is enabled by nixos-hardware.dell-xps-13-9370
    services.tlp.settings = {
      CPU_SCALING_GOVERNOR_ON_BAT="powersave";
      CPU_SCALING_GOVERNOR_ON_AC="ondemand";
      CPU_MAX_PERF_ON_AC=100;
      CPU_MAX_PERF_ON_BAT=50;

      # My laptop is always plugged in wherever I'm willing to use it, so I'll
      # value battery lifespan over runtime. Run `tlp fullcharge` to temporarily
      # force full charge.
      # @see https://linrunner.de/tlp/faq/battery.html#how-to-choose-good-battery-charge-thresholds
      START_CHARGE_THRESH_BAT0=40;
      STOP_CHARGE_THRESH_BAT0=50;
    };

    fileSystems = {
      "/" = {
        device = "/dev/disk/by-label/nixos";
        fsType = "ext4";
        options = [ "noatime" ];
      };
      "/boot" = {
        device = "/dev/disk/by-label/BOOT";
        fsType = "vfat";
      };
      "/home" = {
        device = "/dev/disk/by-label/home";
        fsType = "ext4";
        options = [ "noatime" ];
        neededForBoot = true;
      };
    };
    swapDevices = [ { device = "/dev/disk/by-label/swap"; }];
  };

  # Use 'install.zsh --disk /dev/...' to deploy these.
  # storage = { ... }: {
  #   disk.sda = {
  #     device = "/dev/nvme0n1p8";
  #     type = "disk";
  #     content = {
  #       type = "table";
  #       format = "gpt";
  #       partitions = [
  #         {
  #           type = "partition";
  #           name = "ESP";
  #           start = "1MiB";
  #           end = "128MiB";
  #           bootable = true;
  #           content = {
  #             type = "filesystem";
  #             format = "vfat";
  #             mountpoint = "/boot";
  #           };
  #         }
  #         {
  #           name = "nixos";
  #           type = "partition";
  #           start = "128MiB";
  #           end = "50%";
  #           bootable = true;
  #           content = {
  #             type = "filesystem";
  #             format = "ext4";
  #             mountpoint = "/";
  #             options = [ "noatime" ];
  #           };
  #         }
  #         {
  #           name = "home";
  #           type = "partition";
  #           start = "50%";
  #           end = "-4G";
  #           content = {
  #             name = "home";
  #             type = "luks";
  #             keyFile = "...";
  #             content = {
  #               type = "lvm_pv";
  #               vg = "pool";
  #             };
  #           };
  #         }
  #         {
  #           name = "swap";
  #           type = "partition";
  #           start = "-4G";
  #           end = "100%";
  #           content = {
  #             type = "swap";
  #           };
  #         }
  #       ];
  #     };
  #   };

  #   lvm_vg = {
  #     pool = {
  #       type = "lvm_vg";
  #       lvs = {
  #         home = {
  #           type = "lvm_lv";
  #           start = "1M";
  #           end = "100%";
  #           content = {
  #             type = "filesystem";
  #             format = "ext4";
  #             mountpoint = "/home";
  #             options = [ "noatime" ];
  #           };
  #         };
  #       };
  #     };
  #   };
  # };
}
</file>

<file path="hosts/ramen/README.org">
#+TITLE: Ramen
#+DATE:  December 29, 2018

* Overview
My mobile workstation. Dual-boots NixOS and Windows.

* Specs
| MAKE | [[https://www.dell.com/support/manuals/en-ca/xps-13-9370-laptop/xps-13-9370-setupandspecs/specifications-for-xps-13-9370?guid=guid-c3a6ce65-b23d-41b2-b9c9-244850da6393&lang=en-us][Dell 13" 9370]]  |
| CPU  | Intel i7-8550U |
| RAM  | 16gb           |
| HDD  | 500gb NVMe SSD |

* TODO Filesystems
The primary partition needs to be shrunk on the Windows side, then:

#+begin_src sh

#+end_src

* History
** December 29, 2018
Initial purchase.
</file>

<file path="hosts/udon/bin/set-monitors.zsh">
#!/usr/bin/env zsh
# Enable given monitors and disable the rest.
#
# SYNOPSIS:
#   set-monitors [--on|--off] [@all|@default|@primary|@tv|[MONITOR...]]

udon.all()     { echo DP-3 HDMI-A-2 DP-2 HDMI-A-1; }
udon.default() { echo DP-3 HDMI-A-2 DP-2; }
udon.primary() { echo HDMI-A-2; }
udon.tv()      { echo HDMI-A-1; }

local -a targets=()
for t in ${@:-@default}; do
  if [[ $t == @* ]]; then
    targets+=( $(udon.${t#@}) )
  else
    targets+=$t
  fi
done

hey wm set-monitors ${targets[@]}
</file>

<file path="hosts/udon/rofi/sources/displays.rb">
#!/usr/bin/env cached-nix-shell
#! nix-shell ../shell.nix --keep XDG_DATA_DIRS -i ruby
#
# TODO

require_relative '../lib'

Rofi.define :displays do |d|
  icon = 'video-display-symbolic'

  d.on_entries do |source|
    Rofi::Entry.new(source, text: 'Monitor Layout: ', icon: icon) do |_, c|
      # break Rofi.execute(:mount)
      break Sh.coproc('xrandr', '...') # TODO
    end
  end

  d.on_sources do
    s = Rofi::Source.new
    s.text = "Display Settings"
    s.icon = icon

    s.on_accept_entry do |e, c|
    end

    s.on_start do |c|
      data = Sh.call("xrandr")

    end

    [s]
  end
end
</file>

<file path="hosts/udon/secrets/secrets.nix">
let key = "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINWoMabdXpmDkMVYApsyKKCI0JwK8k9bKgTuZXTCoJ0b";
in {
  # ...
}
</file>

<file path="hosts/udon/default.nix">
# Udon -- my primary powerhouse

{ hey, lib, ... }:

with lib;
with builtins;
{
  system = "x86_64-linux";

  modules = {
    theme.active = "autumnal";
    xdg.ssh.enable = true;

    profiles = {
      role = "workstation";
      user = "hlissner";
      networks = [ "ca" ];
      hardware = [
        "cpu/amd"
        "gpu/nvidia"
        "audio"
        "audio/realtime"
        "ssd"
        "ergodox"
        "bluetooth"
      ];
    };

    desktop = {
      hyprland = rec {
        enable = true;
        monitors = [
          { output = "HDMI-A-2";
            mode = "2560x1440@120";
            position = "1920x2160";
            primary = true; }
          { output = "DP-2";
            position = "0x2191"; }
          { output = "DP-3";
            position = "4480x2191"; }
          { output = "HDMI-A-1";
            mode = "3840x2160@120";
            position = "1280x0"; }
        ];
        extraConfig = ''
          # REVIEW: Might be a hyprland bug, but an "Unknown-1" display is
          #   always created and reserves some desktop space, so I disable it.
          monitor = Unknown-1,disable

          # Bind fixed workspaces to external monitors
          workspace = name:left, monitor:DP-3, default:true
          workspace = name:right, monitor:DP-2, default:true
          workspace = name:tv, monitor:HDMI-A-1, default:true, gapsout:4

          # Scroll by holding down a side button, because the wheel is broken
          device {
              name = mosart-semi.-2.4g-wireless-mouse
              scroll_method = on_button_down
              scroll_button = 276
          }

          # To address 1px overscan on my U2724D's
          general {
            gaps_out = 0,0,1,0
          }

          exec-once = hyprctl keyword monitor HDMI-A-1,disable
        '';
      };
      term.default = "foot";
      term.foot.enable = true;

      ## Extra
      apps.rofi.enable = true;
      apps.thunar.enable = true;
      apps.libreoffice.enable = true;
      apps.steam = {
        enable = true;
        libraryDir = "/media/windows/Program Files (x86)/Steam";
      };
      apps.godot.enable = true;

      browsers.default = "librewolf";
      browsers.librewolf.enable = true;
      media.cad.enable = true;
      media.daw.enable = true;
      media.graphics.enable = true;
      media.music.enable = true;
      media.video.enable = true;
      media.video.capture.enable = true;
      media.pdf.enable = true;
    };
    dev = {
      cc.enable = true;
    };
    editors = {
      default = "nvim";
      emacs.enable = true;
      vim.enable = true;
    };
    shell = {
      vaultwarden.enable = true;
      direnv.enable = true;
      git.enable = true;
      gnupg.enable = true;
      tmux.enable = true;
      zsh.enable = true;
    };
    services = {
      ssh.enable = true;
      # docker.enable = true;
    };
    system = {
      utils.enable = true;
      fs.enable = true;
    };
    # virt.qemu.enable = true;
  };

  ## local config
  config = { pkgs, ... }: {
    networking.search = [ "home.lissner.net" ];

    user.packages = with pkgs; [
      guitarix
      gxplugins-lv2
      ladspaPlugins

      calibre
      signal-desktop
      zoom-us
    ];
  };

  hardware = { ... }: {
    boot.supportedFilesystems = [ "ntfs" ];

    networking.interfaces.eno1.useDHCP = true;

    # Disable all USB wakeup events to ensure restful sleep. This system has
    # many peripherals attached to it (shared between Windows and Linux) that
    # can unpredictably wake it otherwise. Ensures *only* the power button can
    # wake it up.
    systemd.services.fixSuspend = {
      script = ''
        for ev in $(grep enabled /proc/acpi/wakeup | cut --delimiter=\  --fields=1); do
           echo $ev > /proc/acpi/wakeup
        done
      '';
      wantedBy = [ "multi-user.target" ];
    };

    # ...But sometimes the monitors will fall asleep and I'll forget I haven't
    # suspended the system so I'll press the power button thinking I'm waking it
    # up, only to initiate shutdown, so no-op the power button.
    services.logind.powerKey = "ignore";

    # services.xserver = {
    #   # This must be done manually to ensure my screen spaces are arranged
    #   # exactly as I need them to be *and* the correct monitor is "primary".
    #   # Using xrandrHeads does not work.
    #   monitorSection = ''
    #     VendorName  "Unknown"
    #     ModelName   "DELL U2515H"
    #     HorizSync   30.0 - 113.0
    #     VertRefresh 56.0 - 86.0
    #     Option      "DPMS"
    #   '';
    #   screenSection = ''
    #     Option "metamodes" "DP-5: nvidia-auto-select +0+31, HDMI-1: nvidia-auto-select +1920+0, DP-3: nvidia-auto-select +4480+31"
    #     Option "SLI" "Off"
    #     Option "MultiGPU" "Off"
    #     Option "BaseMosaic" "off"
    #     Option "Stereo" "0"
    #     Option "nvidiaXineramaInfoOrder" "DFP-5"
    #   '';
    # };

    fileSystems = {
      "/" = {
        device = "/dev/disk/by-label/nixos";
        fsType = "ext4";
        options = [ "noatime" "errors=remount-ro" ];
      };
      "/boot" = {
        device = "/dev/disk/by-label/BOOT";
        fsType = "vfat";
      };
      "/home" = {
        device = "/dev/disk/by-label/home";
        fsType = "ext4";
        options = [ "noatime" ];
      };
      "/media/video" = {
        device = "/dev/disk/by-label/video";
        fsType = "ntfs";
        options = [ "defaults" "noauto" "nofail" "noatime" "nodev" "exec" "umask=000" "uid=1000" "gid=1000" "x-systemd.automount" ];
      };
      "/media/windows" = {
        device = "/dev/disk/by-label/windows";
        fsType = "ntfs";
        options = [ "defaults" "noauto" "nofail" "noatime" "nodev" "exec" "umask=000" "uid=1000" "gid=1000" "x-systemd.automount" ];
      };
      "/media/nas" = {
        device = "nas0.home.lissner.net:/mnt/nas/users/hlissner/files";
        fsType = "nfs";
        options = [ "noauto" "nofail" "noatime" "nfsvers=4.2" "x-systemd.automount" "x-systemd.idle-timeout=600" ];
      };
    };
    swapDevices = [];
  };

  # Use 'install.zsh --disk /dev/...' to deploy these.
  # storage = { ... }: {
  #   disk = {
  #     main = {
  #       device = "/dev/nvme0n1";
  #       type = "disk";
  #       content = {
  #         type = "table";
  #         format = "gpt";
  #         partitions = [
  #           {
  #             type = "partition";
  #             name = "ESP";
  #             start = "1MiB";
  #             end = "128MiB";
  #             bootable = true;
  #             content = {
  #               type = "filesystem";
  #               format = "vfat";
  #               mountpoint = "/boot";
  #             };
  #           }
  #           {
  #             name = "nixos";
  #             type = "partition";
  #             start = "128MiB";
  #             end = "50%";
  #             bootable = true;
  #             content = {
  #               type = "filesystem";
  #               format = "ext4";
  #               mountpoint = "/";
  #               options = [ "noatime" "errors=remount-ro" ];
  #             };
  #           }
  #           {
  #             name = "home";
  #             type = "partition";
  #             start = "50%";
  #             end = "100%";
  #             content = {
  #               type = "filesystem";
  #               format = "ext4";
  #               mountpoint = "/home";
  #               options = [ "noatime" ];
  #             };
  #           }
  #         ];
  #       };
  #     };
  #     video = {  # 1TB
  #       device = "/dev/sda";
  #       type = "disk";
  #       content = {
  #         type = "table";
  #         format = "gpt";
  #         partitions = [
  #           {
  #             type = "partition";
  #             name = "video";
  #             start = "0%";
  #             end = "100%";
  #             content = {
  #               type = "filesystem";
  #               format = "ext4";
  #               mountpoint = "/media/video";
  #               options = [ "noatime" ];
  #             };
  #           }
  #         ];
  #       };
  #     };
  #     data = {  # 600gb
  #       device = "/dev/sdb";
  #       type = "disk";
  #       content = {
  #         type = "table";
  #         format = "gpt";
  #         partitions = [
  #           {
  #             type = "partition";
  #             name = "data";
  #             start = "0%";
  #             end = "100%";
  #             content = {
  #               type = "filesystem";
  #               format = "ext4";
  #               mountpoint = "/media/data";
  #               options = [ "noatime" ];
  #             };
  #           }
  #         ];
  #       };
  #     };
  #   };
  # };
}
</file>

<file path="hosts/udon/README.org">
#+TITLE: Udon
#+DATE:  September 13, 2020

* Overview
My daily NixOS driver, for work and play. Dual-boots with Windows (used solely
for gaming, when Proton isn't enough).

* Specs
| CASE | [[https://www.amazon.com/Fractal-Design-Define-Cases-FD-CA-DEF-R4-BL/dp/B008HD3CTI][Fractal Design Define R4 ATX Tower Case Black Pearl]] |
| CPU  | [[https://www.newegg.ca/amd-ryzen-9-3900x/p/N82E16819113103][AMD Ryzen 9 3900X 12-core, 24-thread]]                |
| MOBO | [[https://www.newegg.ca/gigabyte-b550-aorus-elite/p/N82E16813145214?Item=N82E16813145214&IsFeedbackTab=true#scrollFullInfo][GIGABYTE B550 AORUS Elite]]                           |
| COOL | [[https://www.newegg.ca/cooler-master-hyper-212-evo-rr-212e-20pk-r2/p/N82E16835103099][Cooler Master Hyper 212 Evo]]                         |
| RAM  | [[https://www.newegg.ca/g-skill-64gb-288-pin-ddr4-sdram/p/N82E16820374003?Description=G.SKILL%20Ripjaws%20V%20Series%2064gb&cm_re=G.SKILL_Ripjaws%20V%20Series%2064gb-_-20-374-003-_-Product][G.SKILL Ripjaws V Series 64GB (2x 32GB)]]             |
| PSU  | [[https://www.newegg.ca/seasonic-prime-ultra-titanium-ssr-1000tr-1000w/p/N82E16817151195][Seasonic PRIME TX-1000]]                              |
| GPU  | ASUS TUF GeForce 3080ti RTX                         |
| HDD  | [[https://www.amazon.ca/gp/product/B0B7CPSN2K?psc=1][WD_BLACK 1TB SN850X NVMe]]                            |
| HDD  | [[https://www.newegg.ca/samsung-970-evo-plus-500gb/p/N82E16820147742?Description=samsung%20970%20evo%20plus&cm_re=samsung_970%20evo%20plus-_-20-147-742-_-Product][Samsung 970 EVO+ 500GB]]                              |
| HDD  | Seagate ST1000DM010 Compute 1TB                     |
| HDD  | WD6400AAKS 640GB                                    |
| KBD  | [[https://ergodox-ez.com/][ErgoDox-EZ]]                                          |
| USB  | [[https://www.anker.com/products/variant/anker-24g-wireless-vertical-ergonomic-optical-mouse/A7852011][Anker Wireless Vertical Mouse]]                       |

* Filesystems
** /dev/nvme0n1: Samsung EVO+ 500gb (nixos, /home)
#+begin_src sh
parted /dev/nvme0n1 -- mklabel gpt
parted /dev/nvme0n1 -- mkpart ESP fat32 1MiB 512MiB
parted /dev/nvme0n1 -- mkpart primary 512MiB 200GiB
parted /dev/nvme0n1 -- mkpart primary 200GiB 100%
parted /dev/nvme0n1 -- set 1 boot on
mkfs.fat -F32 -n BOOT /dev/nvme0n1p1
mkfs.ext4 -L nixos /dev/nvme0n1p2
mkfs.ext4 -L home /dev/nvme0n1p3
#+end_src

** /dev/nvme1n1: SN850X NVMe 1TB (windows, games) :windows:
This is set up on the Windows side, as is my dedicated Windows + game library
drive. On the Linux side I only need a label to consistently refer to it by:
#+begin_src sh
ntfslabel /dev/nvme1n1p2 windows
#+end_src

** /dev/sda: WD6400AAKS 640gb (extra storage and VMs)
#+begin_src sh
parted /dev/sda -- mklabel gpt
parted /dev/sda -- mkpart primary 0% 100%
mkfs.ext4 -L data /dev/sda1
#+end_src

** /dev/sdb: ST1000DM010 1TB (for streaming/recording footage) :windows:
This is set up on the Windows side, as dedicated hot-storage for game and screen
recordings on either Windows (with ShadowPlay) or Linux (with OBS studio). No
setup needed on Linux, except for a label to consistently refer to it by:
#+begin_src sh
$ ntfslabel /dev/sdb video
#+end_src

** Mount filesystems
The final step in the install process, before running ~$DOTFILES_HOME/bin/hey
install~:
#+BEGIN_SRC sh
mount /dev/disk/by-label/nixos /mnt

mkdir -p /mnt/{home,boot}
mount /dev/disk/by-label/boot /mnt/boot
mount /dev/disk/by-label/home /mnt/home

mkdir -p /mnt/media/{windows,video}
mount /dev/disk/by-label/windows /mnt/media/windows
mount /dev/disk/by-label/video /mnt/media/video
#+END_SRC

* History
** January 4, 2023
Repurposed this system from a dedicated workstation to a dual purpose
work+gaming workstation.

- Renamed from Kuro to Udon.
- Replaced EVGA GeForce 680GTX SC with ASUS TUF GeForce 3080ti RTX.
- Added WD_BLACK 1TB SN850X M.2 drive for Windows dualbooting.
- Added Seagate ST1000DM010 1TB for footage and video projects.
- Added WD6400AAKS 640GB for VM storage and local redundancy.
- Replaced PSU: Corsair RM750I -> Seasonic PRIME TX-1000.
</file>

<file path="lib/hey/cmd.janet">
# Alternatives I considered:
# - spork/argparse: interface is too verbose and clumsy; doesn't allow short
#   options without an accompanying long option.
# - ianthehenry/cmd: much better, but doesn't parse options beyond the escape
#   argument (sigh). Also a little more verbose than I'd like.

(import spork/path)
(use ./lib)

(def- *commands* @{})
(def- *argtypes* '[&opts &args &])

# TODO: Use me
# (defn- read-arg-value [spec val]
#   (cond (tuple? spec) (and (index-of val spec) val)
#         (= spec :boolean) (index-of val ["yes" "no" "on" "off" "0"" 1" "true" "false"])
#         (= spec :number) (scan-number (or val ""))
#         (= spec :path) (if (path/exists? val) val)
#         (= spec :file) (if (path/file? val) val)
#         (= spec :dir) (if (path/directory? val) val)
#         (= (type val) spec) val))

(defn- make-arg [arg]
  (let [spec (if (tuple? arg) arg [arg :string nil])]
    {:name (in spec 0)
     # :value (partial read-arg-value (get spec 1))
     :default |(get spec 2)}))

(defn- make-opt [name spec]
  (let [spec (if (tuple? spec) spec [spec])
        {false args true opts} (group-by |(string/has-prefix? "-" $) spec)]
    {:name name
     :multiple (and args (index-of '* args) true)
     :options (map string opts)
     :arguments (if args (map make-arg (filter |(not= $ '*) args)))}))

# TODO: Add opt validation
# TODO: Add arg validation
# TODO: Add arg default values
(defmacro cmdfn [spec & body]
  (let [argspec @[;spec]
        optbinds @[]
        optmap @{}
        argbinds @[]
        restbinds @[]]
    (var arg-type
         (or (if-let [b (get argspec 1)]
               (if (or (and (symbol? b)
                            (string/has-prefix? "-" b))
                       (tuple/type? b :brackets))
                 '&opts))
             '&args))
    (while (not (empty? argspec))
      (def arg (first (take! 1 argspec)))
      (if (index-of arg *argtypes*)
        (set arg-type arg)
        (case arg-type
          '&args (array/push argbinds (make-arg arg))
          '&opts (let [opt (make-opt arg (first (take! 1 argspec)))
                       idx (length optbinds)]
                   (array/push optbinds opt)
                   (each o (get opt :options) (put optmap o idx)))
          '& (if (> (length restbinds) 2)
               (errorf "Too many & binds for %q" arg)
               (array/push restbinds arg)))))
    (with-syms [$rest $argv $all $argmap $optbinds $optmap]
      ~(fn [& args]
         (let [,$all args
               ,$argv @[;,$all]
               ,$rest @[]
               ,$argmap @{}
               ,$optmap ,optmap
               ,$optbinds (quote ,optbinds)]
           (while (not (empty? ,$argv))
             (def arg (first (,take! 1 ,$argv)))
             (cond (= arg "--")
                   (do (array/push ,$rest ;,$argv)
                       (break))

                   (and (string/has-prefix? "-" arg)
                        (> (length arg) 2)
                        (not (string/has-prefix? "--" arg)))
                   (array/insert
                    ,$argv 0 ;(map |(string "-" (string/from-bytes $))
                                   (slice arg 1)))

                   (string/has-prefix? "-" arg)
                   (if-let [idx (get ,$optmap arg)
                            opt (get ,$optbinds idx)
                            val (if-let [args (get opt :arguments)]
                                  (let [len (length args)
                                        val (,take! len ,$argv)]
                                    (if (= len 1) (first val) val))
                                  arg)
                            bind (get opt :name)]
                     (put ,$argmap bind
                           (if (get opt :multiple)
                             [;(get ,$argmap bind []) ;(if (atom? val) [val] val)]
                             val))
                     ,(if (> (length restbinds) 0)
                        ~(array/push ,$rest arg)
                        ~(abort "Unrecognized option: %s" arg)))

                   (array/push ,$rest arg)))
           (let [[,;(map |($ :name) argbinds) & ,(get restbinds 0 '_)] ,$rest
                 ,;(if-not (index-of (get restbinds 1) ['_ nil]) [(get restbinds 1) $all] [])]
             ,;(catseq [o :in optbinds]
                 (let [sym (get o :name)]
                   ~((def ,sym (or (get ,$argmap ',sym)
                                   ,(when-let [args (get o :arguments)
                                               vals (map |(($ :default)) args)]
                                      (if (or (get o :multiple)
                                              (> (length args) 1))
                                        vals (first vals))))))))
             ,;body))))))

(defn cmd [name]
  (or (get *commands* name)
      (errorf "Unrecognized command: %s" name)))

(defn- defcmd* [name cmd file]
  (put *commands* name {:cmd cmd :file file}))

(defmacro defcmd-1 [type name argspec & body]
  ~(upscope
    (,(case type :public 'def :private 'def- (errorf "Unknown type: %s"))
      ,name (cmdfn [,;argspec] ,;body))
    ,(unless (= name 'main)
       ~(,defcmd* ',name ,name ,(path/abspath (dyn :current-file ""))))))

(defmacro defcmd- [name argspec & body]
  ~(defcmd-1 :private ,name [,;argspec] ,;body))

(defmacro defcmd [name argspec & body]
  ~(defcmd-1 :public ,name [,;argspec] ,;body))

(defmacro defmain [argspec & body]
  ~(defcmd-1 :public main [,;argspec] ,;body))
</file>

<file path="lib/hey/init.janet">
(import spork/path :export true)
(import spork/json :export true)
(import sh :export true :prefix "")
(import ./lib :export true :prefix "")

# Janet lacks an analogue for 'trap X EXIT'; I emulate this with handle-exit,
# defer, and os/sigaction. However, this causes os/sleep to be uninterruptable.
(def- *exit-handlers* @[])
(defdyn *exit-handled*)

(defn exit [&opt code]
  (default code 0)
  (if (dyn :exit-handled)
    (error [:exit code])
    (os/exit code)))

(defn abort [message & args]
  (echof :error message ;args)
  (exit 127))

(defn not-implemented [& args]
  (abort "Not implemented yet! %q" args))

(defmacro- with-handled-exits [& body]
  (defn- on-exit [type]
    (each [handler sig] *exit-handlers*
      (when (index-of sig [:exit type])
        (handler type)))
    (unless (= type :exit)
      (os/exit 1)))
  ~(defer (,on-exit :exit)
     (setdyn :exit-handled true)
     (os/sigaction :int (partial ,on-exit :int) true)
     (os/sigaction :term (partial ,on-exit :term) true)
     (os/sigaction :kill (partial ,on-exit :kill) true)
     # os/exit evades all these signal handlers, as well as defer, so as long as
     # downstream promises to avoid os/exit (and use our exit instead), this
     # won't be an issue.
     (try (do ,;body)
          ([err fib]
           (if (= (first err) :exit)
             (do (,on-exit :exit)
                 (os/exit (in err 1)))
             (propagate err fib))))))

(defn trap [handler &opt sig]
  (array/push *exit-handlers* [handler sig]))

(defmacro os/with-lock [file & body]
  (with-syms [$file]
    ~(let [,$file ,file]
       (log 3 "Locking with %s" ,$file)
       (while (os/stat ,$file :mode)
         (os/sleep 0.25))
       (os/mkdir (,path/dirname ,$file))
       (spit ,$file "")
       (os/touch ,$file)
       (,trap (fn [&] (os/rm ,$file)) :exit)
       ,;body)))

(defn- resolve-1 [kind base & args]
  (if (index-of (type base) [:array :tuple])
    (some |(resolve-1 kind $ ;args) base)
    (let [base (if (path/abspath? base) base (path/find base))]
      (case (os/stat base :mode)
        nil nil
        :file [base ;args]
        :directory
        (do (var depth 0)
            (var target nil)
            (var crumbs @[])
            (each arg args
              (cond
                (= arg "--") (do (-- depth) (break))
                (peg/match (peg! '(+ (* "-" :w*) (* "--" :w*))) arg) (break)
                (let [crumb (path/join (or target base) arg)
                      dir (path/sibling :directory crumb "" ".d")]
                  (++ depth)
                  (array/push crumbs crumb)
                  (if dir
                    (set target dir)
                    (do (if (= kind :directory) (-- depth))
                        (break))))))
            (if (= kind :directory)
              [target ;(slice args depth)]
              (do (each crumb (reverse crumbs)
                    (when-let [file (path/sibling :file crumb ".janet" ".zsh" ".sh" "")]
                      (set target file)
                      (break))
                    (-- depth))
                  (when target
                    [target ;(slice args depth)]))))
        (abort "Invalid file or directory: %s" base)))))

(defn resolve [base & args]
  (resolve-1 :file base ;args))

(defn resolve-dir [base & args]
  (resolve-1 :directory base ;args))

(defn help [[file & _args] &opt output]
  (unless (path/exists? file)
    (errorf "File does not exist: %s" (path/abbrev file)))
  (with-dyns [*out* (or output stdout)]
    (with [f (file/open file :rn)]
      (let [peg (peg! '(* "#" (between 0 1 " ")))
            buf @""]
        (var line (file/read f :line))
        (unless (string/has-prefix? "#!/" line)
          (abort "Not a script: %s" (path/abbrev file)))
        (while (set line (file/read f :line))
          (unless (string/has-prefix? "#" line)
            (break))
          (buffer/push buf (peg/replace peg "" line)))
        (when (empty? buf)
          (abort "No documentation for %s" (path/abbrev file)))
        (echo (string/chomp buf)))))
    # TODO: Parse these doc headings into table
    # TODO: Search sub-directory for extra subcommands.
  )

(defn- dispatcher-for [rules &opt command & args]
  (unless command (break))
  (let [odd? (odd? (length rules))
        cmd (get (find (fn [[pat dest]]
                         (case (type pat)
                           :function (pat command ;args)
                           :keyword  (= pat (keyword command))
                           :string   (= pat command)
                           :tuple    (if (keyword? (first pat))
                                       (index-of (keyword command) pat)
                                       (peg/match pat command))
                           (abort "Invalid rule pattern: %q" pat)))
                       (if command
                         (partition 2 (slice rules 0 (if odd? -2 -1)))
                         []))
                 1 (cond (not odd?) nil
                         (string? (last rules)) |[:exec (last rules) ;$&]
                         (last rules)))
        spec (case* (type cmd)
               :function (cmd command ;args)
               :struct [:eval cmd ;args]
               :string [:exec cmd ;args]
               :nil nil
               (abort "Invalid rule destination: %q" cmd))]
    (log 2 "dispatcher-for=%q" spec)
    (case (first spec)
      :eval (let [f (in spec 1)]
              (unless (> (length spec) 1)
                (errorf "Invalid eval dispatcher for: %s" command))
              (fn [op]
                (let [{:cmd cmd :file file}
                      (if (struct? f) f {:cmd f :file (dyn :script)})
                      cargs (slice spec 2)]
                  (case op
                    :which (echo (string/join [file ;cargs] " "))
                    :help  (help [file ;cargs])
                    :call  (cmd command ;cargs)))))
      :exec (let [sargs (slice spec 1)]
              (if (empty? sargs)
                (abort "Unknown command: %q" command)
                (if-let [pargs (resolve ;sargs)]
                  (fn [op]
                    (case op
                      :which (echo (string/join pargs " "))
                      :help (help pargs)
                      :call (os/execute pargs :p)))
                  (abort "Unknown command: %q" command))))
      (abort "Unknown command: %q" command))))

(defdyn *script* "TODO")
(defdyn *dryrun* "TODO")
(defdyn *debug* "TODO")

(defn dryrun? []
  (dyn :dryrun false))

(defn debug? [&opt n]
  (<= (or n 1) (dyn :debug -1)))

(defmacro do?
  "A wrapper for janet-sh macros to no-op them if DRYRUN is active."
  [& args]
  ~(if (,dryrun?)
     (,(first args)
       echo "DRYRUN:"
       ,;(map |(if (index-of $ '[| || & && ; > >> < ^])
                 (string $) $)
              args))
     (,;args)))

(defn- dispatch-1 [file rules & args]
  (let [idx (index-of "--" args -1)
        largs (slice args 0 idx)
        rargs (if (= idx -1) [] (slice args idx -1))
        help? (or (index-of "-h" largs)
                  (index-of "--help" largs))]
    # During compilation, :current-file is relative to the root of the project
    # (which is $DOTFILES_HOME). At runtime, it's an absolute path.
    (setdyn :script (if (path/abspath? file) file (path :home file)))
    (setdyn :dryrun
       (or (index-of "-!" largs)
           (dyn :dryrun (not (empty? (or (os/getenv "HEYDRYRUN") ""))))))
    (setdyn :debug
       (cond (index-of "-???" largs) 3
             (index-of "-??" largs) 2
             (index-of "-?" largs) 1
             (dyn :debug (scan-number (or (os/getenv "HEYDEBUG") "")))))
    # For downstream shell scripts
    (os/setenv "HEYSCRIPT" (dyn :script))
    (os/setenv "HEYDRYRUN" (if (dyn :dryrun) "1"))
    (os/setenv "HEYDEBUG"  (if (dyn :debug) (string (dyn :debug))))
    (with-handled-exits
      (if (debug?)  (log "Enabled debug mode (level=%d)" (dyn :debug)))
      (if (dryrun?) (log "Enabled dry run mode"))
      # For child processes that may not have its environment available (like
      # system units or cronjobs).
      (with-envvars ["PATH" (string/join exec-path ":")
                     "DOTFILES_HOME" (path :home)]
        (if-let [args [;(filter |(not (index-of $ ["-?" "-??" "-???" "-!" "-h" "--help"])) largs)
                       ;rargs]
                 op (case* (first args)
                      ["h" "help"] :help
                       "which" :which
                       :call)
                 cmd (dispatcher-for rules ;(slice args (if (= op :call) 0 1)))]
          (cmd (if help? :help op))
          (do (echo :error "Subcommand required.\n")
              (help [(dyn :script) ;args] *err*)
              (exit 1)))))))

(defmacro dispatch [rules & args]
  ~(,dispatch-1 ,(dyn :current-file) [,;rules] ;args))

(defmacro hey [& args]
  ~(do (def output @"")
       (def error @"")
       (cond ,(tuple '$? (path :bin "hey") ;args
                      '> '(unquote output)
                      '> '[stderr error])
             (do (when (debug?)
                   (log "stderr: %s" error))
                 (,string/chomp output))
             (string/has-prefix? "error: " error)
             (error (slice error 0 8))
             (do (echo :err (string/chomp error))
                 (,exit 16)))))

(defmacro hey! [& args]
  (tuple 'do? '$? (path :bin "hey") ;args))

(defmacro hey? [& args]
  ~(do (def output @"")
       (def error @"")
       (if ,(tuple '$? (path :bin "hey") ;args
                   '> '(unquote output)
                   '> '[stderr error])
         (do (when (debug?)
               (log "stderr: %s" error))
             (,string/chomp output)))))

(defmacro hey* [& args]
  ~(when-let [out (hey ,;args)]
     (string/split "\n" out)))
</file>

<file path="lib/hey/lib.janet">
(import spork/path)
(import spork/json)

# % and mod are both modulo functions. We don't need two, so I take over one of
# them for this common use-case:
(def fmt string/format)

(defmacro ignore-errors
  "Like protect, but returns the result of BODY or nil on errors."
  [& body]
  ~(try (upscope ,;body) ([err fib] nil)))

(defmacro peg!
  "Compile static PAT at compile-time and return it."
  [pat]
  (eval ~(peg/compile ,pat)))

(defmacro with-envvars [args & body]
  (let [xs (struct ;args)
        $old (gensym)]
    ~(let [,$old ,(struct ;(catseq [[k _] :pairs xs] [k ~(os/getenv ,k)]))]
       (defer (do ,;(catseq [k :keys xs] [~(os/setenv ,k (get ,$old ,k))]))
         ,;(catseq [[k v] :pairs xs] [~(os/setenv ,k ,v)])
         ,;body))))

(defmacro with-umask [umask & body]
  ~(let [old (os/umask ,umask)]
     (defer (os/umask old)
       ,;body)))

(def- *atomic-types*
  {:nil true
   :boolean true
   :number true
   :string true
   :buffer true
   :symbol true
   :keyword true})

(defn atom?
  "Return non-nil if VALUE is an atomic type."
  [value]
  (get *atomic-types* (type value) false))

(defn falsey? [val]
  (or (not val)
      (ignore-errors (empty? val))))

(defn tuple/type? [val type]
  (and (tuple? val)
       (or (nil? type)
           (= (tuple/type val) type))))

(defmacro case*
  "Like case, but dispatch values can be tuples to represent one-off matches."
  [value & clauses]
  (let [fallback (if (odd? (length clauses)) (last clauses))
        $var (gensym)]
    ~(let [,$var ,value]
       (cond ,;(reduce
                 (fn [init [pred body]]
                   (array/concat
                    init ~(,(if (tuple/type? pred :brackets)
                              ~(index-of ,$var ,pred)
                              ~(= ,$var ,pred))
                            ,body)))
                 @[] (partition
                      2 (if fallback (slice clauses 0 -2) clauses)))
               ,fallback))))

(defn array/remove-elt [arr elt &opt all?]
  (var idx nil)
  (while (set idx (index-of elt arr))
    (array/remove arr idx)
    (unless all? (break)))
  arr)

(defn take! [n ind]
  (let [val (take n ind)
        len (length val)]
    (unless (zero? len) (array/remove ind 0 len))
    val))

(defn take-while! [pred ind]
  (let [val (take-while pred ind)
        len (length val)]
    (unless (zero? len) (array/remove ind 0 len))
    val))

(defn take-until! [pred ind]
  (let [val (take-until pred ind)
        len (length val)]
    (unless (zero? len) (array/remove ind 0 len))
    val))

(defn drop! [n ind]
  (let [val (drop n ind)
        len (length val)]
    (unless (zero? len) (array/remove ind 0 len))
    val))

(defn drop-while! [pred ind]
  (let [val (drop-while pred ind)
        len (length val)]
    (unless (zero? len) (array/remove ind (- len) len))
    val))

(defn drop-until! [pred ind]
  (let [val (drop-until pred ind)
        len (length val)]
    (unless (zero? len) (array/remove ind (- len) len))
    val))

(defn string/chomp [str]
  (if (string/has-suffix? "\n" str)
    (slice str 0 -2)
    (string str)))

(defn string/no-suffix [suffix str]
  (if (string/has-suffix? suffix str)
    (slice str 0 (- -1 (length suffix)))
    str))

(defn string/no-prefix [prefix str]
  (if (string/has-prefix? prefix str)
    (slice str (length prefix) -1)
    str))

(def- *colors*
  {:r "\e[31m"
   :g "\e[32m"
   :y "\e[33m"
   :warn "\e[33m⚠ "
   :error "\e[31m𐄂 "
   :check "\e[32m✓ "
   :debug "\e[34m"
   :reset "\e[0m"})

(defn echo [& args]
  (var args (array ;args))
  (var format :raw)
  (var color nil)
  (var output stdout)
  (each k (take-while! keyword? args)
    (case* k
      :raw  (set format :raw)
      :json (set format :json)
      :err  (set output stderr)
      [:error :warn :debug] (do (set output stderr)
                                (set color k))
      (set color k)))
  (case (length args)
    0 nil
    1 (when-let [val (first args)]
        (with-dyns [*out* output]
          (case format
            :raw (printf (if (atom? val) "%s%V%s" "%s%m%s")
                         (or (get *colors* color) "")
                         val
                         (if color "\e[0m" ""))
            :json (print (json/encode val "  " "\n"))
            (errorf "Invalid format: %s" format))))
    (each v args
      (echo format ;(if color [color] []) v))))

(defn echof [& args]
  (var args (array ;args))
  (echo ;(take-while! keyword? args)
         (string/format (first args) ;(slice args 1))))

(defn path/no-ext
  "Remove any (or a specific) file extension from PATH."
  [path & exts]
  (if (empty? exts)
    (string/join (slice (string/split "." path) 0 -2) ".")
    (or (when-let [ext (path/ext path)]
          (when (index-of ext exts)
            (string/no-suffix ext path)))
        path)))

(defn path/sibling [type path & exts]
  (when-let [base (path/no-ext path ;exts)
             ext (find |(= (os/stat (string base $) :mode) type)
                       exts)]
    (string base ext)))

(defn path/files-in
  "Like os/dir, but returns a list of absolute paths."
  [dir]
  (map |(path/join dir $) (os/dir dir)))

(defn path/abbrev "Replace /home/$USER to ~ in PATH."
  [path]
  (peg/replace (peg! ~(* ,(os/getenv "HOME"))) "~" path))

(defn path/executable?
  "Return true if PATH exists and is executable."
  [path]
  (when-let [perms (os/stat path :permissions)]
    # TODO: Use bitwise ops instead
    (and (find |(= (chr "x") (get perms $)) [2 5 8])
         true)))

(defn path/exists? [path]
  (truthy? (os/stat path :mode)))

(defn path/file? [path]
  (= (os/stat path :mode) :file))

(defn path/directory? [path]
  (= (os/stat path :mode) :directory))

(defn path/symlink? [path]
  (and (os/stat path :mode)
       (ignore-errors (os/readlink path))))

(def- *xdg*
  (delay {:bin     (os/getenv "XDG_BIN_HOME")
          :config  (os/getenv "XDG_CONFIG_HOME")
          :data    (os/getenv "XDG_DATA_HOME")
          :cache   (os/getenv "XDG_CACHE_HOME")
          :state   (os/getenv "XDG_STATE_HOME")
          :runtime (os/getenv "XDG_RUNTIME_DIR")
          :fake    (os/getenv "XDG_FAKE_HOME")}))

(defn path/xdg [key & args]
  (path/join (or (get (*xdg*) key)
                 (errorf "Invalid XDG directory: %s" key))
             ;args))

(def- *flake-info*
  # Generated by modules/hey.nix
  (json/decode (slurp (path/xdg :data "hey/info.json"))
               :keywords true))

(defn flake/info [& args]
  (get-in *flake-info* args))

(def- *flake*
  (delay {:path  (os/realpath
                  (or (os/getenv "DOTFILES_HOME")
                      (error "DOTFILES_HOME not set")))
          :user  (os/getenv "USER")
          :host  (or (os/getenv "HOST") (string/chomp (slurp "/etc/hostname")))
          :theme (or (os/getenv "THEME") (flake/info :theme :active))}))

(defn flake [&opt key]
  (if key (get (*flake*) key) (*flake*)))

(defn flake/json []
  (string (json/encode (flake))))

(def exec-path
  (distinct
   # Generated by modules/hey.nix. The janet script may be executed from an
   # environment where PATH isn't properly set up (like a systemd service).
   @[(os/realpath (path/join (dyn :syspath) "../bin"))
     (path/xdg :bin)
     ;(let [pfile (path/xdg :data "hey/path")]
        (if (path/file? pfile)
          (string/split ":" (string/trimr (slurp pfile)))
          ["/run/wrappers/bin"
           (string/format "/etc/profiles/per-user/%s/bin" (flake :user))
           "/run/current-system/sw/bin"]))
     ;(string/split ":" (os/getenv "PATH"))]))

(defn path/find
  "Find executable NAME in PATHS (defaults to $PATH)."
  [name &opt paths]
  (if (path/abspath? name)
    (if (path/exists? name) name)
    (some |(let [p (path/join $ name)]
             (if (os/stat p :mode) p))
          (or paths exec-path))))

(defn- wm []
  (let [desktop (os/getenv "XDG_CURRENT_DESKTOP")]
    (case desktop
      "Hyprland" :hypr
      "bspwm"    :bspwm
      nil        (error "XDG_CURRENT_DESKTOP not set")
      (errorf "Unrecognized desktop: %s" desktop))))

(def- *paths*
  {:home     [|(flake :path)]
   :bin      [:home "bin"]
   :cache    [|(path/xdg :cache "hey")]
   :config   [:home "config"]
   :data     [|(path/xdg :data "hey")]
   :hosts    [:home "hosts"]
   :host     [:hosts |(or (flake :host) (error "HOST is not set"))]
   :lib      [:home "lib"]
   :modules  [:home "modules"]
   :runtime  [|(path/xdg :runtime "hey")]
   :state    [|(path/xdg :state "hey")]
   :themes   [:modules "themes"]
   :theme    [:themes |(or (flake :theme) (error "No active theme"))]
   :wm       [:config wm]
   :wm*      [|(path/xdg :config) wm]
   :profile  ["/nix/var/nix/profiles/system"]
   :profile* [|(path/xdg :state "nix/profiles/profile")]})

(defn path "Return a path to an area within my dotfiles."
  [area & args]
  (path/join
   ;(let [segments (if (string? area) [(path/abspath area)] (get *paths* area))]
      (catseq [p :in (or segments (errorf "Unknown area: %s" area))]
        (case (type p)
          :keyword (path p)
          :function (or (p) (errorf "Path segment function returns nil in %s" area))
          :nil []
          [p])))
   ;args))

(defmacro log [& args]
  (var args (array ;args))
  (var message (first args))
  (var level 1)
  (take! 1 args)
  (when (number? message)
    (set level message)
    (set message (first args))
    (take! 1 args))
  ~(when (>= (dyn :debug -1) ,level)
     (with-dyns [*out* stderr]
       (echof :debug (string "LOG[%s]: " ,message)
              ,(path/no-ext
                (path/join ;(slice (path/parts (dyn :current-file)) -3 -1)))
              ,;args))))

(defn opts
  "Return ARGS (a tuple) if no element is nil. An empty tuple otherwise."
  [& args]
  (if (every? args) (map string args) []))

(defn plist/index [plist key]
  (label result
    (each i (range 0 (/ (length plist) 2))
      (def i (* i 2))
      (if (= (in plist i) key)
        (return result (+ i 1))))))

(defn plist/get [plist key]
  (when-let [idx (plist/index plist key)]
    (in plist idx)))

(defn plist/put [plist key val & rest]
  (when-let [idx (plist/index plist key)]
    (put plist idx val)))
</file>

<file path="lib/hey/rofi-blocks.janet">
# /lib/hey/rofi-blocks.janet
#
# An API for interacting with rofi-blocks.

(use ./.)
(import spork/htmlgen)
(import spork/base64)

(def escape htmlgen/escape)
(def encode base64/encode)
(def decode base64/decode)

(def config @{})

(defn exit []
  (os/execute ["pkill" "rofi"] :p))

(defn- as-css [val]
  (when val
    (case (type val)
      :number (fmt "%d" val)
      (fmt "\"%s\"" (string val)))))


(defn to-json [obj]
  (json/encode obj))

(defn- to-entry [line plist]
  (string line "\0"
          (string/join
           (catseq [[k v] :in (partition 2 plist)]
             (if (= k :data)
               [] [(string k "\x1f" (if (atom? v) v (encode (marshal v))))]))
           "\x1f")
          "\n"))

(defn make-line [&named text urgent highlight markup nonselectable icon data]
  {:text text
   :urgent urgent
   :highlight highlight
   :markup markup
   :nonselectable nonselectable
   :icon icon
   :data data})

(defn make-state [&named message overlay prompt input active-entry lines]
  {:message nil
   :overlay nil
   :prompt nil
   :input nil
   :active-entry nil
   :lines @[]})

(def sessions @[])

(defn make-session [& plist]
  (unless (empty? sessions)
    (exit))
  (def cfg (merge config (struct ;plist)))
  (with-envvars ["ROFI_PLACEHOLDER" (as-css (get cfg :placeholder))]
    (let [sess @{:process
                 (os/spawn ["rofi" "-modi" "blocks" "-show" "blocks" "-markup"
                            ;(opts "-i" (not (get cfg :case-sensitive)))
                            ;(opts "-theme" (get cfg :theme))
                            ;(opts "-theme-str" (if (get cfg :icon) (fmt `icon{filename:"%s";}` (get cfg :icon))))])
                 :changed false
                 :alive? (fn [self] )
                 :input-action :filter
                 :state (make-state)
                 :old-state @{}}]
      (array/push sessions sess)
      sess)))

(defn start [f & plist]
  (let [sessions @[]
        session (make-session ;plist)]
    )
  )

(defn call [f & plist]
  (with [rofi (instance ;plist)]
    (var items @[])
    (let [binds @{}
          fib (ev/go
               (coro
                (try (defer (ev/close (rofi :in))
                       (f {:in (rofi :in)
                           :out (rofi :out)
                           :div (fn [self & plist]
                                  (ev/write
                                   (self :in)
                                   (prep-line "<span alpha='30%%'>------------------------------------------------------------</span>"
                                              [:nonselectable true ;plist])))
                           :on-code (fn [self code action] (put binds code action))
                           :sleep (fn [self n] (ev/sleep n))
                           :set (fn [self & plist]
                                  (let [data (table ;plist)]
                                    (when-let [lines (get data :lines)]
                                      (set items lines))
                                    (ev/write (self :in) (to-json data))))
                           :add (fn [self line & plist]
                                  (let [idx (length items)
                                        data (table :text line ;plist)]
                                  (array/push items (struct ;(kvs data)))
                                  (put data :data idx)
                                  (ev/write (self :in) (to-json data))))
                          }))
                     ([err fib]
                      # in case of premature abort
                      (or (= err "stream is closed")
                          (= err "stream err")
                          (= err :exit)
                          (= (first err) :exit)
                          (propagate err fib))))))
          buf @""]
      (defer (ev/cancel fib :exit)
        (when (ev/read (rofi :out) :all buf)
          (os/proc-wait rofi)
          (let [str (string/chomp buf)
                val (if (has-key? items str) (get items str) str)]
            (if-let [f (get binds (get rofi :return-code))]
              (f val) val)))))))
</file>

<file path="lib/hey/rofi.janet">
# lib/hey/rofi.janet
#
# An API for interacting with Rofi.

(use ./.)
(import spork/htmlgen)
(import spork/base64)

(def escape htmlgen/escape)
(def encode base64/encode)
(def decode base64/decode)

(def config @{})

(defn exit []
  (os/execute ["pkill" "rofi"] :p))

(defn instance [& plist]
  (def cfg (merge config (struct ;plist)))
  (with-envvars ["ROFI_PLACEHOLDER" (if-let [ph (get cfg :placeholder)]
                                      (fmt "\"%s\"" ph))]
    # (each binds (get cfg :bind)
    #   )
    (os/spawn ["rofi" "-dmenu" "-markup-rows"
               ;(opts "-i" (not (get cfg :case-sensitive)))
               ;(opts "-p" (get cfg :prompt))
               ;(opts "-mesg" (get cfg :message))
               ;(opts "-theme" (get cfg :theme))
               ;(opts "-theme-str" (if (get cfg :icon) (fmt `icon{filename:"%s";}` (get cfg :icon))))
               ;(opts (if (get cfg :password) "-password"))
               ;(opts (if (get cfg :multiple) "-multi-select"))]
              :pd {:in :pipe :out :pipe})))

(defn- prep-line [line plist]
  (string line "\0"
          (string/join
           (catseq [[k v] :in (partition 2 plist)]
             (if (= k :data)
               [] [(string k "\x1f" (if (atom? v) v (encode (marshal v))))]))
           "\x1f")
          "\n"))

(defn call [f & plist]
  (with [rofi (instance ;plist)]
    (let [items @{}
          binds @{}
          fib (ev/go
               (coro
                (try (defer (ev/close (rofi :in))
                       (f {:in (rofi :in)
                           :out (rofi :out)
                           :add (fn [self line & plist]
                                  (when-let [idx (index-of :data plist)]
                                    (put items line (get plist (+ idx 1))))
                                  (ev/write (self :in) (prep-line line plist) 3))
                           :div (fn [self & plist]
                                  (ev/write
                                   (self :in)
                                   (prep-line "<span alpha='30%%'>------------------------------------------------------------</span>"
                                              [:nonselectable true ;plist])))
                           :on-code (fn [self code action] (put binds code action))
                           :sleep (fn [self n] (ev/sleep n))
                           # :set (fn [self & plist]
                           #        (ev/write (self :in) (prep-line "" plist)))
                          }))
                     ([err fib]
                      # in case of premature abort
                      (or (= err "stream is closed")
                          (= err "stream err")
                          (= err :exit)
                          (= (first err) :exit)
                          (propagate err fib))))))
          buf @""]
      (defer (ev/cancel fib :exit)
        (when (ev/read (rofi :out) :all buf)
          (os/proc-wait rofi)
          (let [str (string/chomp buf)
                val (if (has-key? items str) (get items str) str)]
            (if-let [f (get binds (get rofi :return-code))]
              (f val) val)))))))

(defn pick [items & plist]
  (call (fn [rofi]
          (each i items
            (:add rofi ;(if (atom? i)
                          [(string i)]
                          [;i ;(if (get i :data) [] [:data i])]))))
        (struct ;plist)))

(defn read [& plist]
  (call (fn [_]) ;plist))

(defn prompt [question &named yes no]
  (call (fn [rofi]
          (:add rofi (or yes "Yes") :data true)
          (:add rofi (or no  "No")  :data false))
        :message question
        :theme "modal.rasi"))

(defmacro with ([sym & plist] & body)
  ~(,call (fn [,sym] ,;body) ,;plist))

(defn error [message & args]
  (os/spawn ["rofi" "-markup" "-e"
             (string "<b>Uncaught error:</b>\n\n"
                     (escape (fmt message ;args)))]
            :pd)
  (errorf message ;args))

(defmacro chain [[sym & plist] & body]
  ~(let [init (fn [] (,call (fn [,sym] ,;body) ,;plist))]
     (var n init)
     (while (set n (n))
       (cond (= n :restart) (set n init)
             (nil? n) (abort "Aborted")
             (not (function? n)) (break)))
     n))
</file>

<file path="lib/hey/sys.janet">
(import spork/path)
(use ./lib)
(use sh)

(defn play-sound [name &named volume]
  (when-let [file (path/sibling :file (path :theme "sounds" name)
                                ".ogg" ".wav" ".mp3")]
    (os/spawn ["play" "-q" ;(opts "-v" volume) file] :pd)))

(defn notify [message &named urgency title icon sound]
  (os/spawn ["notify-send"
             ;(opts "-i" icon)
             ;(opts "-u" urgency)
             ;(if title
                [title message]
                [message])]
            :pd)
  (if sound (play-sound sound)))

(defn yank [text &named type once]
  (case (flake/info :desktop :type)
    "wayland" ($? echo ,text | wl-copy ,;(opts "-t" type) ,;(opts (if once "-o")))
    "x11"     ($? echo ,text | xclip -selection clipboard -i)))

(defn yank-file [file &named type once]
  (case (flake/info :desktop :type)
    "wayland" ($? wl-copy ,;(opts "-t" type) ,;(opts (if once "-o")) ,file)
    "x11"     ($? xclip -selection clipboard -i ,file)))

(defn paste []
  (case (flake/info :desktop :type)
    "wayland" ($<_ wl-paste)
    "x11"     ($? xclip -selection clipboard -o)))
</file>

<file path="lib/hey/vars.janet">
(import spork/path)
(use ./lib)

(defn new [dir &opt raw?]
  (let [dir (path/abspath dir)]
    {:dir (fn [self & segments] (path/join dir ;segments))
     :file (fn [self key]
             (path/join dir ;(if (atom? key) [key] key)))
     :list (fn [self] (map keyword (os/dir dir)))
     :get (fn [self key &opt dflt]
            (let [file (:file self key)]
              (if (path/file? file)
                (with-umask 8r077
                  ((if raw? identity unmarshal) (slurp file)))
                dflt)))
     :set (fn [self key val]
            (let [file (:file self key)]
              (if (= val nil)
                (when (path/file? file)
                  (os/rm file)
                  key)
                (do (unless (path/directory? dir)
                      (os/execute ["mkdir" "-p" dir] :px))
                    (with-umask 8r077
                      (spit file ((if raw? identity marshal) val)))
                    val))))
     :clear (fn [self]
              (when (path/directory? dir)
                (each f (path/files-in dir)
                  (when (path/file? f)
                    (os/rm f)))))
     :cache (fn [self key valfn &opt reset?]
              (or (unless reset?
                    (:get self key))
                  (:set self key (valfn))))}))

(def global (new (path :data "vars.d")))
(def temp   (new (path :runtime "vars.d")))

(defn get [key &opt global?]
  (:get (if global? global temp) key))

(defn set [key val &opt global?]
  (:set (if global? global temp) key val))

(defn list [&opt global?]
  (:list (if global? global temp)))

(defmacro cached [vars key & body]
  ~(:cache ,vars ,key (fn [] ,;body)))
</file>

<file path="lib/zsh/hey.abort">
#!/usr/bin/env zsh

hey.error $@
exit 1
</file>

<file path="lib/zsh/hey.cache">
#!/usr/bin/env zsh

main() {
  case $1 in
    [/~]*) [[ -x "$1" ]] || return 1 ;;
    *) (( $+commands[$1] )) || return 1 ;;
  esac
  local cache="$XDG_CACHE_HOME/zsh/${1:t}-${ZSH_VERSION}"
  if [[ ! -f $cache || ! -s $cache ]]; then
      echo "Caching ${1:t:r}..."
      mkdir -p "${cache:h}"
      "$@" >"$cache"
      chmod 600 "$cache"
  fi
  if [[ -o interactive ]]; then
      source "$cache" || rm -f "$cache"
  fi
}

main $@
</file>

<file path="lib/zsh/hey.do">
#!/usr/bin/env zsh
# hey.do [ ( -o [[-e EXE]...]) |
#           ( -! [[-p PACKAGE]...] [[--keep VAR]...] ) ]
#        COMMAND [ARGS...]
#
# TODO
#
# ENVIRONMENT VARIABLES:
#   HEYDEBUG
#     If non-empty, the command and arguments will be emitted to stderr before
#     executing them.
#   HEYDRYRUN
#     If non-empty, the command and arguments will be emitted to stdout instead
#     of executed.
#
# OPTIONS:
#   -o [[-e EXE]...]
#     Makes the command no-op if COMMAND isn't in $PATH. -e can be used to
#     provide explicit executables to check against (instead of COMMAND).
#   -! [[-p PACKAGE]...] [[--keep VAR]...] )
#     If COMMAND isn't in $PATH, run the command in cached-nix-shell and try to
#     automatically provision them. Use -p to specify package names explicitly
#     (instead of COMMAND), and --keep to allow certain environment variables to
#     persist into the nix-shell session.

case $1 in
  -o)
    shift
    zparseopts -D -- e+:=exes
    (( $#exes == 0 )) && exes=( -e "$1" )
    for _ exe in ${exes[@]}; do
      if ! command -v $exe >/dev/null; then
        hey.log -2 "$exe absent, skipping: $ $@"
        exit 1
      fi
    done
    ;;
  -!)
    shift
    zparseopts -D -- p+:=pkgs keep+:=keep
    (( $#pkgs == 0 )) && pkgs=( -p "$1" )
    cached-nix-shell "${keep[@]}" "${pkgs[@]}" --run "$*"
    exit
    ;;
esac

HEYDEBUG=${HEYDEBUG:-${HEYDRYRUN:+1}} hey.log -c green "$" "$*"
[[ $HEYDRYRUN ]] || "$@"
</file>

<file path="lib/zsh/hey.echo">
#!/usr/bin/env zsh

# TODO
main() {
  zparseopts -E -D -- p:=prefix c:=color n=nl || return
  [[ -n $HEYPIPE ]] && color=
  print -P $nl "${color[2]:+%F\{$color[2]\}}${prefix[2]}$@${color[2]:+%f}"
}

main $@
</file>

<file path="lib/zsh/hey.error">
#!/usr/bin/env zsh

[[ $HEYQUIET ]] && return
hey.echo -p "⚠ " -c red $@ >&2
</file>

<file path="lib/zsh/hey.requires">
#!/usr/bin/env zsh
# hey.requires [COMMANDS...]
#
# Asserts that each shell executable in COMMANDS is available (in $PATH). Throws
# an error and exits otherwise.

main() {
  hey.log -2 "hey.requires: $@"
  local ok=1
  for arg in $@; do
    if ! command -v $arg >/dev/null; then
      hey.error "Required dependency not met: $arg"
      ok=
    fi
  done
  [[ $ok ]] || exit 1
}

main $@
</file>

<file path="lib/zsh/hey.start">
#!/usr/bin/env zsh

main() {
  zparseopts -E -D -- r=restart || return 1
  if pidof -s $1 >/dev/null; then
    [[ $restart ]] || return
    hey.do pkill $1
  fi
  hey.do $@ &
}

main $@
</file>

<file path="lib/zsh/hey.warn">
#!/usr/bin/env zsh

[[ $HEYQUIET ]] && return
hey.echo -p "⚠ " -c yellow $@ >&2;
</file>

<file path="lib/attrs.nix">
{ lib }:

with builtins;
with lib;
rec {
  # attrsToList :: attrs -> attrs
  attrsToList = attrs:
    mapAttrsToList (name: value: { inherit name value; }) attrs;

  # mapFilterAttrs ::
  #   (name -> value -> bool)
  #   (name -> value -> { name = any; value = any; })
  #   attrs
  #   -> attrs
  mapFilterAttrs = f: pred: attrs: filterAttrs pred (mapAttrs f attrs);
  mapFilterAttrs' = f: pred: attrs: filterAttrs pred (mapAttrs' f attrs);

  # filterMapAttrs ::
  #   (name -> value -> { name = any; value = any; })
  #   (name -> value -> bool)
  #   attrs
  #   -> attrs
  filterMapAttrs = pred: f: attrs: (mapAttrs f (filterAttrs pred attrs));
  filterMapAttrs' = pred: f: attrs: (mapAttrs' f (filterAttrs pred attrs));

  # Generate an attribute set by mapping a function over a list of values.
  # genAttrs' :: list -> ((any -> any) -> attrs) -> attrs
  genAttrs' = values: f: listToAttrs (map f values);

  # anyAttrs :: (name -> value -> bool) attrs -> bool
  anyAttrs = pred: attrs:
    any (attr: pred attr.name attr.value) (attrsToList attrs);

  # countAttrs :: (name -> value -> bool) attrs -> int
  countAttrs = pred: attrs:
    count (attr: pred attr.name attr.value) (attrsToList attrs);

  # Unlike //, this will deeply merge attrsets (left > right).
  # mergeAttrs' :: listOf attrs -> attrs
  mergeAttrs' = attrList:
    let f = attrPath:
          zipAttrsWith (n: values:
            if (tail values) == []
            then head values
            else if all isList values
            then concatLists values
            else if all isAttrs values
            then f (attrPath ++ [n]) values
            else last values);
    in f [] attrList;

  # flattenAttrs :: (tree -> attrs) -> attrs
  # Credit goes to numtide/flake-utils for this!
  flattenAttrs = tree:
    let
      op = sum: path: val:
        let
          pathStr = concatStringsSep "/" path;
        in
          if (typeOf val) != "set" then
            # ignore that value
            # trace "${pathStr} is not of type set"
            sum
          else if val ? type && val.type == "derivation" then
            # trace "${pathStr} is a derivation"
            # we used to use the derivation outPath as the key, but that crashes Nix
            # so fallback on constructing a static key
            (sum // { ${pathStr} = val; })
          else if val ? recurseForDerivations && val.recurseForDerivations == true then
            # trace "${pathStr} is a recursive"
            # recurse into that attribute set
            (recurse sum path val)
          else
            # ignore that value
            # trace "${pathStr} is something else"
            sum;
      recurse = sum: path: val:
        foldl'
          (sum: key: op sum (path ++ [ key ]) val.${key})
          sum
          (attrNames val);
    in
      recurse { } [ ] tree;
}
</file>

<file path="lib/debug.nix">
{ lib, ... }:

with builtins;
with lib;
rec {
  inspect = fn: val:
    traceSeqN 10 (fn val) val;
}
</file>

<file path="lib/default.nix">
{ self, lib, pkgs, ... }:

let
  inherit (builtins) mapAttrs intersectAttrs functionArgs getEnv fromJSON;
  inherit (lib) attrValues foldr foldl;

  # mapModules gets special treatment because it's needed early!
  inherit (attrs) attrsToList mergeAttrs';
  inherit (modules) mapModules;
  attrs   = import ./attrs.nix   { inherit lib; };
  modules = import ./modules.nix { inherit lib attrs; };

  /* Given an attrset of nix module partials, returns it as a sorted list of
     NameValuePairs according to its callPackage-style dependencies from the
     rest of the list.

     sortLibsByDeps :: AttrSet -> [ AttrSet ... ]

     Example:
       sortLibsByDeps { libA = { libB, ... }: {}; libB = { ... }: { [...] }; }
       => [ { libB = {...}: [...]; } { libA = { libB, ...}: [...]; } ]
  */
  sortLibsByDeps = modules:
    modules;

    # TODO
    # let
    #   dependsOn = a: b:
    #     elem a (attrByPath b [] deps);
    #   maybeSortedAttrs = toposort dependsOn (diskoLib.deviceList devices);
    # in
    #   if (hasAttr "cycle" maybeSortedAttrs) then
    #     abort "detected a cycle in your disk setup: ${maybeSortedAttrs.cycle}"
    #   else
    #     maybeSortedAttrs.result;

  # I embrace the callPackage pattern for lib/*.nix modules. I.e. Their
  # arguments are dynamically passed as they are loaded, drawn from a running
  # list of loaded lib/*.nix modules (plus the nixpkgs 'lib' passed to this
  # module and the whole set altogether).
  libConcat = a: b: a // {
    ${b.name} = b.value (intersectAttrs (functionArgs b.value) a);
  };
  # FIXME: Lexicographical loading can cause race conditions. Sort them?
  libModules = sortLibsByDeps (mapModules ./. import);
  libs = foldl libConcat { inherit lib pkgs; self = libs; } (attrsToList libModules);
in
  # The flattened tree is appended to make the namespaced endpoints optional,
  # and because namespaces are useful for inherit'ed let-bindings. In other
  # words: lib.attrsToList == lib.attrs.attrsToList.
  libs // (mergeAttrs' (attrValues libs))
</file>

<file path="lib/modules.nix">
{ lib, attrs }:

let
  inherit (builtins) attrValues readDir pathExists concatLists;
  inherit (lib) id mapAttrsToList filterAttrs hasPrefix hasSuffix nameValuePair removeSuffix;
in rec {
  mapModules = dir: fn:
    attrs.mapFilterAttrs'
      (n: v:
        let path = "${toString dir}/${n}"; in
        if v == "directory" && pathExists "${path}/default.nix"
        then nameValuePair n (fn path)
        else if v == "regular" &&
                n != "default.nix" &&
                n != "flake.nix" &&
                hasSuffix ".nix" n
        then nameValuePair (removeSuffix ".nix" n) (fn path)
        else nameValuePair "" null)
      (n: v: v != null && !(hasPrefix "_" n))
      (readDir dir);

  mapModules' = dir: fn:
    attrValues (mapModules dir fn);

  # dir -> fn :: attrs (attrs (attrs ...))
  #
  # Creates a file tree where each leaf is the result of FN.
  mapModulesRec = dir: fn:
    attrs.mapFilterAttrs'
      (n: v:
        let path = "${toString dir}/${n}"; in
        if v == "directory"
        then nameValuePair n (mapModulesRec path fn)
        else if v == "regular" &&
                n != "default.nix" &&
                n != "flake.nix" &&
                hasSuffix ".nix" n
        then nameValuePair (removeSuffix ".nix" n) (fn path)
        else nameValuePair "" null)
      (n: v: v != null && !(hasPrefix "_" n))
      (readDir dir);

  # dir -> fn :: listOf paths
  #
  # Returns a list of all files under DIR, mapped by FN.
  mapModulesRec' = dir: fn:
    let
      dirs =
        mapAttrsToList
          (k: _: "${dir}/${k}")
          (filterAttrs
            (n: v: v == "directory"
                   && !(hasPrefix "_" n)
                   && !(pathExists "${dir}/${n}/.noload"))
            (readDir dir));
      files = attrValues (mapModules dir id);
      paths = files ++ concatLists (map (d: mapModulesRec' d id) dirs);
    in map fn paths;

  # dir :: attrs
  #
  # TODO
  mapHosts = dir:
    mapModules dir (path: {
      inherit path;
      config = import path;
    });
}
</file>

<file path="lib/nixos.nix">
# lib/flakes.nix --- syntax sugar for flakes
#
# This may look a lot like what flake-parts, flake-utils(-plus), and/or digga
# offer. I reinvent the wheel because (besides flake-utils), they are too
# volatile to depend on. They see subtle and unannounced changes, often. Since I
# rely on this flake as a basis for 100+ systems, VMs, and containers, some of
# whom are mission-critical, I'd rather have a less polished API that I fully
# control than a robust one that I cannot predict, for maximum mobility. It's
# also a more valuable learning experience.

{ self, lib, attrs, modules }:

with builtins;
with lib;
with attrs;
with modules;
rec {
  mkApp = program: {
    inherit program;
    type = "app";
  };

  # FIXME: Refactor me! (Use submodules?)
  mkFlake = {
    self
    , hey ? self
    , nixpkgs ? hey.inputs.nixpkgs
    , nixpkgs-unstable ? hey.inputs.nixpkgs-unstable or hey.inputs.nixpkgs-unstable or nixpkgs
    , disko ? hey.inputs.disko
    , ...
  } @ inputs: {
    apps ? {}
    , checks ? {}
    , devShells ? {}
    , hosts ? {}
    , modules ? {}
    , overlays ? {}
    , packages ? {}
    , storage ? {}
    , systems
    , templates ? {}
    , ...
  } @ flake:
    let
      mkPkgs = system: pkgs: overlays: import pkgs {
        inherit system overlays;
        config.allowUnfree = true;
        # A number of packages depend on python 2.7, but nixpkgs errors out when
        # it is pulled, so...
        config.permittedInsecurePackages = [ "python-2.7.18.6" ];
      };

      # Processes external arguments that bin/hey will feed to this flake (using
      # a json payload in an envvar). The internal var is kept in lib to stop
      # 'nix flake check' from complaining more than it has to.
      args =
        let hargs = getEnv "HEYENV"; in
        if hargs == ""
        then abort "HEYENV envvar is missing"
        else fromJSON hargs;

      # This is the only impurity we allow into this flake, because there are
      # many times where it is more convenient to generate or seed dotfiles or
      # envvars with local (non-nix-store) paths instead, so I don't have to
      # rebuild each time I change/swap them out.
      nixosConfigurations = mapAttrs (hostName: { path, config }:
        # TODO: Replace with a submodule
        let
          nixosModules =
            filterMapAttrs
              (_: i: i ? nixosModules)
              (_: i: i.nixosModules)
              inputs;
          mkDotfiles = dir: {
            dir =
              if dir != "" then dir
              else abort "No or invalid dir specified: ${dir}";
            binDir      = "${dir}/bin";
            libDir      = "${dir}/lib";
            configDir   = "${dir}/config";
            modulesDir  = "${dir}/modules";
            themesDir   = "${dir}/modules/themes";
            hostDir     = "${path}";
          };
          mkModules = filterMapAttrs
            (_: i: i ? nixosModules)
            (_: i: i.nixosModules);
          mkSelf = system:
            self // {
              inherit args;
              modules = mkModules self.inputs;
              packages = self.packages.${system};
              devShell = self.devShell.${system};
              apps = self.apps.${host.system};
            } // (mkDotfiles (toString self));
          mkHey = system:
            hey // {
              inherit args;
              modules = mkModules hey.inputs;
              packages = hey.packages.${system};
              devShell = hey.devShell.${system};
              apps = hey.apps.${system};
            } // (mkDotfiles args.path);

          self' = mkSelf host.system;
          hey' = mkHey host.system;
          host = config {
            inherit args lib nixosModules;
            hey = hey';
          };
          pkgs = mkPkgs host.system nixpkgs ((attrValues overlays) ++ [
            (final: prev: {
              unstable = mkPkgs host.system nixpkgs-unstable (attrValues overlays);
            })
          ]);
        in
          nixpkgs.lib.nixosSystem {
            system = host.system;
            specialArgs.self = self';
            specialArgs.hey = hey';
            modules = [
              disko.nixosModules.disko
              (if isFunction storage
               then (attrs: { disko.devices = storage attrs; })
               else { disko.devices = storage; })
              {
                nixpkgs.pkgs = pkgs;
                networking.hostName = mkDefault (args.host or hostName);
              }
              ../.
            ]
            ++ (host.imports or [])
            ++ [ {
              modules = host.modules or {};
              # theme = host.theme or {};
            } ]
            ++ [ (host.config or {}) (host.hardware or {}) ];
          }) hosts;
      perSystem = map (system:
        let withPkgs = pkgs: packageAttrs:
              mapFilterAttrs
                (_: v: pkgs.callPackage v { self = self.packages.${system}; })
                (_: v: !(v ? meta.platforms) || (elem system v.meta.platforms))
                packageAttrs;
            pkgs = mkPkgs system nixpkgs (attrValues overlays);
        in filterAttrs (_: v: v.${system} != {}) {
          apps.${system} = apps;
          checks.${system} = withPkgs pkgs checks;
          devShells.${system} = withPkgs pkgs devShells;
          packages.${system} = withPkgs pkgs packages;
        }) systems;
    in
      (filterAttrs (n: _: !elem n [
        "apps" "bundlers" "checks" "devices" "devShells" "hosts" "modules"
        "packages" "storage" "systems"
      ]) flake) // {
          inherit nixosConfigurations;
          nixosModules = modules;

          # To parameterize this flake (more so for flakes derived from this
          # one) I rely on bin/hey (my nix{,os} CLI/wrapper) to emulate
          # --arg/--argstr options. 'dir' and 'host' are special though, and
          # communicated using hey's -f/--flake and --host options:
          #
          #   hey sync -f /etc/nixos#soba
          #   hey sync -f /etc/nixos --host soba
          #
          # The magic that allows this lives in mkFlake, but requires --impure
          # mode. Sorry hermetic purists!
          _heyArgs = args;
      } // (mergeAttrs' perSystem);
}
</file>

<file path="lib/options.nix">
{ lib }:

let
  inherit (lib) mkOption types;
in
rec {
  mkOpt  = type: default:
    mkOption { inherit type default; };

  mkOpt' = type: default: description:
    mkOption { inherit type default description; };

  mkBoolOpt = default: mkOption {
    inherit default;
    type = types.bool;
    example = true;
  };
}
</file>

<file path="lib/pkgs.nix">
# lib/pkgs.nix --- TODO
#
# TODO

{ self, lib, pkgs, ... }:

with builtins;
with lib;
rec {
  boolTo = bool: trueStr: falseStr:
    if (bool == false || bool == null || bool == 0)
    then falseStr
    else trueStr;

  boolToStr = bool: boolTo bool "true" "false";

  mkWrapper = package: postBuild:
    let name = if isList package then elemAt package 0 else package;
        paths = if isList package then package else [ package ];
    in pkgs.symlinkJoin  {
      inherit paths postBuild;
      name = "${name}-wrapped";
      buildInputs = [ pkgs.makeWrapper ];
    };

  mkLauncherEntry = title: {
      prefix ? "launcher-",
      description ? "",
      icon,
      exec,
      categories ? []
    }: pkgs.makeDesktopItem ({
      inherit icon exec categories;
      name = "${prefix}${hashString "md5" exec}";
      desktopName = title;
    } // (if description != "" then {
      genericName = description;
    } else {}));

  toPrettyJSON = attrs:
    readFile ((pkgs.formats.json {}).generate "prettyJSON" attrs);

  compileSCSS = file:
    let fileName = removeSuffix ".scss" (baseNameOf file);
        compiledStyles =
          pkgs.runCommand "compileScssFile" { buildInputs = [ pkgs.sass ]; } ''
            mkdir "$out"
            scss --sourcemap=none \
                 --no-cache \
                 --style compressed \
                 --default-encoding utf-8 \
                 "${file}" \
                 >>"$out/${fileName}.css"
          '';
    in readFile "${compiledStyles}/${fileName}.css";
}
</file>

<file path="modules/desktop/apps/godot.nix">
# modules/dev/godot.nix --- https://godotengine.org/
#
# Gamedev is my hobby. C++ or Rust are my main drivers (and occasionally Lua),
# but to prototype (for 3D, mainly) I often reach for godot (or Love2D).

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop.apps.godot;
in {
  options.modules.desktop.apps.godot = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    user.packages = with pkgs; [
      godot_4
      godot_4-export-templates-bin
      gdtoolkit_4
    ];
  };
}
</file>

<file path="modules/desktop/apps/libreoffice.nix">
# modules/desktop/apps/libreoffice.nix
#
# TODO

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop.apps.libreoffice;
in {
  options.modules.desktop.apps.libreoffice = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    user.packages = with pkgs; [
      libreoffice
      (aspellWithDicts (ds: with ds; [ en en-computers en-science ]))
    ];
  };
}
</file>

<file path="modules/desktop/apps/lutris.nix">
# modules/desktop/apps/steam.nix

{ hey, heyBin, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop.apps.lutris;
in {
  options.modules.desktop.apps.lutris = with types; {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    environment.systemPackages = with pkgs; [
      unstable.lutris
    ];

    # Better for steam proton games
    systemd.extraConfig = mkDefault "DefaultLimitNOFILE=1048576";
  };
}
</file>

<file path="modules/desktop/apps/rofi.nix">
{ hey, lib, config, options, pkgs, ... }:

with builtins;
with lib;
let inherit (hey.lib.pkgs) mkWrapper mkLauncherEntry;
    cfg = config.modules.desktop.apps.rofi;

    rofiPkg = if config.modules.desktop.type == "wayland"
              then pkgs.rofi-wayland-unwrapped
              else pkgs.rofi-unwrapped;
    rofiFBPkg = pkgs.rofi-file-browser.override { rofi = rofiPkg; };
    rofiCalcPkg = pkgs.rofi-calc.override { rofi-unwrapped = rofiPkg; };
    rofiBlocksPkg = hey.packages.rofi-blocks.override { rofi-unwrapped = rofiPkg; };
in {
  options.modules.desktop.apps.rofi = with hey.lib.options; {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable (mkMerge [
    {
      home.configFile."rofi" = {
        source = "${hey.configDir}/rofi";
        recursive = true;
      };

      programs.gdk-pixbuf.modulePackages = [ pkgs.librsvg ];

      environment.variables.ROFI_PLUGIN_PATH = [
        "$XDG_CONFIG_HOME/rofi/plugins"  # for local development
        "${rofiBlocksPkg}/lib/rofi"
        "${rofiFBPkg}/lib/rofi"
        "${rofiCalcPkg}/lib/rofi"
      ];

      user.packages = with pkgs; [
        rofiPkg
        rofimoji
        (mkLauncherEntry "Calculator" {
          icon = "calc";
          exec = "hey @rofi calcmenu";
          categories = [ "Development" ];
        })
        (mkLauncherEntry "Open Bookmark ->" {
          description = "In ${config.modules.desktop.browsers.default}";
          icon = "bookmark-new-symbolic";
          exec = "hey @rofi bookmarkmenu";
        })
        (mkLauncherEntry "Open File ->" {
          icon = "folder";
          exec = ''hey @rofi filemenu -file-browser-dir "\$HOME"'';
        })
        (mkLauncherEntry "Open Directory in Terminal ->" {
          icon = "folder";
          exec = ''hey @rofi filemenu -file-browser-dir "\$HOME" -file-browser-depth 4 -file-browser-no-descend -file-browser-only-dirs -file-browser-cmd "hey .open-term -- cd"'';
        })
        (mkLauncherEntry "Emoji Selector ->" {
          icon = "face-smile";
          exec = "hey @rofi emojimenu";
        })
        (mkLauncherEntry "Power Menu ->" {
          icon = "system-shutdown";
          exec = "hey @rofi powermenu";
        })
        (mkLauncherEntry "Manage audio devices ->" {
          icon = "audio-card";
          exec = "hey @rofi audiomenu";
        })
        (mkLauncherEntry "Manage Wireless Networks ->" {
          icon = "network-wireless";
          exec = "hey @rofi wifimenu";
        })
      ];
    }

    (mkIf config.hardware.bluetooth.enable {
      user.packages = [
        (mkLauncherEntry "Manage Bluetooth Devices ->" {
          icon = "bluetooth";
          exec = "${pkgs.rofi-bluetooth}/bin/rofi-bluetooth";
        })
      ];
    })

    (mkIf config.modules.shell.vaultwarden.enable {
      user.packages = [
        (mkLauncherEntry "Password Manager" {
          icon = "changes-prevent";
          exec = "hey @rofi vaultmenu";
        })
        (mkLauncherEntry "Password Manager: resume from last time" {
          icon = "changes-prevent";
          exec = "hey @rofi vaultmenu -l";
        })
      ];
    })

    (mkIf config.services.udisks2.enable {
      user.packages = [
        (mkLauncherEntry "Mount/unmount Devices ->" {
          icon = "drive-harddisk";
          exec = "hey @rofi mountmenu";
        })
      ];
    })
  ]);
}
</file>

<file path="modules/desktop/apps/spotify.nix">
# modules/desktop/apps/spotify.nix --- TODO
#
# I use spotify for my music needs. Gone are the days where I'd manage 200gb+ of
# local music; most of which I haven't heard or don't even like.

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop.apps.spotify;
in {
  # imports = [
  #   hey.modules.spicetify-nix.default
  # ];

  options.modules.desktop.apps.spotify = with types; {
    enable = mkBoolOpt false;
    theme = mkOpt str "";
    colorscheme = mkOpt str "";
  };

  config = mkIf cfg.enable {
    # programs.spicetify.enable = true;

    user.packages = with pkgs; [
      playerctl   # To control it remotely.
    ];
  };
}
</file>

<file path="modules/desktop/apps/steam.nix">
# modules/desktop/apps/steam.nix

{ hey, heyBin, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop.apps.steam;
in {
  options.modules.desktop.apps.steam = with types; {
    enable = mkBoolOpt false;
    mangohud.enable = mkBoolOpt true;
    libraryDir = mkOpt str "";
  };

  config = mkIf cfg.enable {
    programs = {
      steam = {
        enable = true;
        remotePlay.openFirewall = true;
      };
      gamescope.enable = true;
      # Makes gamemoderun available, but it must be selectively enabled for
      # games by changing said game's launch options to 'gamemoderun %command%'.
      gamemode = {
        enable = true;
        settings = {
          general = {
            inhibit_screensaver = 0;
            renice = 10;
          };
          custom = {
            start = "${heyBin} hook gamemode --on";
            end = "${heyBin} hook gamemode --off";
          };
        };
      };
    };

    user.extraGroups = [ "gamemode" ];

    environment.systemPackages = with pkgs; [
      # Stop Steam from polluting $HOME, and fix symlink/filename issues for a
      # Steam library that lives on an NTFS drive.
      (let pkg = config.programs.steam.package;
           # If the steam library lives on a shared NTFS drive, then we must
           # symlink steamapps/compatdata to a local directory, because Proton
           # will fail to produce certain paths that are illegal on an NTFS
           # filesystem (e.g. contains ":"). WARNING: SOME GAMES WRITE SAVEFILES
           # TO THE COMPATDATA FOLDER. IF THOSE GAMES DON'T HAVE CLOUD-SAVING,
           # THIS WILL DESTROY DATA! (Most games do, though)
           libFix = writeShellScriptBin "libfix" ''
             if [[ "x${cfg.libraryDir}" != "x" ]]; then
               _libdir="${cfg.libraryDir}"
               if [[ -d "$_libdir" ]]; then
                 _steamdir="$_libdir/steamapps"
                 if [[ "$(stat -f -c %T "$_steamdir")" == "fuseblk" ]]; then
                   if [[ ! -L "$_steamdir/compatdata" ]]; then
                     rm -rf "$_steamdir/compatdata"
                   fi
                   if [[ ! -e "$_steamdir/compatdata" ]]; then
                     ln -s "$HOME/.steam/steam/steamapps/compatdata" "$_steamdir/compatdata"
                   fi
                 fi
               fi
             fi
           '';
       in mkWrapper [
         pkg
         pkg.run   # for GOG and humble bundle games
       ] ''
         wrapProgram "$out/bin/steam" \
           --run 'export HOME="$XDG_FAKE_HOME"' \
           --run '${libFix}/bin/libfix'
         wrapProgram "$out/bin/steam-run" --run 'export HOME="$XDG_FAKE_HOME"'
       '')
    ] ++ (if cfg.mangohud.enable then [ pkgs.mangohud ] else []);

    # Better for steam proton games
    systemd.extraConfig = mkDefault "DefaultLimitNOFILE=1048576";
  };
}
</file>

<file path="modules/desktop/apps/teamviewer.nix">
# modules/desktop/apps/teamviewer.nix --- for my parental SOSes
#
# You know the feeling. It's 4am, you get a phone call. It's your parents in
# another timezone and their printer/email/something has stopped working, and
# you're the family computer guy (my condolences). Cue teamviewer.

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop.apps.teamviewer;
in {
  options.modules.desktop.apps.teamviewer = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    environment.systemPackages = [
      # I am aware of services.teamviewer, and choose to avoid it so I can
      # lazily start (and shut down) the teamviewer daemon. I rarely use
      # teamviewr, and don't want the daemon running when it's unused.
      (mkWrapper pkgs.teamviewer ''
        wrapProgram "$out/bin/teamviewer"
          --run 'systemctl start teamviewerd' \
          --run 'trap "systemctl stop teamviewerd" EXIT'
      '')
    ];

    services.dbus.packages = [ pkgs.teamviewer ];

    systemd.services.teamviewerd = {
      description = "TeamViewer remote control daemon";
      requires = [ "dbus.service" ];
      preStart = "mkdir -pv /var/lib/teamviewer /var/log/teamviewer";
      startLimitIntervalSec = 60;
      startLimitBurst = 10;
      serviceConfig = {
        Type = "simple";
        ExecStart = "${pkgs.teamviewer}/bin/teamviewerd -f";
        PIDFile = "/run/teamviewerd.pid";
        ExecReload = "${pkgs.coreutils}/bin/kill -HUP $MAINPID";
        Restart = "on-abort";
      };
    };
  };
}
</file>

<file path="modules/desktop/apps/thunar.nix">
# modules/desktop/apps/thunar.nix --- TODO
#
# TODO

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop.apps.thunar;
in {
  options.modules.desktop.apps.thunar = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    programs.thunar.enable = true;
    # services.gvfs.enable = true; # Mount, trash, and other functionalities
    services.tumbler.enable = true; # Thumbnail support for images
  };
}
</file>

<file path="modules/desktop/apps/ue.nix">
# modules/desktop/apps/ue.nix --- https://unrealengine.com
#
# ...

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop.apps.ue;
in {
  options.modules.desktop.apps.ue = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    user.packages = with pkgs; [
      ue4
    ];
  };
}
</file>

<file path="modules/desktop/apps/unity3d.nix">
# modules/dev/unity3d.nix --- https://unity.com
#
# I don't use Unity often, but when I do, it's in a team or with students.

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop.apps.unity3d;
in {
  options.modules.desktop.apps.unity3d = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    user.packages = with pkgs; [
      unity3d
    ];
  };
}
</file>

<file path="modules/desktop/apps/virtualbox.nix">
# modules/desktop/apps/virtualbox.nix
#
# For testing or building software on other OSes. If I find out how to get macOS
# on qemu/libvirt I'd be happy to leave virtualbox behind.

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop.apps.virtualbox;
in {
  options.modules.desktop.apps.virtualbox = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    virtualisation.virtualbox.host = {
      enable = true;
      # urg, takes so long to build, but needed for macOS guest
      # enableExtensionPack = true;
    };

    user.extraGroups = [ "vboxusers" ];

    # I will always update the microcode for my CPUs, so this is safe heuristic
    # for what CPU to cater to.
    boot.kernelModules =
      if config.hardware.cpu.amd.updateMicrocode
      then [ "kvm-amd" ]
      else [ "kvm-intel" ];
  };
}
</file>

<file path="modules/desktop/browsers/brave.nix">
# modules/browser/brave.nix --- https://publishers.basicattentiontoken.org
#
# A FOSS and privacy-minded browser.

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop.browsers.brave;
in {
  options.modules.desktop.browsers.brave = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    user.packages = with pkgs; [
      brave
      (mkLauncherEntry "Brave Web Browser" {
        description = "Open a private Brave window";
        icon = "brave";
        exec = "${brave}/bin/brave --incognito";
        categories = [ "Network" ];
      })
    ];
  };
}
</file>

<file path="modules/desktop/browsers/default.nix">
{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop.browsers;
in {
  options.modules.desktop.browsers = {
    default = mkOpt (with types; nullOr str) null;
  };

  config = mkIf (cfg.default != null) {
    environment.sessionVariables.BROWSER = cfg.default;
  };
}
</file>

<file path="modules/desktop/browsers/librewolf.nix">
# modules/browser/librewolf.nix --- https://librewolf.net/
#
# Oh Librewolf, gateway to the interwebs, devourer of ram. Give onto me your
# infinite knowledge and shelter me from ads, but bless my $HOME with
# directories nobody needs and live long enough to turn into Chrome.

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop.browsers.librewolf;
in {
  options.modules.desktop.browsers.librewolf = with types; {
    enable = mkBoolOpt false;
    profileName = mkOpt str config.user.name;

    settings = mkOpt' (attrsOf (oneOf [ bool int str ])) {} ''
      Librewolf preferences to set in <filename>user.js</filename>
    '';
    extraConfig = mkOpt' lines "" ''
      Extra lines to add to <filename>user.js</filename>
    '';

    userChrome  = mkOpt' lines "" "CSS Styles for Librewolf's interface";
    userContent = mkOpt' lines "" "Global CSS Styles for websites";

    # TODO
    # profiles = attrsOf (submodule ({ config, ... }: {
    #   options = {
    #     name = mkOpt str config._module.args.name;
    #     default = mkOpt bool false;
    #     settings = mkOpt' (attrsOf (oneOf [ bool int str ])) {} ''
    #       Librewolf preferences to set in <filename>user.js</filename>
    #     '';
    #     extraConfig = mkOpt' lines "" ''
    #       Extra lines to add to <filename>user.js</filename>
    #     '';
    #     userChrome  = mkOpt' lines "" "CSS Styles for Librewolf's interface";
    #     userContent = mkOpt' lines "" "Global CSS Styles for websites";
    #   };
    # }));
  };

  config = mkIf cfg.enable {
    programs.firefox = {
      enable = true;
      package = pkgs.unstable.librewolf;
      # nativeMessagingHosts.packages = with pkgs; [
      #   tridactyl-native
      # ];
      policies = {
        DontCheckDefaultBrowser = true;
        DisablePocket = true;
        DisableAppUpdate = true;
      };
    };

    user.packages = with pkgs; with hey.lib.pkgs; [
      # Obey XDG, damn it!
      (writeShellScriptBin "librewolf" ''
        export HOME="$XDG_FAKE_HOME"
        exec "${config.programs.firefox.package}/bin/librewolf" "$@"
      '')
    ];

    # Treat LibreWolf as our default PDF reader
    xdg.mime.defaultApplications = {
      "application/pdf" = "LibreWolf.desktop";
    };

    modules.desktop.browsers.librewolf.settings = {
      # Allow svgs to take on theme colors
      "svg.context-properties.content.enabled" = true;
      # Pressing TAB from address bar shouldn't cycle through buttons before
      # switching focus back to the webppage. Most of those buttons have
      # dedicated shortcuts, so I don't need this level of tabstop granularity.
      "browser.toolbars.keyboard_navigation" = false;

      # Seriously. Stop popping up on every damn page. If I want it translated,
      # I know where to find gtranslate/deepl/whatever!
      "browser.translations.automaticallyPopup" = false;
      # Enable ETP for decent security (makes firefox containers and many
      # common security/privacy add-ons redundant).
      "browser.contentblocking.category" = "strict";
      "privacy.donottrackheader.enabled" = true;
      "privacy.donottrackheader.value" = 1;
      "privacy.purge_trackers.enabled" = true;
      # Your customized toolbar settings are stored in
      # 'browser.uiCustomization.state'. This tells firefox to sync it between
      # machines. WARNING: This may not work across OSes. Since I use NixOS on
      # all the machines I use Firefox on, this is no concern to me.
      "services.sync.prefs.sync.browser.uiCustomization.state" = true;
      # Enable userContent.css and userChrome.css for our theme modules
      "toolkit.legacyUserProfileCustomizations.stylesheets" = true;
      # Stop creating ~/Downloads!
      "browser.download.dir" = "${config.user.home}/downloads";
      # Don't use the built-in password manager. A nixos user is more likely
      # using an external one (you are using one, right?).
      "signon.rememberSignons" = false;
      # Do not check if Firefox is the default browser
      "browser.shell.checkDefaultBrowser" = false;
      # Disable the "new tab page" feature and show a blank tab instead
      # https://wiki.mozilla.org/Privacy/Reviews/New_Tab
      # https://support.mozilla.org/en-US/kb/new-tab-page-show-hide-and-customize-top-sites#w_how-do-i-turn-the-new-tab-page-off
      "browser.newtabpage.enabled" = false;
      "browser.newtab.url" = "about:blank";
      # Disable Activity Stream
      # https://wiki.mozilla.org/Firefox/Activity_Stream
      "browser.newtabpage.activity-stream.enabled" = false;
      "browser.newtabpage.activity-stream.telemetry" = false;
      # Disable new tab tile ads & preload
      # http://www.thewindowsclub.com/disable-remove-ad-tiles-from-firefox
      # http://forums.mozillazine.org/viewtopic.php?p=13876331#p13876331
      # https://wiki.mozilla.org/Tiles/Technical_Documentation#Ping
      # https://gecko.readthedocs.org/en/latest/browser/browser/DirectoryLinksProvider.html#browser-newtabpage-directory-source
      # https://gecko.readthedocs.org/en/latest/browser/browser/DirectoryLinksProvider.html#browser-newtabpage-directory-ping
      "browser.newtabpage.enhanced" = false;
      "browser.newtabpage.introShown" = true;
      "browser.newtab.preload" = false;
      "browser.newtabpage.directory.ping" = "";
      "browser.newtabpage.directory.source" = "data:text/plain,{}";
      # Reduce search engine noise in the urlbar's completion window. The
      # shortcuts and suggestions will still work, but Firefox won't clutter
      # its UI with reminders that they exist.
      "browser.urlbar.suggest.searches" = false;
      "browser.urlbar.shortcuts.bookmarks" = false;
      "browser.urlbar.shortcuts.history" = false;
      "browser.urlbar.shortcuts.tabs" = false;
      "browser.urlbar.showSearchSuggestionsFirst" = false;
      "browser.urlbar.speculativeConnect.enabled" = false;
      # Since FF 113, you must press TAB twice to cycle through urlbar
      # suggestions. This disables that.
      "browser.urlbar.resultMenu.keyboardAccessible" = false;
      # https://bugzilla.mozilla.org/1642623
      "browser.urlbar.dnsResolveSingleWordsAfterSearch" = 0;
      # https://blog.mozilla.org/data/2021/09/15/data-and-firefox-suggest/
      "browser.urlbar.suggest.quicksuggest.nonsponsored" = false;
      "browser.urlbar.suggest.quicksuggest.sponsored" = false;
      # Show whole URL in address bar
      "browser.urlbar.trimURLs" = false;
      # Disable some not so useful functionality.
      "browser.disableResetPrompt" = true;       # "Looks like you haven't started Firefox in a while."
      "browser.onboarding.enabled" = false;      # "New to Firefox? Let's get started!" tour
      "browser.aboutConfig.showWarning" = false; # Warning when opening about:config
      "media.videocontrols.picture-in-picture.video-toggle.enabled" = false;
      "extensions.pocket.enabled" = false;
      "extensions.unifiedExtensions.enabled" = false;
      "extensions.shield-recipe-client.enabled" = false;
      "reader.parse-on-load.enabled" = false;  # "reader view"

      # Security-oriented defaults
      "security.family_safety.mode" = 0;
      # https://blog.mozilla.org/security/2016/10/18/phasing-out-sha-1-on-the-public-web/
      "security.pki.sha1_enforcement_level" = 1;
      # https://github.com/tlswg/tls13-spec/issues/1001
      "security.tls.enable_0rtt_data" = false;
      # Use Mozilla geolocation service instead of Google if given permission
      "geo.provider.network.url" = "https://location.services.mozilla.com/v1/geolocate?key=%MOZILLA_API_KEY%";
      "geo.provider.use_gpsd" = false;
      # https://support.mozilla.org/en-US/kb/extension-recommendations
      "browser.newtabpage.activity-stream.asrouter.userprefs.cfr" = false;
      "browser.newtabpage.activity-stream.asrouter.userprefs.cfr.addons" = false;
      "browser.newtabpage.activity-stream.asrouter.userprefs.cfr.features" = false;
      "extensions.htmlaboutaddons.recommendations.enabled" = false;
      "extensions.htmlaboutaddons.discover.enabled" = false;
      "extensions.getAddons.showPane" = false;  # uses Google Analytics
      "browser.discovery.enabled" = false;
      # Reduce File IO / SSD abuse
      # Otherwise, Firefox bombards the HD with writes. Not so nice for SSDs.
      # This forces it to write every 30 minutes, rather than 15 seconds.
      "browser.sessionstore.interval" = "1800000";
      # Disable battery API
      # https://developer.mozilla.org/en-US/docs/Web/API/BatteryManager
      # https://bugzilla.mozilla.org/show_bug.cgi?id=1313580
      "dom.battery.enabled" = false;
      # Disable "beacon" asynchronous HTTP transfers (used for analytics)
      # https://developer.mozilla.org/en-US/docs/Web/API/navigator.sendBeacon
      "beacon.enabled" = false;
      # Disable pinging URIs specified in HTML <a> ping= attributes
      # http://kb.mozillazine.org/Browser.send_pings
      "browser.send_pings" = false;
      # Disable gamepad API to prevent USB device enumeration
      # https://www.w3.org/TR/gamepad/
      # https://trac.torproject.org/projects/tor/ticket/13023
      "dom.gamepad.enabled" = false;
      # Don't try to guess domain names when entering an invalid domain name in URL bar
      # http://www-archive.mozilla.org/docs/end-user/domain-guessing.html
      "browser.fixup.alternate.enabled" = false;
      # Disable telemetry
      # https://wiki.mozilla.org/Platform/Features/Telemetry
      # https://wiki.mozilla.org/Privacy/Reviews/Telemetry
      # https://wiki.mozilla.org/Telemetry
      # https://www.mozilla.org/en-US/legal/privacy/firefox.html#telemetry
      # https://support.mozilla.org/t5/Firefox-crashes/Mozilla-Crash-Reporter/ta-p/1715
      # https://wiki.mozilla.org/Security/Reviews/Firefox6/ReviewNotes/telemetry
      # https://gecko.readthedocs.io/en/latest/browser/experiments/experiments/manifest.html
      # https://wiki.mozilla.org/Telemetry/Experiments
      # https://support.mozilla.org/en-US/questions/1197144
      # https://firefox-source-docs.mozilla.org/toolkit/components/telemetry/telemetry/internals/preferences.html#id1
      "toolkit.telemetry.unified" = false;
      "toolkit.telemetry.enabled" = false;
      "toolkit.telemetry.server" = "data:,";
      "toolkit.telemetry.archive.enabled" = false;
      "toolkit.telemetry.coverage.opt-out" = true;
      "toolkit.coverage.opt-out" = true;
      "toolkit.coverage.endpoint.base" = "";
      "experiments.supported" = false;
      "experiments.enabled" = false;
      "experiments.manifest.uri" = "";
      "browser.ping-centre.telemetry" = false;
      # https://mozilla.github.io/normandy/
      "app.normandy.enabled" = false;
      "app.normandy.api_url" = "";
      "app.shield.optoutstudies.enabled" = false;
      # Disable health reports (basically more telemetry)
      # https://support.mozilla.org/en-US/kb/firefox-health-report-understand-your-browser-perf
      # https://gecko.readthedocs.org/en/latest/toolkit/components/telemetry/telemetry/preferences.html
      "datareporting.healthreport.uploadEnabled" = false;
      "datareporting.healthreport.service.enabled" = false;
      "datareporting.policy.dataSubmissionEnabled" = false;

      # Disable crash reports
      "breakpad.reportURL" = "";
      "browser.tabs.crashReporting.sendReport" = false;
      "browser.crashReports.unsubmittedCheck.autoSubmit2" = false;  # don't submit backlogged reports

      # Disable Form autofill
      # https://wiki.mozilla.org/Firefox/Features/Form_Autofill
      "browser.formfill.enable" = false;
      "extensions.formautofill.addresses.enabled" = false;
      "extensions.formautofill.available" = "off";
      "extensions.formautofill.creditCards.available" = false;
      "extensions.formautofill.creditCards.enabled" = false;
      "extensions.formautofill.heuristics.enabled" = false;
    };

    home =
      let localDir = "${config.home.fakeDir}/.librewolf";
      in {
        # configFile."tridactyl" = {
        #   source = "${hey.configDir}/tridactyl";
        #   recursive = true;
        # };

        # programs.firefox.nativeMessagingHosts.tridactyl doesn't seem to be
        # enough, so install the native messenger manually.
        # fakeFile.".mozilla/native-messaging-hosts/tridactyl.json".source =
        #   let version = "0.3.6";
        #       manifestURL = "https://raw.githubusercontent.com/tridactyl/native_messenger/${version}/tridactyl.json";
        #       manifest = pkgs.runCommand "generateTridactylManifest" {} ''
        #       cp "${builtins.fetchurl manifestURL}" "$out"
        #       sed -i.bak "s%REPLACE_ME_WITH_SED%${tridactyl-native}%" "$out"
        #     '';
        #   in "${pkgs.tridactyl-native}/lib/mozilla/native-messaging-hosts/tridactyl.json";

        # Use fixed profile name so it can be targeted in themes and scripts
        file."${localDir}/profiles.ini".text = ''
          [Profile0]
          Name=default
          IsRelative=1
          Path=${cfg.profileName}.default
          Default=1

          [General]
          StartWithLastProfile=1
          Version=2
        '';

        file."${localDir}/${cfg.profileName}.default/user.js" =
          mkIf (cfg.settings != {} || cfg.extraConfig != "") {
            text = ''
              ${concatStrings (mapAttrsToList (name: value: ''
                user_pref("${name}", ${builtins.toJSON value});
              '') cfg.settings)}
              ${cfg.extraConfig}
            '';
          };

        file."${localDir}/${cfg.profileName}.default/chrome/userChrome.css" =
          mkIf (cfg.userChrome != "") { text = cfg.userChrome; };

        file."${localDir}/${cfg.profileName}.default/chrome/userContent.css" =
          mkIf (cfg.userContent != "") { text = cfg.userContent; };
      };
  };
}
</file>

<file path="modules/desktop/media/cad.nix">
# modules/desktop/media/cad.nix --- for 3D modeling & design
#
# For game art assets, interior design, and product demos for clients.

{ hey, lib, config, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop.media.cad;
    version = "4.1";
in {
  options.modules.desktop.media.cad = with types; {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    # Supplies newer versions of Blender with CUDA support baked in.
    # @see https://github.com/edolstra/nix-warez/tree/master/blender
    nixpkgs.overlays = [ hey.inputs.blender-bin.overlays.default ];

    user.packages = [
      (if config.modules.desktop.type == "wayland"
       then pkgs.freecad-wayland
       else pkgs.freecad)

      # Blender itself doesn't need libxcrypt-legacy, but I use blenderkit,
      # which needs libcrypt.so.1, which libxcrypt no longer provides.
      (mkWrapper pkgs."blender_${builtins.replaceStrings ["."] ["_"] version}" ''
        wrapProgram "$out/bin/blender" \
          --run 'export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:${pkgs.libxcrypt-legacy}/lib"'
      '')
    ];

    home.configFile = {
      # "blender/${version}/config" = {
      #   source = "${hey.configDir}/blender/config";
      #   recursive = true;
      # };
      # "blender/${version}/scripts" = {
      #   source = "${hey.configDir}/blender/scripts";
      #   recursive = true;
      # };
    };

    # I copy these files manually because they should be mutable, as Blender is
    # very stateful. Having a consistent starting point for new systems is good
    # enough for me.
    system.userActivationScripts.setupBlenderConfig = ''
      destdir="$XDG_CONFIG_HOME/blender/${version}/config"
      mkdir -p "$destdir"
      for cfile in ${hey.configDir}/blender/config/*; do
        basename="$(basename $cfile)"
        dest="$destdir/$basename"
        if [ ! -e "$dest" ]; then
          cp "$cfile" "$dest"
        fi
      done
      for bfile in startup userpref; do
        src="${hey.configDir}/blender/$bfile.blend.tar.gz"
        if [ ! -e "$destdir/$bfile.blend" ]; then
          ${pkgs.gnutar}/bin/tar xzvf "$src" -C "$destdir"
        fi
      done
    '';
  };
}
</file>

<file path="modules/desktop/media/daw.nix">
# modules/desktop/media/daw.nix
#
# I make games on my spare time (and occasionally edit audio for videos). These
# need music and sound effects. In the past, I've used Apple Logic, Fruityloops,
# and Adobe Audition. To replace them on Linux, I use Reaper.

{ hey, lib, config, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop.media.daw;
in {
  options.modules.desktop.media.daw = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    environment.variables = let
      makePluginPath = format:
        (makeSearchPath format [
          "$HOME/.nix-profile/lib"
          "/run/current-system/sw/lib"
          "/etc/profiles/per-user/$USER/lib"
        ]) + ":$HOME/.config/${format}";
    in {
      DSSI_PATH   = makePluginPath "dssi";
      LADSPA_PATH = makePluginPath "ladspa";
      LV2_PATH    = makePluginPath "lv2";
      LXVST_PATH  = makePluginPath "lxvst";
      VST_PATH    = makePluginPath "vst";
      VST3_PATH   = makePluginPath "vst3";
    };

    services.pipewire.jack.enable = true;

    user.packages = with pkgs; [
      unstable.reaper
      # ardour      # My DAW for recording
      # audacity    # For one-off audio editing
      # sunvox      # For chiptune

      # LMMS creates .lmmsrc.xml in $HOME on launch (see LMMS/lmms#5869).
      # Jailing it has the side-effect of rooting all file dialogs in the fake
      # home, but this is easily worked around by adding proper shortcuts.
      # (mkWrapper lmms ''
      #   wrapProgram "$out/bin/lmms" \
      #     --run 'cfgdir="$XDG_CONFIG_HOME/lmms"' \
      #     --run 'mkdir -p "$cfgdir"' \
      #     --add-flags '-c "$cfgdir/rc.xml"'
      # '')
    ];
  };
}
</file>

<file path="modules/desktop/media/graphics.nix">
# modules/desktop/media/graphics.nix
#
# I use almost every app in the Adobe suite, both professionally and personally.
# Sacrificing them was the hardest (and most liberating) part of my switch to
# Linux more than a decade ago. For much of that time I've maintained a
# dedicated Windows PC for it, but within the past few years (2021/2022), its
# alternatives have finally (in my opinion) become viable enough for me to drop
# the second PC.

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop.media.graphics;
in {
  options.modules.desktop.media.graphics = {
    enable         = mkBoolOpt false;
    tools.enable   = mkBoolOpt true;
    raster.enable  = mkBoolOpt true;
    vector.enable  = mkBoolOpt true;
    sprites.enable = mkBoolOpt true;
    design.enable  = mkBoolOpt true;
  };

  config = mkIf cfg.enable {
    user.packages = with pkgs;
      # CLI/scripting tools
      (optionals cfg.tools.enable [
        imagemagick
        # Optimizers
        # LOSSLESS   LOSSY
        optipng      pngquant
        jpegoptim    libjpeg  # (jpegtran)
                     gifsicle
      ]) ++

      # Replaces Illustrator (maybe indesign?)
      (optionals cfg.vector.enable [
        unstable.inkscape
      ]) ++

      # Replaces Photoshop
      (optionals cfg.raster.enable [
        (unstable.gimp3-with-plugins.override {
          plugins = with unstable.gimp3Plugins; [
            # bimp            # batch image manipulation
            # resynthesizer   # content-aware scaling in gimp
            gmic            # an assortment of extra filters
          ];
        })
        unstable.krita   # But Krita is better for digital illustration
      ]) ++

      # Sprite sheets & animation
      (optionals cfg.sprites.enable [
        unstable.aseprite-unfree
      ]) ++

      # Replaces Adobe XD (or Sketch)
      (optionals cfg.design.enable [
        (if config.modules.desktop.type == "wayland"
         then figma-linux.overrideAttrs (final: prev: {
           postFixup = ''
             substituteInPlace $out/share/applications/figma-linux.desktop \
               --replace "Exec=/opt/figma-linux/figma-linux" \
                         "Exec=$out/bin/${final.pname} --enable-features=UseOzonePlatform \
                                                       --ozone-platform=wayland \
                                                       --enable-vulkan \
                                                       --enable-gpu-rasterization \
                                                       --enable-oop-rasterization \
                                                       --enable-gpu-compositing \
                                                       --enable-accelerated-2d-canvas \
                                                       --enable-zero-copy \
                                                       --canvas-oop-rasterization \
                                                       --disable-features=UseChromeOSDirectVideoDecoder \
                                                       --enable-accelerated-video-decode \
                                                       --enable-accelerated-video-encode \
                                                       --enable-features=VaapiVideoDecoder,VaapiVideoEncoder,VaapiIgnoreDriverChecks,RawDraw,Vulkan \
                                                       --enable-hardware-overlays \
                                                       --enable-unsafe-webgpu"
           '';
         })
         else figma-linux)
      ]);

    # home.configFile = mkIf cfg.raster.enable {
    #   "GIMP/3.0" = {
    #     source = "${hey.configDir}/gimp";
    #     recursive = true;
    #   };
    #   # TODO Inkscape dotfiles
    # };
  };
}
</file>

<file path="modules/desktop/media/music.nix">
{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop.media.music;
in {
  options.modules.desktop.media.music = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    user.packages = with pkgs; [
      (ncmpcpp.override { visualizerSupport = true; })
      beets    # library management
      yt-dlp
      mpc
    ];

    environment.variables.NCMPCPP_HOME = "$XDG_CONFIG_HOME/ncmpcpp";

    home.configFile = {
      "beets" = {
        source = "${hey.configDir}/beets";
        recursive = true;
      };
      "ncmpcpp" = {
        source    = "${hey.configDir}/ncmpcpp";
        recursive = true;
      };
    };
  };
}
</file>

<file path="modules/desktop/media/video.nix">
# modules/desktop/media/video.nix --- the pictures. They move.
#
# For all things video. Video playback, (en|de)coding, and editing.  OBS to
# capture footage/stream, audacity for audio, handbrake/ffmpeg to encode it all.
# This, paired with DaVinci Resolve for video editing and I'm set for the
# occasional gameplay, instructional, or product demo video.

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop.media.video;
in {
  options.modules.desktop.media.video = {
    enable = mkBoolOpt false;
    capture.enable = mkBoolOpt false;
    editor.enable = mkBoolOpt false;
    player.enable = mkBoolOpt true;
    tools.enable = mkBoolOpt true;
  };

  config = mkIf cfg.enable (mkMerge [
    (mkIf cfg.capture.enable {
      user.packages = with pkgs; [
        obs-studio  # For streaming/recording footage
      ];
    })

    (mkIf cfg.editor.enable {
      user.packages = with pkgs; [
        davinci-resolve  # For editing it
      ];
    })

    (mkIf cfg.player.enable {
      user.packages = with pkgs; [
        mpv
        mpvc  # CLI controller for mpv
      ];

      # Use hardware decoding, if available
      home.configFile."mpv/mpv.conf".text = ''
        hwdec=auto
      '';
    })

    (mkIf cfg.tools.enable {
      user.packages = with pkgs; [
        # Tools for (en|de)coding.
        ffmpeg-full     # ...in the CLI
        # handbrake     # ...for the GUI
      ];
    })
  ]);
}
</file>

<file path="modules/desktop/term/default.nix">
{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop.term;
in {
  options.modules.desktop.term = {
    default = mkOpt types.str "xterm";
  };

  config = {
    services.xserver.desktopManager.xterm.enable = mkDefault (cfg.default == "xterm");

    environment.sessionVariables.TERMINAL = cfg.default;
  };
}
</file>

<file path="modules/desktop/term/foot.nix">
# modules/desktop/term/foot.nix
#
# TODO

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop.term.foot;
in {
  options.modules.desktop.term.foot = with types; {
    enable = mkBoolOpt false;
    settings = mkOpt (attrsOf attrs) {};
  };

  config = mkIf cfg.enable {
    user.packages = with pkgs; [
      foot
      libsixel  # image support in foot
    ];

    modules.shell.tmux.term = mkForce "foot";

    home.configFile = {
      "foot/foot.ini".text = ''
        # config/foot/foot.ini
        # This was automatically generated by NixOS and my dotfiles
        include=${config.home.configDir}/foot/foot.global.ini
        include=${config.home.configDir}/foot/foot.local.ini
      '';
      "foot/foot.global.ini".source = "${hey.configDir}/foot/foot.ini";
      "foot/foot.local.ini".text = generators.toINI {} cfg.settings;
    };
  };
}
</file>

<file path="modules/desktop/term/st.nix">
# modules/desktop/term/st.nix
#
# I like (x)st. This appears to be a controversial opinion; don't tell anyone,
# mkay?

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop.term.st;
in {
  options.modules.desktop.term.st = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    user.packages = with pkgs; [
      xst  # st + nice-to-have extensions
      (mkLauncherEntry "Suckless Terminal" {
        description = "Open default terminal application";
        icon = "utilities-terminal";
        exec = "${xst}/bin/xst";
        categories = [ "Development" "System" "Utility" ];
      })
    ];

    # xst-256color isn't supported over ssh, so revert to a known one
    modules.shell.tmux.term = mkForce "xterm-256color";
  };
}
</file>

<file path="modules/desktop/bspwm.nix">
## modules/desktop/bspwm.nix
#
# Sets up a BSPWM-based desktop environment.
#
# TODO: Replace maim/slop with flameshot
# TODO: Need hey .osd analog
# TODO: Need hey.info support
# TODO: Need hey.hooks support
# TODO: Need hey hook startup analog
# TODO: Need hey hook reload analog
# TODO: Need monitors options

{ hey, heyBin, lib, options, config, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop.bspwm;
in {
  options.modules.desktop.bspwm = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    modules.desktop.type = "x11";

    modules.services.dunst.enable = true;

    environment.systemPackages = with pkgs; [
      lightdm
      (polybar.override {
        pulseSupport = true;
        nlSupport = true;
      })
    ];

    services = {
      picom.enable = true;
      redshift.enable = true;
      displayManager.defaultSession = "none+bspwm";
      xserver = {
        enable = true;
        displayManager = {
          lightdm.enable = true;
          lightdm.greeters.mini.enable = true;
          sessionCommands = ''${heyBin} hook startup'';
        };
        windowManager.bspwm.enable = true;
      };
    };

    # Set wallpaper according to modules.theme.wallpapers
    hey.hooks = rec {
      # TODO: Wallpaper setter
      # Set the wallpaper ourselves so we don't need .background-image and/or
      # .fehbg polluting $HOME
      # startup."10-wallpaper" = ''
      #   ${concatStringsSep "\n"
      #     (mapAttrsToList
      #       (output: w: ''
      #         local wallpaper="${w.path}"
      #         if [[ -f "$wallpaper" ]]; then
      #           ${pkgs.feh}/bin/feh --bg-${w.mode} --no-fehbg "$wallpaper"
      #         fi
      #       '')
      #       cfg.wallpapers)}

      #   pgrep -x feh >/dev/null && sleep 0.5
      # '';

      # reload."10-wallpaper" = startup."10-wallpaper";
    };

    # link recursively so other modules can link files in their folders
    home.configFile = {
      "sxhkd" = {
        source = "${hey.configDir}/sxhkd";
        recursive = true;
      };
      "bspwm" = {
        source = "${hey.configDir}/bspwm";
        recursive = true;
      };
    };
  };
}
</file>

<file path="modules/desktop/default.nix">
{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop;
in {
  options.modules.desktop = {
    type = with types; mkOpt (nullOr str) null;
  };

  config = mkMerge [
    {
      assertions =
        let isEnabled = _: v: v.enable or false;
            hasDesktopEnabled = cfg:
              (anyAttrs isEnabled cfg)
              || !(anyAttrs (_: v: isAttrs v && anyAttrs isEnabled v) cfg);
        in [
          {
            assertion = (countAttrs isEnabled cfg) < 2;
            message = "Can't have more than one desktop environment enabled at a time";
          }
          {
            assertion = hasDesktopEnabled cfg;
            message = "Can't enable a desktop sub-module without a desktop environment";
          }
          {
            assertion = cfg.type != null || !(anyAttrs isEnabled cfg);
            message = "Downstream desktop module did not set modules.desktop.type";
          }
        ];

      hey.info.desktop.type = cfg.type;
    }

    (mkIf (cfg.type != null) {
      fonts = {
        fontDir.enable = true;
        enableGhostscriptFonts = true;
        packages = with pkgs; [
          ubuntu_font_family
          dejavu_fonts
          symbola
        ];
      };

      environment.systemPackages = with pkgs; [
        libnotify  # notify-send
        xdg-utils
        sox        # for `play` utility
      ];
    })

    (mkIf (cfg.type == "wayland") {
      user.packages = with pkgs.unstable; [
        # Program     Substitutes for
        ripdrag       # xdragon
        wev           # xev
        wl-clipboard  # xclip
        wtype         # xdotool (sorta)
        swappy        # swappy/Snappy/sharex
        slurp         # slop
        swayimg       # feh (as an image previewer)
        imv
      ];

      # Improves latency and reduces stuttering in high load scenarios
      security.pam.loginLimits = [
        { domain = "@users"; item = "rtprio"; type = "-"; value = 1; }
      ];
    })

    (mkIf (cfg.type == "x11") {
      environment.sessionVariables.QT_QPA_PLATFORMTHEME = "gnome";

      # Try really hard to get QT to respect my GTK theme.
      # environment.sessionVariables.GTK_DATA_PREFIX = [ "${config.system.path}" ];
      # environment.sessionVariables.QT_STYLE_OVERRIDE = "kvantum";

      user.packages = with pkgs; [
        feh       # image viewer
        xdragon   # drag'n'drop from the terminal
        xclip
        xdotool
        xorg.xwininfo
        qgnomeplatform        # QPlatformTheme for a better Qt application inclusion in GNOME
        libsForQt5.qtstyleplugin-kvantum # SVG-based Qt5 theme engine plus a config tool and extra theme
      ];

      ## Apps/Services
      services.xserver.displayManager.lightdm.greeters.mini.user = config.user.name;

      services.picom = {
        backend = "glx";
        vSync = true;
        opacityRules = [
          "100:_NET_WM_STATE@:32a = '_NET_WM_STATE_FULLSCREEN'"
          "0:_NET_WM_STATE@:32a *= '_NET_WM_STATE_HIDDEN'"
          "0:_NET_WM_STATE@[0]:32a *= '_NET_WM_STATE_HIDDEN'"
          "0:_NET_WM_STATE@[1]:32a *= '_NET_WM_STATE_HIDDEN'"
          "0:_NET_WM_STATE@[2]:32a *= '_NET_WM_STATE_HIDDEN'"
          "0:_NET_WM_STATE@[3]:32a *= '_NET_WM_STATE_HIDDEN'"
          "0:_NET_WM_STATE@[4]:32a *= '_NET_WM_STATE_HIDDEN'"
          "98:class_g = 'xst-256color'"
          "90:class_g = 'xst-scratch'"
        ];
        shadowExclude = [
          # Put shadows on notifications, the scratch popup and rofi only
          "! class_g~='(Rofi|xst-scratch|Dunst)$'"
        ];
        settings = {
          blur-background-exclude = [
            "window_type = 'dock'"
            "window_type = 'desktop'"
            "class_g = 'Rofi'"
            "_GTK_FRAME_EXTENTS@:c"
          ];

          # Unredirect all windows if a full-screen opaque window is detected,
          # to maximize performance for full-screen windows. Known to cause
          # flickering when redirecting/unredirecting windows.
          unredir-if-possible = true;

          # GLX backend: Avoid using stencil buffer, useful if you don't have a
          # stencil buffer. Might cause incorrect opacity when rendering
          # transparent content (but never practically happened) and may not
          # work with blur-background. My tests show a 15% performance boost.
          # Recommended.
          glx-no-stencil = true;

          # Use X Sync fence to sync clients' draw calls, to make sure all draw
          # calls are finished before picom starts drawing. Needed on
          # nvidia-drivers with GLX backend for some users.
          xrender-sync-fence = true;
        };
      };
    })
  ];
}
</file>

<file path="modules/desktop/hyprland.nix">
## modules/desktop/hyprland.nix
#
# Sets up a hyprland-based desktop environment.

{ hey, heyBin, lib, options, config, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.desktop.hyprland;
    primaryMonitor = findFirst (x: x.primary) {} cfg.monitors;
in {
  options.modules.desktop.hyprland = with types; {
    enable = mkBoolOpt false;
    extraConfig = mkOpt lines "";
    monitors = mkOpt (listOf (submodule {
      options = {
        output = mkOpt str "";
        mode = mkOpt str "preferred";
        position = mkOpt str "auto";
        scale = mkOpt int 1;
        disable = mkOpt bool false;
        primary = mkOpt bool false;
      };
    })) [{}];

    mako.settings = mkOpt attrs {};

    hyprlock = {
      settings = mkOpt (submodule {
        options = {
          general = mkOpt attrs {};
          input-field = mkOpt attrs {};
          backgrounds = mkOpt (listOf attrs) [];
          labels = mkOpt (listOf attrs) [];
          images = mkOpt (listOf attrs) [];
          shapes = mkOpt (listOf attrs) [];
        };
      }) {};
    };

    idle = {
      time = mkOpt int 600;       # 10 min
      autodpms = mkOpt int 1200;   # 20 min
      autolock = mkOpt int 2400;  # 40 min
      autosleep = mkOpt int 0;
    };
  };

  config = mkIf cfg.enable {
    modules.desktop.type = "wayland";

    environment.sessionVariables = {
      ELECTRON_OZONE_PLATFORM_HINT = "auto";
      NIXOS_OZONE_WL = "1";
      MOZ_ENABLE_WAYLAND = "1";
    };

    # Hyprland's aquamarine requires newer MESA drivers.
    hardware.graphics = {
      package = pkgs.unstable.mesa;
      package32 = pkgs.unstable.pkgsi686Linux.mesa;
    };

    programs.hyprland = {
      enable = true;
      xwayland.enable = true;
      package = pkgs.unstable.hyprland;
      portalPackage = pkgs.unstable.xdg-desktop-portal-hyprland;

      # package = hey.inputs.hyprland.packages.${final.system}.hyprland;
      # portalPackage = hey.inputs.hyprland.packages.${pkgs.stdenv.hostPlatform.system}.xdg-desktop-portal-hyprland;
    };

    # xdg.portal.configPackages = [ pkgs.xdg-desktop-portal-gtk ];

    modules.services = {
      # Redshift, but for wayland, but I use hyprshade instead, since wlsunset
      # is a bit buggy with nvidia and multiple monitors.
      # wlsunset.enable = true;

      # There's a bug in hypridle that causes hyprlock to not read input after
      # waking up from suspend (hyprwm/hyprlock#101). swayidle doesn't suffer
      # from this issue.
      # hypridle = {
      #   enable = true;
      #   settings = {
      #     before_sleep_cmd = "${heyBin} hook idle --on sleep";
      #     after_sleep_cmd = "${heyBin} hook idle --off sleep";
      #     lock_cmd = "${heyBin} hook idle --on lock";
      #     unlock_cmd = "${heyBin} hook idle --off lock";
      #     ignore_dbus_inhibit = "false";
      #   };
      #   timeouts =
      #     (optionals (cfg.idle.time > 0) [{
      #       timeout = cfg.idle.time;
      #       on-timeout = "${heyBin} hook idle --dim";
      #       on-resume = "${heyBin} hook idle --resume";
      #     }]) ++
      #     (optionals (cfg.idle.autodpms > 0) [{
      #       timeout = cfg.idle.autodpms;
      #       on-timeout = "${heyBin} hook idle --dpms";
      #       on-resume = "${heyBin} hook idle --resume";
      #     }]) ++
      #     (optionals (cfg.idle.autolock > 0) [{
      #       timeout = cfg.idle.autolock;
      #       on-timeout = "${heyBin} hook idle --lock";
      #     }]) ++
      #     (optionals (cfg.idle.autosleep > 0) [{
      #       timeout = cfg.idle.autosleep;
      #       on-timeout = "${heyBin} hook idle --sleep";
      #     }]);
      # };
      swayidle = {
        enable = true;
        events = {
          before-sleep = "${heyBin} hook idle --on sleep";
          after-resume = "${heyBin} hook idle --off sleep";
          lock = "${heyBin} hook idle --on lock";
          unlock = "${heyBin} hook idle --off lock";
        } // (optionalAttrs (cfg.idle.time > 0) {
          idlehint = toString cfg.idle.time;
        });
        timeouts =
          (optionals (cfg.idle.time > 0) [{
            timeout = cfg.idle.time;
            command = "${heyBin} hook idle --on";
            resume = "${heyBin} hook idle --off";
          }]) ++
          (optionals (cfg.idle.autodpms > 0) [{
            timeout = cfg.idle.autodpms;
            command = "${heyBin} hook idle --on dpms";
            resume = "${heyBin} hook idle --off dpms";
          }]) ++
          (optionals (cfg.idle.autolock > 0) [{
            timeout = cfg.idle.autolock;
            command = "loginctl lock-session";
          }]) ++
          (optionals (cfg.idle.autosleep > 0) [{
            timeout = cfg.idle.autosleep;
            command = "systemctl suspend";
          }]);
      };

      waybar = {
        enable = true;
        primaryMonitor = mkDefault (primaryMonitor.output or "");
      };

      # REVIEW: Get rid of this when wtype adds mouse support (atx/wtype#24).
      ydotool.enable = true;
    };

    # Retrieve the latest versions.
    nixpkgs.overlays = [
      # Avoiding the hyprland input overlays to avoid cachix misses (and not
      # setting programs.hyprland.package because other packages, like
      # pkgs.hyprshade, may reference pkgs.hyprland in their derivations).
      # (prev: final: {
      #   hyprland = hey.inputs.hyprland.packages.${final.system}.hyprland;
      # })
      # hey.inputs.hyprlock.overlays.default
      # hey.inputs.hyprpicker.overlays.default
    ];

    environment.systemPackages = with pkgs; [
      hyprlock       # *fast* lock screen
      hyprpicker     # screen-space color picker
      hyprshade      # to apply shaders to the screen
      hyprshot       # instead of grim(shot) or maim/slurp

      ## For Hyprland
      mako           # dunst for wayland
      swaybg         # feh (as a wallpaper manager)
      xorg.xrandr    # for XWayland windows

      ## For CLIs
      gromit-mpx     # for drawing on the screen
      pamixer        # for volume control
      wlr-randr      # for monitors that hyprctl can't handle
      ## Waiting for NixOS/nixpkgs@7249e6c56141 to reach nixos-unstable
      # wf-recorder    # for screencasting
    ];

    systemd.user.targets.hyprland-session = {
      unitConfig = {
        Description = "Hyprland compositor session";
        Documentation = [ "man:systemd.special(7)" ];
        BindsTo = [ "graphical-session.target" ];
        Wants = [ "graphical-session-pre.target" ];
        After = [ "graphical-session-pre.target" ];
      };
    };

    ## Bootloader.
    # I don't use a real login screen. Instead, I activate hyprlock immediately
    # after boot for basic authentication, with a specialized config to make the
    # boot up process smoother. This is enough to stop casual snoopers from
    # getting into my desktops.
    services.greetd = {
      enable = true;
      settings.default_session = {
        command = toString (pkgs.writeShellScript "hyprland-wrapper" ''
          trap 'systemctl --user stop hyprland-session.target; sleep 1' EXIT
          exec Hyprland >/dev/null
        '');
        user = config.user.name;
      };
    };
    environment.etc."greetd/environments".text = "Hyprland";

    hey = {
      info.hypr = {
        primaryMonitor = primaryMonitor.output or null;
        monitors = cfg.monitors;
      };
      hooks = rec {
        # Launch my hyprlock-powered, pseudo-login screen on `hey hook
        # on-startup`.
        startup."05-loginscreen" = ''
          hey.do systemctl --user import-environment \
                 DISPLAY WAYLAND_DISPLAY \
                 XDG_CURRENT_DESKTOP \
                 HYPRLAND_INSTANCE_SIGNATURE
          hey.do hyprlock --immediate
          sleep 0.1
          hey.do systemctl --user start hyprland-session.target
          hey .play-sound startup
        '';

        # I'm using this instead of exec= lines in hyprland.conf so I can ensure
        # these aren't run at startup and sequentially (i.e. predictable order,
        # since Hyprland's exec= calls are parallelized).
        reload."95-hyprland" = ''
          for i in $(hyprctl instances -j | jq -r '.[].instance'); do
            echo "Hyprland: reloading instance $i"
            hey.do hyprctl -i ''${i//*\//} reload config-only
          done
          hey.do makoctl reload
        '';

        # Set wallpaper according to modules.theme.wallpapers
        startup."10-wallpaper" = ''
          ${concatStringsSep "\n"
            (mapAttrsToList
              (output: w: ''
                local wallpaper="${w.path}"
                if [[ -f "$wallpaper" ]]; then
                  hey.do swaybg \
                         -o "${output}" \
                         -i "$wallpaper" \
                         -m ${w.mode or "center"} &
                fi
              '')
              config.modules.theme.wallpapers)}
          pgrep -x swaybg >/dev/null && sleep 0.5
        '';
        reload."10-wallpaper" = startup."10-wallpaper";
      };
    };

    home.configFile = {
      "hypr" = {
        source = "${hey.configDir}/hypr";
        recursive = true;
      };

      "hypr/shaders/screen-dim.glsl".text = ''
        precision highp float;
        varying vec2 v_texcoord;
        uniform sampler2D tex;
        void main() {
          gl_FragColor = texture2D(tex, v_texcoord) * 0.3;
        }
      '';

      "hypr/hyprland.pre.conf".text = ''
        # config/hypr/hyprland.pre.conf
        # This was automatically generated by NixOS and my dotfiles

        # Bootstrap session
        exec-once = hey hook startup

        ${concatStringsSep "\n" (map
          (v: if v.disable
              then "monitor = ${v.output},disable"
              else "monitor = ${v.output},${v.mode},${v.position},${toString v.scale}")
          cfg.monitors)}

        $PRIMARY_MONITOR = ${primaryMonitor.output or ""}
        ${optionalString (primaryMonitor ? output) ''
          cursor {
            default_monitor = $PRIMARY_MONITOR
          }

          workspace=1,monitor:$PRIMARY_MONITOR,default:true,persistent:true
          workspace=2,monitor:$PRIMARY_MONITOR
          workspace=3,monitor:$PRIMARY_MONITOR
          workspace=4,monitor:$PRIMARY_MONITOR
          workspace=5,monitor:$PRIMARY_MONITOR
          workspace=6,monitor:$PRIMARY_MONITOR
          workspace=7,monitor:$PRIMARY_MONITOR
          workspace=8,monitor:$PRIMARY_MONITOR
          workspace=9,monitor:$PRIMARY_MONITOR

          # Since wayland doesn't have the concept of a primary monitor,
          # XWayland windows may start in unpredictbale places without a hint.
          exec-once = xrandr --output $PRIMARY_MONITOR --primary
        ''}
      '';
      "hypr/hyprland.post.conf".text = cfg.extraConfig;

      "hypr/hyprlock.conf".text =
        let toHyprlockINI = n: v: ''
              ${n} {
                ${concatStringsSep "\n"
                  (mapAttrsToList (n: v: "${n} = ${toString v}") v)}
              }
            '';
        in concatStringsSep "\n" (flatten
          (mapAttrsToList
            (n: v: if isAttrs v
                   then toHyprlockINI n v
                   else map (x: toHyprlockINI (removeSuffix "s" n) x) v)
            (mergeAttrs' [
              {
                general = {
                  grace = 3;
                  hide_cursor = "false";
                  disable_loading_bar = "true";
                };
              }
              cfg.hyprlock.settings
            ])));

      "mako/config".text =
        let toINI = mapAttrsToList (n: v: "${n}=${toString v}");
        in ''
          # config/mako/config -*- mode: ini -*-
          # This was automatically generated by NixOS and my dotfiles
          ${concatStringsSep "\n"
            (toINI ({ "output" = (primaryMonitor.output or ""); }
                    // (filterAttrs (_: v: ! isAttrs v) cfg.mako.settings)))}

          ${concatStringsSep "\n"
            (mapAttrsToList
              (n: v: ''
                [${n}]
                ${concatStringsSep "\n" (toINI v)}
              '')
              (filterAttrs (_: v: isAttrs v) cfg.mako.settings))}

          [mode=dnd]
          invisible=1
        '';
    };

    user.packages = with pkgs; [
      (mkLauncherEntry "Toggle blue light filter" {
        icon = "redshift";
        exec = "hyprshade toggle blue-light-filter";
      })
      (mkLauncherEntry "Hyprpicker: grab RGB at point" {
        icon = "com.github.finefindus.eyedropper";
        exec = "hey .picker rgb";
      })
      (mkLauncherEntry "Hyprpicker: grab HSL at point" {
        icon = "com.github.finefindus.eyedropper";
        exec = "hey .picker hsl";
      })
      (mkLauncherEntry "Hyprpicker: grab hex at point" {
        icon = "com.github.finefindus.eyedropper";
        exec = "hey .picker hex";
      })
    ];
  };
}
</file>

<file path="modules/dev/cc.nix">
# modules/dev/cc.nix --- C & C++
#
# I like C. I tolerate C++. I like++ C with a few choice C++ features tacked on.
# Liking C/C++ seems to be an unpopular opinion, so it's my guilty secret.
# Don't tell anyone pls.

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let devCfg = config.modules.dev;
    cfg = devCfg.cc;
in {
  options.modules.dev.cc = {
    enable = mkBoolOpt false;
    xdg.enable = mkBoolOpt devCfg.xdg.enable;
  };

  config = mkMerge [
    (mkIf cfg.enable {
      user.packages = with pkgs; [
        clang
        gcc
        bear
        cmake
        llvmPackages.libcxx

        # Respect XDG, damn it!
        (mkWrapper gdb ''
          wrapProgram "$out/bin/gdb" --add-flags '-q -x "$XDG_CONFIG_HOME/gdb/init"'
        '')
      ];
    })

    (mkIf cfg.xdg.enable {
      # TODO
    })
  ];
}
</file>

<file path="modules/dev/clojure.nix">
# modules/dev/clojure.nix --- https://clojure.org/
#
# I don't use clojure... yet.

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let devCfg = config.modules.dev;
    cfg = devCfg.clojure;
in {
  options.modules.dev.clojure = {
    enable = mkBoolOpt false;
    xdg.enable = mkBoolOpt devCfg.xdg.enable;
  };

  config = mkMerge [
    (mkIf cfg.enable {
      user.packages = with pkgs; [
        clojure
        joker
        leiningen
      ];
    })

    (mkIf cfg.xdg.enable {
      # TODO
    })
  ];
}
</file>

<file path="modules/dev/common-lisp.nix">
# modules/dev/common-lisp.nix --- https://common-lisp.net/
#
# Mostly for the occasional dip into lisp gamedev.

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let devCfg = config.modules.dev;
    cfg = devCfg.common-lisp;
in {
  options.modules.dev.common-lisp = {
    enable = mkBoolOpt false;
    xdg.enable = mkBoolOpt devCfg.xdg.enable;
  };

  config = mkMerge [
    (mkIf cfg.enable {
      user.packages = with pkgs; [
        sbcl
        lispPackages.quicklisp
      ];
    })

    (mkIf cfg.xdg.enable {
      # Moves ~/.sbclrc to ~/.config/sbcl/rc
      environment.etc."sbclrc".text = ''
        (require :asdf)
        (setf db-ext:*userinit-pathname-function*
              (lambda () (uiop:xdg-config-home #P"sbcl/rc")))
      '';
    })
  ];
}
</file>

<file path="modules/dev/default.nix">
{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.dev;
in {
  options.modules.dev = {
    xdg.enable = mkBoolOpt config.modules.xdg.enable;
  };

  config = mkIf cfg.xdg.enable {
    # TODO
  };
}
</file>

<file path="modules/dev/java.nix">
# modules/dev/java.nix --- Poster child for carpal tunnel
#
# TODO

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let devCfg = config.modules.dev;
    cfg = devCfg.java;
in {
  options.modules.dev.java = {
    enable = mkBoolOpt false;
    xdg.enable = mkBoolOpt devCfg.xdg.enable;
  };

  config = mkMerge [
    (mkIf cfg.enable {
      # TODO
    })

    (mkIf cfg.xdg.enable {
      environment.sessionVariables._JAVA_OPTIONS =
        ''-Djava.util.prefs.userRoot=$XDG_CONFIG_HOME/java'';
    })
  ];
}
</file>

<file path="modules/dev/lua.nix">
# modules/dev/lua.nix --- https://www.lua.org/
#
# I use lua for modding or Love2D for rapid gamedev prototyping (when godot is
# overkill and I have the luxury of avoiding JS). I write my Love games in
# fennel to get around some of lua's idiosynchrosies. That said, I install
# love2d on a per-project basis, so this module is rarely enabled.

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let devCfg = config.modules.dev;
    cfg = devCfg.lua;
in {
  options.modules.dev.lua = {
    enable = mkBoolOpt false;
    xdg.enable = mkBoolOpt devCfg.enableXDG;
    love2D.enable = mkBoolOpt false;
    fennel.enable = mkBoolOpt false;
  };

  config = mkMerge [
    (mkIf cfg.enable {
      user.packages = with pkgs; [
        lua
        luajit
        (mkIf cfg.love2D.enable love2d)
        (mkIf cfg.fennel.enable fennel)
      ];
    })

    (mkIf cfg.xdg.enable {
      # The lua ecosystem has great XDG support out of the box, so...
    })
  ];
}
</file>

<file path="modules/dev/node.nix">
# modules/dev/node.nix --- https://nodejs.org/en/
#
# JS is one of those "when it's good, it's alright, when it's bad, it's a
# disaster" languages.

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let devCfg = config.modules.dev;
    cfg = devCfg.node;
    nodePkg = pkgs.nodejs_latest;
in {
  options.modules.dev.node = {
    enable = mkBoolOpt false;
    xdg.enable = mkBoolOpt devCfg.xdg.enable;
  };

  config = mkMerge [
    (mkIf cfg.enable {
      user.packages = [
        nodePkg
        pkgs.yarn
      ];

      # Run locally installed bin-script, e.g. n coffee file.coffee
      environment.shellAliases = {
        n  = "PATH=\"$(${nodePkg}/bin/npm bin):$PATH\"";
        ya = "yarn";
      };

      environment.variables.PATH = [ "$(${pkgs.yarn}/bin/yarn global bin)" ];
    })

    (mkIf cfg.xdg.enable {
      # NPM refuses to adopt XDG conventions upstream, so I enforce it myself.
      environment.variables = {
        NPM_CONFIG_USERCONFIG = "$XDG_CONFIG_HOME/npm/config";
        NPM_CONFIG_CACHE      = "$XDG_CACHE_HOME/npm";
        NPM_CONFIG_PREFIX     = "$XDG_CACHE_HOME/npm";
        NPM_CONFIG_TMP        = "$XDG_RUNTIME_DIR/npm";
        NODE_REPL_HISTORY     = "$XDG_CACHE_HOME/node/repl_history";
      };

      home.configFile."npm/config".text = ''
        cache=''${XDG_CACHE_HOME}/npm
        prefix=''${XDG_DATA_HOME}/npm
        tmp=''${XDG_RUNTIME_DIR}/npm
      '';
    })
  ];
}
</file>

<file path="modules/dev/python.nix">
# modules/dev/python.nix --- https://godotengine.org/
#
# Python's ecosystem repulses me. The list of environment "managers" exhausts
# me. The Py2->3 transition make trainwrecks jealous. But SciPy, NumPy, iPython
# and Jupyter can have my babies. Every single one.

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let devCfg = config.modules.dev;
    cfg = devCfg.python;
in {
  options.modules.dev.python = {
    enable = mkBoolOpt false;
    xdg.enable = mkBoolOpt devCfg.xdg.enable;
  };

  config = mkMerge [
    (mkIf cfg.enable {
      user.packages = with pkgs; [
        python37
        python37Packages.pip
        python37Packages.ipython
        python37Packages.black
        python37Packages.setuptools
        python37Packages.pylint
        python37Packages.poetry
      ];

      environment.shellAliases = {
        py     = "python";
        py2    = "python2";
        py3    = "python3";
        po     = "poetry";
        ipy    = "ipython --no-banner";
        ipylab = "ipython --pylab=qt5 --no-banner";
      };
    })

    (mkIf cfg.xdg.enable {
      environment.variables = {
        # Internal
        PYTHONPYCACHEPREFIX = "$XDG_CACHE_HOME/python";
        PYTHONSTARTUP = "$XDG_CONFIG_HOME/python/pythonrc";
        PYTHONUSERBASE = "$XDG_DATA_HOME/python";
        PYTHON_EGG_CACHE = "$XDG_CACHE_HOME/python-eggs";
        PYTHONHISTFILE = "$XDG_DATA_HOME/python/python_history"; # default value as of >=3.4

        # Tools
        IPYTHONDIR = "$XDG_CONFIG_HOME/ipython";
        JUPYTER_CONFIG_DIR = "$XDG_CONFIG_HOME/jupyter";
        PIP_CONFIG_FILE = "$XDG_CONFIG_HOME/pip/pip.conf";
        PIP_LOG_FILE = "$XDG_STATE_HOME/pip/log";
        PYLINTHOME = "$XDG_DATA_HOME/pylint";
        PYLINTRC = "$XDG_CONFIG_HOME/pylint/pylintrc";
        WORKON_HOME = "$XDG_DATA_HOME/virtualenvs";
      };
    })
  ];
}
</file>

<file path="modules/dev/ruby.nix">
# modules/dev/ruby.nix --- ...
#
# TODO

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let devCfg = config.modules.dev;
    cfg = devCfg.ruby;
in {
  options.modules.dev.ruby = {
    enable = mkBoolOpt false;
    xdg.enable = mkBoolOpt devCfg.xdg.enable;
  };

  config = mkMerge [
    (mkIf cfg.enable {
      user.packages = [ pkgs.ruby_3_2 ];
      environment.shellAliases = {
        rb = "ruby";
      };
    })

    (mkIf cfg.xdg.enable {
      environment.variables = {
        BUNDLE_USER_CACHE = "$XDG_CACHE_HOME/bundle";
        BUNDLE_USER_CONFIG = "$XDG_CONFIG_HOME/bundle";
        BUNDLE_USER_PLUGIN = "$XDG_DATA_HOME/bundle";
      };
    })
  ];
}
</file>

<file path="modules/dev/rust.nix">
# modules/dev/rust.nix --- https://rust-lang.org
#
# Oh Rust. The light of my life, fire of my loins. Years of C++ has conditioned
# me to believe there was no hope left, but the gods have heard us. Sure, you're
# not going to replace C/C++. Sure, your starlight popularity has been
# overblown. Sure, macros aren't namespaced, cargo bypasses crates.io, and there
# is no formal proof of your claims for safety, but who said you have to solve
# all the world's problems to be wonderful?

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let devCfg = config.modules.dev;
    cfg = devCfg.rust;
in {
  options.modules.dev.rust = {
    enable = mkBoolOpt false;
    xdg.enable = mkBoolOpt devCfg.xdg.enable;
  };

  config = mkMerge [
    (mkIf cfg.enable {
      user.packages = [ pkgs.rustup ];
      environment.shellAliases = {
        rs  = "rustc";
        rsp = "rustup";
        ca  = "cargo";
      };
    })

    (mkIf cfg.xdg.enable {
      environment.variables = rec {
        RUSTUP_HOME = "$XDG_DATA_HOME/rustup";
        CARGO_HOME = "$XDG_DATA_HOME/cargo";
        PATH = [ "${CARGO_HOME}/bin" ];
      };
    })
  ];
}
</file>

<file path="modules/dev/scala.nix">
{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let devCfg = config.modules.dev;
    cfg = devCfg.scala;
in {
  options.modules.dev.scala = {
    enable = mkBoolOpt false;
    xdg.enable = mkBoolOpt devCfg.xdg.enable;
  };

  config = mkMerge [
    (mkIf cfg.enable {
      user.packages = with pkgs; [
        scala
        jdk
        sbt
      ];
    })

    (mkIf cfg.xdg.enable {
      # TODO
    })
  ];
}
</file>

<file path="modules/dev/shell.nix">
# modules/dev/shell.nix --- http://zsh.sourceforge.net/
#
# Shell script programmers are strange beasts. Writing programs in a language
# that wasn't intended as a programming language. Alas, it is not for us mere
# mortals to question the will of the ancient ones. If they want shell programs,
# they get shell programs.

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let devCfg = config.modules.dev;
    cfg = devCfg.shell;
in {
  options.modules.dev.shell = {
    enable = mkBoolOpt false;
    xdg.enable = mkBoolOpt devCfg.xdg.enable;
  };

  config = mkMerge [
    (mkIf cfg.enable {
      user.packages = with pkgs; [
        shellcheck
      ];
    })

    (mkIf cfg.xdg.enable {
      # TODO
    })
  ];
}
</file>

<file path="modules/editors/default.nix">
{ hey, lib, config, ... }:

with lib;
with hey.lib;
let cfg = config.modules.editors;
in {
  options.modules.editors = {
    default = mkOpt types.str "vim";
  };

  config = mkIf (cfg.default != null) {
    environment.variables.EDITOR = cfg.default;
  };
}
</file>

<file path="modules/editors/emacs.nix">
# Emacs is my main driver. I'm the author of Doom Emacs
# https://github.com/doomemacs. This module sets it up to meet my particular
# Doomy needs.

{ hey, lib, config, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.editors.emacs;
    emacs = with pkgs; (emacsPackagesFor
      (if config.modules.desktop.type == "wayland"
       then emacs-git-pgtk
       else emacs-git)).emacsWithPackages (epkgs: with epkgs; [
         treesit-grammars.with-all-grammars
         vterm
         mu4e
       ]);
in {
  options.modules.editors.emacs = {
    enable = mkBoolOpt false;
    # doom = rec {
    #   enable = mkBoolOpt false;
    #   forgeUrl = mkOpt types.str "https://github.com";
    #   repoUrl = mkOpt types.str "${forgeUrl}/doomemacs/doomemacs";
    #   configRepoUrl = mkOpt types.str "${forgeUrl}/hlissner/.doom.d";
    # };
  };

  config = mkIf cfg.enable {
    nixpkgs.overlays = [
      hey.inputs.emacs-overlay.overlays.default
    ];

    user.packages = with pkgs; [
      (mkLauncherEntry "Emacs (Debug Mode)" {
        description = "Start Emacs in debug mode";
        icon = "emacs";
        exec = "${emacs}/bin/emacs --debug-init";
      })

      ## Emacs itself
      binutils            # native-comp needs 'as', provided by this
      emacs               # HEAD + native-comp

      ## Doom dependencies
      git
      ripgrep
      gnutls              # for TLS connectivity

      ## Optional dependencies
      fd                  # faster projectile indexing
      imagemagick         # for image-dired
      (mkIf (config.programs.gnupg.agent.enable)
        pinentry-emacs)   # in-emacs gnupg prompts
      zstd                # for undo-fu-session/undo-tree compression

      ## Module dependencies
      # :email mu4e
      mu
      isync
      # :checkers spell
      (aspellWithDicts (ds: with ds; [ en en-computers en-science ]))
      # :tools editorconfig
      editorconfig-core-c # per-project style config
      # :tools lookup & :lang org +roam
      sqlite
      # :lang cc
      clang-tools
      # :lang latex & :lang org (latex previews)
      texlive.combined.scheme-medium
      # :lang beancount
      unstable.beancount
      unstable.beanquery
      unstable.fava
      # :lang nix
      age
    ];

    environment.variables.PATH = [ "$XDG_CONFIG_HOME/emacs/bin" ];

    modules.shell.zsh.rcFiles = [ "${hey.configDir}/emacs/aliases.zsh" ];

    fonts.packages = [ pkgs.nerd-fonts.symbols-only ];
  };
}
</file>

<file path="modules/editors/vim.nix">
# When I'm stuck in the terminal or don't have access to Emacs, (neo)vim is my
# go-to. I am a vimmer at heart, after all.

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.editors.vim;
in {
  options.modules.editors.vim = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    user.packages = with pkgs; [
      editorconfig-core-c
      neovim
    ];

    # This is for non-neovim, so it loads my nvim config
    # env.VIMINIT = "let \\$MYVIMRC='\\$XDG_CONFIG_HOME/nvim/init.vim' | source \\$MYVIMRC";

    environment.shellAliases = {
      vim = "nvim";
      v   = "nvim";
    };
  };
}
</file>

<file path="modules/profiles/hardware/cpu/amd.nix">
# modules/profiles/hardware/cpu/amd.nix

{ hey, lib, config, pkgs, ... }:

with lib;
with hey.lib;
let hardware = config.modules.profiles.hardware;
in mkMerge [
  (mkIf (any (s: hasPrefix "cpu/amd" s) hardware) {
    hardware.cpu.amd.updateMicrocode =
      mkDefault config.hardware.enableRedistributableFirmware;

    boot.kernelParams = [ "amd_pstate=active" ];  # For Linux 6.3+
  })

  (mkIf (elem "cpu/amd/raphael" hardware) {
    # Disables scatter/gather which was introduced with kernel version 6.2,
    # which produce completely white or flashing screens when enabled while
    # using the iGPU of Ryzen 7000-series CPUs (Raphael)
    boot.kernelParams = [ "amdgpu.sg_display=0" ];
  })
]
</file>

<file path="modules/profiles/hardware/cpu/intel.nix">
# modules/profiles/hardware/cpu/intel.nix

{ hey, lib, config, pkgs, ... }:

with lib;
with hey.lib;
let hardware = config.modules.profiles.hardware;
in mkMerge [
  (mkIf (any (s: hasPrefix "cpu/intel" s) hardware) {
    hardware.cpu.intel.updateMicrocode =
      mkDefault config.hardware.enableRedistributableFirmware;
  })

  (mkIf (elem "cpu/intel/sandy-bridge" hardware) {
    # Enables RC6, RC6p and RC6pp.
    # Last two are only available on Sandy Bridge CPUs (circa 2011).
    boot.kernelParams = [ "i915.enable_rc6=7" ];
  })

  (mkIf (elem "cpu/intel/kaby-lake" hardware) {
    boot.kernelParams = [ "i915.enable_fbc=1" "i915.enable_psr=2" ];
  })
]
</file>

<file path="modules/profiles/hardware/gpu/nvidia.nix">
# profiles/hardware/common/gpu/nvidia/default.nix --- lipstick on a pig
#
# I use NVIDIA cards on all my machines, largely because I'm locked into CUDA
# for work reasons. Fortunately, mine aren't too old and are relatively beefy
# (680gtx, 960gtx, 1080, 1660S, 3080ti) so only a little cludge is needed to get
# them to work well on NixOS.

{ hey, lib, config, pkgs, ... }:

with lib;
with hey.lib;
let hardware = config.modules.profiles.hardware;
in mkIf (any (s: hasPrefix "gpu/nvidia" s) hardware) (mkMerge [
  {
    services.xserver.videoDrivers = mkDefault [ "nvidia" ];

    hardware = {
      graphics = {
        enable = true;
        enable32Bit = true;
        extraPackages = [ pkgs.vaapiVdpau ];
      };
      nvidia = {
        # Use the NVidia open source kernel module (not to be confused with the
        # independent third-party "nouveau" open source driver). Support is
        # limited to the Turing and later architectures. Full list of supported
        # GPUs is at:
        # https://github.com/NVIDIA/open-gpu-kernel-modules#compatible-gpus
        # Only available from driver 515.43.04+. Currently alpha-quality/buggy,
        # so false is currently the recommended setting.
        open = mkDefault true;
        # Save some idle watts.
        powerManagement.enable = true;  # see NixOS/nixos-hardware#348
        modesetting.enable = true;
        package = config.boot.kernelPackages.nvidiaPackages.beta;
      };
    };

    # REVIEW: Remove when NixOS/nixpkgs#324921 is backported to stable
    boot.kernelParams = [ "nvidia-drm.fbdev=1" ];

    environment = {
      systemPackages = with pkgs; [
        # Respect XDG conventions, damn it!
        (mkWrapper config.hardware.nvidia.package.settings ''
          wrapProgram "$out/bin/nvidia-settings" \
            --run 'mkdir -p "$XDG_CONFIG_HOME/nvidia"' \
            --append-flags '--config="$XDG_CONFIG_HOME/nvidia/rc.conf"'
        '')

        cudaPackages.cudatoolkit  # required for CUDA support
      ];
      variables = {
        CUDA_PATH = "${pkgs.cudaPackages.cudatoolkit}";
        CUDA_CACHE_PATH = "$XDG_CACHE_HOME/nv";

        # $EXTRA_LDFLAGS and $EXTRA_CCFLAGS are sometimes necessary too, but I
        # set those in nix-shells instead.
      };
    };

    # Cajole Firefox into video-acceleration (or try).
    modules.desktop.browsers.librewolf.settings = {
      "media.ffmpeg.vaapi.enabled" = true;
      "gfx.webrender.enabled" = true;
    };
  }

  (mkIf (elem "gpu/nvidia/kepler" hardware) {
    # Last one supporting Kepler architecture
    hardware.nvidia = {
      open = mkForce false;
      package = mkForce config.boot.kernelPackages.nvidiaPackages.legacy_470;
    };
  })

  (mkIf (elem "gpu/nvidia/turing" hardware) {
    # see NixOS/nixos-hardware#348
    hardware.nvidia = {
      powerManagement.finegrained = true;
      nvidiaPersistenced = true;
    };
  })

  (mkIf (config.modules.desktop.type == "wayland") {
    # see NixOS/nixos-hardware#348
    # TODO: Try these!
    environment.systemPackages = with pkgs; [
      libva
      # Fixes crashes in Electron-based apps?
      # libsForQt5.qt5ct
      # libsForQt5.qt5-wayland
    ];

    environment.sessionVariables = {
      LIBVA_DRIVER_NAME = "nvidia";
      WLR_NO_HARDWARE_CURSORS = "1";

      # May cause Firefox crashes
      GBM_BACKEND = "nvidia-drm";

      # If you face problems with Discord windows not displaying or screen
      # sharing not working in Zoom, remove or comment this:
      __GLX_VENDOR_LIBRARY_NAME = "nvidia";
    };
  })
])
</file>

<file path="modules/profiles/hardware/pc/laptop.nix">
# profiles/hardware/pc/laptop.nix ---
#
# TODO

{ hey, lib, config, pkgs, ... }:

with lib;
with hey.lib;
let hardware = config.modules.profiles.hardware;
in mkMerge [
  (mkIf (any (s: hasPrefix "pc/laptop" s) hardware) {
    user.packages = with pkgs; [
      brightnessctl  # instead of programs.light
      acpi
    ];

    # So the system can respond to power events
    # services.udev.extraRules = ''
    #   SUBSYSTEM=="power_supply",ENV{POWER_SUPPLY_ONLINE}=="0",RUN+="${hey.binDir}/hey hook battery --discharging"
    #   SUBSYSTEM=="power_supply",ENV{POWER_SUPPLY_ONLINE}=="1",RUN+="${hey.binDir}/hey hook battery --charging"
    # '';

    # # And so I can monitor the charge level
    # systemd.user.services.battery_monitor = {
    #   wants = [ "display-manager.service" ];
    #   wantedBy = [ "graphical-session.target" ];
    #   script = ''
    #     export PATH="${pkgs.acpi}/bin:${hey.binDir}:$PATH"
    #     while true; do
    #       IFS=: read _ bat0 < <(acpi -b)
    #       IFS=\ , read status val remaining <<<"$bat0"
    #       local wait=$(hey hook battery --poll "$status" "$${val%\%}" "$remaining")
    #       sleep $${wait:-1m}
    #     done
    #   '';
    # };

    # systemd.user.services.battery_monitor = {
    #   wants = [ "display-manager.service" ];
    #   wantedBy = [ "graphical-session.target" ];
    #   script = ''
    #     prev_val=100
    #     _check () {
    #       [[ $1 -ge $val ]] && [[ $1 -lt $prev_val ]];
    #     }
    #     _notify () {
    #       ${pkgs.libnotify}/bin/notify-send \
    #         --app-name battery \
    #         --hint string:x-dunst-stack-tag:battery \
    #         --hint "int:value:$val" \
    #         "$@" "$val%, $remaining"
    #     }
    #     while true; do
    #       ifs=: read _ bat0 < <(${pkgs.acpi}/bin/acpi -b)
    #       ifs=\ , read status val remaining <<<"$bat0"
    #       val=''${val%\%}
    #       if [[ "x$status" = xdischarging ]]; then
    #         echo "$val%, $remaining"
    #         if _check 30 || _check 15; then
    #           _notify "Battery low"
    #         elif _check 10; then
    #           _notify -u critical "Battery critical"
    #         fi
    #       fi
    #       prev_val=$val
    #       # sleep longer when battery is high to save cpu
    #       if [[ $val -gt 30 ]]; then
    #         sleep 10m
    #       elif [[ $val -ge 20 ]]; then
    #         sleep 5m
    #       else
    #         sleep 1m
    #       fi
    #     done
    #   '';
    # };
  })
]
</file>

<file path="modules/profiles/hardware/wacom/cintiq.nix">
{ hey, lib, options, config, ... }:

with lib;
with hey.lib;
mkIf (elem "wacom/cintiq" config.modules.profiles.hardware) (mkMerge [
  (mkIf (config.modules.desktop.type == "x11") {
    # For my intuos4 pro. Doesn't work for cintiqs.
    services.xserver.wacom.enable = true;

    # system.userActivationScripts.wacom = ''
    #   # lock tablet to main display
    #   if xinput list --id-only "Wacom Intuos Pro S Pen stylus" 2>&1 >/dev/null; then
    #     xinput map-to-output $(xinput list --id-only "Wacom Intuos Pro S Pen stylus") DVI-I-1
    #     xinput map-to-output $(xinput list --id-only "Wacom Intuos Pro S Pen eraser") DVI-I-1
    #     xinput map-to-output $(xinput list --id-only "Wacom Intuos Pro S Pen cursor") DVI-I-1
    #   fi
    # '';
  })

  (mkIf (config.modules.desktop.type == "wayland") {
    # hardware.opentablet.driver.enable = true;
  })

  # REVIEW: Maybe cyber-sushi/makima?
])
</file>

<file path="modules/profiles/hardware/audio.nix">
{ hey, lib, options, config, pkgs, ... }:

with lib;
with hey.lib;
mkMerge [
  (mkIf (any (s: hasPrefix "audio" s) config.modules.profiles.hardware) {
    services.pipewire = {
      enable = true;
      alsa.enable = true;
      alsa.support32Bit = true;
      pulse.enable = true;
    };

    # sound.enable = false;
    security.rtkit.enable = true;
    user.extraGroups = [ "audio" ];

    ## easyEffects
    programs.dconf.enable = true;
    user.packages = with pkgs; [
      alsa-utils  # for CLI utilities
      pavucontrol
      easyeffects
      pulseaudio  # for pactl
      # Not strictly needed, but it silences DBus error noise in journalctl. The
      # error can be ignored, in any case, as easyeffects attachs to the
      # gapplication service.
      at-spi2-core
    ];
    systemd.user.services.easyeffects = {
      wantedBy = [ "graphical-session.target" ];
      unitConfig = {
        Description = "Easyeffects daemon";
        Requires = [ "dbus.service" ];
        After = [ "graphical-session-pre.target" ];
        PartOf = [ "graphical-session.target" "pipewire.service" ];
      };
      serviceConfig = {
        ExecStart = "${pkgs.easyeffects}/bin/easyeffects --gapplication-service";
        ExecStop = "${pkgs.easyeffects}/bin/easyeffects --quit";
        Restart = "on-failure";
        RestartSec = 5;
      };
    };

    # Disable Pulseaudio because Pipewire is used.
    services.pulseaudio.enable = lib.mkForce false;

    # HACK: Prevent ~/.esd_auth files by disabling the esound protocol module
    #   for pulseaudio, which I likely don't need. Is there a better way?
    # services.pulseaudio.configFile =
    #   let inherit (pkgs) runCommand pulseaudio;
    #       paConfigFile =
    #         runCommand "disablePulseaudioEsoundModule"
    #           { buildInputs = [ pulseaudio ]; } ''
    #             mkdir "$out"
    #             cp ${pulseaudio}/etc/pulse/default.pa "$out/default.pa"
    #             sed -i -e 's|load-module module-esound-protocol-unix|# ...|' "$out/default.pa"
    #           '';
    #   in mkIf config.services.pulseaudio.enable
    #     "${paConfigFile}/default.pa";
  })

  (mkIf (elem "audio/realtime" config.modules.profiles.hardware) {
    services.pipewire.wireplumber.enable = true;

    # boot = {
    #   kernel.sysctl."vm.swappiness" = 10;
    #   kernelModules = [ "snd-seq" "snd-rawmidi" ];
    #   kernelParams = [ "threadirqs" ];
    #   postBootCommands = ''
    #     echo 2048 > /sys/class/rtc/rtc0/max_user_freq
    #     echo 2048 > /proc/sys/dev/hpet/max-user-freq
    #     setpci -v -d *:* latency_timer=b0
    #   '';
    # };

    # security.pam.loginLimits = [
    #   { domain = "@audio"; item = "memlock"; type = "-"; value = "unlimited"; }
    #   { domain = "@audio"; item = "rtprio"; type = "-"; value = "99"; }
    #   { domain = "@audio"; item = "nofile"; type = "soft"; value = "99999"; }
    #   { domain = "@audio"; item = "nofile"; type = "hard"; value = "99999"; }
    # ];

    # services.udev.extraRules = ''
    #   KERNEL=="rtc0", GROUP="audio"
    #   KERNEL=="hpet", GROUP="audio"
    # '';
  })
]
</file>

<file path="modules/profiles/hardware/bluetooth.nix">
# profiles/hardware/bluetooth.nix --- TODO
#
# TODO

{ hey, lib, config, pkgs, ... }:

with lib;
with hey.lib;
mkIf (elem "bluetooth" config.modules.profiles.hardware) {
  hardware.bluetooth.enable = true;

  # Brute force a reset after waking up from sleep, as some bluetooth devices
  # will fail to connect to a system that's been suspended at some point.
  powerManagement.resumeCommands = ''
    ${pkgs.util-linux}/bin/rfkill block bluetooth
    ${pkgs.util-linux}/bin/rfkill unblock bluetooth
  '';
}
</file>

<file path="modules/profiles/hardware/ergodox.nix">
{ hey, lib, options, config, pkgs, ... }:

with lib;
with hey.lib;
mkIf (elem "ergodox" config.modules.profiles.hardware) {
  user.packages = [ pkgs.wally-cli ];

  hardware.keyboard.zsa.enable = true;

  user.extraGroups = [ "plugdev" ];

  services.xserver.xkb.options = "compose:ralt";
}
</file>

<file path="modules/profiles/hardware/hidpi.nix">
# modules.hardware.hidpi --- special support for hidpi displays
#
# TODO

{ hey, lib, config, ... }:

with lib;
with hey.lib;
mkIf (elem "hidpi" config.modules.profiles.hardware) {
  environment.sessionVariables = {
    QT_DEVICE_PIXEL_RATIO = "2";
    QT_AUTO_SCREEN_SCALE_FACTOR = "true";
  };
}
</file>

<file path="modules/profiles/hardware/printer.nix">
# profiles/hardware/printer
#
# Printers exist because there isn't enough despair in the world.

{ hey, lib, options, config, pkgs, ... }:

with lib;
with hey.lib;
let hardware = config.modules.profiles.hardware;
in mkMerge [
  (mkIf (any (s: hasPrefix "printer" s) hardware) {
    services.printing = {
      enable = true;
      startWhenNeeded = true;
      # logLevel = "debug";
    };
  })

  (mkIf (elem "printer/wireless" hardware) {
    services.avahi = {
      enable = true;
      nssmdns = true;
      openFirewall = true;
    };
  })
]
</file>

<file path="modules/profiles/hardware/razer.nix">
# profiles/hardware/razer.nix --- support for razer devices

{ hey, lib, options, config, pkgs, ... }:

with lib;
with hey.lib;
mkIf (elem "razer" config.modules.profiles.hardware) {
  hardware.openrazer.enable = true;

  user.extraGroups = [ "plugdev" ];

  environment.systemPackages = with pkgs; [
    # TODO Install polychromatic
  ];
}
</file>

<file path="modules/profiles/hardware/scanner.nix">
# profiles/hardware/scanner
#
# TODO

{ hey, lib, options, config, pkgs, ... }:

with lib;
with hey.lib;
let hardware = config.modules.profiles.hardware;
in mkMerge [
  (mkIf (any (s: hasPrefix "scanner" s) hardware) {
    hardware.sane = {
      enable = true;
      openFirewall = true;
    };
    user.extraGroups = [ "scanner" ];
  })
]
</file>

<file path="modules/profiles/hardware/ssd.nix">
# modules/profiles/hardware/ssd.nix --- TODO
#
# TODO

{ hey, lib, config, pkgs, ... }:

with lib;
with hey.lib;
mkIf (elem "ssd" config.modules.profiles.hardware) {
  services =
    let hasZfs = any (x: x ? fsType && x.fsType == "zfs") (attrValues config.fileSystems);
    in {
      fstrim.enable = mkDefault (!hasZfs);
      zfs.trim.enable = mkDefault hasZfs;
    };
  boot.initrd.availableKernelModules = [ "nvme" ];
}
</file>

<file path="modules/profiles/hardware/wifi.nix">
# profiles/hardware/wifi.nix --- TODO

{ hey, lib, options, config, pkgs, ... }:

with builtins;
with lib;
with hey.lib;
let interfaces = config.networking.wireless.interfaces;
in mkIf (elem "wifi" config.modules.profiles.hardware) {
  environment.systemPackages = with pkgs; [
    wpa_supplicant  # for wpa_cli
  ];

  networking.supplicant = listToAttrs (map
    (int: nameValuePair int {
      # Allow wpa_(cli|gui) to modify networks list
      userControlled = {
        enable = true;
        group = "users";
      };
      configFile = {
        path = "/etc/wpa_supplicant.d/${int}.conf";
        writable = true;
      };
      extraConf = ''
        ap_scan=1
        p2p_disabled=1
        okc=1
      '';
    })
    interfaces);

  systemd.tmpfiles.rules =
    [ "d /etc/wpa_supplicant.d 700 root root - -" ] ++
    (map (int: "f /etc/wpa_supplicant.d/${int}.conf 700 root root - -") interfaces);

  systemd.network.wait-online.ignoredInterfaces = interfaces;
  boot.initrd.systemd.network.wait-online.ignoredInterfaces = interfaces;
}
</file>

<file path="modules/profiles/network/ca.nix">
# modules/profiles/network/ca.nix --- TODO

{ hey, lib, config, pkgs, ... }:

with lib;
with hey.lib;
mkIf (elem "ca" config.modules.profiles.networks) {
  time.timeZone = "America/Toronto";

  # For redshift, mainly
  location = {
    latitude = 43.70011;
    longitude = -79.4163;
  };
}
</file>

<file path="modules/profiles/network/dk.nix">
# modules/profiles/network/dk.nix --- TODO

{ hey, lib, config, pkgs, ... }:

with lib;
with hey.lib;
mkIf (elem "dk" config.modules.profiles.networks) {
  time.timeZone = "Europe/Copenhagen";

  # For redshift, mainly
  location = {
    latitude = 55.88;
    longitude = 12.5;
  };
}
</file>

<file path="modules/profiles/network/wg0.nix">
# modules/profiles/network/wg0 -- homelab VPN

{ hey, lib, config, pkgs, ... }:

with lib;
with hey.lib;
mkIf (elem "wg0" config.modules.profiles.networks) (mkMerge [
  {
    networking.firewall.allowedUDPPorts = [ 51820 ];

    age.secrets.wg0PrivateKey.owner = "systemd-network";

    systemd.network = {
      enable = true;
      netdevs."90-wg0" = {
        netdevConfig = {
          Kind = "wireguard";
          Name = "wg0";
        };
        wireguardConfig = {
          PrivateKeyFile = config.age.secrets.wg0PrivateKey.path;
          ListenPort = "51820";
        };
        wireguardPeers = [{
          PublicKey = "kuv6kPygJbjcAbhogEst5m8XyKz9pn0XgyR7EcnveAU=";
          AllowedIPs = [ "10.0.0.0/24" ];
          Endpoint = "0.home.lissner.net:51820";
        }];
      };
      networks.wg0 = {
        # address = ...;
        matchConfig.Name = "wg0";
        DHCP = "no";
        domains = [ "home.lissner.net" ];
        networkConfig = {
          DNSSEC = false;
          DNSDefaultRoute = false;
        };
      };
    };

    systemd.network.wait-online.ignoredInterfaces = [ "wg0" ];
    boot.initrd.systemd.network.wait-online.ignoredInterfaces = [ "wg0" ];
  }

  # ...
])
</file>

<file path="modules/profiles/platform/linode.nix">
# 1. Create three (3) disk images:
#    - Installer: 1024mb
#    - Swap: 512mb
#    - NixOS: rest
#
# 2. Boot in rescue mode with:
#    - /dev/sda -> Installer
#    - /dev/sdb -> Swap
#    - /dev/sdc -> NixOS
#
# 3. Once booted into Finnix (step 2) pipe this script to sh:
#      iso=https://channels.nixos.org/nixos-unstable/latest-nixos-minimal-x86_64-linux.iso
#      update-ca-certificates
#      wget -O nixos.iso $iso
#      cp nixos.iso /dev/sda
#
# 4. Create two configuration profiles:
#    - Installer
#      - Kernel: Direct Disk
#      - /dev/sda -> NixOS
#      - /dev/sdb -> Swap
#      - /dev/sdc -> Installer
#      - Helpers: distro and auto network helpers = off
#      - Leave others on their defaults
#    - Boot
#      - Kernel: GRUB 2
#      - /dev/sda -> NixOS
#      - /dev/sdb -> Swap
#      - Helpers: distro and auto network helpers = off
#      - Leave others on their defaults
#
# 5. Boot into installer profile.
#
# 6. Generate hardware-configuration.nix
#      sudo su -
#      e2label /dev/sda nixos
#      swaplabel -L swap /dev/sdb
#      mount /dev/disk/by-label/nixos /mnt
#      swapon /dev/disk/by-label/swap
#      nixos-generate-config --root /mnt
#      vim /mnt/etc/nixos/hardware-configuration.nix   # change uuids to labels
#
# 7. Install dotfiles:
#      nix-env -iA nixos.git nixos.nixFlakes
#      mkdir -p /mnt/home/hlissner/.config
#      cd /mnt/home/hlissner/.config
#      git clone https://github.com/hlissner/dotfiles
#      nixos-install --root /mnt --flake .#linode --impure
#
# 8. Reboot into "Boot" profile.

{ hey, lib, config, pkgs, modulesPath, ... }:

with lib;
with hey.lib;
{
  # imports =
  #   if config.modules.profiles.platform == "linode"
  #   then [ "${modulesPath}/profiles/qemu-guest.nix" ]
  #   else [];

  config = mkIf (config.modules.profiles.platform == "linode") {
    environment.systemPackages = with pkgs; [
      inetutils
      mtr
      sysstat
      linode-cli
    ];

    # GRUB
    boot = {
      kernelModules = [];
      # Needed for LISH (part 1)
      kernelParams = [ "console=ttyS0,19200n8" ];
      extraModulePackages = [];
      initrd = {
        availableKernelModules = [ "virtio_pci" "virtio_scsi" "ahci" "sd_mod" ];
        kernelModules = [];
      };
      loader = {
        grub = {
          enable = true;
          device = "/dev/sda";
          copyKernels = true;
          fsIdentifier = "provided";
          splashImage = null;
          # Needed for LISH (part 2)
          extraConfig = ''
            serial --speed=19200 --unit=0 --word=8 --parity=no --stop=1;
            terminal_input serial;
            terminal_output serial
          '';
          # GRUB will complain about blocklists when trying to install grub on a
          # partition-less disk. This tells it to ignore the warning and carry on.
          forceInstall = true;
        };
        # Disable globals
        efi.canTouchEfiVariables = false;
        systemd-boot.enable = false;
      };
    };

    networking = {
      enableIPv6 = true;
      tempAddresses = "disabled";
      usePredictableInterfaceNames = false;
      interfaces.eth0 = {
        tempAddress = "disabled";
        useDHCP = true;
      };
    };

    fileSystems."/" = {
      device = "/dev/sda";
      fsType = "ext4";
    };
  };
}
</file>

<file path="modules/profiles/role/server.nix">
# profiles/role/server.nix
#
# Used for headless servers, at home or abroad, with more
# security/automation-minded configuration.

{ hey, lib, config, pkgs, ... }:

with lib;
mkIf (config.modules.profiles.role == "server") {
  nix.gc = {
    automatic = true;
    dates = "weekly";
    options = "--delete-older-than 14d";
  };

  systemd = {
    services.clear-log = {
      description = "Clear >1 month-old logs every week";
      serviceConfig = {
        Type = "oneshot";
        ExecStart = "${pkgs.systemd}/bin/journalctl --vacuum-time=21d";
      };
    };
    timers.clear-log = {
      wantedBy = [ "timers.target" ];
      partOf = [ "clear-log.service" ];
      timerConfig.OnCalendar = "weekly UTC";
    };
  };

  powerManagement.cpuFreqGovernor = mkDefault "ondemand";
  virtualisation.docker.enableOnBoot = mkDefault true;
  power.ups.mode = mkDefault "netclient";

  ## Security tweaks
  boot.kernelPackages = mkForce pkgs.linuxKernel.packages.linux_6_9_hardened;
  # Prevent replacing the running kernel w/o reboot
  security.protectKernelImage = true;
}
</file>

<file path="modules/profiles/role/vm.nix">
{ hey, config, lib, pkgs, ... }:

with lib;
with hey.lib;
let platform = config.modules.profiles.platform;
in mkMerge [
  (mkIf (hasPrefix "vm/" platform) {
    boot.zfs.devNodes = "/dev/disk/by-partuuid";
  })

  (mkIf (platform == "vm/qemu-guest") {
    services.qemuGuest.enable = true;
  })
]
</file>

<file path="modules/profiles/role/workstation.nix">
# profiles/role/workstation.nix
#
# TODO

{ hey, lib, config, pkgs, ... }:

with lib;
with hey.lib;
mkIf (config.modules.profiles.role == "workstation") (mkMerge [
  {
    boot = {
      # HACK I used to disable mitigations for spectre, meltdown, L1TF,
      #   retbleed, and other CPU vulnerabilities for a marginal performance
      #   gain on non-servers, but it really makes little to no difference on
      #   modern CPUs. It may still be worth it on older Xeons and the like (on
      #   workstations) though. I've preserved this in comments for future
      #   reference.
      #
      #   DO NOT COPY AND UNCOMMENT IT BLINDLY! If you're looking for
      #   optimizations, these aren't the droids you're looking for!
      # kernelParams = [ "mitigations=off" ];

      loader = {
        # I'm not a big fan of Grub, so if it's not in use...
        systemd-boot.enable = mkDefault true;
        # For much quicker boot up to NixOS. I can use `systemctl reboot
        # --boot-loader-entry=X` instead.
        timeout = mkDefault 1;
      };

      # For a truly silent boot!
      # kernelParams = [
      #   "quiet"
      #   "splash"
      #   "udev.log_level=3"
      # ];
      # consoleLogLevel = 0;
      # initrd.verbose = false;

      # Common kernels across workstations
      initrd.availableKernelModules = [
        "xhci_pci"     # USB 3.0
        "usb_storage"  # USB mass storage devices
        "usbhid"       # USB human interface devices
        "ahci"         # SATA devices on modern AHCI controllers
        "sd_mod"       # SCSI, SATA, and IDE devices
      ];

      # The default maximum is too low, which starves IO hungry apps.
      kernel.sysctl."fs.inotify.max_user_watches" = 524288;
    };

    # TODO ...
    powerManagement.cpuFreqGovernor = mkDefault "performance";

    # Use systemd-{network,resolve}d; a more unified networking backend that's
    # easier to reconfigure downstream, especially where split-DNS setups (e.g.
    # VPNs) are concerned.
    networking = {
      useDHCP = false;
      useNetworkd = true;
    };
    systemd = {
      network = {
        # Automatically manage all wired/wireless interfaces.
        networks = {
          "30-wired" = {
            enable = true;
            name = "en*";
            networkConfig.DHCP = "yes";
            networkConfig.IPv6PrivacyExtensions = "kernel";
            linkConfig.RequiredForOnline = "no"; # don't hang at boot (if dc'ed)
            dhcpV4Config.RouteMetric = 1024;
          };
          "30-wireless" = {
            enable = true;
            name = "wl*";
            networkConfig.DHCP = "yes";
            networkConfig.IPv6PrivacyExtensions = "kernel";
            linkConfig.RequiredForOnline = "no"; # don't hang at boot (if dc'ed)
            dhcpV4Config.RouteMetric = 2048;     # prefer wired
          };
        };

        # systemd-networkd-wait-online waits forever for *all* interfaces to be
        # online before passing; which is unlikely to ever happen.
        wait-online = {
          anyInterface = true;
          timeout = 30;

          # The anyInterface setting is still finnicky for some networks, so I
          # simply turn off the whole check altogether.
          enable = false;
        };
      };
    };
    boot.initrd.systemd.network.wait-online = {
      anyInterface = true;
      timeout = 10;
    };

    modules.xdg.ssh.enable = true;

    # See systemd/systemd#10579
    services.resolved.dnssec = "false";
  }

  (mkIf config.modules.services.ssh.enable {
    programs.ssh.startAgent = true;
    services.openssh.startWhenNeeded = true;
  })

  # ...
])
</file>

<file path="modules/profiles/user/hlissner.nix">
{ hey, lib, config, ... }:

with lib;
let cfg = config.modules.profiles;
    username = cfg.user;
    key = "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIB71rSnjuC06Qq3NLXQJwSz7jazoB+umydddrxL6vg1a";
in mkIf (username == "hlissner") (mkMerge [
  {
    user.name = username;
    user.description = "Henrik";
    i18n.defaultLocale = mkDefault "en_US.UTF-8";
    modules.shell.vaultwarden.settings.server = "vault.home.lissner.net";

    # Be slightly more restrictive about SSH access to workstations, which I
    # only need LAN access to, if ever. Other systems, particularly servers, are
    # remoted into often, so I leave their access control to an upstream router
    # or local firewall.
    user.openssh.authorizedKeys.keys = [
      key
    ];

    # Allow key-based root access only from private ranges.
    users.users.root.openssh.authorizedKeys.keys = [
      ''from="10.0.0.0/8" ${key} ${username}''
    ];
  }
])
</file>

<file path="modules/profiles/default.nix">
# modules/profiles/default.nix

{ hey, lib, options, config, ... }:

with lib;
with hey.lib;
{
  options.modules.profiles = with types; {
    user = mkOpt str "";
    role = mkOpt str "";
    platform = mkOpt str "";
    hardware = mkOpt (listOf str) [];
    networks = mkOpt (listOf str) [];
  };

  config.hey.info.profiles = config.modules.profiles;
}
</file>

<file path="modules/services/calibre.nix">
{ hey, lib, config, options, ... }:

with lib;
with hey.lib;
let cfg = config.modules.services.calibre;
in {
  options.modules.services.calibre = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    services.calibre-server.enable = true;

    networking.firewall.allowedTCPPorts = [ 8080 ];
  };
}
</file>

<file path="modules/services/cgit.nix">
{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.services.cgit;
    cgitrc = pkgs.writeText "cgitrc" ''
      css=/static/cgit.css
      logo=/static/cgit.png
      favicon=/static/favicon.ico
      root-title=Repositories
      root-desc=Browse repositories
      snapshots=tar.gz zip

      readme=:README
      readme=:readme
      readme=:readme.md
      readme=:README.md
      readme=:readme.org
      readme=:README.org

      ${cfg.extraConfig}

      about-filter=${cfg.package}/lib/cgit/filters/about-formatting.sh
      source-filter=${cfg.package}/lib/cgit/filters/syntax-highlighting.py
      remove-suffix=1
      section-from-path=1
      scan-path=${cfg.reposDirectory}
    '';
in {
  options.modules.services.cgit = with types; {
    enable = mkBoolOpt false;
    package = mkOption {
      default = pkgs.cgit-pink;
      type = package;
      description = ''
        Cgit package to use. This defaults to a better-maintained fork of cgit.
      '';
    };
    authorizedKeys = mkOption {
      default = config.user.openssh.authorizedKeys.keys;
      type = listOf str;
    };
    user = mkOpt str "git";
    directory = mkOpt str "/srv/${cfg.user}";
    reposDirectory = mkOpt str "${cfg.directory}/public";
    domain = mkOpt str "git.example.com";
    extraConfig = mkOpt str "";
  };

  config = mkIf cfg.enable {
    users = {
      groups.${cfg.user} = {};
      users.${cfg.user} = {
        createHome = true;
        group = cfg.user;
        home = cfg.directory;
        isSystemUser = true;
        openssh.authorizedKeys.keys = cfg.authorizedKeys;
        shell = "${pkgs.git}/bin/git-shell";
      };
    };
    user.extraGroups = [ cfg.user ];

    systemd.tmpfiles.rules = [
      "z ${cfg.directory} 770 ${cfg.user} ${cfg.user} - -"
      "d ${cfg.reposDirectory} 770 ${cfg.user} ${cfg.user} - -"
    ];

    services.fcgiwrap = {
      enable = true;
      user = cfg.user;
      group = cfg.user;
    };

    services.nginx.enable = true;
    services.nginx.virtualHosts.${cfg.domain} = {
      locations = {
        "~* ^/static/(.+.(ico|css|png))$".extraConfig = ''
          alias ${cfg.package}/cgit/$1;
        '';
        "/".extraConfig = ''
          include ${pkgs.nginx}/conf/fastcgi_params;
          fastcgi_param CGIT_CONFIG ${cgitrc};
          fastcgi_param SCRIPT_FILENAME ${cfg.package}/cgit/cgit.cgi;
          fastcgi_split_path_info ^(/?)(.+)$;
          fastcgi_param PATH_INFO $fastcgi_path_info;
          fastcgi_param HTTP_HOST $server_name;
          fastcgi_param QUERY_STRING $args;
          fastcgi_pass unix:${config.services.fcgiwrap.socketAddress};
        '';
      };
    };
  };
}
</file>

<file path="modules/services/discourse.nix">
{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.services.discourse;
in {
  options.modules.services.discourse = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    services.postgresql.package = pkgs.postgresql;

    services.discourse = {
      enable = true;
      enableACME = true;
      # plugins = with config.services.discourse.package.plugins; [
      #   discourse-akismet
      #   discourse-chat-integration
      #   discourse-checklist
      #   discourse-canned-replies
      #   discourse-github
      #   discourse-assign
      # ];
    };
  };
}
</file>

<file path="modules/services/docker.nix">
{ hey, lib, options, config, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.services.docker;
in {
  options.modules.services.docker = {
    enable = mkBoolOpt false;
    # portainer.enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable (mkMerge [
    {
      user.packages = with pkgs; [
        docker
        docker-compose
      ];

      environment.variables = {
        DOCKER_CONFIG = "$XDG_CONFIG_HOME/docker";
        MACHINE_STORAGE_PATH = "$XDG_DATA_HOME/docker/machine";
      };

      user.extraGroups = [ "docker" ];

      modules.shell.zsh.rcFiles = [ "${hey.configDir}/docker/aliases.zsh" ];

      virtualisation = {
        docker = {
          enable = true;
          autoPrune.enable = true;
          enableOnBoot = mkDefault false;
          # listenOptions = [];
        };
      };
    }

    # (mkIf cfg.portainer.enable {
    #   virtualisation.oci-containers.containers.portainer = {
    #     image = "...";
    #     ports = [];
    #     volumes = [];
    #   };
    # })
  ]);
}

# docker run -d -p 9001:9001 --name portainer_agent --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v /var/lib/docker/volumes:/var/lib/docker/volumes portainer/agent:latest
</file>

<file path="modules/services/dunst.nix">
{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.services.dunst;
    eitherStrBoolIntList = with types;
      either str (either bool (either int (listOf str)));
    toDunstIni = generators.toINI {
      mkKeyValue = key: value:
        let value' =
              if isBool value then
                (if value then "yes" else "no")
              else if isString value then
                ''"${value}"''
              else
                toString value;
        in "${key}=${value'}";
    };
in {
  options.modules.services.dunst = with types; {
    enable = mkBoolOpt false;
    settings = mkOpt (attrsOf (attrsOf eitherStrBoolIntList)) {};
  };

  config = mkIf cfg.enable {
    environment.systemPackages = [ pkgs.dunst ];

    systemd.user.services.dunst = {
      enable = true;
      unitConfig = {
        Description = "Dunst notification daemon";
        After  = [ "graphical-session-pre.target" ];
        PartOf = [ "graphical-session.target" ];
      };
      serviceConfig = {
        Type = "dbus";
        BusName = "org.freedesktop.Notifications";
        ExecStart = "${pkgs.dunst}/bin/dunst";
      };
    };

    home.dataFile."dbus-1/services/org.knopwob.dunst.service".source =
      "${pkgs.dunst}/share/dbus-1/services/org.knopwob.dunst.service";

    home.configFile."dunst/dunstrc" = {
      text = toDunstIni (mergeAttrs' [
        {
          global = {
            title = "Dunst";
            class = "Dunst";
            browser = "librewolf -new-tab";
            dmenu = "rofi -dmenu -p dunst";
            history_length = 20;
            idle_threshold = 120;
            markup = "full";
            sort = true;
            sticky_history = true;
            progress_bar = true;
            indicate_hidden = true;
            notification_limit = 0;
            monitor = 0;
          };
          experimental = {
            enable_recursive_icon_lookup = true;
          };
        }
        cfg.settings
      ]);
      onChange = ''
        ${pkgs.procps}/bin/pkill -u "$USER" ''${VERBOSE+-e} dunst || true
      '';
    };
  };
}
</file>

<file path="modules/services/fail2ban.nix">
{ hey, lib, config, options, ... }:

with lib;
with hey.lib;
let cfg = config.modules.services.fail2ban;
in {
  options.modules.services.fail2ban = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    services.fail2ban = {
      enable = true;
      ignoreIP = [ "127.0.0.1/16" "192.168.0.0/16" ];
      bantime = "1h";
      bantime-increment = {
        enable = true;
        maxtime = "168h";
        factor = "4";
      };
      jails.DEFAULT.settings = {
        blocktype = "DROP";
        findtime = "1h";
      };
    };

    # Extra filters
    # environment.etc = {
    #   "fail2ban/filter.d/gitea.conf".text = ''
    #     [Definition]
    #     failregex =  .*(Failed authentication attempt|invalid credentials|Attempted access of unknown user).* from <HOST>
    #     ignoreregex =
    #     journalmatch = _SYSTEMD_UNIT=gitea.service
    #   '';
    # };
  };
}
</file>

<file path="modules/services/gitea.nix">
# modules/services/gitea.nix
#
# Gitea is essentially a self-hosted github. This modules configures it with the
# expectation that it will be served over an SSL-secured reverse proxy (best
# paired with my modules.services.nginx module).
#
# Resources
#   Config: https://docs.gitea.io/en-us/config-cheat-sheet/
#   API:    https://docs.gitea.io/en-us/api-usage/

{ hey, lib, config, options, ... }:

with lib;
with hey.lib;
let cfg = config.modules.services.gitea;
in {
  options.modules.services.gitea = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    # Allows git@... clone addresses rather than gitea@...
    users.users.git = {
      useDefaultShell = true;
      home = "/var/lib/gitea";
      group = "gitea";
      isSystemUser = true;
    };

    user.extraGroups = [ "gitea" ];

    services.gitea = {
      enable = true;
      lfs.enable = true;

      user = "git";
      database.user = "git";

      # We're assuming SSL-only connectivity
      cookieSecure = true;
      # Only log what's important, but Info is necessary for fail2ban to work
      log.level = "Info";
      settings = {
        server.DISABLE_ROUTER_LOG = true;
        database.LOG_SQL = false;
        service.ENABLE_BASIC_AUTHENTICATION = false;
      };

      dump.interval = "daily";
    };

    services.fail2ban.jails.gitea = ''
      enabled = true
      filter = gitea
      banaction = %(banaction_allports)s
      maxretry = 5
    '';
  };
}
</file>

<file path="modules/services/hypridle.nix">
# TODO

{ hey, lib, config, options, ... }:

with lib;
with hey.lib;
let cfg = config.modules.services.hypridle;
in {
  options.modules.services.hypridle = with types; {
    enable = mkBoolOpt false;
    settings = mkOpt (attrs) {};
    listeners = mkOpt (listOf (submodule {
      options = {
        timeout = mkOpt int 0;
        on-timeout = mkOpt str "";
        on-resume = mkOpt str "";
      };
    })) {};
  };

  config = mkIf cfg.enable {
    assertions = [
      {
        assertion = config.modules.desktop.hyprland.enable;
        message = "hypridle requires the Hyprland desktop";
      }
    ];

    systemd.user.services.swayidle = {
      unitConfig = {
        Description = "Idle manager for Hyprland";
        PartOf = [ "graphical-session.target" ];
      };
      serviceConfig = {
        Type = "simple";
        Restart = "always";
        ExecStart = "${pkgs.hypridle}/bin/hypridle";
        RestartSec = "5";
      };
      wantedBy = [ "graphical-session.target" ];
    };

    home.configFile."hypr/hypridle.conf".text = ''
      general {
        ${concatStringsSep "\n"
          (mapAttrsToList (n: v: "${n} = ${toString v}") cfg.settings)}
      }

      ${concatMapStringSep "\n" (t: ''
        listener {
          ${optionalString (t.timeout > 0)      "timeout = ${toString t.timeout}"}
          ${optionalString (t.on-timeout != "") "on-timeout = ${t.on-timeout}"}
          ${optionalString (t.on-resume != "")  "on-resume = ${t.on-resume}"}
        }
      '') cfg.timeouts}
    '';
  };
}
</file>

<file path="modules/services/jellyfin.nix">
# Finally, a decent open alternative to Plex!

{ hey, lib, config, options, ... }:

with lib;
with hey.lib;
let cfg = config.modules.services.jellyfin;
in {
  options.modules.services.jellyfin = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    services.jellyfin.enable = true;

    networking.firewall = {
      allowedTCPPorts = [ 8096 ];
      allowedUDPPorts = [ 8096 ];
    };

    user.extraGroups = [ "jellyfin" ];
  };
}
</file>

<file path="modules/services/mpd.nix">
# TODO: Incomple

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.services.dunst;
in {
  options.modules.services.mpd = with types; {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    services.mpd = {
      enable = true;
    };
  };
}
</file>

<file path="modules/services/nginx.nix">
{ hey, lib, config, options, pkgs, ... }:

with builtins;
with lib;
with hey.lib;
let cfg = config.modules.services.nginx;
in {
  options.modules.services.nginx = {
    enable = mkBoolOpt false;
    enableCloudflareSupport = mkBoolOpt false;
  };

  config = mkMerge [
    (mkIf cfg.enable {
      networking.firewall.allowedTCPPorts = [ 80 443 ];

      user.extraGroups = [ "nginx" ];

      services.nginx = {
        enable = true;

        # Use recommended settings
        recommendedGzipSettings = true;
        recommendedOptimisation = true;
        recommendedProxySettings = true;
        recommendedTlsSettings = true;

        # Reduce the permitted size of client requests, to reduce the likelihood
        # of buffer overflow attacks. This can be tweaked on a per-vhost basis,
        # as needed.
        clientMaxBodySize = "256k";  # default 10m
        # Significantly speed up regex matchers
        appendConfig = ''pcre_jit on;'';
        commonHttpConfig = ''
          client_body_buffer_size  4k;       # default: 8k
          large_client_header_buffers 2 4k;  # default: 4 8k

          map $sent_http_content_type $expires {
              default                    off;
              text/html                  10m;
              text/css                   max;
              application/javascript     max;
              application/pdf            max;
              ~image/                    max;
          }
        '';
      };
    })

    (mkIf cfg.enableCloudflareSupport {
      services.nginx.commonHttpConfig = ''
        ${concatMapStrings (ip: "set_real_ip_from ${ip};\n")
          (filter (line: line != "")
            (splitString "\n" ''
              ${readFile (fetchurl "https://www.cloudflare.com/ips-v4/")}
              ${readFile (fetchurl "https://www.cloudflare.com/ips-v6/")}
            ''))}
        real_ip_header CF-Connecting-IP;
      '';
    })
  ];
}

# Helpful nginx snippets
#
# Set expires headers for static files and turn off logging.
#   location ~* ^.+\.(js|css|swf|xml|txt|ogg|ogv|svg|svgz|eot|otf|woff|mp4|ttf|r ss|atom|jpg|jpeg|gif|png|ico|zip|tgz|gz|rar|bz2|doc|xls|exe|ppt|tar|mid|midi|wav |bmp|rtf)$ {
#     access_log off; log_not_found off; expires 30d;
#   }
#
# Deny all attempts to access PHP Files in the uploads directory
#   location ~* /(?:uploads|files)/.*\.php$ {
#     deny all;
#   }
</file>

<file path="modules/services/printing.nix">
# modules/services/printing.nix
#
# Share the suffering.

{ hey, lib, config, options, ... }:

with lib;
with hey.lib;
let cfg = config.modules.services.printing;
in {
  options.modules.services.printing = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    services.avahi = {
      enable = true;
      publish = {
        enable = true;
        userServices = true;
      };
    };

    services.printing = {
      browsing = true;
      listenAddresses = [ "*:631" ];
      allowFrom = [ "all" ];
      defaultShared = true;
    };

    networking.firewall = {
      allowedUDPPorts = [ 631 ];
      allowedTCPPorts = [ 631 ];
    };
  };
}
</file>

<file path="modules/services/prometheus.nix">
# modules/services/prometheus.nix
#
# For keeping an eye on things...

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.services.prometheus;
in {
  options.modules.services.prometheus = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    services.prometheus = {
      enable = true;
    };
  };
}
</file>

<file path="modules/services/ssh.nix">
{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.services.ssh;
in {
  options.modules.services.ssh = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    # Ensure this directory exists and has correct permissions.
    systemd.user.tmpfiles.rules = [ "d %h/.config/ssh 700 - - - -" ];

    services.openssh = {
      enable = true;
      settings = {
        KbdInteractiveAuthentication = false;
        # Require keys over passwords. Ensure target machines are provisioned
        # with authorizedKeys!
        PasswordAuthentication = false;
      };
      # Suppress superfluous TCP traffic on new connections. Undo if using SSSD.
      extraConfig = ''GSSAPIAuthentication no'';
      # Deactivate short moduli
      moduliFile = pkgs.runCommand "filterModuliFile" {} ''
        awk '$5 >= 3071' "${config.programs.ssh.package}/etc/ssh/moduli" >"$out"
      '';
      # Removes the default RSA key (not that it represents a vulnerability, per
      # se, but is one less key (that I don't plan to use) to the castle laying
      # around) and improves the ed25519 key's entropy by generating it with 100
      # rounds (default is 16).
      hostKeys = [
        {
          comment = "${config.networking.hostName}.local";
          path = "/etc/ssh/ssh_host_ed25519_key";
          rounds = 100;
          type = "ed25519";
        }
      ];
    };
  };
}
</file>

<file path="modules/services/swayidle.nix">
{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.services.swayidle;
in {
  options.modules.services.swayidle = with types; {
    enable = mkBoolOpt false;
    package = mkOpt package pkgs.swayidle;
    events = mkOpt (attrsOf str) {};
    timeouts = mkOpt (listOf (submodule {
      options = {
        timeout = mkOpt int 0;
        command = mkOpt str "";
        resume = mkOpt str "";
      };
    })) [];
  };

  config = mkIf cfg.enable {
    assertions = [
      {
        assertion = config.modules.desktop.type == "wayland";
        message = "swayidle requires a wayland desktop";
      }
    ];

    systemd.user.services.swayidle = {
      unitConfig = {
        Description = "Idle manager for Wayland";
        PartOf = [ "graphical-session.target" ];
      };
      serviceConfig = {
        Type = "simple";
        Restart = "always";
        ExecStart = "${cfg.package}/bin/swayidle -w";
      };
      wantedBy = [ "graphical-session.target" ];
    };

    home.configFile."swayidle/config".text =
      let mkTimeout = t:
            concatStringsSep " "
              ([ "timeout" (toString t.timeout) (escapeShellArg t.command) ]
               ++ (optionals (t.resume != "") [ "resume" (escapeShellArg t.resume) ]));
          mkEvent = evt: cmd: "${evt} ${escapeShellArg cmd}";
      in ''
        ${concatStringsSep "\n" (mapAttrsToList mkEvent cfg.events)}
        ${concatMapStringsSep "\n" mkTimeout cfg.timeouts}
      '';

    hey.hooks.reload."98-swayidle" = ''
      hey.do systemctl --user restart swayidle.service
    '';
  };
}
</file>

<file path="modules/services/syncthing.nix">
{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.services.syncthing;
in {
  options.modules.services.syncthing = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    services.syncthing = rec {
      enable = true;
      openDefaultPorts = true;
      user = config.user.name;
      configDir = "${config.home.configDir}/syncthing";
      dataDir = "${config.home.dataDir}/syncthing";
    };
  };
}
</file>

<file path="modules/services/transmission.nix">
{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.services.transmission;
in {
  options.modules.services.transmission = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    services.transmission = {
      enable = true;
      home = "${config.user.home}/torrents";
      settings = {
        incomplete-dir-enabled = true;
        rpc-whitelist = "127.0.0.1,192.168.*.*";
        rpc-host-whitelist = "*";
        rpc-host-whitelist-enabled = true;
        ratio-limit = 0;
        ratio-limit-enabled = true;
      };
    };

    networking.firewall = {
      allowedTCPPorts = [ 51413 ];
      allowedUDPPorts = [ 51413 ];
    };

    user.extraGroups = [ "transmission" ];
  };
}
</file>

<file path="modules/services/vaultwarden.nix">
{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.services.vaultwarden;
in {
  options.modules.services.vaultwarden = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    services.vaultwarden.enable = true;

    user.extraGroups = [ "vaultwarden" ];

    services.fail2ban.jails = {
      vaultwarden = ''
        enabled = true
        filter = vaultwarden
        port = 80,443,8000
        maxretry = 5
      '';
      vaultwarden-admin = ''
        enabled = true
        port = 80,443
        filter = vaultwarden-admin
        maxretry = 3
        bantime = 14400
        findtime = 14400
      '';
    };

    environment.etc = {
      "fail2ban/filter.d/vaultwarden.conf".text = ''
        [INCLUDES]
        before = common.conf

        [Definition]
        failregex = ^.*Username or password is incorrect\. Try again\. IP: <ADDR>\. Username:.*$
        ignoreregex =
        journalmatch = _SYSTEMD_UNIT=vaultwarden.service
      '';
      "fail2ban/filter.d/vaultwarden-admin.conf".text = ''
        [INCLUDES]
        before = common.conf

        [Definition]
        failregex = ^.*Invalid admin token\. IP: <ADDR>.*$
        ignoreregex =
        journalmatch = _SYSTEMD_UNIT=vaultwarden.service
      '';
    };
  };
}
</file>

<file path="modules/services/waybar.nix">
{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.services.waybar;
in {
  options.modules.services.waybar = with types; {
    enable = mkBoolOpt false;
    package = mkOpt package pkgs.waybar;
    settings = mkOpt (attrsOf attrs) {};
    primaryMonitor = mkOpt str "";
  };

  config = mkIf cfg.enable {
    assertions = [
      {
        assertion = config.modules.desktop.type == "wayland";
        message = "swayidle requires a wayland desktop";
      }
    ];

    programs.waybar = {
      enable = true;
      package = mkDefault cfg.package;
    };

    hey.hooks = {
      # startup."20-waybar" = ''
      #   hey.do systemctl --user start waybar.service
      # '';
      reload."98-waybar" = ''
        hey.do systemctl --user restart waybar.service
      '';
    };

    home.configFile."waybar/config".text = ''
      // -*- mode: js-json -*-
      // This was automatically generated by NixOS and my dotfiles
      ${toPrettyJSON
        (mapAttrsToList
          (name: v: mergeAttrs' [
            {
              inherit name;
              output = [ cfg.primaryMonitor ];
              include = [ "${hey.configDir}/waybar/config" ];
            }
            v
          ]) cfg.settings)}
    '';
  };
}
</file>

<file path="modules/services/wlsunset.nix">
{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.services.wlsunset;
in {
  options.modules.services.wlsunset = with types; {
    enable = mkBoolOpt false;
    package = mkOpt package (pkgs.wlsunset.overrideAttrs (final: prev: rec {
      version = "0.4.0";
      src = pkgs.fetchFromSourcehut {
        owner = "~kennylevinsen";
        repo = prev.pname;
        rev = version;
        sha256 = "sha256-U/yROKkU9pOBLIIIsmkltF64tt5ZR97EAxxGgrFYwNg=";
      };
    }));
  };

  config = mkIf cfg.enable {
    assertions = [
      {
        assertion = config.modules.desktop.type == "wayland";
        message = "wlsunset requires a wayland desktop";
      }
      {
        assertion = config.location.latitude != null && config.location.longitude != null;
        message = "Coordinations not set";
      }
    ];

    systemd.user.services.wlsunset = {
      unitConfig = {
        PartOf = [ "graphical-session.target" ];
      };
      serviceConfig = {
        ExecStart =
          let lat = toString config.location.latitude;
              lng = toString config.location.longitude;
          in "${cfg.package}/bin/wlsunset -l ${lat} -L ${lng}";
        Restart = "on-failure";
        KillMode = "mixed";
      };
      wantedBy = [ "graphical-session.target" ];
    };

    # Restarting wlsunset can crash hyprland.
    # hey.hooks.reload."98-wlsunset" = ''
    #   hey.do systemctl --user restart wlsunset.service
    # '';
  };
}
</file>

<file path="modules/services/ydotool.nix">
# modules/services/ydotool.nix
#
# Used as a more portable alternative to xdotool. Not a big fan of anything that
# needs a daemon though; more so since ydotool will soon be rewritten in
# javascript (for its history of supply chain vulnerabiltiies), so I'll likely
# drop it once wtype adds mouse support (see atx/wtype#24).

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.services.ydotool;
    ydotool = pkgs.ydotool;
    socket = "/run/ydotoold/socket";
in {
  options.modules.services.ydotool = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    environment.variables.YDOTOOL_SOCKET = socket;

    users.groups.ydotool = {};
    user.extraGroups = [ "ydotool" ];

    environment.systemPackages = [ ydotool ];
    systemd.services.ydotoold = {
      wantedBy = [ "multi-user.target" ];
      partOf = [ "multi-user.target" ];
      serviceConfig = {
        Group = "ydotool";
        RuntimeDirectory = "ydotoold";
        RuntimeDirectoryMode = "0750";
        ExecStart = "${getExe' ydotool "ydotoold"} --socket-path=${socket} --socket-perm=0660";
        # hardening
        ## allow access to uinput
        DeviceAllow = [ "/dev/uinput" ];
        DevicePolicy = "closed";
        ## allow creation of unix sockets
        RestrictAddressFamilies = [ "AF_UNIX" ];
        CapabilityBoundingSet = "";
        IPAddressDeny = "any";
        LockPersonality = true;
        MemoryDenyWriteExecute = true;
        NoNewPrivileges = true;
        PrivateNetwork = true;
        PrivateTmp = true;
        PrivateUsers = true;
        ProcSubset = "pid";
        ProtectClock = true;
        ProtectControlGroups = true;
        ProtectHome = true;
        ProtectHostname = true;
        ProtectKernelLogs = true;
        ProtectKernelModules = true;
        ProtectKernelTunables = true;
        ProtectProc = "invisible";
        ProtectSystem = "strict";
        RestrictNamespaces = true;
        RestrictRealtime = true;
        RestrictSUIDSGID = true;
        SystemCallArchitectures = "native";
        SystemCallFilter = [
          "@system-service"
          "~@privileged"
          "~@resources"
        ];
        UMask = "0077";
        # -> systemd-analyze security score 0.7 SAFE
      };
    };
  };
}
</file>

<file path="modules/shell/adl.nix">
# modules/shell/adl.nix
#
# To maintain my filty weeb habits, I need tools. Tools that make it easy to
# watch animu and track 'em on anilist. Laziness > my weebery.

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.shell.adl;
in {
  options.modules.shell.adl = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    user.packages = with pkgs; [
      # Dependencies
      trackma
      anime-downloader
      mpv

      # The star of the show
      adl
    ];
  };
}
</file>

<file path="modules/shell/direnv.nix">
{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.shell.direnv;
in {
  options.modules.shell.direnv = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    programs.direnv.enable = true;
  };
}
</file>

<file path="modules/shell/git.nix">
{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.shell.git;
in {
  options.modules.shell.git = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    user.packages = with pkgs; [
      gitAndTools.git-annex
      gitAndTools.gh
      gitAndTools.git-open
      gitAndTools.diff-so-fancy
      (mkIf config.modules.shell.gnupg.enable
        gitAndTools.git-crypt)
      act
    ];

    home.configFile = {
      "git/config".source = "${hey.configDir}/git/config";
      "git/ignore".source = "${hey.configDir}/git/ignore";
      "git/attributes".source = "${hey.configDir}/git/attributes";
    };

    modules.shell.zsh.rcFiles = [ "${hey.configDir}/git/aliases.zsh" ];
  };
}
</file>

<file path="modules/shell/gnupg.nix">
{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.shell.gnupg;
in {
  options.modules.shell.gnupg = with types; {
    enable   = mkBoolOpt false;
    cacheTTL = mkOpt int 3600;  # 1hr
  };

  config = mkIf cfg.enable {
    environment.sessionVariables.GNUPGHOME = "$HOME/.config/gnupg";

    # systemd.user.services.gpg-agent.serviceConfig.Environment = [
    #   "GNUPGHOME=${config.home.configDir}/gnupg"
    # ];

    programs.gnupg = {
      agent = {
        enable = true;
        pinentryPackage = pkgs.pinentry-rofi.override {
          rofi = if config.modules.desktop.type == "wayland"
                 then pkgs.rofi-wayland-unwrapped
                 else pkgs.rofi;
        };
      };
    };

    home.configFile."gnupg/gpg-agent.conf".text = ''
      default-cache-ttl ${toString cfg.cacheTTL}
      allow-emacs-pinentry
      allow-loopback-pinentry
    '';
  };
}
</file>

<file path="modules/shell/tmux.nix">
{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.shell.tmux;
in {
  options.modules.shell.tmux = with types; {
    enable = mkBoolOpt false;
    term = mkOpt str "xterm-256color";
    rcFiles = mkOpt (listOf (either str path)) [];
  };

  config = mkIf cfg.enable {
    environment.variables.TMUX_HOME = "$XDG_CONFIG_HOME/tmux";

    # I avoid programs.tmux because it comes with extra magic I don't need.
    user.packages = [ pkgs.tmux ];

    environment.etc."tmux.conf".text = with pkgs.tmuxPlugins; ''
      set -s default-terminal "${cfg.term}"

      source-file $TMUX_HOME/tmux.conf
      ${concatMapStrings (path: "source-file '${path}'\n") cfg.rcFiles}

      # Run plugins
      run-shell ${yank.rtp}
    '';

    home.configFile."tmux" = {
      source = "${hey.configDir}/tmux";
      recursive = true;
    };

    modules.shell.zsh.rcFiles = [ "${hey.configDir}/tmux/aliases.zsh" ];
  };
}
</file>

<file path="modules/shell/vaultwarden.nix">
{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.shell.vaultwarden;
    package = pkgs.unstable.bitwarden-cli;
in {
  options.modules.shell.vaultwarden = with types; {
    enable = mkBoolOpt false;
    settings = mkOpt attrs {};
  };

  config = mkIf cfg.enable {
    user.packages = [ package ];

    modules.shell.zsh.rcInit = ''
      hey.cache ${package}/bin/bw completion --shell zsh && compdef _bw bw;
    '';

    system.userActivationScripts = mkIf (cfg.settings != {}) {
      initVaultwarden = ''
        if command -v bw >/dev/null; then
          echo "Configuring bitwarden-cli..."
          ${concatStringsSep "\n"
            (mapAttrsToList (n: v: "bw config ${n} ${v}") cfg.settings)}
        fi
      '';
    };
  };
}
</file>

<file path="modules/shell/zsh.nix">
{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.shell.zsh;
in {
  options.modules.shell.zsh = with types; {
    enable = mkBoolOpt false;

    rcInit = mkOpt' lines "" ''
      Zsh lines to be written to $XDG_CONFIG_HOME/zsh/extra.zshrc and sourced by
      $XDG_CONFIG_HOME/zsh/.zshrc
    '';
    envInit = mkOpt' lines "" ''
      Zsh lines to be written to ${config.home.configDir}/zsh/extra.zshenv and
      sourced by $XDG_CONFIG_HOME/zsh/.zshenv
    '';

    rcFiles  = mkOpt (listOf (either str path)) [];
    envFiles = mkOpt (listOf (either str path)) [];
  };

  config = mkIf cfg.enable {
    programs.zsh = {
      enable = true;
      # I init completion myself, because enableGlobalCompInit initializes it
      # too soon, which means commands initialized later in my config won't get
      # completion, and running compinit twice is slow.
      enableCompletion = true;
      enableGlobalCompInit = false;
      # Again. I configure the prompt myself, so disable the default.
      promptInit = "";
      # Respect XDG please!
      histFile = "$XDG_STATE_HOME/zsh/history";
      # Implement these manually (and with caching)
      enableLsColors = false;
    };

    users.defaultUserShell = pkgs.zsh;

    # Some interactive shell utilies I find universally indispensible.
    user.packages = with pkgs; [
      at
      bat      # a better cat
      bc
      dust     # a better du
      eza      # a better ls
      fasd
      fd
      fzf
      gnumake
      libqalculate  # calculator cli w/ currency conversion
      nix-zsh-completions
      ripgrep  # a better grep
      tokei    # for code statistics
      unar
      vim
    ];

    # Ensure XDG compliance
    environment.variables = {
      ZDOTDIR = "$XDG_CONFIG_HOME/zsh";
      ZGEN_DIR = "$XDG_DATA_HOME/zgenom";
      _FASD_DATA = "$XDG_CACHE_HOME/fasd";
      _FASD_VIMINFO = "$XDG_CACHE_HOME/viminfo";
    };

    # Ensure that ZSH's cache directory exists, lest we have IO errors early on.
    systemd.user.tmpfiles.rules = [
      "d %h/.cache/zsh 750 - - - -"
      "d %h/.local/state/zsh 700 - - - -"
    ];

    home.configFile = {
      # Link individual files (recursively), rather than whole directory, so
      # other modules (or the user) can write files there later.
      "zsh" = { source = "${hey.configDir}/zsh"; recursive = true; };

      # Why extra.zsh{rc,env} when I could be using extraInit? Because extraInit
      # generates those files in /etc/profile, and mine just write the files to
      # ~/.config/zsh; where it's easier to edit and tweak them in case of
      # issues or when experimenting.
      "zsh/extra.zshrc".text = ''
         # This file was autogenerated, do not edit it!

         # modules.shell.zsh.rcInit
         hey.cache fasd --init posix-alias zsh-{hook,{c,w}comp{,-install}}
         hey.cache ${pkgs.coreutils}/bin/dircolors -b
         ${cfg.rcInit}

         # modules.shell.zsh.rcFiles
         ${concatMapStringsSep "\n\n" builtins.readFile cfg.rcFiles}
      '';

      "zsh/.zshenv".text = ''
        # This file is autogenerated, do not edit it!

        # Be more restrictive with permissions in $HOME; no one has any business
        # reading things that don't belong to them.
        if (( EUID != 0 )); then
          umask 027
        else
          # Be even less permissive if root.
          umask 077
        fi

        # modules.shell.zsh.envInit
        ${cfg.envInit}

        # modules.shell.zsh.envFiles
        ${concatMapStringsSep "\n\n" builtins.readFile cfg.envFiles}
      '';
    };

    # Delete compiled zgenom state, so that everything can rebuild from scratch.
    hey.hooks.reload."80-zsh" = ''
      rm -fv "$ZGEN_DIR"/init.zsh
      rm -frv "$XDG_CACHE_HOME"/zsh/*(DN)
      rm -fv "$ZDOTDIR"/**/*.zwc(D.N)
    '';
  };
}
</file>

<file path="modules/system/fs.nix">
# modules/system/fs.nix --- TODO
#
# TODO

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.system.fs;
in {
  options.modules.system.fs = {
    enable = mkBoolOpt true;
    zfs.enable = mkBoolOpt (any (x: x ? fsType && x.fsType == "zfs") (attrValues config.fileSystems));
    nfs.enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable (mkMerge [
    {
      # Support for more filesystems (for external drives)
      environment.systemPackages = with pkgs; [
        exfat       # ExFAT drives
        ntfs3g      # Windows drives
        hfsprogs    # MacOS drives
        cryptsetup  # for Luks drives
      ];

      # A daemon that lets us mount/poll disks in userspace. I'd prefer udevil,
      # since it's daemon-less, but it's unmaintained and doesn't understand
      # encrypted filesystems.
      services.udisks2.enable = true;
    }

    (mkIf cfg.zfs.enable (mkMerge [
      {
        boot.loader.grub.copyKernels = true;
        boot.supportedFilesystems = [ "zfs" ];
        services.zfs.autoScrub.enable = true;

        # TODO: services.zfs.autoSnapshot/services.sanoid
      }

      (mkIf cfg.zfs.mail.enable {
        # TODO: services.zfs.zed.enableMail
      })
    ]))

    (mkIf cfg.nfs.enable {
      services.nfs.server.enable = true;
    })
  ]);
}
</file>

<file path="modules/system/utils.nix">
# modules/system/utils.nix --- TODO
#
# TODO

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.system.utils;
in {
  options.modules.system.utils = {
    enable = mkBoolOpt false;
    benchmarks.enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable (mkMerge [
    {
      environment.systemPackages = with pkgs; [
        glances
        bandwhich # network utilization monitor
        hwinfo
        iftop
        ioping
        lm_sensors
        lsof
        pciutils  # lspci
        powertop
        smartmontools
        sysstat   # sar, iostat, pidstat
        unixtools.netstat
        usbutils  # lsusb
      ];
    }

    (mkIf cfg.benchmarks.enable {
      environment.systemPackages = [
        sysbench
        unigine-valley
        speedtest-cli
      ];
    })
  ]);
}
</file>

<file path="modules/themes/autumnal/config/inkscape/default-template.svg">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   inkscape:version="1.0 (4035a4fb49, 2020-05-01)"
   id="svg1923"
   version="1.1"
   viewBox="0 0 210 297"
   height="297mm"
   width="210mm">
  <defs
     id="defs1917" />
  <sodipodi:namedview
     inkscape:window-maximized="1"
     inkscape:window-y="0"
     inkscape:window-x="1920"
     inkscape:window-height="1404"
     inkscape:window-width="2558"
     inkscape:snap-page="true"
     borderlayer="true"
     inkscape:showpageshadow="false"
     inkscape:pagecheckerboard="true"
     showgrid="false"
     inkscape:document-rotation="0"
     inkscape:current-layer="layer1"
     inkscape:document-units="mm"
     inkscape:cy="957.95113"
     inkscape:cx="307.6222"
     inkscape:zoom="1.5412019"
     inkscape:pageshadow="2"
     inkscape:pageopacity="0"
     borderopacity="1.0"
     bordercolor="#666666"
     pagecolor="#282c34"
     id="base" />
  <metadata
     id="metadata1920">
    <rdf:RDF>
      <cc:Work
         rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
        <dc:title></dc:title>
      </cc:Work>
    </rdf:RDF>
  </metadata>
  <g
     sodipodi:insensitive="true"
     id="layer1"
     inkscape:groupmode="layer"
     inkscape:label="Background">
    <rect
       ry="0"
       y="0"
       x="0"
       height="297"
       width="210"
       id="rect1927"
       style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.264583" />
  </g>
  <g
     inkscape:label="Layer 1"
     id="layer2"
     inkscape:groupmode="layer" />
  <inkscape:templateinfo>
    <inkscape:name>Default template</inkscape:name>
    <inkscape:date>2020-08-05</inkscape:date>
  </inkscape:templateinfo>
</svg>
</file>

<file path="modules/themes/autumnal/config/librewolf/userstyles/stylus-2020-02-11.json">
[
	{
		"enabled": true,
		"updateUrl": null,
		"md5Url": null,
		"url": null,
		"originalMd5": null,
		"installDate": 1562423881810,
		"name": "Monospace textareas",
		"sections": [
			{
				"code": "textarea {\n    font-family: monospace;\n}"
			}
		],
		"updateDate": 1562423881810,
		"id": 3
	},
	{
		"enabled": true,
		"updateUrl": "https://userstyles.org/styles/chrome/119903.json",
		"md5Url": "https://update.userstyles.org/119903.md5",
		"url": "http://userstyles.org/styles/119903",
		"originalMd5": "0b2b6adac6c0d80d1e0512d007323127",
		"installDate": 1565469520822,
		"sections": [
			{
				"urls": [],
				"urlPrefixes": [],
				"domains": [
					"www.keyhero.com"
				],
				"regexps": [],
				"code": "body {\r\n    background-color: #2C2C2C !important;\r\n    color: #ccc;\r\n}\r\n.description-block {\r\n    background-color: #2C2C2C !important;\r\n    color: white !important;\r\n}\r\ntr.head td {\r\n    background-color: #2C2C2C !important;\r\n    color: white !important;\r\n}\r\ndiv.new-post a {\r\n    background-color: #2C2C2C !important;\r\n    color: white !important;\r\n}\r\n.quote-current {\r\n    background: black;\r\n}\r\n.quote-left {\r\n    color: black;\r\n}\r\n.navbar-default .navbar-collapse,\r\n.navbar-default .navbar-form {\r\n    background: #202020 !important;\r\n}\r\n.navbar-default {\r\n    background-color: #202020 !important;\r\n    box-shadow: none !important;\r\n}\r\nh4,\r\n.h4 {\r\n    color: #ccc !important;\r\n}\r\nspan {\r\n    color: #A2A2A2 !important;\r\n}\r\n.dl-horizontal dd {\r\n    background-color: #2c2c2c !important;\r\n}\r\n.dl-horizontal dt {\r\n    color: #808080 !important;\r\n}\r\n.table-striped>tbody>tr:nth-child(odd)>td,\r\n.table-striped>tbody>tr:nth-child(odd)>th {\r\n    background: #2c2c2c !important;\r\n}\r\n.row {\r\n    background: #2c2c2c !important;\r\n}\r\nfooter {\r\n    background: #2c2c2c !important;\r\n}\r\nh3,\r\n.h3 {\r\n    color: #ccc !important;\r\n}\r\n.alert-info {\r\n    background: #3c3c3c !important;\r\n}\r\n.form-control {\r\n    background: #202020 !important;\r\n    color: #ccc !important;\r\n    border: none !important;\r\n}\r\n.table>thead>tr>th, .table>tbody>tr>th, .table>tfoot>tr>th, .table>thead>tr>td, .table>tbody>tr>td, .table>tfoot>tr>td {\r\n    background: #3c3c3c !important;\r\n}\r\ninput, button, select {\r\n    background: #2c2c2c !important;\r\n}\r\ntextarea {\r\n\tbackground: #3c3c3c !important;\r\n}\r\n.panel-body {\r\n    background: #3c3c3c !important;\r\n}\r\n.panel-default>.panel-heading {\r\n    background: #3c3c3c !important;\r\n}\r\n.quote-bg-error {\r\n    background: #4c4c4c !important;\r\n}\r\n.correction {\r\n    background: #2c2c2c !important;\r\n}\r\n.label-awesome {\r\n    background-color: #84840B !important;\r\n}\r\n#tooltip {\r\n    background-color: #202020 !important;\r\n}\r\n.legendLabel {\r\n    background: #202020 !important;\r\n    color: #ccc !important;\r\n}\r\n.btn-success {\r\n    background: #21692B !important;\r\n    border-color: #21692B !important;\r\n}\r\n.btn-info {\r\n\tbackground: #772953 !important;\r\n}\r\n.well {\r\n \tbackground: #202020;   \r\n}\r\n.navbar-default .navbar-nav>li>a {\r\n\tcolor: #ccc !important;\r\n}\r\n.media, .media-body {\r\n\tbackground: #262626 !important;\r\n\tborder-radius: 5px !important;\r\n}\r\n.table-striped>tbody>tr:nth-child(odd)>td, .table-striped>tbody>tr:nth-child(odd)>th {\r\n\tbackground: #3c3c3c !important;\r\n}\r\n.topic-message {\r\n\tborder: none !important;\r\n\tborder-radius: 5px !important;\r\n\tbackground: #202020 !important;\r\n}\r\n.pager li>a, .pager li>span {\r\n\tbackground: #202020 !important;\r\n\tborder: 1px solid #313131 !important;\r\n}\r\n.btn-link {\r\n\tbackground: #242424 !important;\r\n\tborder-radius: 5px;\r\n}\r\n.btn-primary {\r\n\tbackground: #dd4814 !important;\r\n}\r\n.comment-reply {\r\n\tbackground: #2c2c2c !important;\r\n\tborder-radius: 3px !important;\r\n}\r\n.btn-default {\r\n\tborder-color: #202020 !important;\r\n}\r\n.parent-message {\r\n\tbackground: #2c2c2c !important;\r\n}\r\n.alert-warning {\r\n\tbackground: #3c3c3c !important;\r\n\tborder-color: #a9a9a9 !important;\r\n}\r\n.label-great {\r\n    background: #8E4D00;\r\n}\r\n\r\n/* vimmium styles */\r\ndiv.internalVimiumHintMarker {\r\n \tborder: black !important;\r\n\tbackground: rgb(78, 146, 255) !important;\r\n}\r\ndiv.internalVimiumHintMarker span {\r\n    color: black !important;\r\n    text-shadow: none !important;\r\n}\r\ndiv.internalVimiumHintMarker {\r\n\tcolor: red !important;\r\n}\r\ndiv.internalVimiumHintMarker > .matchingCharacter {\r\n\tcolor: white !important;\r\n}\r\n/* 14.11.2015 12:35 */"
			}
		],
		"name": "KeyHero: Dark Reign",
		"originalDigest": "74af3625a2069f9717126deec918ef9d35e35d0a",
		"id": 5
	},
	{
		"enabled": true,
		"updateUrl": "https://userstyles.org/styles/chrome/169544.json",
		"md5Url": "https://update.userstyles.org/169544.md5",
		"url": "http://userstyles.org/styles/169544",
		"originalMd5": "98c3766882c44152c5b3afc51fc7327e",
		"installDate": 1566107759034,
		"sections": [
			{
				"code": "body {\n    background-color: #1E2029!important\n}\ndiv.grid_page,\ndiv[class*=\"side_bar\"],\ndiv[class*=\"sidebar\"],\ndiv[class*=\"Sidebar\"] {\n    background-color: #1E2029!important\n}\ndiv.Toggle.ContentPageFeed.SimpleToggle {\n    background-color: #1E2029!important\n}\n.SiteHeader {\n    background-color: #282a36!important;\n    border-bottom: 1px solid #373844!important\n}\nspan.expanded {\n    color: gainsboro!important\n}\nspan.expanded:hover {\n    color: #6272a4!important\n}\n.ui_qtext_rendered_qtext,\n.rendered_qtext {\n    color: #b6b6c2!important\n}\ndiv.AmaSelfServeQuestionsPrompt {\n    background-color: #1E2029!important\n}\n.selector_input.text {\n    color: gainsboro!important\n}\ndiv[class*=\"story\"],\ndiv[class$=\"answer\"] {\n    background-color: #282a36!important\n}\ndiv[id$=\"item\"] {\n    background-color: #282a36!important\n}\n.container,\ndiv[class*=\"bundle\"] {\n    background-color: #282a36!important\n}\n.comments_preview_toggle,\n.answer_auto_expanded_comments,\n.show_child_link {\n    background-color: #282a36!important\n}\n.BetterUserHoverMenuContents,\n.BetterTopicHoverMenuContents.ObjectCard {\n    background-color: #1E2029!important\n}\na.user,\n.NameCredential,\n.TopicName,\n.header_text_main,\n.user,\n.prompt_title,\ndiv[class^=\"answer\"] {\n    color: lightgrey!important\n}\n.layout_1col_main_card,\n.layout_1col_secondary_card {\n    background-color: #282a36!important\n}\n.grid_page h3 {\n    color: #b6b6b2!important\n}\n.AboutListItem .main_text,\n.UserCredential {\n    color: #b6b6b2!important\n}\n.icon_action_bar.sticky,\n.hover_menu_title {\n    background-color: #282a36!important\n}\n.hover_menu_contents,\n.Notif {\n    background-color: #1E2029!important;\n    color: white!important\n}\n[class*=\"LookupBarResults\"] {\n    background-color: #1E2029!important;\n    color: #f8f8f2!important\n}",
				"regexps": [
					"https?://(www|blog).quora.com.*"
				]
			}
		],
		"name": "Quora - Dark focused mode",
		"originalDigest": "fabde60a33e2fc6a17c8c3f585c652854c631728",
		"id": 6,
		"updateDate": 1581131678066
	},
	{
		"enabled": true,
		"updateUrl": "https://userstyles.org/styles/chrome/124693.json",
		"md5Url": "https://update.userstyles.org/124693.md5",
		"url": "http://userstyles.org/styles/124693",
		"originalMd5": "963068df63c3ae5642decc633d44f6d0",
		"installDate": 1572046592546,
		"sections": [
			{
				"urls": [],
				"urlPrefixes": [],
				"domains": [
					"stackexchange.com",
					"superuser.com",
					"askubuntu.com"
				],
				"regexps": [],
				"code": "/* @-moz-document regexp(\"^https?://((chat|meta)\\.)?((tex|math|unix)\\.)?stackexchange\\.com.*\") { */\r\n /***************************************************************\r\n \r\n  \r\n Worlbuilding Dark v0.9.1 (05/10/2014)\r\n\r\n - 0.9.1\r\n   - fixed answered questions not showing up with a different color\r\n  \r\n  based on:\r\n  \r\n StackOverflow Dark v2.5.7 (10/2/2014)\r\n https://github.com/StylishThemes/StackOverflow-Dark\r\n http://userstyles.org/styles/35345\r\n\r\n this is still quite crude\r\n  \r\n  the logo image is made by me ivycarp@gmail.com from a public domain\r\n  image created by NASA that you can find on Wikipedia\r\n ****************************************************************/\r\n  \r\n  /***** Modifications by Abhishek Chakraborty *****/\r\n  \r\n  /*** codereview.stackexchange.com ***/\r\n  #question-header {\r\n    background-color: #232323;\r\n  }\r\n  \r\n  #mainbar {\r\n    background-color: transparent;\r\n  }\r\n  \r\n  #sidebar .module:not(.community-bulletin) {\r\n    background-color: transparent;\r\n  }\r\n  \r\n  #sidebar .ad-container {\r\n    background-color: #232323;\r\n  }\r\n  \r\n  div.ad > a > img {\r\n    filter: invert(100%);\r\n  }\r\n  \r\n  #footer #footer-menu {\r\n    background-color: transparent;\r\n  }\r\n  \r\n  /*** askubuntu.com ***/\r\n  \r\n  #footer .footerwrap {\r\n    background-color: transparent;\r\n  }\r\n  \r\n  /***************************************************/\r\n  \r\n\r\n * {\r\n  border-color: #444 !important;\r\n  text-shadow: none !important;\r\n  box-shadow: none !important;\r\n }\r\n\r\n  #content{\r\n    background-color: rgba(255,255,255,0);\r\n  }\r\n  \r\n  .mention{\r\n    background-color: #666;\r\n    color: #111;\r\n  }\r\n  .reviewed-action{\r\n    background-color: #444 !important;\r\n    color: #00aa00 !important;\r\n    \r\n  }\r\n  span.comments{\r\n    color: #aaa !important;\r\n  }\r\n  div.cp div{\r\n    border: 0px !important;\r\n  }\r\n  .bottom-notice{\r\n    background-color: #222;\r\n  }\r\n  #promo-box{\r\n    background-color: #222;\r\n  }\r\n  table.history-table tbody tr span[style*=\"color:maroon;\"]{\r\n    color: red !important;\r\n  }\r\n  div.question-summary.narrow:not(.tagget-interesting) div.cp div{\r\n    background: none !important;\r\n  }\r\n  div.status.answered-accepted > *{\r\n    color: #4C9067 !important;\r\n  }\r\n  div.status.answered-accepted{\r\n    border: 1px solid #4C9067 !important;\r\n    width: 46px !important;\r\n    height: 36px !important;\r\n  }\r\n\r\n body, .container, #footer {\r\n  background-color: #191919 !important;\r\n  background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAgMAAAANjH3HAAAACVBMVEUaGhohISElJSUh9lebAAAB20lEQVRIx4XWuZXDMAwE0C0SAQtggIIYoAAEU+aKOHhYojTrYP2+QfOW/5QIJOih/q8HwF/pb3EX+UPIveYcQGgEHiu9hI+ihEc5Jz5KBIlRRRaJ1JtoSAl5Hw96hLB1/up1tnIXOck5jZQy+3iU2hAOKSH1JvwxHsp+5TLF5MOl1/MQXsVs1miXc+KDbYydyMeUgpPQreZ7fWidbNhkXNJSeAhc6qHmHD8AYovunYyEACWEbyIhNeB9fRrH3hFi0bGPLuEW7xCNaohw1vAlS805nfsrTspclB/hVdoqusg53eH7FWot+wjYpOViX8KbFFKTwlnzvj65P9H/vD0/hibYBGhPwlPO8TmxRsaxsNnrUmUXpNhirlJMPr6Hqq9k5Xn/8iYQHYIuQsWFC6Z87IOxLxHphSY4SpuiU87xJnJr5axfeRd+lnMExXpEWPpuZ1v7qZdNBOjiHzDREHX5fs5Zz9p6X0vVKbKKchlSl5rv+3p//FJ/PYvoKryI8vs+2G9lzRmnEKkh+BU8yDk515jDj/HAswu7CCz6U/Mxb/PnC9N41ndpU4hUU7JGk/C9PmP/M2xZYdvBW2PObyf1IUiIzoHmHW9yTncliYs9A9tVNppdShfgQaTLMf+j3X723tLeHgAAAABJRU5ErkJggg==) !important;\r\n  background-clip: border-box !important;\r\n  background-origin: padding-box !important;\r\n  background-repeat: repeat !important;\r\nbackground-size: auto !important;\r\nbackground-position: left top !important;\r\n  background-attachment: scroll !important;\r\n }\r\n\r\n /* === custom color === */\r\n a, .profile-popup a, .seWrapper a, .post-tag, .comments-link, .tag-synonym-link {\r\n  color: #4183C4 !important\r\n }\r\n/*\r\n .nav .primarynav li a:hover {\r\n  color: #fff !important;\r\n  background: #4183C4 !important;\r\n }\r\n*/\r\n  \r\n .post-tag:hover, .comments-link:hover, .summary .post-tag:hover , .commentslink, .bounty-indicator,\r\n .bounty-indicator-tab, .bounty-award {\r\n  background-color: #4183C4 !important;\r\n  color: #eee !important;\r\n }\r\n\r\n /* === text selection === */\r\n ::selection {\r\n  background: #4183C4 !important;\r\n  color: #fff !important;\r\n }\r\n ::-moz-selection {\r\n  background: #4183C4 !important;\r\n  color: #fff !important;\r\n }\r\n\r\n /* === input focus hightlight === */\r\n input:focus {\r\n  border-color: #4183C4 !important;\r\n  box-shadow: 0px 1px 2px rgba(255, 255, 255, 0.075) inset, 0px 0px 5px rgba(255, 255, 255, .075) !important;\r\n }\r\n .tag-editor input:focus {\r\n  border: 0 !important;\r\n  box-shadow: none !important;\r\n }\r\n\r\n /* === hidden === */\r\n div.hireme, div#hireme {\r\n  display: none !important;\r\n }\r\n\r\n /* === background color === */\r\n /* from darkest to lightest grey */\r\n .search-container input[type=text] {\r\n  background-color: #000 !important;\r\n }\r\n\r\n #custom-header, .review-bar, .diff-choices a.selected, #header #topbar, td.owner, a.owner, .question-status,\r\n .profile-popup, .profile-popup div, .profile-popup th, .profile-popup td, #global, .actual-edit-overlay,\r\n input:not([type='submit']), textarea, #search input, .tag-editor {\r\n  background-color: #111 !important;\r\n  color: #ddd !important;\r\n }\r\n\r\n .summary .post-tag, .onebox, .profile-ad {\r\n  background: #151515 !important;\r\n }\r\n\r\n html, blockquote, #post-preview, .nav .primarynav li a, #container, #hsearch .textbox, .form-item, .grippie,\r\n .welovestackoverflow, #wmd-button-bar, .wmd-button-bar, .qa-block, .content-block, .user-info-rep, .sidebar,\r\n .popup {\r\n  background: #191919 none !important\r\n }\r\n\r\n .authcomment, .seIntro, .seFooter {\r\n  background-color: #191919 !important;\r\n  border: 2px solid #262626 !important;\r\n }\r\n\r\n #tabs a {\r\n  border: 1px solid transparent !important;\r\n }\r\n\r\n #tabs a.youarehere, .tag-suggestions {\r\n  background: #191919 !important;\r\n  border: 1px solid #444 !important;\r\n }\r\n  \r\n  .nav .youarehere{\r\n    font-weight: bold !important;\r\n    background: none !important;\r\n    color: blue !important;\r\n  }\r\n\r\n #user-about-me, .user-about-me, .mine .messages {\r\n  background: #191919 !important;\r\n  border: 0px !important;\r\n  color: #C1BEBA !important;\r\n }\r\n\r\n .topbar-dialog .header, .topbar-dialog .modal-content li:hover, .share-tip,\r\n #tag-menu, .sidebar h3, #overlay-header, .action-list .action-selected, .switcher-nudge-lightbox,\r\n .user-rep-chart-summary-tooltip:hover, #footer {\r\n  background-color: #222 !important;\r\n  color: #ddd !important;\r\n }\r\n\r\n .profile-popup, .profile-popup tr, .profile-popup th, .profile-gravatar, .newuser, .roomcard,\r\n .seWrapper, h2.index.header, .privilege-table-row:hover {\r\n  background-color: #222 !important;\r\n  border-color: #555 !important;\r\n  color: #ddd !important;\r\n }\r\n\r\n #header #topbar, .revision-comment, .date-span, .post-tag, .form-submit input, .preferred-login,\r\n .mdhelp, .wmd-help-button.active-help, .date_brick, .more-info {\r\n  background: #222 !important;\r\n  color: #ddd !important;\r\n  -webkit-border-radius: 3px !important;\r\n  border-radius: 3px !important;\r\n }\r\n\r\n .ad502-room, .messages, .messages,.topbar-dialog .unread-item {\r\n  background-color: #232323 !important;\r\n  border: 1px solid #191919 !important;\r\n }\r\n\r\n .rep-recent-row, .bounty, .diff-choices a:hover, div.meter, .narrow .votes, .stats, .ob-post-votes {\r\n  background-color: #232323 !important;\r\n  color: #bbb !important;\r\n }\r\n\r\n .answer, #system-message, .commentlist, .revision td, #hero-content, .mdhelp-tabs .selected, .tabs .selected {\r\n  background: #232323 !important;\r\n  color: #999 !important;\r\n }\r\n\r\n .tagged-interesting, .tagged-interesting .views, .highlight-row, .highlighted {\r\n  background-color: #242424 !important;\r\n  background-image: none !important;\r\n }\r\n\r\n /*.nav li,*/ .seNav, .topbar a.topbar-icon-on, .topbar a.topbar-icon-on:hover, .topbar-dialog, .owner,\r\n .module li.current, .seCurrent, .community-bulletin, .owner-revision td, .markdown-diff .skip,\r\n #footer .container, .current-site-container, .body-diffs .skip, .newsletter-anon, .tag-suggestions>div:hover {\r\n  background-color: #333 !important;\r\n }\r\n\r\n .owner-answer, .question-status, #input-area, .notification, #feed-ticker, #top-menu, .vote-revision td {\r\n  background: #404040 !important;\r\n }\r\n\r\n tr.comment:hover, .reply-parent, .timestamp, .usercard, .page-numbers.current,\r\n .comment-help, .answer-help-background, .mdhelp-tabs, .tabs li, .hi, .seNavLinks a:hover,\r\n .seNavLinks a:focus, .itemBoxNew {\r\n  background-color: #444 !important;\r\n  color: #ddd !important;\r\n }\r\n\r\n #post-text-container div span {\r\n  background: #c1beba !important\r\n }\r\n\r\n /* === Brown(ish) === */\r\n .new-post-activity, #new-answer-activity {\r\n  background-color: #840 !important;\r\n }\r\n\r\n /* chat room buttons */\r\n a.button {\r\n  background: #840 !important;\r\n  color: #eee !important;\r\n }\r\n\r\n .supernovabg, .hotbg, /*.nav .youarehere,*/ /*.nav li:hover,*/ a.button:hover {\r\n  background-color: #d80 !important;\r\n }\r\n\r\n /* === Green === */\r\n .accepted-answer, .suggested-edit .inserted, .markdown-diff .inserted {\r\n  background: #232 !important;\r\n }\r\n\r\n .answered, .answer-votes {\r\n  background: #232323 !important;\r\n  /*color: #4b553c !important*/\r\n   color: #00aa00 !important\r\n }\r\n\r\n .answered-accepted, .answered-accepted strong, .rep-up.bounty-indicator-tab, .user-rep-chart-summary-bar {\r\n  background: #4b553c !important;\r\n  color: #fff !important;\r\n    border: none !important;\r\n }\r\n\r\n .answered strong {\r\n  color: #4b553c !important\r\n }\r\n\r\n /* === Red === */\r\n .deleted-answer, .suggested-edit .deleted, .markdown-diff .deleted {\r\n  background-color: #200 !important;\r\n }\r\n\r\n a.moderator-tag {\r\n  background-color: #400 !important;\r\n }\r\n\r\n a.moderator-tag:hover {\r\n  background-color: #600 !important;\r\n }\r\n\r\n /* === Transparent background === */\r\n div.message .meta, .spaces, .comment, span.feed-icon, a.role-switch, .nav.careers li, .nav.careers li:hover,\r\n .switcher-nudge-content p {\r\n  background-color: transparent !important;\r\n }\r\n\r\n #tabs a:hover {\r\n  background-color: transparent !important;\r\n  border: 1px solid #666666 !important;\r\n  border-bottom: 1px solid #444 !important;\r\n }\r\n\r\n .highcharts-container rect[fill=\"#FFFFFF\"], rect[fill=\"rgb(255, 255, 255)\"] {\r\n  fill: transparent !important;\r\n }\r\n\r\n /* === Dark border === */\r\n .body-diffs table * {\r\n  border-color: #111 !important;\r\n }\r\n\r\n a.required-tag, .welovestackoverflow, .question-summary {\r\n  border-color: #333 !important;\r\n }\r\n\r\n #tabs a.youarehere {\r\n  border-bottom: 1px solid #191919 !important;\r\n }\r\n\r\n /* === No/hide border === */\r\n div.list > div {\r\n  border-right: 0 !important;\r\n }\r\n\r\n .module {\r\n  border-color: transparent !important;\r\n }\r\n\r\n /* blue label count */\r\n .bounty-indicator-tab {\r\n  background: #07d !important;\r\n  color: #ccc !important;\r\n }\r\n\r\n /* === Text Color === */\r\n div, input, .accepted-answer .post-text, .accepted-answer .user-action-time, #question-header a,\r\n .post-text, .user-info, .topbar-dialog .header h3, .topbar-dialog .header h3 a, .topbar-dialog span,\r\n .search-result .answered .vote-count-post strong, .votes-cast-stats th {\r\n  color: #ddd !important;\r\n }\r\n\r\n /* placeholder */\r\n ::-webkit-input-placeholder {\r\n  color: #ddd !important;\r\n }\r\n ::-moz-placeholder {\r\n  color: #ddd !important;\r\n }\r\n\r\n .user-details td, .content-page, h2, h2 a, .profile-popup a:hover, .module h4, .page-description,\r\n #openid_identifier, .form-item label {\r\n  color: #c1beba !important\r\n }\r\n\r\n .comment, #top-menu a, .subheader a, .reputation a, .reputation-score, a:visited, .relativetime.old,\r\n .votes-cast-stats td {\r\n  color: #aaa !important;\r\n }\r\n\r\n .answered-accepted strong, .youarehere, .nav .primarynav li a, .nav a, a:hover, .rep-up.special-rep {\r\n  color: #fff !important\r\n }\r\n\r\n input, .actual-edit-overlay {\r\n  -webkit-text-fill-color: #fff !important;\r\n }\r\n\r\n .rep-up {\r\n  /*color: #4b553c !important;*/\r\n   color: #00dd00 !important;\r\n }\r\n .rep-down {\r\n  color: #d65 !important;\r\n }\r\n\r\n /* dark blue */\r\n .result-highlight {\r\n  color: #aa0 !important;\r\n }\r\n\r\n /* brown/dark orange */\r\n .warm {\r\n  color: #840 !important;\r\n }\r\n\r\n /* orange */\r\n .hot {\r\n  color: #a20 !important;\r\n }\r\n\r\n /* light brown */\r\n .unanswered {\r\n  color: #9a4444 !important;\r\n }\r\n\r\n /* === Style adjustments === */\r\n a.question-hyperlink, a:hover, a:visited {\r\n  text-decoration: underline !important;\r\n }\r\n\r\n .nav a, .post-tag, .comments-link, .tag-synonym-link, a.post-tag:hover, .topbar a {\r\n  text-decoration: none !important;\r\n }\r\n\r\n .post-tag, .comments-link, .tag-synonym-link {\r\n  margin: 2px !important;\r\n  padding: 3px !important;\r\n  font-size: 80% !important;\r\n  line-height: 2.2 !important;\r\n  white-space: nowrap !important\r\n }\r\n\r\n .stats {\r\n  float: right !important;\r\n  margin-top: 5px !important;\r\n }\r\n\r\n #hsearch, .statscontainer {\r\n  margin-right: 5px !important;\r\n }\r\n\r\n .stats {\r\n  margin-bottom: 4px !important;\r\n }\r\n\r\n .nav .primarynav li a {\r\n  display: block !important;\r\n  float: left !important\r\n }\r\n\r\n /* === badges === */\r\n a.badge[title^=\"bronze\"], a.badge-tag[title^=\"bronze\"], .badge3 + .badgecount {\r\n  color: #cc9966 !important;\r\n }\r\n a.badge[title^=\"silver\"], a.badge-tag[title^=\"silver\"], .badge2 + .badgecount {\r\n  color: #c5c5c5 !important;\r\n }\r\n a.badge[title^=\"gold\"], a.badge-tag[title^=\"gold\"], .badge1 + .badgecount {\r\n  color: #ffcc46 !important;\r\n }\r\n .badge-tag {\r\n  background-color: #191919 !important;\r\n  border-color: #111 !important;\r\n }\r\n\r\n /* === code & syntax highlighting === */\r\n pre, code, .pln, .youarehere {\r\n  background: #333 !important;\r\n  color: #ccc !important;\r\n }\r\n\r\n .str { color: #0a0 !important; }\r\n .lit { color: #d65 !important; }\r\n .pun { color: #999 !important; } /* parenthesis */\r\n .kwd { color: #08f !important; } /* keyword */\r\n .tag { color: #999 !important; } /* html tag */\r\n .atn { color: #088 !important; } /* attribute */\r\n .atv { color: #0a0 !important; } /* attribute value*/\r\n .dec { color: #90a !important; } /* doc type */\r\n\r\n /* === Images === */\r\n .wmd-button>span {\r\n  background-image: url(http://StylishThemes.github.io/StackOverflow-Dark/images/wmd-buttons.png) !important;\r\n }\r\n\r\n .statsarrow {\r\n  width: 7px !important;\r\n  height: 13px !important;\r\n  background: url('data:image/gif;base64,R0lGODlhBwANAIAAACMjI////yH5BAEAAAEALAAAAAAHAA0AAAITRI5gGLrnXlzT1NsidEkx/zFHAQA7') 0 0 !important;\r\n }\r\n\r\n #hlogo img, .everyonelovesstackoverflow, #newsletter-ad { opacity: 0.3 !important; }\r\n\r\n /* chat domain logo */\r\n #header-logo a {\r\n  display: block;\r\n  width: 150px !important;\r\n  height: 36px !important;\r\n  background-size: cover !important;\r\n  background-position: 0 -2px !important;\r\n }\r\n\r\n #header-logo img {\r\n  display: none;\r\n }"
			},
			{
				"urls": [],
				"urlPrefixes": [],
				"domains": [],
				"regexps": [
					"^https?://(chat.)?worldbuilding.stackexchange.com.*"
				],
				"code": "#hlogo a {\r\n  /* background-image: url(http://StylishThemes.github.io/StackOverflow-Dark/images/logo.png) !important; */\r\n  /* background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAAA9CAYAAACEAXQxAAAgAElEQVR4nMyd519U1xb3T6JXyI2JJorSq/Te29CbdJDee1GwxQoYbNgwCgYxiAVFUCzYiYgokaKoqInGaJJ7b+697/Vf+D0vzqw9+xxmAE3u8zwv9mdgGGbOOXO+e631W2uvLXxzYQO+ubABe8+twd5za9DQVYXaE4XY+F0uvvo2C199m4WV+9NR0ZCM8p1JKN+ZhLIdiahoSEZxfTzya2KQs2EpCuviUFgXh6Kv45C1NhI566OQsz4KGavDkb4qDJlrIrC2OQvxJQoklgUirkh8pJFQGoD4EgXiihRIrgxCcmUQUqtCkb4qDPElCizN9UVElhei830RW+iP9FVhSCoPQkJpAJLKgxCd74vofPE1EVleCEv3RFi6JwKTXBGY5ApFgjO8IuzgHWkPvxhHxJcoYONhAjsvM9h4mMDGwwRWrsawdDGCmb0+TO30YGytC2NrXRhaLGLDwFyHDX2zhdAzXYDFRl9isdGX0DGYj4X687BAdx6+XPw5vlj0Gb5Y9Bnm68zFF4s+g67xAszXmYv5OnMxb4FqfP7lp5i3YC7722KjL2HtZgIDcx0YWy2GqZ0eljgbwiXACg4+FnAPsYFvtAPC0j0RV6RAUnkQ0laGImN1OLLXRSJnw1J2/XPWRyF3YzSy1kYifVUYe13G6nCkVoUitSoUSeVBSCoPQlyRgo34EgViC/0RW+iPpbm+iMrxQVyR+Fx0vi8is73Zd5G5JgJpK0PZd5haFYq0leJIWRGC6HxfLM31RVyRgn12+qowxBb6IzDJFd6R9vCKsINXhB18ox3gFWEH9xAbOPpZSIaDjwVsPU1h62kKGw8T9mjjYQJrN9WwcjWGlasxljgbThoWjqph7mDAhpm9Pszs9fHzHxOS303t9CT3grG1LoytFk+6H/TNFkLfbCF0jcX7YZHhF1hk+IXkfuC/+7nzP8Hc+Z/g088/wd8/08Ync7UkY4723zB7ziw2Zs2ehY9nfYyPPv4IwkfCjMbsObNUv7de24aWK/Vo7q3Fvp612HtuDbadLsfmo/moaS/AprY8bGrLw9pmEfjqxjSs3J+OlfvTUbUvFcX18SjdloiyHYko3ZaIkq0JKKyLQ0FtLArr4tjNlrkmgt0QqVWhSK4MYjde5poIZK+LRNbaSHYTpK8KQ876KHxzYQO7aQh++h8aNKHQjcVPIHFFCkTn+yI8wwuhaR4ITfPA0lxfKBKc4R1pD7dga7gEWMHRzwKxhf54/d/n7EYws9eHiY34JRtZqodd13gB+1IXGX4hgf2LRZ9JgDcw15kEOk0COgbzoWMwH7rGC2BosQjGVoth7mAAK1dj2HmZwVlhCe9Ie4SleyI635fBTedfUBuL3I3RyNscza5/QW2sCP2GpchaG8lgJ9jomqVWifAvWx6Mjv79iCnwQ3yJasKliYCuZ9rKUORujEbOhqVIWRGC/JoYpFaForAuDiVbE5C9LhKJZYGIzvdlr6fviMAPSnaDIs4ZfjGO8Iqwg1+MIzxCbeEeYgPXICs4+S+Bk/8SOPhYwN7bnAE+E9B54DXBLgechoWjIYPbxEaPff8EuJm9vuT71zNdwCb7mcBNYBPc2p/OgdYnc/A3rdn4m9ZsCdjvA/W04+jNXfju+k60XtuG1mvbcODiRuzrWYvd3avQ0FWFHZ3Lse10ObadLkftiUJsaM3FprY8bGjNxbqWbKzcn44Ve1NQvjMJX32bhYqGZFQ0JKNkawIqGpJRtS9V4gkU18ejZGsCiuvj2SRRvjMJlbuWscniq2+zmNdAf1uxNwUr9qZgQ2suKnctmzTovYrr41FYF4e8zdHMstENTvCTVQrP8GIW3y/GEf6xTsjdGM1uoCXO4g1BX7oceEOLRWwW579kGjzscgs/b4EI+EL9eVhs9CWz3mb2+rByNYa1mwkc/SzgG+2AwCRXRGZ7I6k8CBmrwxnYRV/HsVG2Q5xs6XcCXQ575poIZKwOR+aaCDah0qSavioMP/7jIbLWRjL401eFiR7ahqUoqI1F5a5lKNmawCbVgtpY9j3n18QgoTQAcUUKZK2NZJN+9rpIJFeqPIbqxjRmtWm4BllJBoHOW3PeovPA87DbeppOadk1WXLeeksAt1oMI0vp5K4OcB5uApy8NbnlJmvOW+zZc0Sw/1K4+XH8+304/v0+tPftxtGbu9B6bRsOXtqEg5c2Yf/59djVXY3d3avY2NVdjfqOUtQcL8Dmo/mi5T9egHUt2dh6qgxffZuFyl3LUL4zCcv3LEN1YxqqG9OwoTUXm4/mY01TJioaktnkUL4zCSv2pqC6MQ0NXVXYdroca5uzsLY5C2uaMrGmKRPrWrLR0FWFDa25qDtZhHUt2dh8NB9bOopRd7IIm9rysK4lG199m4XVBzPYWLE3Bcv3LGMTRtHXcWwSoJuZrFRElhfCM7ygSHCGT5QD3IKt4ehnATsvM1i5GjMLTzeDlasxbD1NmcumyY3noacbYYHuPCwy/AL6ZgtF622tC3MHA1i7mcDe2xzuITYITHJFeIYXEssCRRA3LEXJ1gSUbE1g100+2U0HOsHOW/X0VWHIXqdy63d0LkfmmgjkbY5mYFftS8Xqgxnsc1cdSGfffXVjGrLWRrLjZGHbhqVIWxmK2EJ/RGZ7IzhFtOCKONGT8o60Z5B7hNpOAl0d7E7+S+ARajsJdh54Rz+LSVbd2s1kWmtOcJvY6MHYajED3MhykeT75eGWh2oE92df/B1z56ss998/02aWW+6OE9zqAFf33Bztv30Y6L3DJ3DuXis6B5pwqv8AOvr348j17czCf3tlC5p7a9HYsw77z6/HNxc2YM/Z1djVXY2GrirUd5Rid/cq7Dm7GltPlWHrqTJxImgvwFffisBSrL/+cA7WH85hEK9tzsK6lmzUtBeg5ngBtnQUo76jlAG89VQZak8UYld3NfacXY2Grirs6q7GzjMr0NBVxT53d/cqbO+swLbT5djSUYwtHcWoOS6+5/rDOdjQKuoN1Y1pWL5HBIKsTd7maKSvCkNqVSjiikQtIDjFDX4xjvCJckBElhfsvMxg52UGSxcjLHFW79LzN4M6d17HYL5auC1djBCd7wsn/yVQxDljaa4vEkoDkL0uEgW1sWzCrNylmjTXNGWya0shVNW+VAY7AU+Q7+hcPsmF58MeAjN7nWiFy3YkMg9tQ2suVh0QQ7X959ejZ+gI9pxdjerGNGSvi0TaylBUN6ahbEcicjYsRe7GaCxbHoyILC8R7gRnBCa5IiDRBYFJrvCPdUJMgR8D3SPUlo3pYHfyXwL3EBuNrry6WJ2HnAedt+L8d0nfJ6/BTOeak9Xm4f5krha0PpkjibVnzZ4Mt3xMB+ys2bM+DPRLw8dw7l4rzt49zGA/enMX2vt2o+1GA9puNODozV04fHUrWq9tw5Hr29HcW4umSzX45sIG7Oquxv7z61mc/82FDegebJFMBAQdTQQUDtR3lGJH53IWIuzoXI59PWvxzYUNOHhpE5p7a3Hoch2bdNpuNKD12jZ8d30njlzfjsNXtzIvhI6JPJFvLmxAY8867Dm7momMW0+VYfPRfKw/nIM1TZlYfTAD61qyWUiRsz6KiVPR+b5MKKI4Xg67mb0+E2Z4QUbuzuuZquJuUzs92HubM+vtG+2A4BQ3JJQGIHNNBArr4lDRkIzVBzPw1bdZzHuhsaktD1s6irHtdDk2fieGT+QBVe1LRXVjmsTCl+1IZG4+wU7xdd7maOZRkdezfM8yZrG/+jYLm4/mY0fncrRe24bd3atQtS+V6QGl2xKxfI/oveWsj0JiWSDiS0RNJCrHB8EpbgxuGj5RDqjvKIVHqC18ohwkoKsDngDnLbujn8W0kMsBl1txucBGkzWBPZ2oRlabd8nJahPcMwH7Q2D/oNE3fg5XRjtweeQkLg0fw6XhY+gcaMLJW404ffsgezzWtxfHv9+Hk7cacfJWI/v50OU67D+/Ht9e2YKWK/X47vpOfHtlC5ou1aC5txbNvbU4cHEjg/fgpU345sIGHLpcJ/l706UaHLi4kYF8rG8vOvr3o6N/P07easSp/gPoHmxB92ALzt49jK7BQ2zQ8dJxXR45ySaGi/fb0TnQhMNXt+LgpU3MMyDrv6ktDxu/U1mt4vp4ZK2NxLLlwUgsC0RElheL4UkJtvU0ZdbB1E5vkgpLVtvcwQBGlqL1tnA0ZHArEpzhH+uE6HxfJlSV7UhEdWMavvo2C5va8piHs6WjGDXtqp/rThZJoKewZW2zGLbwoBPApHfwz1U3pmHjd7kMaAqtak8Uor6jFLu6q5lAu/loPqr2pbLMCnkVpdsSkbM+CmkrQ9n1ItCX5ooaCA85DzuN6UDnrTlBbudl9l6Qy+NwsuCmdnoS1ZzCLl5rIbjl8Tap49qfimCTW/4hYM8U+D81CQxM9KJv/Bxujnfj8shJnB9qQ/dgC071H8Cp/gMM9NO3D+JU/wF0DjThzJ1mdA404VjfXrT37cb5oTYG6HfXd6LtRgOOXN+OthsNaO/bjfa+3TjWtxfH+vai7UYDe1173272Gaf6D+BY3172/j1DR9AzdAS9wydweeQkLt5vR+/wCTZoUro0fAwX77ezcWn4GHqGjuD8UBvO3WuVTF7tfbvRem0b80Yae9Zhd/cq7Ohcjpp20c2vbkxDydYE5NfEIGutKCJF5/siJNUdigRneITawiXACraepiwVZ2KjJ1p3LhVHz1m7iTeis8ISPlEOiMrxYa55cX08qhvTmNUmuMn7aOiqYmPrqTIW2tSeKBTDHVlWhKw6ZUdW7E3BqgPpWNuchS0dxag9UYhtp8slIVZ9Rym2d1ZgR+dyHLy0CYcu16HpUg2+vbIF9R2lWL5nGUq3JaJy1zLRM2svQNW+VJRuS0TuxmgGOYHOpzhDUt0RkOiiEfLpQHcJsGIZEV6U41OiPOQkvDn6WTArPsmCc5OyocUijTH3F4s+Uyum8So575IbWizCQv15DMi/EnYe8Jm8Ru24Od6N2xMXcXviIq6NdYJ35WmcudPMYD99+yC6Bg/hzJ1mdA0ewunbB9E50ISO/v0sxuc9AgKXLPHZu4dx4Yej7Lne4RO4Od6NGw+7cPF+O66MdjAPgx4vj5ycBDgP98X77bjww1E25L9f+OEozg+1sWMhD+XQ5ToculyHxp512HlmBUsrkttbXB+P7HWiaBdT4MfEOu9Ie+bK081EVoJSNNZuJnAPsWEhQFyRglnulfvTmTZR31GKhq4q7Dm7WjKae2vZzzzsFPLwIZEc9lUH0vHVt1moOV6AupNF2HlmBZp7a3H46lZQ3URDVxUOXtqE9r7d6Ojfj7YbDWjoqsLG73JZvM9b/M1H87GuJZu56ZlrIpjnQ6k3ymYQ6BSj8/H5dFadh5yHeyrIeXVdU/wtD7HUwa1JKZfD/Vda7Q+B/n0mBzYB3Hp8Ht8/6sHN8W5cHTuFq2OnGOi8tSUXunOgCT1DR3Dhh6PoHmzByVuNGJjoRc/QEYk1Pnv3MC7eb2egUmhwc7ybeQ83x7vRN34OAxO9GJjoxe2Ji+xYro114urYKQa73IqrG3Lwzw+1sUEewvmhNlz44Sg6B5rQNXgIx/r2ouVKPXPrt54qw3fXd2LvuTWoaEhG3uZo7OquxrLlwUydJzfePcSGxeyWLkYsvUMFLZHZ3kiuDELO+ihUNCQzuAncPWdXY1/PWhy4uBEHLm5kYcy+nrXoGTqCAxc3Mp2B/mdH53KV4Hm8QLTuSuA3fpeLmuMF2NG5HLu7V6GxZx3TOUi7aO6txbG+vegdPoGrY6dwrG8vGrqqsPpgBip3LcOWjmKsacpkE9Dmo/nMw+ELolJWhCBlRYgkx05FS9H5vghN8xBz5WpA9412kMAuB12TFech5y24ujQZH3sT3HzcrWMwn1luirn5HDe55HLL/b+AnGJ6+fOzZs+a9PyHegxC3/g55rpff3AGV0Y7cPF+OwOX3HV6PHv3MLoHW3DmTjNLy1FsTJBfGj6G80NtDOab493of3IBtx6fZ2Ngohd3n1/F/Z9uYvhFH+7/dBNDz69j8NkV3J64iP4nF9gxXR07JZkw5EPu0pMLP91kcH6ojYUh313fiebeWlY/QBaMUn85G5YitUpMF4WmebBCD89wW/hGO8A32gGKBGeW787dKApda5oyGXz7z6/HwUub0HKlnmUz6PHI9e04dLkOh69ulWgXBGhjzzrs61nLoCfxctvpcuzoXI6959YwT4DqIg5drmPvceDiRnT072eTaNuNBuzqrkZNewFLTa5pysTr/z7HqgPpTC9YsTeFVT/SyF4XyfLwVMxE1Y2UK4/IEguUEssCWaFSULIbAhJd4BfjyK4Zn093CbCCe4gNnBWWcFZYThLf1LnplPak0IlXzynfzWc/eLjlRSxyuAlsfnw86+NpB8Gl7nn+kQYBre69ZvqZmo6DfhZ++PEGBp9dwZ2nlxmUF344inP3WhkE5Irz8fmp/gM4ffsgi8GP3tyF07cPomfoCC6PnMS1sU5cf3AG/U8u4PtHPRh8dgWjL/tx/6ebGPv5NiZ+HcbjN0N49PoeHr4axMNXgxh92Y+RF7dw/6ebGHx2BQMTvWyCuPGwC9fGOiXu/EwHPxHwz10aPobe4RO48MNRnL17GKdvH0TLlXo09qwT4/bjBSwtR8ITWXYq5U0oDZBUha3cn45NbXmoO1mE3d2r8M2FDSxbcfz7fUzroEnyu+s78fjNEI5c385G67VtOHx1qwT6pks1aOxZx+oa9vWsRWPPOhy4uBHn7rWio38/E0Np0jpyfTs6+vfj3L1WlkJtuVLPJovGnnUsc1JzvIDpEzXtBciviUH5ziRJmTOv2BPwWWsjWdUiFSRRuXJYuierSAxOcUNwihuCkt2wbHkwC4E8w8VqOLdga7gFW8M1yApuwdYMdCqUsfMyg7WbCSxdjCSViyxs4gpbeMtNohrB/fmXn0ry3HwajLfevBVXV4o6E/D51/LPTTV5vM/7TzW0P50jmTyE4Rd9GHx2hVnQm+PduDLagd7hE8x95y1650ATU9z5n+kmJtBvjndLLPfIi1sY/+Uunv42gme/j+L57w/w7PdRPP1tBE9/G8GTN/cx/stdBjxZ+fs/3cTd51cZ9AMTvRLXnh7JzZ9uTDUh8KIdKc7bOyuwqS0Pqw6oKgBJ1SYhbUtHMY717cXu7lU4fHUr2m404OStRnT070f3YAt6ho6ge7AFN8e70Tt8gukFBDwJm0eub8fRm7tYypCHnc9SfHtlC/OkOgea8ODVAF79+ym+ubABx7/fh+7BFnQNHsL5oTZ0DR7C4atb8d31nTh5qxFn7jTjWN9eNF2qwZ6zq7GjcznLOlCKbe+5NSj6Oo5VLRbUxiK/JkYCPFXLUdlyapVYKUcWPSrHB1E5PgjPEIEnax6Q6ILwDC/4RjswyAl01yArCeDkqhPglCKT1J8rY291FYrqiljkcTdZcfmQAz+ToQ5iOdAEH00g9Df+efnEMNNJgkH9kQALR0N8MldL9dzoy348fDUoAYpiaMqt84IcpdkI+o7+/UykO3OnmYltl0dOYmCiF8Mv+vDw1SAevxnC898f4Kd/juPlH4/xy3+e4eUfj/Hyj8d48a9H+PEfD/Hs91FM/DqMF/96hIlfh/Hw1SAevBqQgH/3+dVJ7j2NGw+72CC3/9pYp2TIJ4VrY51M+KMJ7ty9Vhzr24vDV7cyoa6+o5SJYWQND12uY5mFzoEm9D+5gIv323FtrJMdj1xroBCCrumZO83o6N/PshI0KMVI4/j3+3Dn6WUmhHYONOHozV349soWlmK8NHwM3YMt7G+kT9x42IWTtxpx8X47Tt5qRNOlGlbjsKWjmKXr9pxdzarfSrYm4OClTQx2su4Efd7maFZsw9fRU+ERn2Lj8+nkrvMxObnqTv5LWOqMUmQEOF+9xq83ILipKIlKjflCFnmumx/qnqNBVv5vWrMlP8vHh0wKM5045C79TK28IAhS1338l7sY+/k2hp5fl1hOiotJyOJdebIkZNFJce8ebGFuYu/wCfQ/uYDhF30Y/+WuBOpX/36K1/99jl/+8wyv/v0Ur/79VPL3n/45zqB/8uY+Jn4dZi6+HHzexecHTQQ0SHTkNQmaFAh+fvQMHWHne/z7fTjWtxenbx/E7YmL6B0+gWtjnSxbcff5VQy/6MPoy36M/Xxb4oncfX6VvY5PY14aPsYeKRXYOdDEshpn7x5m15FeS5PD2buHcXXsFPrGz+HaWCcTP0/easThq1tZMRH93HSphg0S97Z3VkhAX9eSjVUH0ll8TmXM5TuTULotkQ1y5XnYs9epFiNRwVFMgR8is73ZCkJawOIdaT9p8QpvvWkFIS+wmdjoMbc8INEFpnZ6kmIWPu6Ww81XqskHD7v8Od7Sy0HnYfxfgj6TMIL3CDR5ErPnzILw7PdRjP9yV2ItByZ6WZxN1ujs3cNMuaabkoeeIL88chLn7rXiymgHA/3HfzzEi389wuv/Psfr/z7Hz39M4Jf/PGO/84PgJ/B/+uc4fvrnOJ7//gBPfxvBxK/DbAJ4/GYID18NYuzn2wz84Rd9LM7nxw8/3mBiH2kSpPTfenxeAj9lA25PXMSdp5fxw483MPLiFh68GsCj1/cw8eswfvrn+KTzePXvp+xYH78ZklzXO08v487Ty+xz+CwCWd5rY524/9NNibdB2Y1z91pxbayTCZg04dB30dG/H12Dh1gVI1+92NizTjJIwd/eWcGqBTe05rJSYSoeonw8LVSqaEhG6TaxvJase+7GaFY0Q5oFv2BIEecscdP5IhhamSZX0PmYm89389abd8352FsO+J8Zmqw9xfSahibL/1d5APL34IHWNIQf//EQP/7jIZ7+NoKHrwYx/KKPWXaCgNxgErHOD7Vh7Ofb7CY7e/cwU9nJXe0bP4fBZ1fw8NUgA/bFvx7h5R+P8erfTzWCrmn88p9n+PmPCbz84zF7pEFuPz8R0CDgSPAjj2DkxS2JDkATAI37P93Eo9f38ODVAB6/GcKz30fx4l+Pppyk5MA/fjOEB68GJGERn+G4Od6N7x/14PtHPSy1+P2jHpb9oBoH0jhIMOVDEdIVKBdOlvzw1a1ouVLPYOehl4NOC5Q2tOZKymrXNGWywhsecgJc7q6TFae0Gq+qk8BGK9Dkq80o5pZXGE6VEuPX8i8y/ILBTvE4WXYafxZ6+dD6ZM6kMdUEMN3kwP9MQGt/OucvmRwEHhhym8lS8ir4wEQvg57iWkpj8TfenaeXcff5VYy+7Mej1/eY8PbiX48YIOS6/y8G7w3w8T8v/vGhAHkEpFWQnjDx6zCe/T7KLPeHHMdP/xzH099GGOz3f7qJO08vM0+BXHv58yMvbuHpbyN4/GYIIy9u4e7zq2xioHFp+BiLzanikECn9Qi8Yk+FMpSqIwWfFgnt6FzOqu4IelqMRK48LS0uqI1linvKipDJVjxBZcVD0zzgEqBy0QlwPu7m4Saw+VWAPNzyph188w5Ng+CXTwIzmQw+maul1rqToDed+y/3BN5nYpjKI3hf+IVX/36Kn/+YAD0SHGQpf/zHQzx5cx+jL/tZeuyHH2/gztPLLIVGFunmeDeGnl/Hg1cDeP3f53j++wM8//0BfvzHQwbe/xLymQzeGyD46ThJKPyrjvHlH4/x9LcRjP9yl7n+47/cZY+UiXj8Zggv/3jMJogHrwaYu08WnSbYK6MdzNUn0GlNwLG+vaD+ArxVpwVHBPzec2sk0JN1395ZwerpqcPQ6oMZrKcA30iEXPXYQn+EZ0jLXcmSuwVbI7EskOXBrd1MpA09ZIo5r5rTsl5+DT816eBddgJf/rOmiYCH/dPPJwM/0wlgukGK/lSQz2S8T0gwVYggyGNMgp63iryVJ8s0+rKfufa8hRp5cQuPXt/DL/95hqe/jUhA/xDL+L8av/znmWT8rz0MXnQk+J/+NsJe99M/xyXaAll7st7n7rWi/8kFdA0ewrl7rUxdVwf60Zu7mCBHkMutuzxe33a6HHUni5glX9OUydKJlDPn4Q5L90RwihuD2ydKtOCUD+c7w9DCEnLPnRWWLOaWu+YUe/ONOnjYabkvD7ocdk2WX27d5ZZdDrem8ffPtCU/G1osmgS6Oouuyd1/X9jfB3wGOt309PjzHxOSIQf++e8PmFtPse34L3cxMNGL+z/dZJbr4atBjP9yl4lXZDnpvf4q6AkgdeP/9WSi6Xh5i89bcXLTb09cxPUHZ5jYdu5eK84PtbH0GT1HsBPoZM15i97cW4vX/33OlvCS8k5r+KmElgCnOn9ap59cKSrovHruG+3A1pNTuaq9tzlr0rHE2RAmNmKu29LFCCY2epPW6ZNLLnfL5RZ8JoNvyzWdG6/OlacxFdhTxe4LdOcxd56P5+UuvaaYXw42D+pM3PoZue6arBzBqCnfTYry4LMrTM2+/9NNNgmM/XwbYz/flijVfNxLufQPsaZ8iMGHF5Srp8GLf/S/j17f+38O+8s/HuPxmyE8fjPEniMlnQqWLvxwlBXaEOiUhiPIafAWnarrDl/dylaiHbm+Hbu7V2HnmRXYeWYFW+pKq/WoPVTuxmjWcovaQZErTikxUsz5dBgVsZCYZuVqDEc/C7Vw8xabB/t94Z7OeuuZLpjUFEJuub9Y9NlfJtjJgVYn3k0Ftyag/6rUnKDpZpS7tuqs+5M39/Ho9T0WZz55c1+ibo/9fJtZdsqHy4tm3hfwF/96xGLrJ2/uSwYdA42JX4dZJR4JchRKvPjXI7z45zgbL//1CD//6wle/+eZhvGUGxPceMI9PsHr/zyWPce/9ile/mscT3+9j8ev7+LBz/24/+MNyWIeKtoh0MV05mHlaMG5ey04O9iMroH96BrYj+6BRnT270bH9ztw/MbXaL9Wg/ZrNWjp/QrnB7/BwfNV2HOmDA2dJfj6WOf4Y3kAACAASURBVC42Hs7Emm9SsbIxBZUNiSipj0XmmjAklSkQkeGJwCRn+Mc6wDvSFq5BlnBWWMDBxxx2XiawcTeGlYshljgawMxWFybWi2BiuQhGS3RgYL4QBuYLoW9GYpoI92KjLyRttciK86213hd0Hmh1HXU///JTtlBFk4tOJbAUl78PyBR/q8vHy+NyeXw+R/tvmK8zF7rGC9Ra7Kly9lPl1+frzJ0y1aYRdE1uJ5/eIuiojFVdOuvhq0E8en3vT4FOn0efRVDTJEPKOU0qFDLQoNfwj49e32NWlSYI8gI0hRV8TP1nXPenv40wN51EN1oTQKk3Wn1Hy2z5nDu/jJgEOcqfk4tOdfC7uqtxrG8vU8/Ldyax1BjVpYemebA4OzrfFy4BViy/zRevyJd6yruwyBtk8kCr653HW/b3td5TxeHqYnECmnfR3zefTm2Yzez1p1TXp4rHycX/7Iu/a7Tkcvedz59PB/9fAjpv7dWlr3jgCSSCnIAige6nf47PKI6WA06wUkxLVXI//HgDP/x4gxXN0CCQCCp6DT9IU3j0+h47vv+VcEjptpEXtyS5cxr8wiKqWeALlc7da0XX4CHmrlNKreVKPfb1rEVDVxXrnENwU3+8jNXhbDlpaJoHovN9WZ7bNUjsGR+U7MbKT+XpL3U98aj0VN4Mk1fOedjloH+om67JkquLwWcK9kzcbu1P52Ch/rxpU2lyqy5/Tm7NZ6qe//0z7fdOrc2a/YGg8649KfVkdfkqNn7xCl/UQqLcVBb95z8mWOzNW22++EQ+bj0+z8pd+8bP4cbDLlx/cIYV8VAums8UEPijL/uZnvDkzX38+I+Hf7kaT9acUmskvMkhp6o4cuEpFifLTdab2mNRPT415CS4KeaOL1GwHDctr6U+eKSM89bb1E5PbZNE3nrzgPPCGoGuZ7pArZvOA/4+oKvb8EJT2kxuyWcK+XSAzyRNNkf7b/j7Z9qYrzNXYqHli2f+6qq56cpgPxj0mU4EvKLPp++m8hRooqAwgC/a4ZtkqFuCyi8ekXef4RtRUIkvNb744ccbGH3Zz/QGPjVIouRfAT5fCMMXytB5Uaksv7SUz48fulwn6RKz7XQ5NrXlYeX+dLEBpDLHHVckwh2Q6MJUcmq2yAtp1BWVxDQjy0WwcDSccvcROeRya64pFlcHvLqhKWaXg65OOdeUQptJ7ftMhjrYCWbePf/8y0/fy2r/FeWxU9W9/89A/ysmCT6fz69uI2X/hx9vYGCiFzcedjHIr46dwvUHZyYNWqxCkwK5xLRAhYp+qK6dKuUevxn6S607VcvxVp1gvzLawdx6ypGTkk45cFpLvqWjGBtac5n1zlwTgaTyIIRneCF3YzQCk1yZWk6VaVSVxrc8pgUjvHtOFpwvZFEXj8vh5t32qYDnoeeLYuRbWMlh15QTV5dCk1t2TcBPZ+Hlbve8BXPfq+5dk1Xn4abj0hSHT1fHPpWF/9Ou+/9y8OEAKeQklD37fZSFAA9fDWLkxS0MPb+O2xMX2Yqu2xMXJS69fOEKKduXho8xoevyyEnm2vc/ucBKUSd+Hf5LQaeCGQKah/z1f5/j7N3DrLkm33Biz9nVkn75K/amoLAujm3uEFvoz7Y5ohw3lZ3yyz6ZsKa03nyLat6CL3E2nFS1xndJ1QS7jsF8LDb6kv3+5eLP1QJPgBtZLpqxJZ8qJtckwk1VCCOHW92iGF6I0ySyabLa9Du9hqy83IJThmA6Sz3V6rTpJoT/r0CnQhde1aeYn6rr+HJVsu5Dz6+z2JtWpZHwJu9Yw9frUxzMu/m9wydw42EXBp9dYWvp+dVqtCDnQ8Gnc3jwaoCp7VfHTuH8UBsevxmSNIXY3lnBNqFYfzgHK/ens0YQmWsimGqesTqctVYmyKmBA63vnrS9lKwbqrp95eQbCFLPc35HGrniTq79VBafH3LrrmlCmGnMzg+5O68OfAJaHfz8c5pi9vdZ2cZb7L9pzWaf8SGquqYlquqA/79u0Wey6kueqydRjwYP/cNXg7g53o3BZ1ckoA89v84U9ZEXt9hKtaHn19nadRK+aKUYpa9o1Ri1v6IiIPIoqAiH0owEPz8BTDURvPzjMcZ/uYvBZ1dw6/F5XB45ia7BQ2i70YCmSzXYf349GrqqUNNegNUHM9g+dlRjnr4qjC0iicrxwdsKS7ytsMS7SnG8rbDC2worvKu0nLSQhKrWNHVJJfjl+8tp2kV2KksvH28rxeOkx3f0e4XltJOBfMPCmRTMaEq5zbTclSCUK/Ka4nt1de1TufHTNbT4s3H6pBj9f1nnLVfleTD4AhwCiF8yy7eZ4oUxcuUpbue7x5KoNvLiliRvTuW6/IIcUuf51XgUr/PuO6XfHr2+Jym44Y9F0wSgTsR7/GYI93+6iRsPu3D27mHWtqqxZ51owdUATnvE0QYJfAeXt5WWGF2ohVEdLfFROd5WWEosO6+u82u/aecYY2tdtbuHyhsuqtsuWB308vGuwhKjC7UxpqOtOlYd8Tjlwp6R5SIo4pyZtecfP6SCTh30mopopquUo+dnUvmmrliGQP9fC3RqQZ8OdgJWbrE0PU9LNB++GpSsQ+ctNS+u8fl3KrqhQX/nAecniNGX/egbP8dAf0fWolJlPXir97bCEu8qrNQuu+XjdPIOaOIQ38OKe18rvKsUf3+ntFTvOKvFQ08T28NXgxiY6MWV0Q6cudOM1mvb0NizjinnFHsX18ezohaCnO+wyrdVfqsEyMxxEUzsF8PIZhFGFmjhbaW4YQT1ZGPHKbGqVuzY6RpRPzb5mLSNkdIDeMvO3Ur13sr34938d5WWGFuohUg/DywN9EJMmDdGF2rhnRJ0iu91DObDNcgKF344ivk6cyeVzapb7PIhZbTTLV/99PNPYGavj4X689SCv8jwC8xbMFflTUmu4+RrIbkX6Vop78W3/PeiHO/496kQf/8zirwgB1UT6JqGusUkfHzNWziyfGTVhl/0sSWZ1JSB1rFTsQ3VyRPs8gYWwy/6WLuoO08v412Flcqy6WhhdKHSguhIrR15AnLQCfZbj89j8NkVFeiVqvcdW8hbT23Vo442Rhdq422FpWStwE//HMfoy37cHO/Gqf4D6Bk6gubeWuaiE+DUR54Ap86qBHhMgR8DfGmu6Lq/q7DEqI4WzJwWw9RhMYxsF7FzpN5sbsHWKsu/UFs8fh358YvQ8S497TYjf47fbVSTR/GOA13XeAGbkCJ9PbE0wBPRod7sONWl6ghyvhccPfLq/VRw8wq+OtDVNar4+2faWKA7D59/+em0q9hEL4W713To+qruBfFRS/XIDx3ZfaT2tap76k+BrgngP+OqkzWTTwgTvw5jYKIX1x+cwcBEL66OnWINJ6mDbM/QEVwZ7UDf+Dn88OMNVjrL166TdacCFMpH33l6Ge8qxRuq8NtQlBwJQ1lbBCqORaLieAQqjoWzm4tv5ECAkzh3c7wbAxO9LEYf+/k2u1FzdzkjZ6cTsnc6oFYQUCsIyKy3QcYWK2TUWWJ0gXiT0zV59Poei8WPf78PBy9tYi46AV6+Mwl5m6NZN1XeRafdTwhuaqVMbZTfKm82c5fFMHVcBGO7xRhdoIW3FdK9y97ShOBoBHMXY1i4mcDSwxRWnmaw9rYQvYAKK2ncLovd1Y23yusd7O+GYH83hPi5sWvMu/Q0IUR6eyBK4Ymlwd7K41QPOq/YU5zOd3d9Xys+nWJPsFu7mWC+ztxp43jyUOgeSCqJQlJJJBKKwxFfFIa4whDEFAYhuiAQSwsC2OtqBQF1goDQHE+E5HggOMsdQVmuCMx0RkCmE/wzHOGdZgP3ZeZwSjKEbdwi9t1ofTIHi42+/CB3XiPo7wu83JXnBTaKk/ufXGCrrA5c3IiGriq2KQFtSLDn7Gq0XtuGY317ce5eK26Od7O12/KYnTyHZ7+Pom/8HIZf9DHLW9AUgqKWEJS0hqHsaAQqjouwjyyQWnS++ysV0NyeuMggf/BqABO/DrMJJHe3M3IanJCz0xGJgoAkQUDmVltk1Fsj42srZs1++uc425TizJ1mfHd9Jxp71qG+o5QtBy2si2ONFWnvsoTSAMSXiH3jyWoT2GHpnqxHOm1FTKBbuOqKVt1+ETtHvm0Tvc7U0RBmzkawcDWGpbsprDzNYeNtzuCciQpv6WLE4vO3Sg8q2N8NwX6uCPFzw4jMoi82+pJNNJHe7ojy88TSIC8R9EpLtp30dOq8uvw7b7E1NZ2YqhONPBfPp9mmSsnR9awTBCwrjUayEvTE4nAkFIchrigUMYXBiCkIRHSBAknKeyVJEJAoCAjL8URItgeCs90QlO2KwCwXKDKd4Z/hCN90W7inLIFzkhHs4hezCfFvWrMxa/asKeN3TZPAtKCrA16TCy+Hf/yXu7g9cZFtxdR6bRvqO0pZ19F1LdmSnT/XNot7fG3pKMbOMyvQdKkGXYOHcHXsFIaeX8f4L3clLaH4Bo3Pfh/FzfFu9gXkfROEgqZgFJFlPxqOymOR7KJRUczIi1vMdec3nBh92Y/Hb4bYZ7yttMSojjbydrsgd5cTchocoRAEKAQBmdtskUmgcxPJldEOnL59EAcvbcK+nrVMaKvctQz5NTGs9pwseHyJyj0nuENS3RGY5DppSyMaBFqt8gaqEQQ22VBZ6xJnQxXoDoYwcxKt+hI3U1h6msHaSwW6urTaVEMMHbQRrBCteYi/G7sGfLEND0aS8jhpQqL4fLo0m7r6ePlKNk3x+EzXqM+0bJY8lNSyWCwri0ZyaRSSikXQ44tFix5bGIzowiBEFwSwe4VGWI4XQnM8EZztjqAsNwRmuSCAgW4Pz5QlcEk2hn2CLps41bWTmumYlF5TB7FUPFA9yiFXiQckWqlEiXdc2odPsTDxjBPRaH/ud9znTRI0+GPhRAyKe0YWqG7+ohaCPYJB8OTNfckCnBsPuyalfXjBhGDK3eOK3N0uyG1wgp0gwE4QkL3dDpnbbJBZb81Ao3Pnz5euTdrKUOXfrbi0GAk6VojM9paIOBKxp1J6vei4kjjQR5TQ8hVw9Fr+9UvcTGDpbiqCrrSu8r3e9UwXSI5D9f2KQt6YEt5ghStz32vpGnD/N6qj5jiVoPP7j9N14a8HLx5KxL9KK7xTXsPPv/xUKnzJBDL+XuIf31VYTgm5JuDJQ0kti1Va9KVIKolCYnEEnObMQXxRKGKLghFTILrvdK/YKx8Z6Dnu7G/88OcnxIUqi/4hQ23BjDp3nU5KHNpMwHlXackgJ1FIIvDoyEUfbZVAJhOC+N/fVlqiZGuCClwd7UlixpiOTNCg91XePG8rLDGyQBu1goCC5hAUtYSi9Eg4+zu/yObpbyPM4qgXS7TZpJG31w25u12Ru8sZhoIAA0FA1g57ZG2zQ+ZWW86qahBflCmlUfnxc0JhYJKrcnLRlh2LtvK8VdeX4FFwNwadI6+S8xMXwW7haoIlSvddHegEOS8UjfHfJedJEOghfm5IUsai/L1Cx+kv8zzIdSeLLv881flrQ/19o80mb3XXUyKQyf+u/C54y67Omhtb605as85b9JSyaCwrXYrkkkh2TxgIAgwFAWZaWogpCGS/02N4rgp0/nkDJegKNRPih4Ku1qKrG+8qLRFS5ABFji18M6xRS7NMpSWbGChPWisI8Eq2hNcyS3gvs5QIEL4Z1vDLtIFflg0U2TZQ5NgiMM8Ogfl2CCqwR53ydfwXVysIiKh0RtQKZ0RVuaBWEBC90hUxa9wQu8YdcV95IH69BxI2erCZj1J4NPnkfROEguZgFLeEsovGF+HQl1anPNaSbxUoPqRAUZMvipp8UHjAG4XfeEIhCMjf547cPa7I2+2CeYKA+YKA7J0OyN5uh6yttlAIAjK+FoW59FoLpG02R9omM6RuNGHXgkScOkFATIUhokoNEVlswM7bJcCKaQ1+yfrwSdCHV5w+uz70Pg6BurDz14WNjy6svBbD0l0X5i6qmI7Pf/M58HeVVhjV0Rbdd3cTWHmYsf+hjQlFyK0k10UR6IKAQBcEBLgiIMAFgQpXBCpcoRAEBCncEOTvimB/V2aN6P/CfN0R7uuOcB8PhHt7IEIZp49yrjsN+t5TC4KQXhaMzBUhqBUE5KyPQF5NJPLrl6Jw51IU74tBycFYdh3pXqkVBKy6kIKV51OxsicFK8+mororFdWdqagVBFQdT8WK9jQsb01j98J0xTJfLv58EvzkpaSWxyGlLEYEvTQKBsp7gsY85ZD/Hp7rLQpy2R7seYJ80mQog5yOYTq4+Tz9jEB/W2EJ3zQreCUvgXu8BdwSLCTuGX05dYIA93gLuMdbwCPBAh6JS5ir5p1iCZ8UK/ikWsE33Rp+Gdbwz7SGItsGAbm2CMizQ2CBncoacFYgvNwJEZVOiFwuwr602gVLV4mwx6xVwU5fHKXgyDrkNAYi70AQCg+pQH/62whe/vFYBJ07/tLWIJS0BChh90NRky8KD/qg4IA3CvZ7In+fB/L3uiFvjyu0BAFaBPoOe2Rts0XWVhsR9C2WSK9bgrQac6RuFkFP3WDMAKDrErvcEEvLDBFZYshAt/U0Zcfkt0wfvkl68IrXY/9Doo5jkB7sFbqw9dWFtZcuLD0Ww8J18bTCGhPwnI2wxFV03+l/+AUtb7nQwCXcDopAZwQEukAR4ILAAFcEKh+DFK4i5AoRdN71TBIEhPm6IczHHeE+7ojwcUeEtwcifVSg8zG4CvRApJUEI2N5KLJWhSJ7XQRyN0cgf0sUCncsRfHeGJQeiEPZoTh2zyQJAqrPLhNBv5Aign4uBdVdKajuTEFVRyqqTqRieXsqlh9JY58/VfdXTcUzdA1Fiy6CLrruovJO94aWIEBbOfjnwnK8REEuRwSdICdrLtcxeIDpWGZiyakwZ2agV1rCKc0CDpkWsM82h0OWhcw9U0HpnGoBl2RzuCaZwy3BAgpBQG55CjyTLOCVtATeyyzhnWoFnzQrpYW3hn+WaN0Dcu2wqWEle+9E5UmHlTkqYXdG5AoXJeyuWLrKDdGrybK7M9Hi6W8jooCm/DKy9wQgd38Q8g8GMxf19X+fM9edLFfZdyEoPRKEksOBKGlRoOSQP4oY7N4o+MZLCbsb8va64WNBwMeCgJwGRxH07aL7Tum29LolzKqnbjZD6gYTpKw3ZuelEATErjBEdIUhlpYaMI/E1tOUxdSKFAP4JYlWnb8BagQBjkG6cAjQg62fLqy9F8PKUxdL3NSDzots5C2YOxkx951uKL6ena6fc4gtXMLs4RbhwFl1FwQqaIigBylcEeznKrFIZNHDfJWge4sj0kc1MVO6zDfagWU3UvKDkFocjIzKEGRWhyF7bThyN0WKoG9fiqLdMSjZH4uy5njm5q7oSEJ1twj6qgupWNmTipXnUlHdnSqCfjoVK06kYsWxNCxvS2Wg8xacz6drqnvnXfc0ZtFFQS6RE+TiC0OgPWcOu0/4IVp0L6Xy7o7gbEqxqZR3j5QlEsX9fYa8Y+yMSmDfVljButgcNkXmsCkwh22BORSCALs8c9jlKkeO+JxDlgUcM83hmG4B5xQL2AkC3BJFK++eYAGPpCXwShaB90m1gm+a0rpnWUORbYuAHDv2xSkEUbwILXFAWJkjwsiyK2HfoqWFzPIYxChhp4vS0b8fZ+8eZgBn7vJH9t5A5H0TyF5DBS3Pf3+At0pRqbwtFGXfBYtW/XAASlo4q97kowK90R15+9whCAIEQUBOgxOydzoiazvF6jbI/NpahL12CdJqLET3fZNo1em87AQBcVWGiKkUrTqBrkqHaUORqi+674n6KndugRZGF2hhZKEWapTXytZXVwTdXeW6y3c9kcTdOloS9Z28iUllqzpK0EPt4BZuD4XSopMLH6hwYRY9SCnGJXJe2YgyHqbjjPD2EC26twebkMwdDDBfZ66YhlMClJIbiNSiIKSXhyCzOhTZa8NRujoTebWRKNi6FIW7olHcGIuypjjmQazoSEJV1zKsOp+ClRdSxcdzKVjZLbrvVadSUXUyFVXH0rCiLY1N+tM1h1T393eVooZS+/HHHOhLlSm2CCQUhyG+MBSxhcGIKQxk94rAQPeRKu/ZpLw7QcGUd0vlNbKatmRWDrZ8CLTQgt8qSQ7/2wor+Gc4wj5+MYwitWFZag57QYBNoQVsCpXw55mLrkeOOeyzzWGfZQ6HTAsYkpVPModrgjnc4ywkwoOBIMAnzQp+6Urrnm0DeyXkdsq/hxQ5ILTUkcHObqQFMuFFWayyoTUX206XK29obaTv8EfWLgVy9qlAH3x2BRfvt+PyyEllvKWN8qNhKGsLQdmRYJQeDoSh8jgNlfFV4UFvFBzwQv5+D+Q3cqDvcuasuj1zxegc02sskFZjjrRNpkjZYAJ7zlWLqzZCzHJDRJcbsuO39TRlhSgBaQbwT9GHT5I+O2c+OzCi9KZE930xLD10WcEMb8UlxStKS23mZCiC7moiUcDZQhTlROkcLILuGm4PRaCz5LubLwic+y6CrhIEVVkY0m8oTo/09mCg8akwEmCX5QQitVCM0zNWhDJvxl8QULA1CoU7o1G8LwalB+PYtVxxIglVnclY2ZOCVedT2HdH30X1aSXox9OwvE0Vo890kQu/nJXEUgrDUkpjZKCHI64oVFI487Eg4COl6x6e64OwXBXowVluCMwUU2yKTEf4pzvAK9VSOflbSaCVu+Xqer5PAp1foEGxLTVIpAngXaUlxgw+R3C2G/wzHOCYaAB7QYBlqTmsSixEa18oQm2XZwG7XHPY55hjkZYW5gsCHDPM4ZRqDudl5nBNsmDiBAkT3imWStit4JdhLb4PdyMFF9ojpNgBISUi7KrYZXLN8LsKS1Q0JKO4Pp7dqGnbfJHR4I+sPQHsy73xsAvdgy1ovbYN7yqtRIt+NExl1Y8EMcDnK78cMVYXrXpBoztzwyjdRrG6Fnd+8wUB6XVK0JWxOr2vgSAgYaUhYlcYIqbCSJJKoXAoIN0AilR9+CbrM8hpbbm1mwmzzrb+urD2EeN03nVXt9RUnlO3cDVh/8OvRCOB1SnYRgm6HdwiHSTXxUAQEESgK2N0dbE3fabKffdgr+NBp5BlWXYAUguCkFYWgszloWxyTxQEBMyaJQpye2NQciCWCVkEevU50X2fJzvOqtNKq348FSuOqmJ0dUtXecg1TQJ07fnMR3JJJBJZhVyoMp8ugk7x+TxBQESuD8JyvRGa46HWU6PHkQVidutD9nOTgM73QSfgab03PU8nFJXnj9AcDwRkOsMr1Qq28YtgHKkNq1JzWBebI3JtGGwKzWGbbwG7PAt2Ug7KuN4x3QKfaWlJRAktQcA8bW2VK59ujfmcFTUQBATl24uwFzmgdvZsdlMaWS6Cmb0+7LzMEJjkCu9Ie4RneGHl/nREZnsz9yql3hdp2/2QuUshERGP3tyF+o5S5i6Wt4ej/GgoytpC4KylxY6BjvNzbW0UHlDG6o2e7PncPaoiGnXn97m2tui+bzZD6iZTySSXsMoIcVVGiKk04nQPVWFJUIYBAtL04Z9sIH7pFZZsa2Eze31mLe39dWGjFOVGFkyO0fnuMe840M2djGHhasxSgu8qLVnzR3pvxyAbOIfYwSXMTnJd6Ptx0dYWYfd3RZDCjR0nX6b6rtISYzoi6OHTga6jhWVZgUjJD0JaSbAEhBrldSncHo2iPdEo+SaWHcvyY4moOp2M6u5l+Fxbm11//jinAn26wUNP3iJNPv6CwDy1+YKAT2fPRnyxEvSCYEQXBLLv3FAQEJ7nw5R3PiXKe2t8vv/PbuIo8GWlr/79lC0T5ScAAiGuKBRR+SLsgZku8Eu3h1OiIcyjP4du2EewKjFXWncxjmcpA6U775BlDscMc0mqYb4gwCNRGbeniCIduWLkHgbm2YmwF9lL3EJ9s4UsbbTE2RDOCkt4hNoid2M03ENsmEVaVueD1K2+SN/hj+RZs5iI+LbSUlmYI1r+imMRIuxtoSj7LoTd0HScRc2+EqtOfxNBd0bOLifk7HSYlFLJ2GIpEeXovOYJAhJXGyGh2hCxyw0R8PHHEgU5JMcAQZn6IujLpBadlpqSpbRX6Inuu7cu8wqoVn1SfbrcorsYI4mui7I+QrW0VAtOQdYsTncNt5dcFwNBUCrwpLyrat150OkeCvNxR4SPGKdT/Clx3ZWfmZypQEpeINKKgyXqM3k6TJBrjGFwVbYnYkVHMqq7RIv+MWdBDQQB1Z1Ki34iDSvaJ4POVozJ1szTIw89n5Ega27PGaj5gsBq3mMLxcIZ+t7tBAEReb5K192LHcf7NKDkl7zKl72qe61AS0HVDZoA3lVYYVRHC0klUYgtDEZkvh9CcjwQlOkKvwwHOCcZYUnMfOiHz2KwWxdZqFIGuRawy1Eq9pkW7IRpuMeLqTjP5CXwTrFkKQZKNwTk2rJc++jCOSyW1DdbyNxTQ4tFMLHRg7WbCdyCrWHlaswEraQab6R87YO0bX7IbFBIxCK+hLTyeCQq2iNQ3h6Gsu9CJx1ncbOfmFdXKvD0fN4eN7EGfpczcnY6TiqOSN9ihYzaJWKsvtmMnZeBICBpjRESVhohtsoIMRWGTLFWCAJCcg0QnG2AwHR9+Kfqq+oXKiZXxtkH6MHOTwSdz7+yyrtKSwY9xf8m9gYwdTSCubMRlriZqK6LjrSOwTHQGk4hNgx0+XUJDBDz6eS+yyvjSOysFQRJmo00BxZ2cfUMyRkBWJYbiNSiYInlp+Mq2BaFooYYFO+LhZ3yOlceTcTyk0mo7lqGledTWDxMHmL1mVTRfT+ZihXHUtnkQTXw0qKvyQU5EtCV91Z6eTxSy+MkoNN1iS8KQ1yREvTCIInxisjzFS16rhd3HaQVlPyy57eVltNOAFMNgd9pRd148uY+S8eklMUgoTgcMQWBiMjzRUi2BwIzneGXYQ+nJONJsNsq9gAEjQAAEWhJREFUb1jbfJU6b59tIVr2dHM48SJdgoWYgku2ZKq7vxIIyrUH5tsxa05NCGkL3kWGX8DAXAfG1rqw9zaHiY0eu3ESN3kiuc4bqfU+SN/hh6zdikn5+kQC/VikyqofCUZpa7CYbvtWgeJD/ihq8hOt+jdeDNi8va7I2+OiXPDiiOwdDkoFnku1bVGm2mrMWWrNVhCQvNYIicx9N0R0mSEiFE4ILzBAWJ4S9AwxTlcds/aktKZDgKp4hp/IqDLsbYUlW5VGltHY3gCmDkYwczJWptnMJNeFwgfHQGtlnG7L4nRFgJhiC6CcOgc6/x7yCj4RdNGiy49zTEf1XSSlK7AsJwCphUES0Y5gLNgahcKGaJTsi2Euc+XRRCw/kYSqM8lY2bNMTLGR8n42FSu7UpkgJwd93oK5zEqXbEtHyZYMFG3MQOHaDLa+Xz3oCUgri1PVvJcshbOWFlPeRUFOtOh0P9sJAiJyfZnyPul6sUpAacWkpg0hNG3PzD8n8DuqqBvjv9xlN0ZaeRySSyIRVxiCqHx/hOd6I1hLCyHa2vBNt4VjogEsoj+HnhJ2UkqjV0SIcXuuOexzzZUxuwi7c4o5XJMt4BYvwr6yppTFZGTZ/LNsxNRbri07aVqswHcdXWT4BXSNFzBLT8cdv94TSZu9kLLFB2nbfJG501+ZWw9EQVMw+5zy9kiVVT8airLvQlGqVOBLWgLEarlmEfTCg97wV05GefvEAprc3S7KlW2qAprMehtk1FshfYulMtVmjkTu3JK/MkbiaiPEVxuxnHpUqQEiCg0Qlm+gdN8NRPVdeT1rBQGeMfpwj9KDS7gunEN04RioK7rvPrqw9lyMJe66sHBZDFPHxeyGJtAppDG20+cEOTHNZqVc5GLrs4Sp3AS6GKeL+fQAvkqOcunKNJuCO85QP3eE+Lkj1Fcc4cp8eriycCbKxwNLAzwRE+ItiXeT0hRYlh2I1IIgiUWn7zS/Xqm8741h3l9lWwKWn0gUlXelIDepQu50Kqo6UrHieCq7lwh08hZKtitB35SBwq8yWH3GJNB1tJChBD2lLBbLqEKuJEqZSxeV99iiEMQUBLFzUwgCIvN8EZHrg1Blii0k2x3B2arFLYoMR/gpU2ykeUy1K4y6TR35IdDGBbQtMu2DThslPnw1KIlHlpVGI6EoHDEFQYjM82PVWooMJ3imWMI+QQ9mS+eyqigC1ibfQkzB5VrAnsXsFnBKN4dLijlcE83hHm8hqQiiL94vQ6ygU+TaspPmixv41Uuk9DLVWEcLces9kLDRE8m13kip92VWPWdfIPIPBjHwVFY9AhVKq176XYgyrx6I4haF6L4rY3U6dyqgyd3twqXaHFj9e0a9NSugIStG12XZOiPRfV9lhLgVolWPKjNEZJEhwvMNRfc9ywAB6frsGJMEAZ4xenBfqgfXCD04h+rBMVgXDgpdZfGMLiw9dGHhuhhmToslMbuJjR7z0Ixt9SVx+hI3U1h5iKDb+FhIrotjsDWc5Pl0yqXzVt3fVbIkM8TPDaF+bgjzdRNB95GCHukjrk+PDvGWfF5SqgLLsgKQmh/EUkwS0L9WVsjtiWYxsp0goPK4KMipQE/Bqp4UsXCmKwXVnamoPqUEfZJFF7MvpTsyULIlA8WbM1C4LoO51Tzo75TXML0iAenlcUgtF0EXF7dEIrFEmUsvCkVcUQiSZs1iQmKiEnSWS89Wgp7lhqBMZS4900mZYrNiHo2mxpQz6UcvPHw1iDtPL2Ps59usiSINWsrJx7GpZTFILIlAbGEIluYrWJVWYJYL/DMc4JZsBps4HVYVRUUdtYIAW8q355rDTplrd8ywgFOaBVyWmav+h5aSKj/TN8Ma/plifTy57nxek09/8MsVKRatEwTEb/BA0mYvLNvirUy3KZC9JwB53wSycyAAK5koF8aq5UoPi68rPuSPomY/FB30Yf+Xv89DBH2PK2oEZaXcTgdkb7dXLWHdYiW5JjSR1QgCktYqQa8yRMxyQywtN0BkiSFqBAGheSLogRn67PU1ggCvWH14LNWDW6QenMP04BSsC3ty370Xw9JzMZa46cLcWWrRTWz02KqzWkFgcbqFi5hms/QwhZWXOWy8LSTXpFYQxHx6mB3cIlSgKwLEcw7kUmw13HGG+ImAh/m5Kyvk3KSlsN4eiFJ4ITrYS/J/SSkKJGcFICUvUCLaUTiWtyUKBduXonh3NAOIYF9xOhkru0XXfRWVwp5NgbOWlhind4iCHAHMFH+lkl66Mx0lX6ejuCYDReszJ00IvPXPINC5UthkrhQ2viiUnRPPQkSeLyLyfBCW463MpXsoLbqr0qI7wT/DAV5pqqXPH7rpxCdztSBcHTuFGw+7cONhF/rGz6H/yQXWXYVaKT14NSBZ5sgXqowsUP1O+T8+H0gz8Ijs7yNqil1ovK2wxKzZs1RtihaoPkfuxlDOk+8WwmZo5QQlOS4uR8l/pqZjkQozqkov+fuOcNdFfq7y9+LXB6j9TO5c+fMe0XAsIwtkx8MfC3dNqf+b5LO59x6Rfba6Y5d832qOWX6d1V1v+TWUXq85qvPiHpnrrpy8+TwzXyFIsPOiGImiK7tTmPK+4oTKossVf/6Y6RjkoL/V8P2NyK4Tf5+z/5HfL/x1kv/fgjnsf/8U6NRd5dy9Vlz44aikb9q1sU4MTPSKoFeoW1stbWCnrhHe7DmzJj0nH/IGhR/P+hgfz/qYS3VYSf9HWUDAd9qkNIJ85ZHaz5TlKSedRwW/9prWLVup+R8156X2GklzoollgQhL95z8XrJjecelelTvL3tO3d8rVOux33E/8/3f1F13+bVR9QqwUn/NNPQHUHc9NV2PKa9lhZWkoaUIo/r3ZZmT9kRWCrvyfCqc5sxRLm5R1ryfoRSbCnR9s4UsnTjVvSoHXdM5a7oOYv5dfvxWaj9zUi+Gij8J+qXhY2wL3s6BJpy504wzd5rRM3QEF++34+rYKTx4NSApiX30+h4uj5zE6dsHcehyHRQJzqzBga2nKfRMF2D2nFn4ZK4WZs/RvAPkrNmz8PGsj9kjjVmzZ+Gjjz+S/K6pOb18yxtaxkdb3Gp9IsYwn34ubtFDIp68KwnF9YsMv4Ce6QIYWiyCsbUuLBwNsau7WrLPOzWtoPHw1SDuPr+K/icXcGW0Axfvt6Ojfz+ae2ux88wKbD6azzrLFNfHI3tdJOJLFAhN80BgkisUcc5sfzTvSHv4xzrBK8IOfjGO8ItxZN1cPcNt4Rmu2mLJ3tscDj7iJg3Wbiaw8TCR9HC3cFT1cJcPvsOrsdViSatnTf3hzB0MWN2CvNOMmb2+5He+5Haq/u/q+sHz3WZm2heOYK84mogVJ5NQdUZMsa1iMbpSkDujUt75Cj7qciM/jqk62kzVpop/brqVcZraTf/ZjSEloHcONOHkrUacvNWI9r7d7OeTtxrROdCEi/fbJ4H+/aMenLnTjOPf78Omtjx4htvC2k11g82d/wlL3FMfrtlzpDDLB8EufCRA+EhgP6t7nSbY+RY7c7T/JjlRTRdX3mfsy8WfM/Xe0EKsvCusi5NkIijtSPUGj17fw8iLW/jhxxu48bCLeUjtfbtx9OYuNHRVofZEIVbuT2e94tJWhiKhNABROT7iVkoJzvCJEttDUbsoah1FO6B6htuyrZYIcurXzg8C38LRkHWZoaEJdga9UrDTBLumFXG0hdNUrajk8PMLaKaCXdNuLVLQlUVPbQlYfpJLsZ1PUa5ik4KuqjWwYt831WPwlYRUJbhAd957bRqhbp+4mVbgzWQrKXUTwZSgt91owHfXd04aBP7F++0Y+/m2pNnjxfvt2HtuDdr7dqOgNha+0Q6IzveFvbc5Fhl+gfk64paxdGAE5FSg84Nglw/5pCDfioZc+L9pzWbqJC1CoKWH/I4b/MX7/MtPWU8y3rIbW+sipsCP7cn+4NUAqzugttRP3txnWzrfeXoZwy/62K6tT38bwf7z6yftncZvzkB94qJyfNjmiAmlAaxPHPWHI9AJcBoOPhbsOTsvMwY6vxWymb2+5JFvMyWHf9JGDpyVp7JjddDLJwD5yjn51k7qNm7UtO/6At15MDDXUdsUkl8MU9GWIObSO5NFuCmX3pOKamWKjQRGfk2AsbUuTO30YOFoiCXOhmxHGzp3XeMFWKg//fZQ77tbzJ8B/n1gF5p7a3Hoch3bzK/pUg0OXa7Doct1OHx1K3qGjmD0ZT8D/cGrAXT078ees6ux+Wg+Ygv9Ye1mgsSyQJjY6DFo5s7/BFqfzGGgy8GUw/3Rxx9J3PWZAk8WnAeedsr4ZK6WBHKy5AQ7Wfq58z9hXxrl42mWN7JcBO9Iezx4NcBSjg9eDTDrTn3naTcYamfdM3SEbXvM78ayo3M56jtKsa4lG6XbEpG5JgLJlUFYdSAdg8+uICTVHaFpHghJdUdAogui830RnOIGrwg7uIfYsD3No/N94ehnAZcAKwn4vGUn2OnmJQtPP2sCnWCXW3rycNYfzlG7bdN01l/dHm68hZ9qSyd+80Z1u7C+rbSUCIHqhFK5eEiQm9rpwcrVGO4hNghKdkN4hheCkt3gG+0AW09TNrHpmWqGfboW03JXfqrNI2YKPb87LD1q2jpK2HtuDRp71qGxZx32nluDhq4q7D23BvvPr0dzby1O3z6I4Rd9DPQ7Ty+j5Uo9ak8UIm1lKKJyfGDraYqlub7QMZjPTlLHYL5kEzl5LK7p55mAzgM/a/Ysyc9an4hWnFR53q2Xgy5P0fGdRnn33T3ERlJfQINgp0mANnsk6HuGjqB7sIWFOW03GnDoch12d69C3ckifPVtFioaklnbZ77lc2yhPyKzvRGe4cUsu3ekPVwCrFiMzgPOW3UCneJ1CqmsXI0lv/O7q07l0vP7s70P3JpcfX2zhZP2X5+pS89v4kjuvY7BfPU7oshEVV4ofcdBbu1mgtA0D2StjUR1YxrWNmdhbbPodcUVKeAWbA0LRzE0WWz0pVo3firYZ2L15bG8un3f1cX/ck+Bt/QS0LeeKmP91Rt71mFLRzHqThZh66kyHLi4EUdv7sL9n24y0Md+vo3m3lpsaM1FWLonnPyXIDLbG9ZuJvjsi79Dx2A+5s4XrbrWJ3MmCW+aBll0fkwHutwL4MU9EuXkIiBpB+TW8278519+ivk6k+P0oGQ3VlOgDnT6ffDZFTx+M8RCHNq7nYDvHGjC8e/3ofXaNuzrWcs2clh/OAdrmjJRui2RQZ+yIgTJlUGIL1Ew6AOTXOEVYQevCDsGPg84Ac+DTkMd/AS83L3n4ZcDPwn+KcQ7+TCyFMEi0DW59tPt46ZrLHoD6lx9An+qdtF8WGblaozAJFcU1MZie2cFTt5qZILqoct1WNuchbgiBWw9TWFsrQs90wWTQP9i0WesSw71nue3mNI0+ElL04Qm33Ja3Q418t1j1XXIEbaeKsOWjmJs6ShG7YlCbD6ajw2tudjQmou6k0XYf3497jy9zEB/+tsIdp5ZgbIdiYjI8mLb8prZ60s+nICaCejqIJeDTr+re71ctJs9Z5bEmqtrck/1wGTdedC/WPQZU4T1zRYibWUog3nkxS2M/XybVQ0+fDUoic8fvhr8P/t/9cHZ/+dvH4M35WE3wMCa8gt29P6fvL7uf9eK4v8tS7L/NyxM+181N+F/6dSY/yVTov+nNQf8T6rz/R9d6gG/PdU32Qae2ZHPeYc13dH77ciZGxZHyLU9cmaHZXjkQTtianrkPjysKa+ghXsgT05d4r+6kTzO/j2+TE/Mza3YbnxBzvTII+swt+paKf/3T7X7XzY95v/SPZP/7zm3/v+Ja3v/n7i29//Bi1v+bzy66H/v6jJ4Vyu6xP1/4YRIyGyJnz4E++jDZ0jMXLX+Gzmo/9e1Uv6va6UMv80WVsDCztmHzYggX3OF3upB9jPMj4TOt4fV+OhXSQMAboC0nRvKrGgAAAAASUVORK5CYII=') !important; */\r\n   /*\r\n   width: 250px;\r\n   height: 61px;\r\n   font-size: 0px;*/\r\n }"
			},
			{
				"urls": [],
				"urlPrefixes": [],
				"domains": [],
				"regexps": [
					"^https?://meta.worldbuilding.stackexchange.com.*"
				],
				"code": "#hlogo a {\r\n  /* background-image: url(http://StylishThemes.github.io/StackOverflow-Dark/images/meta-logo.png) !important; */\r\n  /* background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAO4AAAA9CAMAAACdmqWRAAAAk1BMVEUAAAD///////////////////////////////////////////////////+MiYaLiISJhoKKh4OHhICIhYGLh4SMiISKh4OHhYGIg34IAAAUAAAHAAAOAACLiokKAAARAACMh4JsAACDg4OHgnyBfnqLiomMioeOiIQpAABfAABmAAAbAABXAABOAAA/AAA0AABIAADInvqVAAAAIXRSTlMA6RGs1cFmVSJ3M5mIRCYRSeafz4q6elwzQfEXp29ix2ZyYf0pAAAIQElEQVRo3uSXW27iQBBF7wr8woABCyhhQT9s4/2vbqguFzFkPiZGDSPlfCSNZaSc1O3qavwjybFI8Fso8/xyyfBbWF5urPAGavwHlKy7RHw6avF5MtbNER9HtMFnyFIo1YVJEZsNEe3wCZLlqYSSBt0KsdnedPEJjqcbX3456x4RG09k8QGqE5M/tuYSsTH0oVZVBN8CI6v3tOaeqMMnSPPgm72tNavugI+QSZxTBJILkyAG+x2UjqjHFztjtngT5TTOKfeqGGPktSWi1khf5vUVir/JvzHci2mcl7Nbs2mpx64b//DNYNlOaUno+UXnjB/cDQuEbwgbvIXqFJA4F6xbzJB1XLGaGAsYtRMsP9xZIvKAde46GMfwCSy8rb4a5yWY47zWbIkZSGivquDB8Ecj/4MW8MaTdVdzA3D8tY0nBtHI0u9xDhHO5o2Rrfo5Fn+u2CgepA7gReuuYMwYgTaqbtI06+nHUyB5oTXXLpR1i7142tqMuR41N2NwjVTbiG4/vtNH1S2apllU01GSWfBybmvuubSSa8ks5PfEpZbt/KyrhXeIRNYEigTKMviWL9zwe+1MrUbWapi7sbobibfu5aluTUO8KXrRjNy10lOg0hv+PF2jugNUVxYM/zTPuuis7cONsI+nm919F2t9pHE+zhgjtelsVdfrope7vHCFf9RVvPcS/FiscxUuquldoZx1w9d+BLXch8KpLjGmDm8Z803XW9L9Ho101ShFOrkrVAjVTfBTDnrqtFNvo9UdoDzrDlz3PvqYkRTqm68lzoF0tcqSFD9mR+TV0kG3rNFF+5d9Pnm9jqv7vIUzjXOZYiaO7KNuiLDWz0LYPOrqTj9IACKzbhg9lPLTosJs7JPu/j5EetLtDEM2+Kuutij/Fl2kRaOsUJV4gY7sPcOSbu3VeBA/iG4PRldDLN2kWCWYUH0lOsULeD04nejKUFHfE9tpwTnMnRU5PawMxdJdn8/nvFgn3w+lAq/Qt6K7G5VwGGcpTXPvvRy+96vRwcLKABKwiEBxFhaiPDmUUrzClaurlp4f6CKslRY6PNs/3JjZbqswEIbBgxcMBqchjdQjcnGkSCkKUd//6TpjM1Vw94Qu6n/D8A8Z+4sX4uDI0rv5aw+8K2Jl5FvfPr2UttdUPeCZ/TCMBz7X3+1CwLxs83n/NN2y/0AGjfzSahiVtY5L2V81lXdISwqzk0/6M95/p+Nw/4A3/P/UPR6NTxgch2G8oytvbIuq9bfrBJiX8jI6nMbxOI7DOGn34d8p/F0srWZ78wwZt+W/LERezUY4++tqm7N5fbNERWtFtqiEVkqLzFhrTfYp/Ue9sZS3/MQ1ynO9KG2ZowohAC/qEty2adpnyLSU21+IG2gZt7wEt9/v96v1puv63p+TU/Q6roBCfz+uKRbBZUXyTdd737yDW+Q/gOsIVlmbXY7b7V9W9wtxFQ0tBZfjbl7B7b8MVxgjpgjFLoZpnm2yhHgDV2Cew7M6M49Hd/VRXGGsNWIKi1xxYfbnDya4jCN0JYtC1hZjUwGAjtkaQ0WR43wQ2c7WaIE2riZc7dwc1yiQhQRFTWpAiViRazvyDMPQ3ux933Wb9Tm5T3E10EYhKy0yUUlsF6CixmqJPnbQMJcKRmVnuCVAJMwnldgp6nQV0pYshx+e5SNWVUSHU8lW5eRkS8d1uGIEr0OUTtWEvElwS2ICKl1nBgKhBGwMIwnhPrSCOQwDsI64vOoUd58Ue6vpKp5WJUaIxKqT50G/iEsdYB+H/bH1Mkt6GwSCsFlmYbtE7n/IBJq2iP9SOaoKL4YBjfpjRgOGQJ5Za8sFawHz/etmUSweY6xd/ExmDTL+dNxykB2PrB59pNDiG9dODTkhHhUHixGrb/7UuyBIxJWUQ3KXvAaSDtwocImpuEIp2yO22OHrGW4Ljcm6S5ViaL5/kUQ6f5DTEdFFBFrEUyFIjXFhNQQzUVJFIHpEioRE0SVG7z5dIrSR3y7Ppu7R+6LC2OER2WzYB8L8umkn7vSv95WZG7A2u/+ozFXWe88vq0PD2NmskOZIaa6cWJi4P4jKhsFWFkTbsBTgDYnzCPeVQv+CK6EsmfUT1yUIUgAbzaBkpzioX/NMoil+cOIWlzDstbchAVfhyZ7gstb4F1wIjh+4U5ptJ4wV4lgRnIaRbxxZLSyR33HZgau0t3R57DLfVuH7CS5fkCU1jQcuDlIKLFNQ/sDVnbc/cUNl0i47Uvxs+hhX9r3a58pR2GuvJ7g8TgOanbhOa7jBlZA1h36Du4qTJXj9H7iwaJpbXOdcQko/q8y8LdmErsDd75URj2T+xF0gBWjHt4sU4w6cg1bfLT7BxW3i8NhXZRD6fo77IhZwITvX0z5C8A9c1OsUrwIFcPScVyZYoZjtOy4LFHuHx4GA0+Vj3PMEJq7taBHXYT9wO5ZdJ74yKAnuKI7zA+7GP+DSVH/4RhZV+C7PcSOocCTxlD1xHW7bZQCuEaqy3pVa26XCKI5Ks3n0IcHucLlJMjyCSMxNyI2YYpt5fSPM97ZpW6p/3Z4S0rOSJzboqjk0n2MTIy4yLG02NnEeaRTHcGRZNrvBRQ9MAGdrh5PxJpfXM1xQ5KZms+S1COHSy6Kc9iJHduWuBeuOf0TolfM+j9YZAGJwwT0uJoDr6PHKyJiyImLRE1zwJqrokfpDvt6WizA7BZa57sKNsouvbGmVDJXi+PS14B735Y0k3jOFHRvYL/LxEBd6q/bWujkNbmrTPsofs/rLlDXaemsFA1UnlWo9ZiFtr1FGGv5667oXmO7H6EPtrcfwHJRNBWyuytH404Wn33iFQHtUqeywAAAAAElFTkSuQmCC') !important; */\r\n }"
			}
		],
		"name": "StackExchange Dark",
		"originalDigest": "ce78ad218ea4e735ac86babbd088cf6709dfa384",
		"id": 9
	},
	{
		"enabled": true,
		"updateUrl": "https://userstyles.org/styles/chrome/118568.json",
		"md5Url": "https://update.userstyles.org/118568.md5",
		"url": "http://userstyles.org/styles/118568",
		"originalMd5": "badf151eede9eb53f25c70bab174e664",
		"installDate": 1574150561677,
		"sections": [
			{
				"urls": [],
				"urlPrefixes": [],
				"domains": [],
				"regexps": [
					"https?://([^:]+)(:[0-9]+)?/transmission/web/.*"
				],
				"code": "@namespace url(http://www.w3.org/1999/xhtml);\n* {\r\n        background-color: transparent !important;\r\n        color: inherit !important;\r\n        border-color: var(--border-color) !important;\r\n    }\r\n      \r\n    body, div.dialog_container div.dialog_window, .inspector-tab, div#jqContextMenu ul, .ui-widget-content {\r\n        background-color: var(--background-color) !important;\r\n        color: var(--foreground-color) !important;\r\n    }\r\n      \r\n    div#toolbar, #statusbar, div.torrent_footer, .ui-widget-header {\r\n        background-color: var(--background-color) !important;\r\n        background-image: var(--gradient-header) !important;\r\n    }\r\n\r\n    div.dialog_container div.dialog_window a {\r\n        background-color: var(--background-color) !important;\r\n        background-image: var(--gradient-button) !important;\r\n    }\r\n    div.dialog_container div.dialog_window a:hover, div.dialog_container div.dialog_window a:active {\r\n        background-color: var(--background-color) !important;\r\n        background-image: var(--gradient-button-selected);\r\n        border-color: var(--border-color-selected) !important;\r\n    }\r\n\r\n    .ui-state-default, .ui-widget-content .ui-state-default, .ui-widget-header .ui-state-default {\r\n        background-color: var(--background-color) !important;\r\n        background-image: var(--gradient-tab);\r\n    }\r\n    .ui-state-active, .ui-widget-content .ui-state-active, .ui-widget-header .ui-state-active {\r\n        background-color: var(--background-color) !important;\r\n        background-image: var(--gradient-tab-selected) !important;\r\n        border-color: var(--border-color-selected) !important;\r\n    }\r\n      \r\n    ul {\r\n        list-style: none;\r\n    }\r\n      \r\n    ul.torrent_list li.torrent.even {\r\n        background-color: rgba(255, 255, 255, 0.1) !important;\r\n    }\r\n    ul.torrent_list li.torrent.selected, ul.torrent_list li.torrent.selected.even, div#jqContextMenu ul li:hover {\r\n        color: var(--foreground-color-selected) !important;\r\n        border-color: var(--border-color-selected) !important;\r\n    }\r\n      \r\n\r\n    \r\n    div.inspector-tab.selected { border-color: var(--border-color-selected) !important; }\r\n    #inspector-tab-files {             background-image: var(--tab-files),    var(--gradient-button)          !important; }\r\n    #inspector-tab-files.selected {    background-image: var(--tab-files),    var(--gradient-button-selected) !important; }\r\n    #inspector-tab-info {              background-image: var(--tab-info),     var(--gradient-button)          !important; }\r\n    #inspector-tab-info.selected {     background-image: var(--tab-info),     var(--gradient-button-selected) !important; }\r\n    #inspector-tab-peers {             background-image: var(--tab-peers),    var(--gradient-button)          !important; }\r\n    #inspector-tab-peers.selected {    background-image: var(--tab-peers),    var(--gradient-button-selected) !important; }\r\n    #inspector-tab-trackers {          background-image: var(--tab-trackers), var(--gradient-button)          !important; }\r\n    #inspector-tab-trackers.selected { background-image: var(--tab-trackers), var(--gradient-button-selected) !important; }\r\n\r\n    div.torrent_footer div.selected { border-color: var(--border-color-selected) !important; }\r\n    div.torrent_footer div.main_container { display: none; }\r\n    #prefs-button {                    background-image: var(--button-prefs),              var(--gradient-button)          !important; }\r\n    #turtle-button {                   background-image: var(--button-turtle),             var(--gradient-button)          !important; }\r\n    #turtle-button.selected {          background-image: var(--button-turtle),             var(--gradient-button-selected) !important; }\r\n    #compact-button {                  background-image: var(--button-compact),            var(--gradient-button)          !important; }\r\n    #compact-button.selected {         background-image: var(--button-compact),            var(--gradient-button-selected) !important; }\r\n\r\n    div.file-priority-radiobox > div.selected { border-color: var(--border-color-selected) !important; }\r\n    div.file-priority-radiobox > div.low {             background-image: var(--priority-low),    var(--gradient-button)          !important; }\r\n    div.file-priority-radiobox > div.low.selected {    background-image: var(--priority-low),    var(--gradient-button-selected) !important; }\r\n    div.file-priority-radiobox > div.normal {          background-image: var(--priority-normal), var(--gradient-button)          !important; }\r\n    div.file-priority-radiobox > div.normal.selected { background-image: var(--priority-normal), var(--gradient-button-selected) !important; }\r\n    div.file-priority-radiobox > div.high {            background-image: var(--priority-high),   var(--gradient-button)          !important; }\r\n    div.file-priority-radiobox > div.high.selected {   background-image: var(--priority-high),   var(--gradient-button-selected) !important; }\r\n      \r\n    :root {\r\n        --background-color: #333;\r\n        --border-color: #222;\r\n        --border-color-selected: #666;\r\n        --foreground-color: rgba(255, 255, 255, 0.8);\r\n        --foreground-color-selected: rgba(0, 255, 0, 0.8);\r\n        --gradient-to-top:    linear-gradient(to top,    rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.1));\r\n        --gradient-to-bottom: linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.1));\r\n        --gradient-selected:  linear-gradient(to right, rgba(0, 255, 0, 0.2), rgba(0, 255, 0, 0),     rgba(0, 255, 0, 0.2));\r\n\r\n        --gradient-header: var(--gradient-to-top);\r\n        --gradient-button: var(--gradient-to-top);\r\n        --gradient-button-selected: var(--gradient-to-top), var(--gradient-selected);\r\n        --gradient-button-selected: var(--gradient-to-bottom);\r\n        --gradient-tab: var(--gradient-to-bottom);\r\n        --gradient-tab-selected: var(--gradient-to-top);\r\n\r\n        /* Images */\r\n        --priority-high: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAwUlEQVQokcXQMYoCMBAF0I9mqmRIkUkRkibpkiY38Bja7RU8hMcQPIedeCdLYWxUlhXBRvbDr+bBMAP8S+achznn4RO77L3vxhg6xtDe+w7A8h1e1Fr3rTX93VrrHsDiRaeUTqUUzTlrzvnnXi2laErp9ITMHEIIRxFREbnEGNePWYxxLSIXEdEQwpGZA6y1Z2ZW59zVe7/5u9l7v3HOXZlZrbVnENGWiNQYs3p3nDFmRURKRFsAMADaBx9sd/vl3ACk0StFsQlurQAAAABJRU5ErkJggg==\");\r\n        --priority-normal: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAASklEQVQokWNgGIlAVFRURVZW9qmMjMwDfFhWVvadiIiIFIOEhISWpKTkfyKxPIOIiAiviIhIk4iISD0+LCoq2i4oKMg/0CFCDQAAK2Qigs7t83QAAAAASUVORK5CYII=\");\r\n        --priority-low: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAwUlEQVQokb3QQQoCMQwF0FBn064KQlMoE4rQQKG5gseY2XkFDzHHGPAc7sQ7uRTiRl0Myqz0QzbhEZIA/COdiOzW0NN00Fo7iojWWvffcK11LyLaWjsCM1+ZWUsp95zzuMQ557GUcmdmZeYrpJS2RHQmIu37/kZEwwsT0fDsKRGdU0rb9yREvCCixhg1hHAIIRxijIqIioiXT6sa7/3svddFzQBgvt23cc5N1lq11qpzbgKAzdoHwRhzMsacVuFP8gCN6y5Xkv6lMgAAAABJRU5ErkJggg==\");\r\n\r\n        --button-turtle: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAICAYAAADwdn+XAAAAmklEQVQokY3PPQoCUQwE4E9sFEsbK8FOEES0trT0FLZ2Woi9XkTY4l3DO1haCHoJwWfzFtafXR0IhGQyk+ETLayQ4YDlF04pRrgjvtUZzQKvgc77cTuRH18EIq4YYFaYbYsCl4rjMuE9dHH64Z7XDTvM0cud+9jg+Id7M8ZYewkeQqinNkukBcYYpszTlD8ms1IETCr26/T6C54Bx0EzYFeoXQAAAABJRU5ErkJggg==\");\r\n        --button-prefs: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAA7klEQVQokZWP0YmEMBCG5yEkEMEwQsDgihIhAcEYK70SUsKVsCWkhCvhSph7MYcPruv+8MEQ5mPyA9xIjDFt20Yxxp87+/9ZliWFECiEQOu6preCtVaVeZ5n2vn96CoAgHMue+/Je0/OubS/Je/9dQVrrbLWpmma6IxLeRiGPI4jveB1/8fjQUf6vk9d1+Uyn0qIqIwx2RhDBzIiqlPhKGqts9aaCm3bXncrIiLmpmmogIj5rQgAqq7rXNc1HcgAcP1VAFBSylxVFRWklLdE4JwnIQQJIZ5CCOKc3xMBABhjX4wx2rkvHpIA4PtT8Q/UuVtO1WtEUAAAAABJRU5ErkJggg==\");\r\n        --button-compact: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAICAYAAADwdn+XAAAAbUlEQVQokcWQMQrAMAwD5UAwmUoGZzDK/5/nJ7hLU9op3Sq4RXAaBJI559xCMt19AsBySCbcPb/Sez8AvByYWYwxcoeZBa4s59n9GFWN1lruUNUAcDwdVQ3UWvMra+DViUiUUnKHiNyHLUdE4gRg62K+ejzZwAAAAABJRU5ErkJggg==\");\r\n\r\n        --tab-files: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAABBklEQVQ4jdWTsWqFMBiFfxwqjh26Xejz6hv8PoZ3EDcXQUTQIQYhLi5ZXFxcXE6HxlAsarx06YFvzEc4JyH67/GYGXEc/+L5fCoi8u4KfWbGuq6WrusAAGVZIkmS29KAmbEsi6VtW2xhZhDR223hPM+Wuq4tRhjcEkZRBCEEhBAYhgHTNFlchIcjZFmGpmnQ9z201tBaOwlPR0jTFFVVYRxHjOPoJLwcoSgKKKWglHIXno2Q5zmklJBSugt/Fr8fIQxDMLPFSbiVvscIPonoYfggIv9SuJW+xwjfza0CIzv9KQEz29L3vPSQmdmWvudl4Rl3hT59F/044HKEfTxzIDjgcoQ/zxc9wNC8RsMJhQAAAABJRU5ErkJggg==\");\r\n        --tab-info: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAClElEQVQ4jdWUS0hUYRiGP4UxBV0JgpJLL8d/lHFOUYFCNEaLMogSBN1ZE4JQeYsghjHJhamImhQKKTahgVcKpCIvVLSwclGjjgkFSV4WXtIiCp4W58jozJi07IcHzvf+//fyfuccfpH/dqV2Tyar4eU2NbLpVS9AvQA1sulVw8ttqd2Tyf/iFaYGl9ptI3B2Ai55oeqjwSWvoR0YAzW41C4iYXuZhauhjanj41D5Hq57Q1PxHnLGQA1tTIlI+O7JuhbaHU+g7B2Ub+PmB/j+G8aX/FrZW3A8BdW1EDppUvWYltEDF19ByeuduN4Zhs+/7tSdLyGjB5Kqx7SgUbXWxV5HP5wfDebWJFx9HaxfGAVHH2iti72Bo1tUy/r0mUEoHPbjfAaf1gFg8xecewQn+iH7IRzuBv0B2DpBtaxPi4hlu2GkaoKzfXCu30/PFLS8MQy//QS9Ixj7PVBNICKR2w2jVC2cvA+nPH5yOqHhlWE4NAP63WDsd0DVgohE7TBMc63NZLeCow2OtcGh26A3w8QXw7DssVEHYquHNNfaTKBhpFY6P5B5A440gl7nZ2s5e6B+ZOeeXgcZbtBK5wcCR7Yk5jYetJaDvRr0GoOjDbD+wzCc+GzUW3t6DWRWgbUcEk83Hwj8KOEiEqM557rSS8HuAt1tkNsIzg5/vYXdBelXQHPOdYlITOBvIyISISKxWtGqz1oM9krQr4UmswKsxaAVrfpEJNbsDVph5ouNSynweaxFkO4EWwnYLxvYSgzNWgQpBT6PiMSZPbteEuHmgdgE3Z2VkufzpOWvzKpCUIWQlr8ym5Ln8yTo7iwzWVSoUUMljRCRaLMpXkT2m8SbWrR5Zs/rKzCtRUT2mUmizGfL31L9ARu1bU1qe+H9AAAAAElFTkSuQmCC\");\r\n        --tab-peers: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAABZUlEQVQ4je2UMWrDMBhGf0JJ3EUpNTJElrEhKgYPxuAWgfFgAjbEYIgne/It0qX3yNBT5ATJJQqla+g9vg5NoSEdEs198CZJD/0gRPTPb6qqcpqm2TdNg6P7qqoc096orutd27YYhgHDMKBtW9R1vSOikUlwXJYluq5D3/fo+x5d16EsSxDR2CR4WxQFVqvViUVRgIhujYJ5nmO5XJ6Y57l5UGuNxWJxotbaPJgkyYfWGlmWIcsyaK2RJMmHaXAShuE6jmOkaYo0TRHHMcIwXBPRxCR4Q0R3SqltFEWIoghKqS0R3R3XrkNK+eD7/ksQBO/z+RxKKQRB8On7/qvneU8XRTjnSgjxLIR4c10XUkp4nneilBKu60IIcRBCbGaz2eOfMdu2nzjn4JzDcZyL/Nlv2/b5jRljG8YYptPpVTLGwBjbnAUtyzpYlgVDD39NfU9ELhHJK3WPZ88Y0/eDNdHos7iIL1k4pt0kxY1cAAAAAElFTkSuQmCC\");\r\n        --tab-trackers: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAACC0lEQVQ4jdWSsWsiQRTGvyoEIsmUuS7/QRbOImwRbDRbpNhiFyZYLOyyLKwh4hVrJdhsY5ohsOfYbGVlY2ezZf4ELYVUIW2IheV3jQaJcpru7oMHj5lvfu/NmwH+e9m2Xcmy7CXLshfbtisHHxyAP3bleZ6/z+dzzudz5nn+vs//qd/gz135aDRaFEXBoig4Go0W+/yf0uD1E3i6yssZeA4A4/H4fjKZvE0mk7fxeHwPABl4rsEyADyBpxq83gL2wcq6Uh+80OBdFzwiKUherUJ0wSMN3vXBi3V3fbCya4ZnGmx2weMV9EaDl6ZpGr1ej71ej6ZpGhq87IM3ANAFjzXYHIBnW8AV1B2A3uZakiRDpRSVUkySZPjF7w1AdydsY5ZKg81H8EQIITqdziIMw2UYhstOp7MQQohH8ESDTQ2qv8IAIANLGvyVgSUppR/HMdvt9nO73X6O45hSSn/Tsxf45bozx3GYpinTNKXjOEySZPYtyFqGYRhxHNPzvFeSFZIVz/Ne4zimYRjGt4G+7w+llGw0Gmy1Wmy1Wmw0GpRS0vf94X7ChoQQIoqiD8uyltPp9Hbd4XQ6vbUsaxlF0YcQQhwMrNVqvpSSrusyiiIGQcAgCBhFEV3XpZSStVrNPxhYr9dn1WqVSqmHdXfrUEo9VKtV1uv1wx+HZHkF2PoWJEurvfLBwH9KfwCL+zyAGn9UVAAAAABJRU5ErkJggg==\");\r\n    }"
			}
		],
		"name": "Transmission dark theme",
		"originalDigest": "870ff0bb623012a14a3ff083756fb0b94f6668a0",
		"id": 11
	},
	{
		"enabled": true,
		"updateUrl": "https://userstyles.org/styles/chrome/157126.json?ik-colorPallets=ik-navyblue&ik-frosted=ik-froston&ik-watchedoverlay=ik-watchedon&ik-searchbox=ik-searchboxcenter",
		"md5Url": "https://update.userstyles.org/157126.md5",
		"url": "http://userstyles.org/styles/157126",
		"originalMd5": "662b85c8aea5f0cc483285ec80705517",
		"installDate": 1575341578500,
		"sections": [
			{
				"code": "/*\n    * Name:    CleanTube v2\n    * Author:  Sardorbek Usmonov\n    * Version: 2.0.0\n*/\n/* ============ COLOR PALETTE ============ */\n:root {\n    --blue-day: #306AF2;\n    --blue-night: #4789E5;\n    --red-day: #F8333C;\n    --red-night: #ee353e;\n    /* Day */\n    --day-darker: #7d7d7d;\n    --day-dark: #B7B7B7;\n    --day-light: #DDDDDD;\n    --day-lighter: #EAEAEA;\n    --day-lightest: #FFFFFF;\n    /* Night */\n    --night-darkest: #1E2029;\n    --night-darker: #282a36;\n    --night-dark: #373844;\n    --night-light: ##6272a4;\n    --night-lighter: #e2e2dc\n}\n/* Cream White Theme */\nhtml:not([style-scope]):not(.style-scope) {\n    --yt-spec-brand-background-primary: var(--day-lightest) !important;\n}\nytd-masthead, app-toolbar.ytd-c4-tabbed-header-renderer {\n    box-shadow: var(--masterhead-shadow) !important;\n}\n\n/* Day */\nhtml:not([style-scope]):not(.style-scope) {\n    /* CUSTOM */\n    --watched-bg-color: rgba(255, 255, 255, .45);\n    --masterhead-shadow: 0 5px 12px 5px rgba(228, 9, 9, .07), 0 0 0px rgba(0, 0, 0, 0.25);\n    /* REMAPPED */\n    --yt-spec-brand-background-primary: var(--day-lighter);\n    --yt-main-app-background: var(--day-lightest);\n    --yt-app-background: var(--day-lightest);\n    --yt-main-app-background-tmp: var(--day-lightest);\n    --yt-spec-general-background-b: var(--day-lightest);\n    --yt-spec-general-background-a: var(--day-lightest);\n    --yt-sidebar-background: var(--day-lightest);\n    --yt-guide-background: var(--day-lightest);\n    --yt-dialog-background: var(--day-lightest);\n    --yt-live-chat-background-color: var(--day-lightest);\n    --paper-listbox-background-color: var(--day-lightest);\n    --yt-spec-brand-background-solid: var(--day-lightest);\n    --darker-bg-color: var(--day-lightest);\n    --yt-live-chat-vem-background-color: var(--day-lighter);\n    --yt-std-surface-300: var(--day-lighter);\n    --yt-simple-menu-header-background: var(--day-lighter);\n    --yt-featured-channel-title-text-color: var(--day-darker);\n    --ytd-metadata-line-color: var(--day-darker);\n    --yt-spec-text-disabled: var(--day-darker);\n    --yt-spec-text-primary: var(--night-darkest);\n    --video-title-text-color: var(--night-darker);\n    --yt-expand-color: var(--day-darker);\n    --yt-spec-text-secondary: var(--day-darker);\n    --link-text-color: var(--day-darker);\n    --ytd-badge-icon-color: var(--day-darker);\n    --ytd-owner-badge-color: var(--day-darker);\n    --yt-spec-call-to-action: var(--day-darker);\n    --badge-bg: var(--red-day);\n    --badge-color: var(--day-lightest);\n    --comment-op-bg-color: var(--day-darker);\n    --iron-icon-fill-color: var(--day-darker);\n    --comment-op-check-color: var(--day-lightest);\n    --yt-button-color: var(--day-darker);\n    --yt-spec-brand-button-background: var(--red-day);\n    --searchbox-focus-color: var(--red-day);\n    --searchresults-bg-color: var(--day-lightest);\n    --searchresults-text-color: var(--day-darker);\n    --searchresults-text-bg-hovered: var(--day-light);\n    --searchbox-placeholder-color: var(--day-darker);\n    --searchresults-searched-text-color: var(--blue-day);\n    --paper-toggle-button-checked-button-color: var(--blue-day);\n    --scrollbar-background: var(--day-lightest);\n    --scrollbar-color: var(--day-light);\n    --scrollbar-hover: var(--day-dark);\n    --scrollbar-active: var(--day-darker);\n    --sidepanel-menu-active: rgb(255, 0, 0, .25);\n    --sidepanel-menu-active-color: red;\n    --yt-spec-10-percent-layer: var(--day-light);\n    --yt-spec-icon-disabled: var(--day-light);\n    --yt-spec-icon-inactive: var(--day-darker);\n    --skeleton-bg-color: var(--day-lighter);\n    --paper-toggle-button-unchecked-bar: var(--day-dark);\n    --paper-toggle-button-unchecked-bar-color: var(--paper-toggle-button-unchecked-bar);\n    --url-color: var(--blue-day);\n}\n\n/* Night */\nhtml[dark]:not([style-scope]):not(.style-scope), [dark]:not([style-scope]):not(.style-scope) {\n    /* CUSTOM */\n    --watched-bg-color: rgba(0, 0, 0, .65);\n    --masterhead-shadow: 0 5px 12px 5px rgba(36, 36, 36, .07), 0 0 0px rgba(0, 0, 0, 0.25);\n    /* REMAPPED */\n    --yt-spec-brand-background-primary: var(--night-darker) !important;\n    --yt-main-app-background: var(--night-darkest);\n    --yt-app-background: var(--night-darkest);\n    --yt-main-app-background-tmp: var(--night-darkest);\n    --yt-spec-general-background-b: var(--night-darkest);\n    --yt-spec-general-background-a: var(--night-darkest);\n    --yt-sidebar-background: var(--night-darkest);\n    --yt-guide-background: var(--night-darkest);\n    --yt-dialog-background: var(--night-darkest);\n    --yt-live-chat-background-color: var(--night-darkest);\n    --paper-listbox-background-color: var(--night-darkest);\n    --yt-spec-brand-background-solid: var(--night-darkest);\n    --darker-bg-color: var(--night-darkest);\n    --yt-live-chat-vem-background-color: var(--night-darker);\n    --yt-std-surface-300: var(--night-darker);\n    --yt-simple-menu-header-background: var(--night-darker);\n    --yt-featured-channel-title-text-color: var(--night-lighter);\n    --ytd-metadata-line-color: var(--night-lighter);\n    --yt-spec-text-disabled: var(--night-lighter);\n    --yt-spec-text-primary: var(--night-lighter);\n    --video-title-text-color: var(--day-lightest);\n    --yt-expand-color: var(--night-lighter);\n    --link-text-color: var(--night-lighter);\n    --yt-spec-text-secondary: var(--night-lighter);\n    --ytd-badge-icon-color: var(--night-lighter);\n    --ytd-owner-badge-color: var(--night-lighter);\n    --yt-spec-call-to-action: var(--night-lighter);\n    --badge-bg: var(--red-night);\n    --badge-color: var(--day-lighter);\n    --comment-op-bg-color: var(--night-dark);\n    --iron-icon-fill-color: var(--night-lighter);\n    --comment-op-check-color: var(--day-lightest);\n    --yt-button-color: var(--night-lighter);\n    --yt-spec-brand-button-background: var(--red-night);\n    --searchbox-focus-color: var(--red-night);\n    --searchresults-bg-color: var(--night-darker);\n    --searchresults-text-color: var(--night-lighter);\n    --searchresults-text-bg-hovered: var(--night-dark);\n    --searchbox-placeholder-color: var(--night-lighter);\n    --searchresults-searched-text-color: var(--blue-night);\n    --paper-toggle-button-checked-button-color: var(--blue-night);\n    --scrollbar-background: var(--night-darkest);\n    --scrollbar-color: var(--night-dark);\n    --scrollbar-hover: var(--night-light);\n    --scrollbar-active: var(--night-lighter);\n    --sidepanel-menu-active: var(--night-dark);\n    --sidepanel-menu-active-color: var(--red-night);\n    --yt-spec-10-percent-layer: var(--night-dark);\n    --yt-spec-icon-disabled: var(--night-dark);\n    --yt-spec-icon-inactive: var(--night-lighter);\n    --skeleton-bg-color: var(--night-darker);\n    --paper-toggle-button-unchecked-bar: var(--night-dark);\n    --paper-toggle-button-unchecked-bar-color: var(--paper-toggle-button-unchecked-bar);\n    --url-color: var(--blue-night);\n}\n\n/* ============ FONTS ============ */\n@font-face {\n    font-family: Google Sans;\n    font-style: normal;\n    font-weight: 400;\n    src: url(https://fonts.gstatic.com/s/googlesans/v14/4UaGrENHsxJlGDuGo1OIlL3Owp4.woff2);\n}\n\n@font-face {\n    font-family: Google Sans;\n    font-style: normal;\n    font-weight: 500;\n    src: url(https://fonts.gstatic.com/s/googlesans/v14/4UabrENHsxJlGDuGo1OIlLU94YtzCwY.woff2);\n}\n\n/* ============ BASE CODE ============ */\nbody, html, #search-input.ytd-searchbox-spt input {\n    font-family: 'Google Sans', Roboto, sans-serif;\n    font-weight: 400;\n}\n\nb {\n    font-family: 'Google Sans', Roboto, sans-serif !important;\n    font-weight: 500 !important;\n}\n\nyt-formatted-string[has-link-only_]:not([force-default-style]) a.yt-simple-endpoint.yt-formatted-string, #description-text.ytd-video-renderer, .content.ytd-channel-video-player-renderer, .deemphasize.yt-formatted-string, #caption.ytd-toggle-item-renderer, #label.ytd-pinned-comment-badge-renderer {\n    color: var(--link-text-color) !important;\n}\n\nyt-icon.ytd-pinned-comment-badge-renderer {\n    fill: var(--link-text-color) !important;\n}\n\n#tabs-inner-container.ytd-c4-tabbed-header-renderer, #channel-header.ytd-c4-tabbed-header-renderer, #container #section, ytd-multi-page-menu-renderer {\n    background: var(--darker-bg-color) !important;\n}\n\n#sections.ytd-multi-page-menu-renderer > ytd-background-promo-renderer.ytd-multi-page-menu-renderer {\n    background: var(--darker-bg-color);\n    margin-bottom: none;\n}\n\npaper-button.ytd-subscribe-button-renderer .deemphasize.yt-formatted-string {\n    color: white !important;\n}\n\npaper-button.ytd-subscribe-button-renderer[subscribed] .deemphasize.yt-formatted-string {\n    color: var(--yt-spec-text-secondary) !important;\n}\n\n#video-title.yt-simple-endpoint.ytd-grid-video-renderer, h3.ytd-compact-video-renderer, ytd-compact-radio-renderer.use-ellipsis #video-title.ytd-compact-radio-renderer, #video-title.ytd-playlist-panel-video-renderer, .title.ytd-video-primary-info-renderer {\n    color: var(--video-title-text-color) !important;\n}\n\nytd-live-chat-frame#chat, #search-icon-legacy.ytd-searchbox:hover {\n    border: none;\n    box-shadow: none;\n}\n\nytd-author-comment-badge-renderer {\n    background: var(--comment-op-bg-color);\n}\n\nytd-author-comment-badge-renderer yt-icon {\n    fill: var(--comment-op-check-color);\n}\n\nytd-guide-entry-renderer[active] {\n    background-color: var(--sidepanel-menu-active);\n    border-radius: 0 25px 25px 0;\n}\n\nytd-guide-entry-renderer[active] .guide-icon.ytd-guide-entry-renderer, ytd-guide-entry-renderer[active] .title.ytd-guide-entry-renderer {\n    fill: var(--sidepanel-menu-active-color);\n    color: var(--sidepanel-menu-active-color);\n}\n\napp-toolbar.ytd-c4-tabbed-header-renderer {\n    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.15), 0 0 0px rgba(0, 0, 0, 0.25);\n}\n\nytd-sentiment-bar-renderer[activated_] #like-bar.ytd-sentiment-bar-renderer {\n    background: var(--blue-day);\n}\n\nytd-toggle-button-renderer.style-default-active[is-icon-button], ytd-toggle-button-renderer.style-default-active[is-icon-button] yt-icon {\n    color: var(--blue-day);\n    fill: var(--blue-day);\n}\n\n#home-page-skeleton .skeleton-bg-color, .masthead-skeleton-icon, .watch-skeleton .skeleton-bg-color, html[dark] #home-page-skeleton .skeleton-bg-color, html[dark] .masthead-skeleton-icon, html[dark] .watch-skeleton .skeleton-bg-color {\n    background-color: var(--skeleton-bg-color);\n}\n\npaper-toggle-button[checked]:not([disabled]) .toggle-bar.paper-toggle-button {\n    background-color: var(--paper-toggle-button-unchecked-bar) !important;\n}\n\n#expander yt-formatted-string[has-link-only_]:not([force-default-style]) a.yt-simple-endpoint.yt-formatted-string, #description a.yt-simple-endpoint.yt-formatted-string, #expander a.yt-simple-endpoint.yt-formatted-string {\n    color: var(--url-color) !important;\n}\n\n/* ============ SEARCHBOX ============ */\n#search-icon-legacy.ytd-searchbox, #container.ytd-searchbox {\n    border: none;\n    background: transparent !important;\n}\n\n#container.ytd-searchbox input.ytd-searchbox::placeholder, input#search::placeholder {\n    color: var(--searchbox-placeholder-color);\n}\n\nytd-searchbox[has-focus] #container.ytd-searchbox {\n    border: none;\n    border-bottom: var(--searchbox-focus-color) solid 1px;\n    box-shadow: none;\n    transition: border-bottom 350ms ease-in-out;\n    -webkit-transition: border-bottom 350ms ease-in-out;\n    -o-transition: border-bottom 350ms ease-in-out;\n}\n\n#container.ytd-searchbox {\n    box-shadow: none !important;\n}\n\n/* ============ SEARCHRESULTS ============ */\n.sbdd_b, .sbsb_a, .sbfl_b {\n    background: var(--searchresults-bg-color);\n    border: none;\n}\n\n.gsfs, .sbfl_a {\n    color: var(--searchresults-text-color);\n}\n\n.sbsb_d {\n    background: var(--searchresults-text-bg-color-hovered);\n}\n\n.sbpqs_a {\n    color: var(--searchresults-searched-text-color);\n}\n\n.sbdd_a {\n    top: 50px !important;\n    z-index: 9999 !important;\n}\n\n.sbdd_b {\n    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.15), 0 0 0px rgba(0, 0, 0, 0.25);\n}\n\n/* ============ WATCHED BADGE ============ */\nytd-thumbnail-overlay-toggle-button-renderer, ytd-thumbnail-overlay-time-status-renderer[overlay-style=DEFAULT] {\n    z-index: 2;\n}\n\nytd-thumbnail-overlay-resume-playback-renderer, #progress.ytd-thumbnail-overlay-resume-playback-renderer {\n    background-color: var(--watched-bg-color);\n    height: 100%;\n    width: 100%;\n}\n\n#progress.ytd-thumbnail-overlay-resume-playback-renderer:after {\n    content: 'WATCHED';\n    left: 0;\n    top: 0;\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-pack: center;\n    -ms-flex-pack: center;\n    justify-content: center;\n    -webkit-box-align: center;\n    -ms-flex-align: center;\n    align-items: center;\n    font-size: 1.35rem;\n    letter-spacing: 0.035rem;\n    height: 21px;\n    width: 77px;\n    margin: 4px;\n    border-radius: 3px;\n    opacity: .8;\n    color: #fff;\n    background: #121212\n}\n\nytd-thumbnail:hover ytd-thumbnail-overlay-resume-playback-renderer, #progress.ytd-thumbnail-overlay-resume-playback-renderer {\n    height: 0\n}\n\nyt-formatted-string.ytd-thumbnail-overlay-playback-status-renderer {\n    display: none;\n}\n  \n/* ============  BADGES ============ */\n.badge-style-type-simple.ytd-badge-supported-renderer, .badge-style-type-live-now.ytd-badge-supported-renderer, .badge-style-type-red.ytd-badge-supported-renderer {\n    background: var(--badge-bg);\n    color: var(--badge-color);\n    border: none;\n}\n\n/* ============ FROSTED ============ */\nytd-thumbnail-overlay-side-panel-renderer {\n    --blur: 10px;\n    backdrop-filter: blur(var(--blur));\n    -webkit-backdrop-filter: blur(var(--blur));\n}\n\n/* ============ SCROLLBAR ============ */\nhtml[hide-scrollbar=\"true\"] ::-webkit-scrollbar, ::-webkit-scrollbar-corner {\n    display: none;\n}\n\n::-webkit-scrollbar, ::-webkit-scrollbar-corner {\n    background: var(--scrollbar-background);\n    width: 10px;\n    height: 10px;\n}\n\n::-webkit-scrollbar-button {\n    display: none;\n}\n\n::-webkit-scrollbar-thumb {\n    background: var(--scrollbar-color);\n}\n\n::-webkit-scrollbar-thumb:not(:active):hover {\n    background: var(--scrollbar-hover);\n}\n\n::-webkit-scrollbar-thumb:active, ::-webkit-scrollbar-thumb:hover:active {\n    background: var(--scrollbar-active);\n}",
				"urlPrefixes": [
					"https://www.youtube.com/"
				]
			}
		],
		"name": "CleanTube 2 (NEW UPDATE!!!)",
		"originalDigest": "f77d1739500a82bd642f03ecabb54308bd2b03f1",
		"id": 21,
		"updateDate": 1581129986355
	},
	{
		"enabled": true,
		"updateUrl": "https://userstyles.org/styles/chrome/22251.json",
		"md5Url": "https://update.userstyles.org/22251.md5",
		"url": "http://userstyles.org/styles/22251",
		"originalMd5": "52673f0b8a441088a0229dbbf36f9ee4",
		"installDate": 1575343452208,
		"sections": [
			{
				"code": "@namespace url(http://www.w3.org/1999/xhtml);\n#topRight,\n#topLeft,\n#bottom,\n#middleContainer>h3 {\n    display: none !important;\n}\n\n#ctitle {\n    color: #dddddd !important;\n}\n\nbody {\n    background: #1E2029;\n}\n\n#middleContainer {\n    background: #1E2029 !important;\n    border: 0 !important;\n    color: #1E2029 !important;\n}\n\nul.comicNav li a {\n    background: #1E2029 !important;\n    border-color: hsl(220, 28%, 40%) !important;\n    box-shadow: none !important;\n}\n\nul.comicNav li a:hover {\n    background: hsl(211, 38%, 66%) !important;\n    color: #ffffff !important;\n}\n\n.imageCaption {\n    color: #dddddd !important;\n    text-align: center !important;\n    background: #282a36 !important;\n    margin: 5px 0 0 !important;\n    padding: 5px !important;\n    font-size: 13px !important;\n}",
				"domains": [
					"xkcd.com"
				]
			}
		],
		"name": "dracula: xkcd",
		"originalDigest": "4bc70aa95f0eb41725e1c4e2dbc5b718dcdd0a6f",
		"id": 22,
		"updateDate": 1581130216156
	},
	{
		"enabled": true,
		"updateUrl": "https://userstyles.org/styles/chrome/153882.json",
		"md5Url": "https://update.userstyles.org/153882.md5",
		"url": "http://userstyles.org/styles/153882",
		"originalMd5": "cab8c955bd5e6f83d66045dbee50142c",
		"installDate": 1575355300691,
		"sections": [
			{
				"urls": [],
				"urlPrefixes": [],
				"domains": [
					"nixos.org"
				],
				"regexps": [],
				"code": "@font-face {\r\n  font-family: 'Quattrocento';\r\n  font-style: normal;\r\n  font-weight: 400;\r\n  src: local('Quattrocento'), url(http://themes.googleusercontent.com/static/fonts/quattrocento/v5/WZDISdyil4HsmirlOdBRFKRDOzjiPcYnFooOUGCOsRk.woff) format('woff');\r\n}\r\nbody {\r\n  font-family: 'Quattrocento';\r\n  font-size: 18px;\r\n  line-height: 1.45em;\r\n  background-color: #002b36 !important;\r\n  color: #93a1a1 !important;\r\n}\r\nh1 {\r\n  color: #93a1a1 !important;\r\n}\r\na:link {\r\n  color: #268bd2 !important;\r\n}\r\na:visited {\r\n  color: #2aa198 !important;\r\n}\r\na:hover {\r\n  color: #d33682 !important;\r\n}\r\ndiv.book {\r\n  background-color: #073642 !important;\r\n}\r\ndiv.docbook code {\r\n  font-size: 0.8em;\r\n}\r\npre {\r\n  box-shadow: none !important;\r\n  border: none !important;\r\n}\r\ncode,\r\npre {\r\n  background-color: #073642 !important;\r\n  color: #93a1a1 !important;\r\n}\r\n.alert-info code,\r\n.alert-info pre,\r\n.alert-info {\r\n  background-color: #fdf6e3 !important;\r\n  color: #586e75 !important;\r\n  border: none !important;\r\n  line-height: 1.4em !important;\r\n}\r\n.alert-info code,\r\n.alert-info pre {\r\n  background-color: #eee8d5 !important;\r\n}\r\ntable#search-results tr.odd > td {\r\n  background-color: #073642;\r\n}\r\n.table th,\r\n.table td {\r\n  border: none;\r\n}\r\ntable#search-results tr.details > td:hover {\r\n  background-color: #002b36;\r\n}\r\n.table-hover tbody tr:hover>td,\r\n.table-hover tbody tr:hover>th {\r\n  background-color: #002b36;\r\n}\r\n.navbar-inner {\r\n  background-image: none;\r\n  background-color: #073642;\r\n  border: none;\r\n}\r\n.navbar .brand,\r\n.navbar .nav>li>a {\r\n  text-shadow: none;\r\n}\r\n.navbar-search .search-query {\r\n  background-color: #002b36;\r\n  border: none;\r\n}\r\nul.nixos-blogs > li:nth-child(odd),\r\nul.nixos-commits > li:nth-child(odd) {\r\n  background-color: #073642;\r\n}\r\nul.nixos-blogs > li,\r\nul.nixos-commits > li {\r\n  border-top: 1px solid #073642;\r\n}\r\nhr {\r\n  border-top: 1px solid #073642;\r\n  border-bottom: 1px solid #073642;\r\n}\r\ntr.news-header {\r\n  border-bottom: 1px solid #073642;\r\n}\r\n.news-short {\r\n  color: #b58900;\r\n}\r\n/* $base03:    #002b36; */\r\n/* $base02:    #073642; */\r\n/* $base01:    #586e75; */\r\n/* $base00:    #657b83; */\r\n/* $base0:     #839496; */\r\n/* $base1:     #93a1a1; */\r\n/* $base2:     #eee8d5; */\r\n/* $base3:     #fdf6e3; */\r\n/* $yellow:    #b58900; */\r\n/* $orange:    #cb4b16; */\r\n/* $red:       #dc322f; */\r\n/* $magenta:   #d33682; */\r\n/* $violet:    #6c71c4; */\r\n/* $blue:      #268bd2; */\r\n/* $cyan:      #2aa198; */\r\n/* $green:     #859900; */"
			}
		],
		"name": "Nixos Solarized (Dark)",
		"originalDigest": "b8e24095530af971f61ee64a39b373a7ca2e5736",
		"id": 25
	},
	{
		"enabled": true,
		"updateUrl": "https://userstyles.org/styles/chrome/179101.json",
		"md5Url": "https://update.userstyles.org/179101.md5",
		"url": "http://userstyles.org/styles/179101",
		"originalMd5": "5a232c77627dfdb22013e4026899b0b1",
		"installDate": 1581128205184,
		"sections": [
			{
				"code": ":root {\n  --bg1: #1E2029;\n  --bg2: #282a36;\n  --bg3: #282a36;\n  --bg4: #21222d;\n  /* code background */\n  --bg5: #282a36;\n  --bg6: #282a36;\n\n  --selected: #f8f8f2;\n  --selected2: #f8f8f2;\n  --accents: #bd93f9;\n\n  --btn: #44475a;\n  --btn2: #44475a;\n  --btn3: #44475a;\n  --btn4: #44475a;\n}\n\npre,\ncode,\ntt,\nkbd:not(.badmono),\npre,\nsamp,\n.js-line-number,\n.blob-num,\n.blob-code,\n.file-data pre,\n.line-data,\n#gist-form .file .input textarea,\n.blob-code-inner {\n  font-family: 'Source Code Pro', 'Menlo', Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;\n}\n\n.tabnav--responsive .tabnav-tab,\n.page-responsive .previewable-comment-form .comment-form-head.tabnav .toolbar-commenting,\n.pagehead.repohead.readability-menu {\n  background-color: var(--bg1) !important;\n  border: 0px;\n}\n\n.SelectMenu-item,\n.SelectMenu-header {\n  background-color: var(--bg1) !important;\n  color: var(--selected) !important;\n}\n\n.SelectMenu-item:hover {\n  background-color: var(--btn) !important;\n}\n\ntextarea:focus {\n  background-color: var(--bg1) !important;\n}\nbody {\n  background-color: var(--bg3) !important;\n}\n.markdown-body table tr,\n.blob-num-context,\n#user-content-toc td {\n  background: var(--bg1) !important;\n}\n.highlight:not(.lines) tr:not(.inline-comments):hover td.selected-line.blob-num:not(.line-age),\n.highlight:not(.lines) tr:not(.inline-comments):hover td.blob-num,\n.blob-num[colspan],\n.blob-num-hunk {\n  background: var(--bg3) !important;\n}\n.list-browser-item.closed,\n.content .verseblock-content,\n.content .verseblock-content,\n.simple-stacked-bar,\n.date_selector td.selectable_day:hover,\n.date_selector td.selectable_day.hover,\n.pagination a:hover,\n.pagination a:focus,\n.pagination span:hover,\n.pagination span:focus,\n.pagination em:not(.current):hover,\n.pagination em:not(.current):focus,\n.dropdown-divider,\n.js-current .standalone a,\n.sidebar-module .disable > a,\n.label-select-menu div.labelstyle-000000.selected,\n.ScreenshotCarousel-navitem.selected,\n.CircleBadge {\n  background: var(--bg1) !important;\n}\n.header,\n.headers,\n#readme .markdown-body,\n.social-count,\n.file,\n.box-body,\n.markdown-body table tr:nth-child(2n),\n.steps li,\n.explore-section:nth-child(2n),\n.markdown-format table,\n.list-group-item,\n.chromed-list-browser .none p,\n.chromed-list-browser .error p,\n.list-browser-footer,\n.commandbar .choice:hover,\n#gollum-editor-help,\n.search-filter:hover,\n#wiki-history table tr:nth-child(2n) td,\n.display tr:hover,\n.octofication .message,\n.commandbar .loading:hover,\n.comment-content,\n.commandbar .message,\n.boxed-group-inner,\n#adv_code_search .search-page-label,\n.timeline-comment,\n#contributors-master svg.viz,\n.diff-table .line-comments,\n.menu,\nsvg.spark,\nsvg.capped-card-content,\nbody.api .content tbody,\n.markdown-format img:not(.emoji),\n.mini-repo-list,\n#common-issues,\n.setup-wrapper .oauth-permissions-details,\n.milestone-list,\n.setup-form .setup-plans,\n.prose-diff > .markdown-body,\n.revision .gu,\n.tree-browser td,\n.tree-browser .alt td,\n.branches .branch-summary,\n.branches .no-results-message,\n.simple-box-footer,\n.commit-group,\n.blankslate,\n.content table tr,\n#search-results,\ntable.files,\n.mergeable,\n.org-module,\n.org-add-footer,\n.branch-infobar,\ntable.capped-list tr:nth-child(2n),\n.team-org-group,\n#gollum-editor-help-wrapper,\n.integrations-quality,\n.showcase-featured .mo-info .featured-grid-outer,\n.render-shell,\n.list,\n.latest-commit .commit-author,\n.bubble,\n.tabs > a.selected,\n.comment-form-head .tabnav-tab.selected,\n.oauth-org-access-details .boxed-group-list > li.on,\n#fullscreen_overlay,\n.branch-action-body,\n.inline-comment-form,\n.file-history-tease .participation,\n.gist-quicksearch-result-header,\n.label-generic,\n.migrate-org-roles,\n.commit-tease .commit-meta,\n.manage-repo-access-icon,\n.table-list:not(.team-member-list),\n.repo-file-upload-progress,\n.gcr-ext-editor-dialog,\n.shade-gray,\n.exploregrid-item,\n.signed-commit-badge-small,\n.facebox-popup,\n.explore-signup-entice-wrapper,\n.billing-addon-items tr.total-row,\n.billing-addon-items tr.dark-row,\n.Box-body,\nli.pinned-repo-item,\n.js-contribution-graph h2 + div:last-child,\n.project-triage-pane,\n.user-profile-nav.is-stuck,\n[data-filterable-for='projects-filter'] .container-lg,\n.review-summary-form-wrapper,\n#projects-results,\n.listgroup,\n.protected-branch-orgs-and-repo-admins,\n.listgroup-overflow,\n.Header,\n.project-column,\n.btn.btn-outline,\n.js-notice > .border,\n.news .issues_labeled .border,\ntable.pricing-table,\n.two-factor-steps,\ndiv.border.rounded-1,\narticle.border.rounded-1,\n.border-right.border-bottom.border-left,\n.graph-before-activity-overview,\n.access-form-wrapper {\n  background: var(--bg2) !important;\n}\n.table-list-header,\n.timeline-comment-header,\n.boxed-group > h3,\n.boxed-group .heading,\n.file-header,\n.capped-card h3,\n.select-menu-header,\n#gist-form .file .meta,\n.file .meta,\n.file-box .meta,\n.menu-heading,\n.audit-results-header,\n.branches .branch-group-heading,\n.auth-form-header,\n.commit-form,\n.migration-jumbotron,\n.migration-sub-header,\n.commit-tease,\n.manage-repo-access-title,\n.select-menu-divider,\n.signed-commit-header,\n.reorderable-task-lists .markdown-body .task-list-item.hovered,\n.next-charge-box,\n.credit-card,\n.branch-action-body .merge-message,\n.review-thread-reply,\na.card.bg-gray-light:hover,\n.add-member-team-list .team-row-header,\n.Box-header,\n.pagination .gap,\n.pagination .disabled,\n.pagination .gap:hover,\n.pagination .disabled:hover,\n.listgroup-header,\n.merge-status-item,\n.previewable-comment-form .comment-form-head.tabnav,\n.bg-gray:not(body):not(.team-discussions-container),\n.Header .header-search-wrapper,\n.Header .header-search-wrapper input,\n.user-key-email-unverified {\n  background: var(--bg1) !important;\n}\n.calendar-graph .contrib-details div,\n.tabnav-tabs a,\n.time,\n.gist-item .metadata .datetime,\n.list-group-item-meta,\na.keyboard-shortcuts,\nbutton.keyboard-shortcuts,\n.simple-conversation-list,\n.simple-conversation-list > li .title .num,\n.drag-and-drop,\n.starred-repo .sort-info,\n.org-stats,\n.commandbar .choice,\n.commandbar .loading,\n.commandbar .description,\nul.summary-stats li a,\n.authorship,\n.sha-block,\n.gh-header-meta,\n#last-edit,\n.setup-header .lead a,\n.repository-meta .edit-link a,\n.api-status a,\n.meta li,\n.who_when a,\n.numbers-summary a,\n.mini-icon-remove-close:hover,\n.section-heading-title .separator,\n.blog-aside .rss,\n.hook-list a,\n.github-jobs-promotion a.jobs-logo,\n.org-teams-list .team-meta,\n.repo-list-item .repo-description,\n.branch-infobar .lightweight-actions > li a,\n.repo-leaderboard-list .repo-leaderboard-meta-item a,\n.changed .moved-up:before,\n.changed .moved-down:before,\n.comment-header .octicon,\na.section-heading-back,\n.list-group-item-meta .octicon,\n.repo-leaderboard-title .title-meta,\na.pagehead-nav-item,\n.wiki-wrapper .wiki-empty-box,\n.commits-list-item .commits-comments-link,\n.timeline-comment-header,\n.commits-list-item .commit-meta,\n.issues-listing .table-list-issues .issue-comments-link,\n.issues-listing .table-list-issues .issue-meta-section a,\na.issues-reset-query,\n.labels-list-action,\ntable.tag-list p a,\ntable.tag-list td.date a,\n.muted-link,\na.muted-link,\n.render-view-modes li,\n.site-footer,\n.site-footer .octicon-mark-github:hover,\n.repo-list-stats .repo-list-stat-item,\n.range-editor span.flag .octicon,\n.commit-info .commit-meta a,\n.notifications .issue-notification.read .type-icon,\n.notifications .read a,\n.auth-form-header .octicon,\n.releases-tag-list p a,\n.history-link a,\na.issue-nwo-link,\nul.filter-list .filter-item,\n.member-meta .teams-link,\n.member-meta .btn-link,\nul.comparison-list > li em,\nul.comparison-list > li.title,\n.diffstat-summary,\na.team-member-ellipsis,\na.discussion-item-toggle-open,\na.discussion-item-toggle-closed,\nbutton.discussion-item-toggle-open,\nbutton.discussion-item-toggle-closed,\n.dropdown-header,\n.participation a,\n.completeness-indicator-info,\n.type-icon-state-none,\n.pagehead-tabs-item,\na.pagehead-tabs-item,\n.commit-tease,\n.reponav-item,\na.reponav-item,\n.delete-owners-button,\n.stats-group-stat,\n.stats-group-stat.no-link:hover,\n.wiki-edit-link,\n.toolbar-item .menu-target,\n.member-meta .member-meta-link,\n.hidden-text-expander a,\n.ellipsis-expander,\n.text-muted,\n.listgroup-item,\n.discussion-item-header,\n.discussion-sidebar-heading,\n.org-header-meta .meta-item .meta-link,\n.underline-nav-item,\n.boxed-group-inner,\n.lead,\n.form-checkbox .note,\n.bot-identifier,\n.dashboard-notice .dismiss:hover,\n.text-gray,\ntd.icon .octicon-file-text,\ntd.icon .octicon-file-symlink-file,\n.UnderlineNav-item,\n.project-header-link,\nbutton.project-header-link,\ntd.icon,\n.project-pane-close,\n.facebox-close,\n.tree-browser-result mark {\n  color: #a3aac1 !important;\n}\nimg,\n#browser table,\n#browser table th,\n#issues .menu ul li,\n.branches .more-branches,\n.issues td,\nul.main_nav li.selected,\n.browser_header,\n.issue-head,\n.bootcamp-help .image,\nul.hook-list,\n.clone-url-button,\n.list-tip li,\n.section-nav a,\n.search-menu-container,\n.repo_list li a,\n.graphs .axis,\n.switcher > span:after,\na.assignee-bit,\n.menu li,\n.notifications td,\n.filter-tab,\nul.hook-list li,\n.repo .border,\n.box-action,\nul.repo-stats li a,\n.footer_nav h4,\n.footer-divider,\n.chromed-list-browser,\n.js-activate-link,\n.chromed-list-browser div,\n.filter-bar,\n.columns.sidebar,\n.title,\n.lbl,\n#contributors .person,\n.tabnav,\n#commit-activity-master,\n#services,\n.top-rule,\n.blog-post,\n#services .service,\nul.stats,\n.select-menu-filters,\n.select-menu-item,\n.select-menu-tabs,\n.release-list > li,\n.context-body,\n.api li:before,\n.library-list .feature,\n.lower_footer,\n.cheatsheet,\n.pagehead.settings-area,\n.release-body,\n.suggester,\n.pull-state,\n.pull-number,\n.merge-pr,\n.gist-file,\n#graph-shots li,\n.sidebar,\n.release-timeline,\n.explore h2,\n#head,\n.leaderboard-list-item,\n.release-timeline-tags .main,\n.search-result-item,\n.details,\n.jobs-list,\n.content-header,\n.user-list-item,\n.markdown-body,\nul#categories li h5,\n.render-view-modes li,\n.gobutton.with-comments .sha,\n#gollum-editor-function-bar,\n.capped-box,\n.steps li,\n#common-issues,\n.steps,\n#graphs,\n.previewable-comment-form .comment,\n.org-module,\n.org-repo,\n.table-list,\n.org-add-footer,\n.auto-search-group .search-filter,\n#notification-center li,\n.branch-status,\n.comment + .comment,\n.discussion-bubble-inner,\n.member-row,\n.press-info,\n.timeline-comment,\n.timeline-comment-header,\n.timeline-commits .timeline-commits-header,\n.marketing-section,\n.featured-callout .screenshot,\n.page-new-repo .license-container,\n.sidebar-module,\n.collapsed,\n.expanded,\n.discussion-topic,\n.bubble-inner,\n.team-org-group,\ndiv.article div.helper div.content,\n.boxed-group-inner .help,\ndl.new-email-form,\n.file .meta-divider,\n.avatar-stack.multiple-avatars:before,\n.file-box,\n.file-actions .btn-group li,\n.gist .gist-file .gist-data,\n.calendar-graph .contrib-details div,\n.branch-action-body,\n.setup-form .tos-info,\n.setup-form .setup-organization-next,\n.collection-page .other-content,\n.bubble-wrap,\n.release-show,\n.file-wrap,\n.branches .branch-summary,\n.branches .no-results-message,\n.branch-a-b-count .count-half:last-child,\n.tabnav-tab.selected,\n.panel-nav,\n.file,\n.full-commit .sha-block > a,\n.theme-selector-thumbnail,\n.segmented-nav li,\n.overall-summary,\n.boxed-group-inner,\n.search-form button,\n.branches .branch-group-heading,\n.boxed-group > h3,\n.boxed-group .heading,\n.issues-list-actions,\np code,\ncode,\n.wiki-wrapper .wiki-empty-box,\n#adv_code_search .search-page-label,\npre.headers,\n.inline-comment-form,\n.history-link,\n.oauth-permissions-details,\n.setup-info-module .features-list .list-divider,\n.setup-wrapper .oauth-permissions,\n.swipe .swipe-frame .swipe-shell,\nul.search-results,\n.orgs-help-shelf-content .orgs-help-divider,\n.repository-lang-stats-graph,\n.gist-quicksearch-results,\n.gist-quicksearch-result,\n.gist-quicksearch-result-group,\n.listgroup,\n.listgroup-item + .listgroup-item,\n.user-key-badge,\n.newsfeed-placeholder,\n.progress-bar-inline .progress-bar,\n.menu-heading,\nbody .border-gray-dark,\n.discussion-item-review .blob-wrapper,\n.bot-identifier,\n.counter,\n.Counter,\ndiv.marketplace-product-callout,\n.CodeMirror-dialog-top,\n.project-card:hover {\n  border-color: rgba(30, 32, 41, 1) !important;\n}\n.edit-repository-meta,\n.field label,\n.boxed-group-list li,\n.capped-box,\n.marketing-nav a,\n.repository-meta,\n.gist-item .description,\np.explain,\n.news .alert .simple .title,\n#network .graph-date,\n.tabnav-widget.text,\n.feature .intro,\nspan.diffstat,\nspan.diffstat a,\n.commit .commit-branches a,\n#readme .plain,\n.news blockquote,\n.news blockquote p,\n.collection-stat,\n.overall-summary .graphs .desc,\n.flash-global a,\n.calendar-graph .contrib-details div .lbl,\n.tag-info a,\na.browse-button,\n.ghead .dir,\n.repository-lang-stats .percent,\n.comment-header-action-text a,\n.comment-header-right a,\n.gist-item .creator,\n.dashboard-tabs a,\n#graph_data .tab a,\n.pull-info,\n.list-group-item .list-group-item-summary a,\n#contributors .capped-card .cmt,\n.boxed-group-list .access-level,\nh3.conversation-list-heading,\na.filter-tab,\n.starred-repo p.description,\n.commit-desc pre,\n.org-repo-stats a,\n.org-repo-updated a,\n.org-repo-description,\n.org-repo-forked a,\n.commandbar .display table td span,\n.clone-options,\n.pulse-section,\n.discussion-sidebar p,\n.discussion-topic-header .discussion-topic-author,\n.gist-description,\n.explain,\np.subtext,\n.team-grid .team-description,\n.orgs-nav .org-nav-item,\n.form-actions-protip .protip,\n.discussion-item .author,\n.inline-comments .comment-count,\n.sidebar-heading,\n.clear-issue-filters a,\n.render-view-modes li.active:before,\nul.comparison-list > li em,\n.marketing-benefits .column p,\n.sub-nav li a,\n.headlines a .date,\n.sidebar-module ul ul li span,\n.merge-branch-description,\n.gist-item ul.meta > li > a,\nul#categories li h5 a,\n.render-view-modes li.active,\n.user-leaderboard-list .repo-list-item .repo,\n.repo-stats li a,\n.about p,\ndl.form > dd p.note,\np.subdued,\n.team-header .team-description,\n.hfields dl.form > dt label,\n.boxed-group > h3 a.boxed-group-breadcrumb,\n.boxed-group .heading a.boxed-group-breadcrumb,\n.subscriptions-sidebar .note,\n.thread-subscription-status,\n.ellipsis-button,\n.follow-list .follow-list-info,\nform.btn .count,\n.blame .commitinfo .date,\n.gist .gist-file .gist-meta a,\n.merge-pr-more-commits,\n.hidden-text-expander a,\n.news div.message,\n.news li blockquote,\n.news .alert .pull-info,\n.news .alert .branch-link,\n.release .release-authorship a,\n.wiki-wrapper .wiki-empty-box:hover,\n.select-menu.is-showing-clear-item .select-menu-clear-item .octicon,\n.diffstat-summary a,\na.subnav-item,\n.branches .branch-group-heading .branch-group-name,\n.render-notice,\n.table-list-milestones .stat,\n.commits-listing .commit-group-title .octicon-git-commit,\n.select-menu-header .octicon:hover,\n.repo-list-description,\n.file .meta,\n.email-format .email-hidden-toggle a,\n.file-diffstat,\n.program-info-column .mega-octicon,\n.octofication .notice-dismiss:hover,\n.markdown-format .intro,\n.label-admin,\n.program-info-column p,\n.file-history-tease,\n.blob-num:hover,\n.gist-snippet-meta .gist-count-links > li > a,\n.commit-tease .message,\n.commit-author-section,\n.manage-repo-access-not-active,\n.milestone-name,\n.select-menu-modal,\n.select-menu-action,\n.feature-callout,\n.repo-file-upload-file-wrap .remove-file:hover,\n.rss-subscribe,\ntable.capped-list .octicon,\n.site-header-menu .nav-item,\n.exploregrid-item,\n.markdown-body blockquote,\n.link-gray,\n.tabnav-tabs button.tabnav-tab,\n.commits-list-item .commit-desc pre,\n.Label--outline.bg-yellow-light,\n.review-comment .pending-batched-suggestion-label {\n  color: rgba(255, 255, 255, 0.6) !important;\n}\n\n.Label--outline.bg-yellow-light {\n  background-color: var(--btn) !important;\n}\n#main,\n.capped-box,\n.unread_count,\n#browser table th,\n.markdown-format table th,\ntable.upgrades tr.current td,\n.definitions,\n.discussion-topic-header,\n.timeline-commits-minimal .commit-icon .octicon,\n.timeline-commits .commit-icon .octicon,\n.upload-progress,\n.search-results-listing em,\n.discussion-bubble-inner,\n#wiki-history table td,\n.gist .gist-file .gist-data,\n.logo-box,\n.markdown-example .rendered,\n.team-grid .team-members,\n.diagram-icon:not(.active),\ntable.capped-list th,\n.filter-bar,\n.audit-search-clear,\n.country-info,\n.tabnav-tab.selected,\n.file-diff-split .empty-cell,\n.composer-infobar,\n.completeness-indicator-blank,\n.leaflet-control-zoom,\n.pagehead-tabs-item.selected,\n.reponav-item.selected,\n.manage-repo-access-not-active,\n.header-search-scope,\n.reverse-progress-bar,\n.featurette.py-5,\n.payment-history .refunded,\n.payment-history .failed,\n.profile-timeline-month-heading.bg-white,\n.project-card,\n.gh-header .gh-header-sticky.is-stuck + .gh-header-shadow {\n  background: var(--bg2) !important;\n}\n.btn,\npre,\nh1,\nh2,\nh3,\n.header,\ntable,\ntable tr,\ntable td,\ntable th,\nblockquote,\n.pulse-graph,\n.minibutton,\n.social-count,\n.discusion-topic-infobar,\n.box-body,\n.timeline-comment-label,\n.logo-box,\n.developer-program-badge,\n.vcard-details,\n.vcard-stats,\n.auth-form-header,\n.nav-bar-tabs .section-title,\n.pagination a:last-child,\n.pagination span:first-child,\n.boxed-group-list > li,\n.toolbar-bordered,\n.pagination span:last-child,\n.dashboard-tabs,\n.graphs,\n.graph,\n.sub-nav,\n.audit-search-clear,\n.repo-list-item,\n.email-signature-reply,\nfooter,\n.bubble .bubble-expand,\n.grid .col,\n.composer-infobar,\n.email-quoted-reply,\n.summary-stats li,\n.columns.equacols.bordered,\n.file-diffstat,\nul.filter-list,\n.news .alert,\ntable.files td,\n.explore-section,\n.repolist > li,\n.featured-grid-outer,\n.gh-header-meta,\n.theme-picker-thumbs,\n.team,\n.billing-section,\n.sidebar-module ul h3,\n.headlines li,\n.discussion-sidebar-item + .discussion-sidebar-item,\n.markdown-format img,\ndiv#common-issues ul li,\n.about-facts,\n.starred-repo,\n.markdown-example,\n.traffic-graph-stats,\n.discussion-item + .discussion-item,\n.bubble,\n.tree-browser,\n.simple-box-footer,\n.team-grid .team-members,\n.org-list .list-item,\n.stats-group .stat,\n.team-info-card .team-stats,\n.table-of-contents li,\n.commit-group,\n.table-list-bordered .table-list-cell:first-child,\n.table-list-bordered .table-list-cell:last-child,\n.table-list-cell,\n.table-list,\n.table-list-header,\n.blankslate,\n.labels-list-item,\n.subnav-divider-right,\n.subnav-bordered,\n.content table tr th,\n#search-results li,\n.subhead,\n#pages-composer,\n.render-bar,\n#gollum-editor-help,\n#gollum-editor-help-parent,\n#gollum-editor-help-list,\n.auth-section,\n.commit-sha,\n.comment-body,\n.mini-repo-list-item,\n.advanced-search-form fieldset,\n.contrib-column,\n.org-header .edit-org,\n.pulse-summary .summary-box,\n.pulse-summary .summary-box li:first-child,\n.list-item + .list-item,\n.list-item + .list-heading,\n.list-heading + .list-item,\n.issue-list-item,\n.collection-card,\n.setup-header,\nbody.api pre,\n.stats-group-stat:first-child,\n.build-statuses-list,\n#gollum-dialog-dialog-buttons,\n#gollum-dialog-dialog h4,\na.gollum-minibutton,\na.gollum-minibutton:visited,\n.two-factor-toggle .two-factor-status,\n.two-factor-settings-group,\n.member-badge,\nul.comparison-list > li,\n.release-downloads,\n.release-downloads li,\n.blob-interaction-bar,\ninput.subnav-search-input,\n.select-menu-header,\n.select-menu-modal,\n#gist-form .file .meta,\n.file .meta,\n.file-box .meta,\n.capped-card,\n.audit-results-header,\n.pagination a,\n.pagination span,\n.pagination em,\n.input_area,\n.output_area .rendered_html table,\n.render-info .message,\n.subnav .btn + .issues-search,\n.branch-action-body .branch-action-item + .branch-action-item,\n.discussion-item-merged.open .discussion-item-details-header,\n.discussion-item-merged.open .build-statuses-list,\n.build-status-item,\n.pagehead-tabs-item.selected,\n.org-header,\n.pagehead,\n.branch-action-item + .mergeability-details,\n.migration-section,\n.migrate-org-roles,\n.migrate-org-roles-header,\n.migration-footer,\n.migration-org-avatar,\n.org-migration-settings-section,\n.word-upload-callout .note,\n.commit-tease .commit-meta,\n.manage-user-info,\n.manage-repo-access-title,\n.org-settings-team-item:first-child,\n.label-generic,\n.plan-notice,\n.intgr-header,\n.code-list-item,\n.sort-bar,\n.repo-file-upload-outline,\n.comment-reactions.has-reactions,\n.reaction-summary-item,\n.select-menu-divider,\n.featurette.border-top,\n.tile-block,\n.tile-bordered:not(:last-child),\n.showcase-page-header,\n.showcase-page-repo-list,\n.header-search-scope,\n.result-group a,\n.signed-commit-badge,\n.signed-commit-header,\n.user-key-email,\n.border-top,\n.pricing-card-cta,\n.shelf,\n.access-token,\n.about-menu,\n.oauth-border,\n.reponav-item.selected,\n.file-header,\n.reorderable-task-lists .markdown-body .task-list-item.hovered,\n.next-charge-box,\n.setup-info-module h2,\n.radio-label,\n.border,\n.border-top,\n.border-right,\n.border-bottom,\n.border-left,\n.border-y,\n.pinned-repo-list-item,\n.pinned-repo-filters,\n.orghead,\n.orghead .edit-org,\n.Box-body-row,\n.discussion-item-deployed,\n.branch-action-body .merge-message,\n.new-project-column,\n.confirm-removal-list-container,\n.confirm-removal-list-item,\n.user-profile-nav,\n.review-thread-reply,\n.feature-callout-octicon,\n.feature-callout,\n.discussion-item + .discussion-item,\n.discussion-item-review + .discussion-item,\n.libraries-jumbotron,\n.last-review-thread,\n.menu-item,\n.review-comment.is-comment-editing,\n.Box,\n.team-list-footer,\n.Box-header,\n.profile-rollup-summarized + .profile-rollup-summarized,\n.Subhead,\n.dashboard-notice .coupon,\n.Box-body,\n.listgroup-header,\n.merge-status-item,\n.pending-team-invitations-link,\n.discussion-item + .discussion-item-review,\n.profile-timeline-card-wrapper,\n.profile-rollup-wrapper + .profile-rollup-wrapper,\n.email-preference-exceptions .exception,\n.user-key-email-unverified {\n  border-color: rgba(255, 255, 255, 0.02) !important;\n}\n.btn:active,\noption:hover,\n.listings-layout .nav li a:hover,\n.state-merged,\n#fork-select .target:not(.disabled):hover,\n.flash-notice,\ntable.upgrades tr:hover td,\n.email-format .email-hidden-toggle:hover a,\n.dashboard-tabs a:hover,\n.documentation-results a:hover,\n.hidden-text-expander a:hover,\n.dropdown-item:hover,\n.dropdown-item.zeroclipboard-is-hover,\n.subnav-item.selected,\n.subnav-item.selected:hover,\n.subnav-item.selected:focus,\n.example-nav li a.selected,\n.issues-reset-query:hover .octicon-x,\n.segmented-nav li.active,\n.diff-expander:hover,\n.pagination .current,\n.owner-select-target:hover,\n.release-timeline-tags .expander-text:hover .expander-dots,\n.gollum-minibutton:hover,\n.gollum-minibutton:visited:hover,\n.search-result-item.navigation-focus,\n.gist-quicksearch-result.navigation-focus,\n.gist-snippet .link-overlay .link,\n.btn.btn-outline:hover,\n.btn.btn-outline:active,\n.btn.btn-outline.selected,\n.btn.btn-outline.zeroclipboard-is-hover,\n.btn.btn-outline.zeroclipboard-is-active,\n.pull-request-link:hover,\n.issues-reset-query:hover .issues-reset-query-block,\n.date-selector td.selected,\n.date-selector td.selectable-day:hover,\n.add-line-comment,\n.suggester .cur,\n.result.selected,\n.result:hover,\n.CommunityTemplate-highlight,\n.diff-table button.add-line-comment,\n.version-picker a:hover,\n.discussion-item-changes-marker.is-unread .discussion-item-icon {\n  background: var(--bg2) !important;\n  color: #fff !important;\n}\n.comment-reactions .user-has-reacted,\n.filter-item.selected {\n  background: #373848 !important;\n}\n.markdown-format pre,\n.markdown-body pre,\n.markdown-format .highlight pre,\n.markdown-body .highlight pre,\n#facebox pre,\n.blob-expanded,\n.terminal,\n.copyable-terminal,\n#notebook .input_area,\n.blob-code-context,\n.markdown-format code,\n.api pre,\n.api code,\n.hook-delivery-details pre,\n.hook-delivery-container pre,\n.CodeMirror,\n.highlight {\n  background: var(--bg4) !important;\n  color: #ccc !important;\n  border: none !important;\n}\n.blob-expanded .blob-num,\n.blob-expanded .blob-code {\n  background: var(--bg3) !important;\n}\n\n#readme .plain,\n.readme .markdown-body,\n.readme .plain,\n.pull-request-composer,\n.drag-and-drop,\n.octofication .broadcast-icon-mask,\n.file .image,\n.merge-pr-more-commits,\n.coupons .coupon-form-body,\n.manage-repo-access-group,\n.saved-reply-form,\n.orghead .edit-org:hover,\n.octotree_views,\n.simple-box,\n.btn-link.timeline-progressive-disclosure-button,\na.border.rounded-1,\n.Box:not([style*='background']),\n.octotree_sidebar .octotree_bottom {\n  background: var(--bg2) !important;\n  border-color: var(--bg2) !important;\n}\n.Box-row,\n.Box-footer,\n.border-y,\n.border-top,\n.border-sm-top,\n.border-md-top,\n.border-lg-top,\n.commits-list-item + .commits-list-item,\n.diff-table .line-comments,\n.diff-table tr:not(:last-child) .line-comments,\n.timeline-comment .comment + .comment,\n.facebox-footer,\n.comment-reactions.has-reactions,\n.select-menu-divider,\n.branch-action-body .merge-branch-form,\n.branch-action-body .merge-message,\n.branch-action-item + .branch-action-item,\n.branch-action-item + .mergeability-details,\n.codesearch-results .repo-list-item + .repo-list-item,\n.dashboard-rollup-items > .dashboard-rollup-item,\n.topic-list .topic-list-item + .topic-list-item,\n.discussion-post .reply-comment:first-child,\n.issue-list-item + .issue-list-item,\n.last-review-thread,\n.review-thread-reply,\n.file-navigation .get-repo-btn,\n.user-list-item + .user-list-item,\n.wiki-list .wiki-list-item + .wiki-list-item {\n  border-top: 1px solid var(--bg2) !important;\n}\n.Header {\n  border-bottom: none !important;\n}\n.blame .blob-num,\n.blame-blob-num,\n.overall-summary,\n.repository-lang-stats,\n.collection-card,\n.team-grid .team,\n.code-list .divider .blob-num,\n.code-list .divider .blob-code,\n.expandable-line-num .diff-expander:hover,\n.select-menu-filters,\n.select-menu-modal,\n.pagination a,\n.build-status-item,\n.more-branches,\n.plan-choice.open,\n.uploaded-files > li.delete,\n.bg-gray-light,\n.more-repos,\n.billing-per-seat-callout:after,\n.code-list-item .blob-num,\n.blob-num.js-line-number,\n.bg-gray-light.disabled {\n  background: var(--bg1) !important;\n}\n.UnderlineNav-item:focus .UnderlineNav-octicon,\n.UnderlineNav-item:hover .UnderlineNav-octicon,\n.UnderlineNav-item.selected .UnderlineNav-octicon,\n.text-gray-light,\n.markdown-body blockquote,\n.markdown-body h6,\n.table-list,\n.autocomplete-item .organization-member,\n.full-commit .branches-list li.loading,\n.full-commit .branches-list li.pull-request,\n.branches-tag-list li.loading,\n.commit-branches,\n.table-of-contents .octicon-diff-renamed,\n.toc-select .select-menu-item-icon.octicon-diff-renamed,\n.conversation-list-heading,\n.simple-conversation-list,\n.simple-conversation-list > li .num,\n.deployment-status-label,\n.list-group-item .list-group-item-summary a.quiet,\n.select-menu-tabs .select-menu-tab-nav,\n.select-menu-tabs a,\n.select-menu-item.disabled,\n.select-menu-item.disabled.selected,\n.select-menu-item.disabled .description,\n.select-menu-item.disabled.selected .description,\n.credit-card.amex .title,\n.billing-addon-items .addon-cost,\n.payment-history .refunded .status,\n.plan-choice-exp,\n.blame-commit-date[data-heat='10'],\n.blame-hunk:hover .reblame-link,\nul.comparison-list > li.title,\n.admin-options-block .disabled,\n.admin-options-block .disabled .note,\n.check-annotation-notice .annotation-title,\n.code-list .full-path a,\n.deployments-timeline-icon.is-inactive,\n.graphs .dir,\n.delete-topic-button,\n.topic-tag-action .add-topic-button,\n.topic-tag-action .remove-topic-button,\n.jump-to-suggestions-path .jump-to-octicon,\n.hook-item .description,\n.hook-item.inactive .icon-for-inactive,\n.hook-item.mute .icon-for-mute,\n.hook-item.pending .icon-for-pending,\n.hook-deliveries-list .item-status.pending,\n.hook-delivery-time,\n.repository-lang-stats ol.repository-lang-stats-numbers li > a,\n.repository-lang-stats ol.repository-lang-stats-numbers li > span,\n.page-new-repo .form-checkbox.disabled,\n.oauth-permissions-details.default:not(.delete) .access-details,\n.oauth-permissions-details.default:not(.delete) .permission-title,\n.oauth-permissions-details.none .access-details,\n.oauth-permissions-details.none .permission-title,\n.oauth-application-whitelist .edit-link,\n.oauth-application-info .app-info,\n.developer-app-item .developer-app-list-meta,\n.org-insights-cards [role='tab'][aria-selected='true'] .UnderlineNav-octicon,\n.export-actions a,\n.pinned-repo-name,\n.vcard-detail .octicon,\n.profile-timeline-card .issue-meta-section .octicon,\n.profile-rollup-toggle,\n.mini-repo-list-item .stars,\n.numbers-summary .octicon,\ntable.files td .simplified-path,\ntable.files td.message,\ntable.files td.message a,\ntable.files td.age,\n.settings-email .email-actions .settings-remove-email.settings-disabled-remove-email,\n.setup-creditcard-form .form-group select:invalid,\n.task-run.inactive .icon-for-inactive,\n.task-run.pending .icon-for-pending,\n.team-listing .expand-nested-team,\n.user-status-emoji-tab[role='tab'][aria-selected='true'] .UnderlineNav-octicon,\n.home-hero-signup .form-control-note,\n.gist-snippet-meta .gist-count-links > li .octicon,\n.gist-snippet-meta .extra-info,\n.gist-quicksearch-results .gist-quicksearch-result-header,\n.gist-quicksearch-results .select-menu-item h4,\n.gist-quicksearch-results .select-menu-item span,\n.markdown-body del {\n  color: rgba(255, 255, 255, 0.4) !important;\n}\n.issues-list,\n.pulls-list-group,\n.commit-tease,\n.branch-infobar,\n.pagehead.repohead h1 .repo-label span,\n.coupons .coupon-form-body .coupon-icon,\n.menu,\n.merge-pr-more-commits,\n.api pre {\n  border: 1px solid rgba(0, 0, 0, 0.03) !important;\n}\n.compare-pr-placeholder,\n.compare-cutoff,\n.diff-cutoff,\n.flash.flash-warn,\n.flash-global.flash-warn,\n.markdown-body li.added.moved,\n.repo-private-label,\n.gist-secret-label,\n.label-private,\n.stale-files-tab,\n.signed-out-comment,\n.warning,\n.commits-list-item em,\n.unsupported-browser,\n.prereceive-feedback,\n.zhc-banner {\n  background: rgba(126, 81, 35, 0.4) !important;\n  border: 1px solid #542 !important;\n}\n.btn,\ninput.btn,\nheader.nav-bar,\n.bubble .bubble-title,\nkbd,\na.feed,\n.list-browser-filterbar,\n.gobutton,\n.comment-header,\n.pagehead ul.tabs li a,\n.login_form input[type='submit'],\n.top-bar,\nul#bootcamp li a h4,\n#gists .context-menu-container,\nbody#com #header,\n.white-nav .selected span,\n.filter-tab,\n#header-wrapper,\n#header-wrapper .nav,\n.pagination span,\n.cheatsheet h2,\n.section a.section-head,\n.octotree_view_header,\n.list-heading,\n.dashboard-tabs li a,\na.function-button,\n.add-pill-form,\n.gist .gist-file .gist-meta,\n.octotree_toggle,\nul.comparison-list > li.title,\nbutton.button,\na.button,\nspan.button,\nbutton.minibutton,\na.minibutton,\nspan.minibutton,\n.clone-url-button > .clone-url-link {\n  background: var(--bg2) !important;\n  border-color: var(--bg2) !important;\n}\n.btn:hover,\n.btn:active,\n.btn.zeroclipboard-is-hover,\n.btn.zeroclipboard-is-active,\n.minibutton:hover,\n.minibutton:active,\n.minibutton.zeroclipboard-is-hover,\n.minibutton.zeroclipboard-is-active.kbd,\n.signup-button:hover,\na.signin:hover,\n.hero .textographic,\n.hero .screenographic,\n.pagination span.current,\n.box-action:active,\n.btn:active,\n.btn.selected,\n.btn.selected:hover,\n.btn.zeroclipboard-is-active,\n.minibutton:active,\n.minibutton.selected,\n.minibutton.selected:hover,\n.minibutton.zeroclipboard-is-active,\n.octotree_toggle:hover,\nbutton.button:hover,\na.button:hover,\nspan.button:hover,\nbutton.minibutton:hover,\na.minibutton:hover,\nspan.minibutton:hover,\n.clone-url-button.selected > .clone-url-link,\n.clone-url-button.selected > .clone-url-link:hover,\nul#bootcamp li a:hover h4 {\n  background: var(--bg5) !important;\n  border-color: var(--bg5) !important;\n}\n.commitinfo,\n.gc .diff-line-code,\n.gc .diff-line-num,\n.gc .diff-line-pre,\n.featured-commit-activity-graph,\n.featured-repo-logo,\n.outline-box,\n.gobutton > .sha .octicon,\n.markdown-body .csv-data .blob-num,\n#feedBody,\n.search-result-header,\n.accessibility-aid:focus,\n.file-data,\n.signup-plans th,\n.signup-plans td,\n.signup-plans-orgs th,\n.signup-plans-orgs td,\n.commits td,\n.featured-callout,\n.sidebar-module ul ul li,\n.native-download,\n.setup-info-module,\ndiv#common-issues ul,\n#gist-form .name,\n.subnav-item,\n.render-notice,\n.label-edit.edit-color-label-form .color-editor .color-editor-input,\n.date_selector td,\n.new-label,\n.range-editor .range,\n.range-editor .flag,\n.octotree_sidebar,\n.auth-form-body,\ndiv.border-wrap,\n.profile-header,\n.highlight .gc,\n.uploaded-files.is-populated,\n.range-editor,\n#gollum-editor-help-parent li a.selected,\n#gollum-editor-help-list li a.selected,\n#gollum-editor-help-parent li a:hover,\n#gollum-editor-help-list li a:hover,\n.github-access-banner,\n.protip-callout,\nul.comparison-list,\n.wiki-custom-sidebar,\n.invitation-container,\n.orgs-help-shelf,\n.orgs-help-item-octicon,\ntextarea,\n.thread-subscription-status,\n.branch-action-body .merge-branch-form,\n.pull-info,\n.branch-link,\n.discussion-item-merged.open .discussion-item-details,\n.word-upload-callout,\n.commit-tease-contributors,\n.session-authentication .create-account-callout,\n.intgrs-lstng-item,\n.intgr-install-callout,\n.is-failed .repo-file-upload-errors,\n.is-bad-file .repo-file-upload-errors,\n.is-too-big .repo-file-upload-errors,\n.is-too-many .repo-file-upload-errors,moz-extension://7d69bfd2-7bdf-41a4-8b4c-d5d025044fe0/edit.html?id=26#\n.is-empty .repo-file-upload-errors,\n.site-header,\n.site-subheader,\n.pricing-card,\n.explore-signup-entice,\n.price-box,\n.cvv-hint-tooltip,\n.plan-choice,\n.date-selector td,\n.user-profile-sticky-bar:after,\n.review-thread,\n.card,\n.tutorial,\n.overview .card > div[style*='background'],\n.Box-footer,\n.ScreenshotCarousel,\n.card-filter-autocomplete-dropdown .autocomplete-keyword-only,\n.inbox-zero,\n.tag-input .suggester,\n.review-comment:target .timeline-comment-label,\n.review-comment:target button.reaction-summary-item {\n  background: var(--bg1) !important;\n  border-color: var(--bg1) !important;\n}\n.pagehead ul.actions a.feed,\n.explore h2 .feed,\n#code_search_instructions h2,\ntd.inst,\n.metabox-loader,\n.pull-flag,\n.browser-content,\n.filterbar ul.filters li,\n.pagehead ul.tabs li.contextswitch,\n#wiki-header > div,\n.pagehead ul.tabs li.contextswitch:hover,\n.bigbutton a,\n#new_message,\n#issues_next ul.sorts li,\nul.sorts li.asc,\nul.sorts li.desc,\n.listings-layout .columns.main .content,\n.fieldswrap,\n.filterbar li.selected,\n#issues_next ul.filters li,\ntable.instruction tr:nth-child(2n),\n.email-hidden-toggle a,\n#commit-activity-master-head,\n.action-indicator,\n.pull-head .diffstat,\nul.suggestions,\n.discusion-topic-infobar,\n.commits-listing:before,\n.discussion-item-icon,\n.jstree-wholerow-hovered,\n.bubble-contents,\n.ellipsis-button,\n.filter-list li span.bar,\n.selectable_day.today,\n.billing-plans .current,\n.commits-listing:before,\n.billing-section .usage-bar,\n.issue-list em,\n.file-info-divider,\n.pagehead ul.tabs li a:hover,\n.repos .bottom-bar,\n#languages .popular,\n.tip-box h4,\ntable.upgrades td,\n.commit-preview .message,\n.commit-preview p.error,\n.pagehead ul.tabs li.contextswitch,\n#browser tr th,\n.status-box h4,\n.line_numbers,\n#files span.icon,\n#issues_list .actions,\n#repos .public,\n.inset-callout,\n#repo-message,\n.repo-private-label,\n.label-admin,\na.team-member-ellipsis,\n.code-list em,\n.user-list em,\n.credit-card.normal .signature,\n.credit-card.amex .gladiator,\n.subnav-item:hover,\n.subnav-item:focus,\n.wiki-list em,\n.progress-bar:not(.anim-grow-x),\n.header-search-scope:hover,\n.CommunityTemplate-highlight--focus,\n.related-issue-item.navigation-focus,\n.commit-sha {\n  background: var(--bg5) !important;\n}\n.template-previews .discussion-sidebar-heading,\nbody,\n.Box-row-link,\n.btn,\n.social-count,\n.form-control,\n.form-select,\np.explain strong,\n.menu-item.selected,\n.menu-item .octicon,\n.tabnav-tab.selected,\n.tabnav-tab:focus,\n.tabnav-tab:hover,\n.UnderlineNav-item:focus,\n.UnderlineNav-item:hover,\n.UnderlineNav-item.selected,\n.text-gray-dark,\n.link-gray-dark,\n.text-emphasized,\n.Counter--gray-light,\n.markdown-body span.frame span span,\n.table-list-header-toggle .btn-link:hover,\n.table-list-header-toggle .btn-link.selected,\n.table-list-header-toggle .btn-link.selected:hover,\n.table-list-header-toggle .select-menu-button.selected,\n.table-list-header-toggle .select-menu-button.selected:hover,\n.table-list-header-toggle .select-menu-button:hover,\n.breadcrumb strong.final-path,\n.commit-author-section,\n.commits-list-item .commit-title,\n.signed-commit-signer-name .signer,\n.toc-select .select-menu-item-heading,\n.toc-select .select-menu-item-text,\n.blob-code-inner,\n.blob-code-addition .x,\n.blob-code-deletion .x,\n.tabnav-pr .tabnav-tab.selected,\n.discussion-item-entity,\n.discussion-item-ref-title .title-link,\n.pull-request-integrations-title,\n.discussion-item .renamed-is,\n.discussion-item .renamed-was,\n.dropdown-item,\n.keyboard-mappings th,\n.list-group-item-link,\n.team-mention,\n.user-mention,\n.pagehead-actions > li,\n.pagehead-tabs-item:hover,\n.pagehead-tabs-item.selected,\n.reponav-item:focus,\n.reponav-item:hover,\n.reponav-item.selected,\n.steps li.current,\n.prose-diff.collapsed .rich-diff-level-zero.expandable:hover .octicon,\n.prose-diff.collapsed .rich-diff-level-zero.expandable:only-child:hover:before,\n.radio-label,\n.select-menu-divider,\n.select-menu-header .select-menu-title,\n.select-menu-tabs .select-menu-tab-nav:hover,\n.select-menu-tabs a:hover,\n.select-menu-tabs .select-menu-tab-nav.selected,\n.select-menu-tabs .select-menu-tab-nav[aria-selected='true'],\n.select-menu-tabs a.selected,\n.select-menu-tabs a[aria-selected='true'],\n.select-menu-blankslate h3,\n.select-menu-item.selected,\ndetails-menu .select-menu-item[aria-checked='true'],\ndetails-menu .select-menu-item[aria-selected='true'],\n.select-menu-item.selected > .octicon,\ndetails-menu .select-menu-item[aria-checked='true'] > .octicon,\ndetails-menu .select-menu-item[aria-selected='true'] > .octicon,\n.select-menu-item-parent.navigation-focus,\n.select-menu-item-parent.navigation-focus.selected,\n.select-menu-item-parent[aria-selected='true'],\n.select-menu-item-parent[aria-selected='true'].selected,\n.select-menu-item-parent.navigation-focus .octicon-check,\n.select-menu-item-parent.navigation-focus.selected .octicon-check,\n.select-menu-item-parent[aria-selected='true'] .octicon-check,\n.select-menu-item-parent[aria-selected='true'].selected .octicon-check,\n.selected .checks-index-label,\n.code-list em,\n.search-autocomplete-dropdown .autocomplete-text,\n.CommunityTemplate-highlight,\n.dashboard-notice h2,\n.exploregrid-item-title,\n.getting-started .link-text,\n.jump-to-field-active,\n.page-responsive .HeaderMenu-link:hover,\n.page-responsive .HeaderMenu-details[open] .HeaderMenu-link,\n.header-nav-current-user .user-profile-link,\n.select-menu-item.navigation-focus > .octicon.label-options-icon,\n.select-menu-item[aria-selected='true'] > .octicon.label-options-icon,\n.repository-lang-stats ol.repository-lang-stats-numbers li .lang,\n.marketplace-plan-emphasis,\n.merge-branch-heading,\n.oauth-org-access-details .oauth-org-item.on strong,\n.oauth-application-whitelist .request-info strong,\n.oauth-application-info .application-title,\n.developer-app-item .developer-app-name,\n.org-insights-cards [role='tab'][aria-selected='true'],\n.manage-repo-access-not-active,\n.manage-memberships-tabs-item.selected,\n.pinned-repo-checkbox:checked + .pinned-repo-name,\n.access-token .token-description,\n.token-scope,\n.shelf-dismiss .close-button:hover,\n.team-listing .is-open .expand-nested-team,\n.user-status-emoji-tab[role='tab'][aria-selected='true'],\n.subheader-nav .nav-item.selected,\n.illflow-item.selected .illflow-item-heading,\n.MarketingBody-lead > p:first-child,\n.site-header-nav .dropdown-menu a.active,\n.flash {\n  color: rgba(255, 255, 255, 0.7) !important;\n}\n.text-alpha,\n.text-beta,\n.text-delta,\n.text-gamma,\nh1,\nh2,\nh3,\nh4,\nh5,\n.link-muted:hover,\n.text-black,\n.menu-item.selected,\n.header-enterprise-version {\n  color: rgba(255, 255, 255, 0.65) !important;\n}\n.subnav-bordered,\n.markdown-body h1,\n.markdown-body h2,\n.boxed-group-table th,\n.boxed-group-table td,\n.capped-card > p,\n.capped-card h3,\n.select-menu-item,\ntable.files tr.up-tree,\ntable.capped-list td,\n.pricing-table td {\n  border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;\n}\n.list-browser-item.navigation-focus,\n.headlines li:hover,\n.js-details-container.navigation-focus,\n.js-details-container.navigation-focus:nth-child(2n),\n.team-grid .team-members,\n.tree-browser tr.navigation-focus td,\n.issues-listing .table-list-issues .selectable:hover,\n.issues-listing .table-list-issues .navigation-focus,\n.setup-plans tr.selected,\n.notifications .navigation-focus,\n.sidebar-module ul ul li a:hover,\n.typeahead-result,\n.no-results,\n.link-overlay .link,\n#gollum-editor-help-list,\n.owner-select-target,\n.divider .blob-code div.highlight,\n.oauth-org-access-details .boxed-group-list > li.on:hover,\npre div:hover,\n.summary-stats li a:hover,\n.pinned-repos-selection-list-item.selected,\n.Box-body-row--highlight.navigation-focus,\n.Box-body-row--highlight:hover,\n.js-current .standalone a,\n.menu-item:hover,\n.Box-row--focus-gray.navigation-focus,\n.team-listing .is-open.root-team,\n.Box-row--hover-gray:hover,\n.Box-row--hover-blue:hover,\ntable.files tr[aria-selected='true'] td,\n.label-select-menu .select-menu-item[aria-selected='true'],\n.label-select-menu .select-menu-item.navigation-focus,\n.user-profile-nav {\n  background: var(--bg4) !important;\n}\n.ellipsis-expander,\n.hidden-text-expander a,\n.subnav-search-context .btn,\n.markdown-body kbd,\n.email-format .email-hidden-toggle a,\n.commit .commit-title,\n.commit .commit-title a,\n.commit-tease-sha,\n.timeline-commits .author,\n.timeline-commits .commit-message > code a,\n.full-commit .branches-list li,\n.full-commit .sha-block > .sha,\n.full-commit .sha-block > a,\n.branches-tag-list li:first-child,\n.keyboard-mappings,\nkbd,\n.pagehead-tabs-item .Counter,\n.reponav-item .Counter,\n.protip-callout,\n.render-notice,\n.select-menu-header .close-button:hover,\n.select-menu-header .octicon:hover,\n.select-menu-action,\n.page-responsive .HeaderMenu-link,\ntable.capped-list .octicon,\n.illflow-item .illflow-item-heading,\n.action-card-syntax,\n.markdown-format kbd,\n.repohead h1.private .octicon {\n  color: rgba(255, 255, 255, 0.6) !important;\n}\nul.sidetabs li a:hover,\n.editbox h1,\n#issues .labels .admin,\n#issues .display .sortbar,\n#facebox .close,\n#issues_search .wrapper,\n.ranked-repositories .meta a,\n.actor,\nul.nav.logged_out,\n.tip-box a.next,\n#inbox .list .unread,\n.main .filterbar,\n.browser-content .footerbar,\nul.smalltabs,\n.snippet,\n.supportstaffer,\n.discussion-form,\n.chooser-box,\n.chooser-box h3,\n#forkqueue .instructions,\n.selector-item.clear:hover,\n#contributors-master svg,\n.inset-callout h2,\n.documentation ul.nav,\n.date_selector td.selected,\n#contributors-master,\n.context-title,\n.list-module h2,\n.bootcamp-help h1,\ntable.files tr.up-tree a:hover,\n.ellipsis-button:hover,\n.codesearch-results .repo-list-name em,\n.codesearch-results .repo-list-description em,\n.blog-search-results em,\n.codesearch-cols em,\nul.bignav li a:hover,\nul.smallnav li a:hover,\n.comments-wrapper,\n.rackspace,\n.subnav-bar > ul > li > ul > li > a:hover,\n.issue.active,\n.orgs-nav .count,\n.filter-item:not(.selected):hover,\n.task-progress .progress-bar .progress,\n.oauth-connection-illustration .oauth-image,\n.manage-repo-access-wrapper:before,\n.counter,\n.Counter,\n.block-diff-neutral {\n  background: var(--bg6) !important;\n}\n.vcard-detail .octicon,\n.member-badge .octicon,\n.command-bar .octicon-question:before,\n.news .alert .time,\nul.color-label-list .color-label.zeroed,\nul.color-label-list .color-label.zeroed .count,\n.gh-header-title .issue-number,\na.leaderboard-list-rank,\n.bootcamp ul li a,\n.ssh-key-fingerprint,\n.tag-references > li a,\n.release .release-authorship,\n.branches .branch-summary,\n.branches .no-results-message,\nheader ul.links > li a,\n.team-info-card .stats-group .stat,\n.team-info-card .stats-group .stat.no-link:hover,\n.discussion-sidebar-item,\n.issues-listing .table-list-issues .issue-meta,\n.task-progress,\n.table-list-milestones .stat-label,\n.table-list,\n#blog-home,\n.blog-post-meta,\n.blog-post-meta a,\n.blog-post-meta .octicon,\n.diff-line-num,\n.file-data .line-numbers span,\n.discussion-item .timestamp,\n.branch-status .divider,\n.news .alert .octicon,\n.news .alert .mega-octicon,\n.blankslate > .mega-octicon,\n.repo-list-meta,\na.discussion-item-help,\n.page-new-repo .license-info,\n.notification-actions .btn-link,\n.commit-info .commit-meta,\n.notifications .read .type-icon,\n.notification-actions .age,\n.list-item .byline,\n.issue-list-meta,\n.blob-num-expandable .diff-expander,\n.file-type-icon,\n.uploaded-files .remove,\n.releases-tag-list td.date a,\n.collaborators .collab-remove .remove-link,\n.octofication .notice-dismiss,\nul.comparison-list > li .octicon,\ndiv.content-header h6,\n.fullscreen-overlay textarea,\n.blob-num.non-expandable:hover,\n.breadcrumb,\n.application-authorizations .oauth-app-list-meta,\n.application-authorizations .oauth-app-owner,\n.boxed-group-inner .help,\n.thread-subscription-status .reason,\n.toc-diff-stats .octicon,\n.blob-num,\n.recent-gists .description .blank,\n.recent-gists .metadata,\n.member-meta .access-link,\n.gist-quicksearch-no-results,\n#user-content-toc ul ul li:before,\n.btn-octicon,\nbutton.btn-octicon,\n.user-list li em,\n.reponav-item .octicon,\n.pagehead-tabs-item .octicon,\n.table-list-header-toggle .btn-link,\n#graph_data h2,\n#message-list .message .time,\n.tabnav .tabnav-extras,\n.discussion-item-integrations-callout .pull-request-integrations-dismiss,\n.oauth-application-info .meta-link,\n.oauth-application-info .app-info,\n.repo-file-upload-file-wrap .remove-file,\n.gcr-ext-editor-close svg,\n.commit-id,\n.orghead .edit-org,\n.signed-commit-badge,\n.manage-member-meta-item .btn-link,\n.note,\n.topic-tag-action .add-topic-button,\n.topic-tag-action .remove-topic-button,\n.text-gray-light,\n.js-notice .octicon-x,\na.footer-octicon:hover,\n.table-of-contents .toc-diff-stats .octicon {\n  color: rgba(255, 255, 255, 0.3) !important;\n}\n.btn:disabled,\n.btn:disabled:hover,\n.btn.disabled,\n.btn.disabled:hover,\nbutton.button:disabled,\nbutton.button:disabled:hover,\nbutton.button.disabled,\nbutton.button.disabled:hover,\nbutton.minibutton:disabled,\nbutton.minibutton:disabled:hover,\nbutton.minibutton.disabled,\nspan.minibutton.disabled,\na.minibutton.disabled,\nbutton.minibutton.disabled:hover,\na.minibutton:disabled:hover,\na.minibutton.disabled:hover,\nspan.minibutton:disabled:hover,\nspan.minibutton.disabled:hover,\n.search-result-group,\n.gist-quicksearch-result-group {\n  background: var(--bg2) !important;\n  border-color: var(--bg2) !important;\n  color: rgba(255, 255, 255, 0.2) !important;\n}\n.avatar.avatar-more,\n.AvatarStack--right .avatar.avatar-more:after,\n.markdown-body .csv-data th,\n.capped-card-content,\n.new-discussion-timeline .previewable-comment-form .comment-form-head.tabnav,\n.select-menu-divider,\n.select-menu-header,\n.payment-history .failed,\n.payment-history .refunded,\n.search-autocomplete-dropdown .autocomplete-keyword-only,\n.tint-box,\n.MarketplaceEdit-body .menu-item:hover,\ntable.files tr.navigation-focus td,\ntable.files tr[aria-selected='true'] td,\n.team-member-ellipsis:hover,\ntable.capped-list th,\n.action-card:after,\n.action-card:before,\n.action-card-header:before,\n.gistsearch-aside .filter-list li span.bar,\n.gist-quicksearch-results .gist-quicksearch-result-header {\n  background: var(--bg1) !important;\n}\n.sidebar-module,\n.form-control,\n.form-select,\n.octotree_github_sidebar input[type='text'],\n.octotree_github_sidebar textarea,\ndiv.search-form input,\n#search > input[name='q'] {\n  background-color: var(--bg2) !important;\n  border-color: var(--bg2) !important;\n}\n.octofication .message,\n.panel-nav:not(.disabled):active,\n.diagram-icon:not(.active),\n.btn.btn-outline:hover:not(.ajax-pagination-btn),\n.btn.btn-outline.zeroclipboard-is-hover,\n:checked + .radio-label,\n.gist-snippet .file-box:hover .file,\n.octofication .message,\n.reaction-sort-item.selected,\n.pull-request-link,\ndiv.project-card:focus,\n.timeline-progressive-disclosure-button:hover,\n.release-timeline-tags .expander-text:hover .expander-dots,\n.review-comment[aria-selected='true'],\n.timeline-comment[aria-selected='true'] .review-summary .comment-body {\n  border-color: var(--selected) !important;\n}\n.repo-file-upload-progress,\n.project-updated-message,\n.delete-topic-button,\n.topic-tag-action .add-topic-button,\n.topic-tag-action .remove-topic-button,\n.commit-desc + .commit-branches,\n.full-commit .btn-outline {\n  border-color: var(--btn3) !important;\n}\n.template-previews .discussion-sidebar-heading:hover,\n.zeroclipboard-link,\na:not(.IssueLabel),\n.Box-row.navigation-focus .Box-row--drag-button,\n.Box-row-link:hover,\n.btn-blue .Counter,\n.btn-outline,\n.btn-outline.selected .Counter,\n.btn-outline:active .Counter,\n.btn-outline:hover .Counter,\n[open] > .btn-outline .Counter,\n.social-count:hover,\n.btn-link,\n.drag-and-drop-error-info a,\na.tabnav-extra:hover,\n.pagination a,\n.pagination em,\n.pagination span,\n.text-blue,\n.link-gray:hover,\n.link-gray-dark:hover,\n.link-hover-blue:hover,\n.muted-link:hover,\na.branch-name,\n.ajax-pagination-form .ajax-pagination-btn,\n.btn-invisible,\n.btn-invisible.selected,\n.btn-invisible.zeroclipboard-is-active,\n.btn-invisible.zeroclipboard-is-hover,\n.btn-invisible:active,\n.btn-invisible:focus,\n.btn-invisible:hover,\n.btn-octicon:hover,\n.commit .commit-title .issue-link,\n.commit-link,\n.timeline-commits .commit-message > code a:hover,\n.commit-id:hover,\n.discussion-sidebar-toggle:hover,\n.milestone-name:hover,\n.sidebar-assignee .assignee:hover,\n.participation a:hover,\n.timeline-comment-action:focus,\n.timeline-comment-action:hover,\n.discussion-item-link:hover,\n.discussion-item-entity:hover,\n.discussion-item-ref-title .title-link:hover,\n.discussion-item-help:hover,\n.steps li.current .octicon,\n.prose-diff .show-rich-diff,\n.select-menu-action:hover,\n.select-menu-new-item-form .octicon,\n.marketing-hero-octicon .octicon,\n.intgrs-lstng-item-link:hover .intgrs-lstng-item-header,\n.intgr-admin-link:hover .octicon,\n.listgroup-item:hover .link-small,\n.rule-type-conditions,\n.code-list .blob-num a:hover,\n.coupon-icon,\n.dashboard-notice .octicon-organization,\n.dashboards-overview-cards .summary-stats .metric-1,\n.repo-snipit:hover .repo-snipit-description,\n.repo-snipit:hover .repo-snipit-name,\n.exploregrid-item:hover .exploregrid-item-title,\n.getting-started .link-text strong,\n.scoped-search .form-control.focus .header-search-scope,\n.issues-reset-query:hover,\n.milestone-title-link a:hover,\n.milestone-description .expand-more,\na.task-progress:hover,\n.page-new-repo .license-info,\n.notifications .notifications-more > a,\n.notifications-sso-prompt em,\n.notification-actions .btn-link:hover,\n.oauth-application-whitelist .edit-link:hover,\n.developer-app-item .developer-app-name:hover,\n.org-insights-card-legend .metric-0,\n.orghead .edit-org:hover,\n.export-actions a:hover,\n.member-row a:hover,\n.invite-team-member-list .team-link,\n.stats-group-stat:hover,\n.stats-group-stat:hover .stat-number,\n.ldap-memberships-list .edit,\n.project-comment-body-hover .octicon-pencil:hover,\n.project-comment-title-hover .octicon-pencil:hover,\n.profile-rollup-toggle:hover,\n.pr-toolbar .subset-files-tab,\n.numbers-summary a:hover,\ntable.files td.message a:hover,\n.session-details:hover .octicon,\n.setup-header .lead a:hover,\n.shelf-dismiss:hover,\n.orgs-help-item-octicon .octicon,\n.orgs-help-dismiss:hover,\n.team-member-ellipsis:hover,\n.team-listing .team-name,\n.team-listing .team-show-more,\n.team-listing .expand-nested-team:hover,\n.tree-browser tr.navigation-focus td .octicon-chevron-right,\n.tree-browser tr[aria-selected='true'] td .octicon-chevron-right,\n.tree-browser-result mark,\n.toolbar-commenting .dropdown-item:hover,\n.toolbar-commenting .dropdown-item:focus,\n.toolbar-item .menu-target:hover,\n.toolbar-item:hover,\n.toolbar-item .menu-target:focus,\n.toolbar-item:focus,\n.link-mktg:hover,\n.btn-outline-mktg:hover,\n.illflow-blue .illflow-item .illflow-item-heading,\n.MarketingBody-lead a:hover {\n  color: var(--selected) !important;\n}\n.HeaderNavlink:hover,\n.HeaderNavlink:focus,\ntable.files .octicon-file-directory,\ntable.files .octicon-file-symlink-directory,\ntable.files .octicon-file-submodule,\n.header-logo-invertocat:hover,\n.notification-indicator:hover,\n.btn.btn-outline,\n.full-commit .btn-outline:not(:disabled):hover,\n.markdown-body a strong,\n.markdown-format a strong,\n.notifications.list-group a:hover,\n.octotree_sidebar .octotree_bottom a:hover i:before {\n  color: var(--selected) !important;\n}\n#com #header .top-nav .dropdown-button:hover .dropdown-caret,\n.header-nav-link:hover .dropdown-caret,\n.header-nav-link:focus .dropdown-caret,\n.header-navlink:hover .dropdown-caret,\n.header-navlink:focus .dropdown-caret,\n.HeaderNavlink:hover .dropdown-caret,\n.HeaderNavlink:focus .dropdown-caret {\n  border-top-color: var(--selected) !important;\n}\n.btn-primary:not(.compare-button):not(.btn-outline):not([disabled]):not(.disabled),\n.button.primary,\n.btn-theme-green,\n.btn-primary-mktg {\n  background: var(--btn) !important;\n  border-color: var(--btn) !important;\n}\n.btn-primary:not(:disabled):not(.disabled):not(.compare-button):not(.btn-outline):hover,\n.button.primary:not(:disabled):hover,\n.btn-theme-green:hover,\n.btn-primary-mktg:hover {\n  background: var(--btn) !important;\n  border-color: #7686C3 !important;\n}\nimage-crop .handle:before,\n.pagination a,\n.pagination em,\n.pagination span,\n.AvatarStack-body,\n.blankslate code,\n.markdown-body .csv-data .blob-num,\n.ajax-pagination-form .ajax-pagination-btn,\n.autocomplete-results,\n.suggester,\n.boxed-group-inner,\n.commit-group-title .octicon-git-commit,\n.full-commit .commit-meta,\n.conversation-list-heading .inner,\n.details-overlay[open] > .dropdown-item:hover,\n.discussion-timeline.team-discussion-timeline .blankslate,\nul.comparison-list,\n.tint-box.transparent,\n.dashboard-notice .coupon,\n.getting-started .list-group-item,\n.topic-tag-outline,\n.MarketplaceEdit-body .menu-item.selected,\n.oauth-org-access-details .oauth-org-item.on,\n.oauth-org-access-details .oauth-org-item.revoked,\n.manage-repo-access-icon,\ntable.files,\n.qr-code-table .white,\n.action-card:after,\n.action-card-controls:before,\n.actions-bg-mask,\n.TenYearNav-year.selected .TenYearNav-digits,\n.TenYearNav-year:hover .TenYearNav-digits,\n.gist-snippet-meta .gist-count-links > li > a:hover,\n.gist-quicksearch-results,\ndiv#common-issues ul,\n.markdown-format img,\n.dropdown-menu,\n.btn-primary .counter,\n.bg-white,\n.card,\n.pagination > span,\n.rgh-reactions-near-limit,\n.select-menu-item {\n  background: var(--bg2) !important;\n}\n.timeline-comment.current-user,\n.github-jobs-promotion p,\n.octotip,\n.markdown-format .alert:not(.warning),\n.full-commit.commit,\n.bootcamp .bootcamp-body,\n.bootcamp h1,\n.owners-notice,\n.new-user-avatar-cta,\n.full-commit .browse-button,\n.commit-ref,\n.branch-name,\n.timeline-comment.current-user .timeline-comment-header .timeline-comment-label,\n.file-history-tease,\n.flash,\n.flash-global,\n.feature-banner,\n.recently-touched-branches,\n.timeline-progressive-disclosure-items button,\n.pr-toolbar .subset-files-tab,\narticle.full .alert,\n.btn.btn-blue,\n.topic-tag,\n.RecentBranches,\n.js-tag-input-tag,\nul.search-results li .label,\n.topic-tag-action,\n.alert {\n  border: 1px solid var(--btn2) !important;\n}\n.timeline-comment.current-user .timeline-comment-header,\n.blob-history,\n.recently-touched-branches li {\n  border-bottom-color: var(--btn2) !important;\n}\n.timeline-comment.current-user .timeline-comment-header,\n.github-jobs-promotion p,\n.octotip,\n.markdown-format .alert:not(.warning),\n.full-commit.commit,\n.flash,\n.bootcamp h1,\n.bootcamp-body,\n.owners-notice,\n.full-commit .browse-button,\n.blob-history,\n.branch-name,\n.new-user-avatar-cta,\n.jstree-wholerow-clicked,\n.commit-ref,\n.api .alert,\n.file-history-tease,\n.flash,\n.flash-global,\n.feature-banner,\n.recently-touched-branches,\n.pr-toolbar .subset-files-tab,\narticle.full .alert,\n.btn.btn-blue,\n.hook-delivery-guid,\n.topic-tag,\n.topic-tag-action,\n.delete-topic-button,\n.topic-tag-action .add-topic-button,\n.topic-tag-action .remove-topic-button,\n.RecentBranches,\n.signup-prompt-bg,\nul.search-results li .label,\ndiv[style*='background-color: #044d6e'],\n.alert,\n.btn-mktg {\n  background: var(--btn4) !important;\n}\n.timeline-comment.current-user:before {\n  border-right-color: var(--btn2) !important;\n}\n.diff-table tr:hover > pre,\n.highlight:not(.lines) tr:not(.inline-comments):hover td.selected-line.blob-code:not(.line-age),\n.highlight:not(.lines) tr:not(.inline-comments):hover td.blob-code,\n.blob-code-hunk,\n.blob-code-expandable {\n  background: var(--bg2) !important;\n}\n.pagination a:focus,\n.pagination a:hover,\n.pagination em:focus,\n.pagination em:hover,\n.pagination span:focus,\n.pagination span:hover,\n.select-menu-item + .semantic-toc-file:after,\n.semantic-toc-symbol:not(.last-visible):after,\n.tabnav-pr,\n.tabnav-pr .tabnav-tab.selected,\n.plans-card-btn {\n  border-color: transparent !important;\n}\n::-webkit-scrollbar-track,\n::-webkit-scrollbar-corner {\n  background: var(--bg3) !important;\n}\n::-webkit-scrollbar-thumb {\n  background: rgba(255, 255, 255, 0.1) !important;\n}\npath.js-diff-placeholder {\n  fill: var(--bg5) !important;\n}\n.repohead.experiment-repo-nav,\n.discussion-timeline-actions,\n.gh-header {\n  background-color: var(--bg3);\n}\n.timeline-comment-wrapper {\n  border-bottom: 2px solid var(--bg5);\n  border-top: 2px solid var(--bg5);\n}\n.discussion-timeline-actions {\n  border-top: 2px solid var(--bg5);\n}\n.discussion-item-icon {\n  border: 2px solid var(--bg5);\n}\n.discussion-timeline:before,\n.profile-timeline.discussion-timeline:before,\n.profile-timeline.discussion-timeline .profile-timeline-month-heading:after {\n  background-color: var(--bg5);\n}\n.thread-subscription-status {\n  background-color: var(--bg3) !important;\n}\n.Counter {\n  color: rgba(255, 255, 255, 0.75);\n}\n.UnderlineNav-item.selected,\n.UnderlineNav-item:focus,\n.UnderlineNav-item:hover {\n  border-bottom-color: var(--selected);\n}\n.profile-timeline-year-list {\n  background: var(--bg3) !important;\n}\n.contribution-activity .filter-item.selected {\n  color: rgba(0, 0, 0, 0.7) !important;\n}\n.markdown-body img {\n  background-color: transparent;\n}\n.ellipsis-expander,\n.hidden-text-expander a {\n  background: rgba(0, 0, 0, 0.2);\n}\n\n/* CODE */\n.pl-s .pl-s1,\n.pl-smi {\n  color: #b2ccd6;\n}\n.pl-e,\n.pl-en {\n  color: #50fa7b;\n}\n.pl-c1,\n.pl-s .pl-v {\n  color: #ffb86c;\n}\n.pl-pds,\n.pl-s,\n.pl-s .pl-pse .pl-s1,\n.pl-sr,\n.pl-sr .pl-cce,\n.pl-sr .pl-sra,\n.pl-sr .pl-sre {\n  color: #f1fa8c;\n}\n.pl-ent {\n  color: #8be9fd;\n}\n.pl-mi1 {\n  color: #8be9fd;\n  background-color: var(--bg4);\n}\n.pl-k {\n  color: #ff79c6;\n}\n.pl-smw,\n.pl-v {\n  color: #bd93f9;\n}\n.pl-c {\n  color: #6272a4;\n}\n.blob-code-inner.highlighted {\n  background-color: var(--btn);\n}\n.blob-code-deletion {\n  background-color: hsla(353, 25%, 30%, 1);\n}\n.blob-num-deletion {\n  background-color: hsla(353, 25%, 25%, 1);\n  border-color: hsla(353, 25%, 20%, 1);\n}\n.blob-code-addition {\n  background-color: hsla(137, 25%, 30%, 1);\n}\n.blob-num-addition {\n  background-color: hsla(137, 25%, 25%, 1);\n  border-color: hsla(137, 25%, 20%, 1);\n}\n.blob-code-addition .x {\n  background-color: hsla(135, 73%, 30%, 1);\n}\n.blob-code-deletion .x {\n  background-color: hsla(353, 73%, 30%, 1);\n}\n.timeline-comment {\n  color: inherit;\n}\n/* comments */\n.comment-body,\n.js-comment-body {\n  color: #f8f8f2 !important;\n}\n/* timeline background lines, badges, etc */\n.TimelineItem-break {\n  background-color: var(--bg3) !important;\n  border-top: 4px solid var(--bg5) !important;\n}\n.TimelineItem:before {\n  background-color: var(--bg5) !important;\n}\n.TimelineItem-badge {\n  border: 2px solid var(--bg5) !important;\n}\n/* tabs on the comment box and such, Write, Preview, etc  */\n.tabnav-tab.selected,\n.tabnav-tab[aria-selected='true'] {\n  background-color: var(--bg5) !important;\n  border-color: var(--bg4) !important;\n}\n/* badges, like bug, feature, etc, */\n.protip code {\n  background-color: var(--bg5) !important;\n  padding: 3px;\n}\n.menu-item.selected {\n  background-color: var(--bg4);\n}\n.menu .menu-item:hover {\n  background-color: var(--bg5) !important;\n}\n.timeline-comment--caret:after,\n.timeline-comment--caret:before {\n  border-right-color: var(--bg1);\n}\n.Popover-message:after {\n  border-bottom-color: var(--bg1);\n}\n.Popover-message--bottom-left:after,\n.Popover-message--bottom-right:after,\n.Popover-message--bottom:after {\n  border-top-color: var(--bg1);\n}\n.Popover-message--right-bottom:after,\n.Popover-message--right-top:after,\n.Popover-message--right:after {\n  border-left-color: var(--bg1);\n}\n.select-menu-tabs .select-menu-tab-nav.selected,\n.select-menu-tabs .select-menu-tab-nav[aria-selected='true'],\n.select-menu-tabs a.selected,\n.select-menu-tabs a[aria-selected='true'] {\n  color: #24292e;\n  background-color: var(--btn);\n  border-color: var(--btn);\n}\n.TimelineItem-badge {\n  background-color: var(--bg5);\n}\n.TimelineItem-badge .octicon {\n  fill: hsla(0, 0%, 100%, 0.5);\n}\n.TimelineItem-body {\n  color: hsla(0, 0%, 100%, 0.33);\n}\n.commit-ref,\n.branch-name {\n  color: hsla(0, 0%, 100%, 0.4);\n}\n.diffbar,\n.pr-toolbar {\n  background-color: var(--bg3);\n}\n.orghead {\n  background-color: var(--bg1);\n}\n\n.comment-body a {\n  color: var(--accents) !important;\n}\n",
				"domains": [
					"github.com"
				]
			}
		],
		"name": "Dracula GitHub",
		"originalDigest": "f68b01ff04b2cc0ddb61d0b91dfd2f3b87b1af73",
		"id": 26,
		"updateDate": 1581223257532
	},
	{
		"enabled": true,
		"updateUrl": "https://userstyles.org/styles/chrome/176998.json",
		"md5Url": "https://update.userstyles.org/176998.md5",
		"url": "http://userstyles.org/styles/176998",
		"originalMd5": "1175f7014bcea33009b6ff8ed2603887",
		"installDate": 1581128402636,
		"sections": [
			{
				"urls": [],
				"urlPrefixes": [],
				"domains": [
					"stackoverflow.com",
					"superuser.com",
					"serverfault.com",
					"askubuntu.com",
					"stackexchange.com"
				],
				"regexps": [],
				"code": "/* Conwy - Stack Exchange\r\n   Version:  1.0.0\r\n   Author:   lineav\r\n   Licence:  https://creativecommons.org/licenses/by-sa/4.0/\r\n*/\r\n\r\n/* Invert the whole website */\r\nhtml {\r\n    filter: invert(0.80) hue-rotate(180deg) contrast(1.2)!important;\r\n    background: #ffffff !important;\r\n}\r\n\r\nimg {\r\n    filter: invert(1) hue-rotate(180deg) brightness(1.1) contrast(1.05)!important;\r\n}\r\n\r\n/* invert logo */\r\nimg.h-auto.wmx100 {\r\n    filter: invert(0)!important;\r\n}\r\n\r\n/* make scrollbars dark */\r\n::-webkit-scrollbar {\r\n    background: #2f2f2f;\r\n    width: 0.8em;\r\n}\r\n::-webkit-scrollbar-thumb {\r\n  background-color: #555555;\r\n  outline: 1px solid #111111;\r\n}"
			}
		],
		"name": "Conwy - Stack Exchange",
		"originalDigest": "055ce9ac0041cad64b4c5245fb4bb1083a231dc2",
		"id": 29
	},
	{
		"enabled": true,
		"updateUrl": "https://userstyles.org/styles/chrome/174814.json",
		"md5Url": "https://update.userstyles.org/174814.md5",
		"url": "http://userstyles.org/styles/174814",
		"originalMd5": "fcfb3986795d61f47eb67338edb01330",
		"installDate": 1581129281945,
		"sections": [
			{
				"code": "html, body {\n\tbackground-color: #282a36;\n\tcolor: #f3f3f3;\n}\n\n.style-name-link {\n    color: #f3f3f3;\n}\n\n#header {\n\tborder-color: transparent;\n\tbox-shadow: 0 0 16px -3px #191A21;\n}\n\n#options input[type=\"number\"] {\n\tborder-width: 1px;\t\n}\n\ninput[type=\"number\"],\nselect,\ninput[type=\"checkbox\"],\nbutton,\ninput:not([type]) {\n\tbackground-color: #282a36;\n\tborder-color: #191A21 !important;\n\tcolor: #6272a4;\n\tbackground: none;\n\tborder-radius: .2rem;\n\ttransition: .12s all;\n}\n\ninput[type=\"number\"]:hover,\nselect:hover,\ninput[type=\"checkbox\"]:hover,\nbutton:not([disabled]):hover,\ninput:not([type]):hover {\n\tborder-color: #6272a4 !important;\n\tbackground-color: #282a36 !important;\n\tcolor: #f3f3f3;\n\tcursor: pointer;\n}\n\ninput:not([type]):hover {\n\tcursor: auto !important;\n}\n\ninput[type=\"checkbox\"] {\t\n\tborder-color: #191A21 !important;\n}\n\nsvg.svg-icon.checked,\nsvg.svg-icon.select-arrow {\n\tfill: #6272a4;\n}\n\n#enabled-label:hover svg {\n\tfill: #f3f3f3 !important;\n}\n\n.cm-s-dracula .CodeMirror-activeline-background {\n\tbackground: #2d2e3b;\t\n}\n\n.resize-grip {\n\tborder-color: transparent;\n\tbox-shadow: 0 0 15px -.5px #191A21;\n\tborder-radius: 2rem !important;\n}\n\n.resize-grip::after {\n\tborder: none;\n}\n\n.CodeMirror-focused,\n.codeMirror>div>textarea {\n\toutline: none !important;\n}",
				"regexps": [
					"moz-extension://.*"
				]
			}
		],
		"name": "dracula: stylus",
		"originalDigest": "52c36bb7712fdb6f67195019664f060f4838a4f6",
		"id": 30,
		"updateDate": 1581130211735
	},
	{
		"enabled": true,
		"updateUrl": "https://userstyles.org/styles/chrome/170121.json",
		"md5Url": "https://update.userstyles.org/170121.md5",
		"url": "http://userstyles.org/styles/170121",
		"originalMd5": "25c77995809000a269e5275133b6a485",
		"installDate": 1581129599953,
		"sections": [
			{
				"code": "body, td, tr, input, textarea, select {\n    font-family: 'open sans', 'source sans pro', 'helvetica neue', sans-serif;\n}\n\n.gt {\n    font-size: 90%;\n    line-height: 1.5em;\n    font-weight: 400;\n    color: #222;\n}\n\n.LW-avf {\n    font-size: 0.95em;\n    line-height: 1.45em;\n}\n\n/* //////// GLOBAL NON-COLOR ///////// */\n\n.Bu.y3, .aKB, .aKl {\n    display: none;\n}\n\n.aAy {\n    width: auto;\n}\n\n/* opacity icons */\n\n.gbqfi, .gb_X .gb_Nb .gb_Pb, .aQS, .n4 .G-asx, .aii, .gb_Pb, .T-I-auR.ayk-axZ-aup-I .ayk-axZ-aup-auo, .aqN, .aos, .gb_Qb {\n    opacity: .7;\n    background-color: transparent;\n}\n\n.gb_Rb {\n    opacity: 0.7;\n}\n\n.l6 {\n    padding-top: 0;\n}\n\n.J-KU-Jg-K9 .J-KU .aAy, .aRy, .aKj {\n    height: 46px;\n}\n\nbody, td, tr, input, textarea, select {\n    font-family: \"Helvetica Neue\", arial;\n}\n\n.aKj {\n    padding-top: 4px;\n}\n\n/* search text*/\n\n.gbqfif, .gbqfq {\n    height: auto;\n    font-family: \"Helvetica Neue\", arial;\n    margin: 0;\n}\n\n/* tab icons, something, labels */\n\n.aKp, .aRx, .as {\n    display: none;\n}\n\n/* //////// BACKGROUND COLOR ///////// */\n\n.wl {\n    background: #171A21;\n    /* background: linear-gradient(45deg, #042029 0%,#073642 146%); */\n}\n\n/* //////// TRANSLUSCENT WHITE ///////// */\n\n.aOd, .aJ6 {\n    color: rgba(255,255,255,.7);\n}\n\n.aAy.aAy.aIf-aLe.J-KU-Je.J-KU-JW .aKo {\n    background-color: rgba(255,255,255,.7);\n}\n\n.J-KU-Jg-K9.aAA .aAy, .J-KU-Jg-K9.aAA .J-KU-KO.aAy, .aKj, .yO, .xY, .aKz, .gbqfqw, #gbqfb, .UI .TB {\n    border: none;\n    background: transparent;\n    color: rgba(255,255,255,.7);\n    box-shadow: none;\n}\n\n/* search bar */\n\n.gbqfqw {\n    border-bottom: 1px dashed rgba(255,255,255,.3);\n    /*\n    border-bottom: 1px dashed rgba(0,0,0,.3);\n    */\n}\n\n/* //////// TRANSLUSCENT BLACK ///////// */\n\n.NQ {\n    background-color: rgba(0,0,0,.3);\n}\n\n\n/* //////// SEARCH TEXT COLOR ///////// */\n\n.gbqfif {\n    color: #F573C7;\n}\n\n/* //////// UNREAD HIGHLIGHT LINE ///////// */\n\n.zE {\n    background: #292936;\n}\n\n/* //////// EMAIL FROM ///////// */\n\n.xY, .e, .x2, .CL .CK {\n    color: #8DBBE0;\n}\n\n/* //////// EMAIL TITLE ///////// */\n\n.y6 span {\n    color: #7A8CBE;\n}\n\n/* //////// GRAY VARIANT 1 ///////// */\n\n.TO .n0, .akh, .mj, .l8, .l9, .ma, .B .Di .Dj, .l6, .z .Di .Dj, .Wz .Wy {\n    color: #878C91;\n}\n\n/* buttons */\n\n.T-I-KE, .G-atb .T-I-ax7, .TD, .aOd {\n    color: #878C91;\n    background-color: rgba(0,0,0,.35);\n    background-image: none;\n    border: none;\n}\n\n/* //////// GRAY VARIANT 2 ///////// */\n\n.y6 .y2, .h0, .C .Di .Dj {\n    color: #878C91;\n}\n\n/* //////// SIDEBAR MORE LINK ///////// */\n\n.n4 {\n    color: #F573C7;\n}\n\n/* active menu item tick */\n\n.ain {\n    border-color: #F573C7;\n}\n\n/* //////// HOUHIN ///////// */\n\n.bX a, .Cz.J-J5-Ji.e {\n    color: #B587DE;\n}\n\n/* contact header */\n\n.bX {\n    color: #B587DE;\n    background-color: rgba(0,0,0,.35);\n}\n\n/* //////// SENCHA ///////// */\n\n.T-I-auR {\n    background-image: none;\n    border: none;\n    background-color: #B587DE;\n    color: rgba(255,255,255,.8);\n}\n\n/* Promotions line */\n\n.aJi-aLe .aDG, .aAy.J-KU-JW.aAy.aJi-aLe .aKo, .aAy.J-KU-KO.aAy.aJi-aLe .aKo {\n    background-color: #B587DE;\n}\n\n/* //////// SHENG ///////// */\n\n/* flash alerts */\n\n.b8 .vh, .cc .vh, .vX .vh {\n    background-color: #FFBA66;\n    border: none;\n    color: rgba(0,0,0,.85);\n}\n\n/* Updates Line */\n\n.aH2-aLe .aDG, .aAy.J-KU-JW.aAy.aH2-aLe .aKo, .aAy.J-KU-KO.aAy.aH2-aLe .aKo {\n    background-color: #DEF085;\n}\n\n/* //////// GAIWAN ///////// */\n\n/* tooltips */\n\n.T-ays, .T-ays-atD, .T-ays-atC {\n    background-color: #878C91;\n    border: none;\n    color: rgba(0,0,0,.85);\n}\n\n/* //////// KYUSU ///////// */\n\n.aIf-aLe .aDG, .aAy.J-KU-JW.aAy.aIf-aLe .aKo, .aAy.J-KU-KO.aAy.aIf-aLe .aKo {\n    background-color: #FFBA66;\n}\n\n/* did you mean */\n\n.Wz, .ya {\n    color: #FFBA66;\n    background-color: rgba(0,0,0,.35);\n    padding: 11px;\n}\n\n/* email line cursor */\n\n.PF.xY.PE {\n    background: #FFBA66;\n}\n\n/* tab text */\n\n.aKz {\n    color: #FFBA66;\n}",
				"domains": [
					"mail.google.com"
				]
			}
		],
		"name": "dracula: gmail",
		"originalDigest": "e3be0bd4ec5291d6ce6a194524e36ff2d77f3bac",
		"id": 31,
		"updateDate": 1581130222031
	}
]
</file>

<file path="modules/themes/autumnal/config/librewolf/userChrome.css">
/* @namespace url("http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"); */

@-moz-document url(chrome://browser/content/browser.xul),
               url(chrome://browser/content/browser.xhtml)
{
  :root {
    --hey-short-delay: 33ms;
    --hey-long-delay:  300ms;
    --hey-tabbar-height: 3.35em;
  }

  /*** Hiding all the unwanted elements ***/
  /* Hide 'list all tabs' button */
  #tabbrowser-tabs, #tabbrowser-arrowscrollbox { min-height:0!important; }
  #alltabs-button { display:none !important; }
  /* Hide tab close button (takes up valuable title real-estate when there are a lot of tabs) */
  .tabbrowser-tab .tab-close-button { display: none !important; }
  /* Hide minimize, maximize, and close window buttons; I use shortcut keys instead */
  .titlebar-buttonbox-container { display: none !important; }
  /* Hide extra space left over on either side of the tabbar */
  .titlebar-spacer[type="pre-tabs"], .titlebar-spacer[type="post-tabs"] { display: none !important; }
  /* Hide useless header in the sidebar */
  #sidebar-box #sidebar-header { display: none !important; }
  /* Hide the search engine suggestions at bottom of completion window */
  #urlbar .urlbarView .search-one-offs { display: none !important; }

  /* /\*** Auto-hide tab bar when Sidebery is open (w/ sliding animation) *\/ */
  /* #main-window #titlebar { */
  /*   overflow: hidden; */
  /*   transition: height 0.3s 0.3s !important; */
  /* } */
  /* /\** Default state: **\/ */
  /* #main-window #titlebar { height: auto !important; } */
  /* /\* #main-window[uidensity="touch"] #titlebar { height: 3.35em !important; } *\/ */
  /* /\* #main-window[uidensity="compact"] #titlebar { height: 2.7em !important; } *\/ */

  /* /\** Hidden state **\/ */
  /* #main-window[titlepreface*="Sidebery"] #titlebar { height: 0 !important; } */
  /* /\* Fix z-index of active pinned tabs *\/ */
  /* #main-window[titlepreface*="Sidebery"] #tabbrowser-tabs { z-index: 0 !important; } */


  /* /\*** Auto-hide address bar (w/ sliding animations) ***\/ */
  /* /\** Hidden state: **\/ */
  /* #nav-bar { */
  /*   /\* Hover the nav-bar over the web content, otherwise it will obnoxiously */
  /*    * push UI elements around while showing/hiding *\/ */
  /*   position: fixed !important; */
  /*   top: var(--hey-tabbar-height); */
  /*   width: 100vw; */
  /*   margin-top: calc(var(--hey-tabbar-height) * -1); */
  /*   transition: margin-top 72ms linear, opacity 72ms linear !important; */
  /*   opacity: 0 !important; */
  /* } */
  /* #main-window[titlepreface*="Sidebery"] #nav-bar { top: 0px; } */

  /* /\** Visible state: **\/ */
  /* /\* Auto-show nav-bar if hovered over (after a delay) *\/ */
  /* #main-window[titlepreface*="Sidebery"] #navigator-toolbox:hover #nav-bar { */
  /*   transition-delay: var(--hey-long-delay) !important; */
  /* } */
  /* #navigator-toolbox:hover #nav-bar { */
  /*   transition-delay: calc(var(--hey-long-delay) * 2) !important; */
  /* } */
  /* /\* ...but do so immediately if invoked via ctrl+L... *\/ */
  /* #nav-bar:focus-within { transition-delay: var(--hey-short-delay) !important; } */

  /* /\* Auto-show when hovering or nearby *\/ */
  /* :root[customizing=true] #nav-bar, */
  /* #navigator-toolbox:hover #nav-bar, */
  /* #nav-bar:focus-within { */
  /*   margin-top: 0; */
  /*   opacity: 1 !important; */
  /*   z-index: 9999 !important; */
  /* } */

  /* /\* Fixes for the above hacks *\/ */
  /* #nav-bar { z-index: 2 !important; } */
  /* #TabsToolbar { z-index: 3 !important; } */


  /*** Load local overrides ***/
  @import url(./userChrome.local.css);
}
</file>

<file path="modules/themes/autumnal/config/polybar/modules/bluetooth">
#!/usr/bin/env bash

bluetoothctl | while read -r; do
    if [ "$(systemctl is-active "bluetooth.service")" = "active" ]; then
        printf ''

        devices_paired=$(bluetoothctl devices Paired | grep Device | cut -d ' ' -f 2)
        counter=0
        # TODO: Use fewer processes
        for device in $devices_paired; do
            device_info=$(bluetoothctl info "$device")

            if echo "$device_info" | grep -q "Connected: yes"; then
                counter=$((counter + 1))
            fi
        done

        printf "$counter\n"
    else
        echo '%{F#604c7e}'
    fi
done
</file>

<file path="modules/themes/autumnal/config/polybar/modules/redshift">
#!/usr/bin/env bash

_notify() {
    dunstify -h int:transient:1 \
             -u low \
             -i redshift \
             -- "$@"
}

action="$1"
active="$(systemctl --user is-active redshift.service)"
case "$action" in
    toggle)
        case "$active" in
            active)
                _notify "Disabling redshift..."
                systemctl --user stop redshift.service
                ;;
            inactive)
                _notify "Enabling redshift..."
                systemctl --user start redshift.service
                ;;
        esac
        ;;
    *)
        case "$active" in
            active)   echo "" ;;
            inactive) echo "%{F#604c7e}" ;;
            *)        echo "%{F#373844}!" ;;
        esac
        ;;
esac
</file>

<file path="modules/themes/autumnal/config/polybar/config">
[colors]
black    = ${xrdb:color0}
bblack   = ${xrdb:color8}
red      = ${xrdb:color1}
bred     = ${xrdb:color9}
green    = ${xrdb:color2}
bgreen   = ${xrdb:color10}
yellow   = ${xrdb:color3}
byellow  = ${xrdb:color11}
blue     = ${xrdb:color4}
bblue    = ${xrdb:color12}
magenta  = ${xrdb:color5}
bmagenta = ${xrdb:color13}
cyan     = ${xrdb:color6}
bcyan    = ${xrdb:color14}
white    = #FFFFFF
bwhite   = ${xrdb:color15}

bg = #cc0f1113
fg = ${colors.white}
bg-alt = #161719
fg-alt = #5a5b5a
; fg-alt = #373844
bg-dark = #181a23

alert = ${colors.yellow}
accent = ${colors.fg-alt}
; accent = #604c7e

[global/wm]
margin-top = 0
margin-bottom = 34


[bar/global]
monitor = ${env:MONITOR}
monitor-strict = true
enable-ipc = true
override-redirect = true
fixed-center = true
background = ${colors.bg}
foreground = ${colors.fg}
padding = 0
; offset-x = 37.5%
; offset-y = 11.7%
bottom = false
overline-size = 0
; overline-color = #f00
underline-size = 0
; underline-color = #00f
wm-restack = bspwm
font-0 = "JetBrainsMono:pixelsize=9;3"
font-1 = "Font Awesome 6 Free Solid:pixelsize=9;3"
font-2 = "Font Awesome 6 Free Solid:pixelsize=8;3"
font-3 = "Font Awesome 6 Free Solid:pixelsize=16;3"
font-4 = "Material Icons:pixelsize=10;3"

[bar/main]
inherit = bar/global
width = 100%
height = 31
modules-left = date_day date clock cpu memory fs-root fs-home
modules-center = bspwm
modules-right = wlan lan battery bluetooth redshift pulseaudio

; [bar/meta]
; inherit = bar/global
; width = 100%
; height = 32
; modules-center = cpu memory fs
; background = ${colors.bg-dark}

; [bar/date]
; inherit = bar/global
; width = 25%
; height = 32
; offset-y = 5.5%
; font-0 = "Fira Code:pixelsize=10:weight=bold;2"
; font-1 = "Wuncon Siji:pixelsize=14:weight=bold;2"
; font-2 = "Siji:pixelsize=12:weight=bold;2"
; modules-center = date time
; background = "#ee1E2029"


[module/bspwm]
type = internal/bspwm
pin-workspaces = true
enable-click = true

; ws-icon-0 = 1;
; ws-icon-1 = 2;
; ws-icon-2 = 3;
; ws-icon-3 = 4;
; ws-icon-4 = 5;
; ws-icon-5 = 6;
ws-icon-default = "%{T3}%{T-}"

format = <label-state> <label-mode>
label-padding = 1

label-focused = "%{T3}%{T-}"
label-focused-foreground = ${colors.fg}
; label-focused-background = ${colors.bg-dark}
label-focused-padding = 1

label-occupied = "%{T3}%{T-}"
label-occupied-foreground = ${colors.accent}
; label-occupied-background = ${colors.bg}
label-occupied-padding = 1

label-urgent = %icon%
label-urgent-foreground = ${colors.alert}
; label-urgent-background = ${colors.bg}
; label-urgent-background = ${colors.alert}
label-urgent-padding = 1

label-empty = %icon%
label-empty-foreground = ${colors.fg-alt}
; label-empty-background = ${colors.bg}
label-empty-padding = 1

; [module/date]
; type = internal/date
; interval = 60
; date = "<b>%a</b>  %Y-%M-%d"
; date-alt = "%A, %B %d"
; date-foreground = ${colors.accent}
; format-prefix = "·"
; ; format-prefix-padding = 1
; ; format-prefix-background = ${colors.bg-alt}
; format-prefix-foreground = ${colors.fg}
; ; format-underline = ${xrdb:color4}

[module/date_day]
type = internal/date
interval = 60
label = %date%
date = "%a"
date-alt = "%A"
format-padding = 1

[module/date]
type = internal/date
interval = 60
label = %date%
label-foreground = ${colors.fg-alt}
date = "%Y-%m-%d"
date-alt = "%B %d, %Y"

[module/clock]
type = internal/date
interval = 60
label = %time%
time = %H%M
time-alt = %H%M
format = <time>  <date>
format-padding = 2
format-suffix = "hrs"
format-suffix-padding = 1
format-suffix-foreground = ${colors.accent}
; format-prefix-background = ${colors.bg-alt}
; format-underline = ${xrdb:color4}

[fs-base]
type = internal/fs
; mount-0 = /
; mount-1 = /home          ; for laptop
interval = 30

; Available tags:
;   <label-mounted> (default)
;   <bar-free>
;   <bar-used>
;   <ramp-capacity>
; format-mounted = <ramp-capacity>
format-mounted = <label-mounted> <bar-used>
; Available tokens:
;   %mountpoint%
;   %type%
;   %fsname%
;   %percentage_free%
;   %percentage_used%
;   %total%
;   %free%
;   %used%
; Default: %mountpoint% %percentage_free%%
label-mounted = %mountpoint%

format-mounted-prefix = " "
format-mounted-padding = 1
format-unmounted =
; label-unmounted =
; label-unmounted-foreground = ${colors.fg-alt}

ramp-capacity-0 = 
; ramp-capacity-1 = ▂
; ramp-capacity-2 = ▃
; ramp-capacity-3 = ▄
; ramp-capacity-4 = ▅
; ramp-capacity-5 = ▆
; ramp-capacity-6 = ▇
; ramp-capacity-7 = █
ramp-capacity-0-foreground = ${colors.red}
ramp-capacity-1-foreground = ${colors.yellow}
ramp-capacity-2-foreground = ${colors.fg}
ramp-capacity-3-foreground = ${colors.accent}
ramp-capacity-4-foreground = ${colors.accent}

bar-used-indicator = |
bar-used-fill = ─
bar-used-empty = ─
bar-used-width = 8
bar-used-foreground-0 = ${colors.fg}
bar-used-foreground-1 = ${colors.fg}
bar-used-foreground-2 = ${colors.yellow}
bar-used-foreground-3 = ${colors.alert}
bar-used-foreground-4 = ${colors.alert}
bar-used-empty-foreground = ${colors.fg-alt}

[module/fs-root]
inherit = fs-base
hidden = true
mount-0 = /

[module/fs-home]
inherit = fs-base
hidden = true
mount-0 = /home

[module/xwindow]
type = internal/xwindow
label = %title:0:80:...%
label-padding-left = 2

; [module/mpd]
; type = internal/mpd
; host = /home/hlissner/.config/mpd/mpd.sock
;
; format-online = <label-song> <toggle>
; format-padding = 5
;
; label-song-maxlen = 45
; label-song-ellipsis = true
;
; icon-prev = 
; icon-seekb = 
; icon-stop = 
; icon-play = 
; icon-pause = 
; icon-next = 
; icon-seekf = 
;
; icon-random = 
; icon-repeat = 
;
; toggle-on-foreground = ${colors.fg}
; toggle-off-foreground = #66

[module/cpu]
type = internal/cpu
hidden = true
interval = 1
format = <ramp-coreload>
; format = <bar-load>
format-prefix = "CPU "
format-prefix-foreground = ${colors.fg}
; format-foreground = ${colors.accent}
; format-background = ${colors.bg-dark}
; format-underline = #f90000
; label = %percentage%%
; format-padding-left = 1
format-padding = 1

ramp-coreload-spacing = 0
; ramp-coreload-0 = ▁
; ramp-coreload-1 = ▂
; ramp-coreload-2 = ▃
; ramp-coreload-3 = ▄
; ramp-coreload-4 = ▅
; ramp-coreload-5 = ▆
; ramp-coreload-6 = ▇
; ramp-coreload-7 = █
ramp-coreload-0 = ·
ramp-coreload-1 = ·
ramp-coreload-2 = ¦
ramp-coreload-3 = ¦
ramp-coreload-4 = |
ramp-coreload-5 = |
ramp-coreload-6 = |
ramp-coreload-7 = |
ramp-coreload-0-foreground = ${colors.fg-alt}
ramp-coreload-1-foreground = ${colors.fg-alt}
ramp-coreload-2-foreground = ${colors.accent}
ramp-coreload-3-foreground = ${colors.accent}
ramp-coreload-4-foreground = ${colors.fg}
ramp-coreload-5-foreground = ${colors.fg}
ramp-coreload-6-foreground = ${colors.yellow}
ramp-coreload-7-foreground = ${colors.yellow}

bar-load-indicator =
bar-load-width = 10
bar-load-foreground-0 = ${colors.fg}
bar-load-foreground-1 = ${colors.fg}
bar-load-foreground-2 = ${colors.yellow}
bar-load-foreground-3 = ${colors.alert}
bar-load-foreground-4 = ${colors.alert}
bar-load-fill = |
bar-load-empty = ¦
bar-load-empty-foreground = ${colors.fg-alt}

[module/memory]
type = internal/memory
hidden = true
interval = 3
format = <bar-used>
; format = <bar-used>
; format-prefix = ""
; format-prefix-foreground = ${colors.fg}
format-prefix = "MEM "
format-prefix-foreground = ${colors.fg}
; format-background = ${colors.bg-dark}
; format-underline = #4bffdc
; label = %percentage_used%%
format-padding = 1

; Only applies if <ramp-used> is used
ramp-used-0 =
ramp-used-1 =
ramp-used-2 =
ramp-used-3 = !
ramp-used-4 = !
ramp-used-5 = !
ramp-used-0-foreground = ${colors.accent}
ramp-used-1-foreground = ${colors.accent}
ramp-used-2-foreground = ${colors.accent}
ramp-used-3-foreground = ${colors.fg}
ramp-used-4-foreground = ${colors.yellow}
ramp-used-5-foreground = ${colors.red}

; Only applies if <bar-used> is used
bar-used-indicator = |
bar-used-fill = ─
bar-used-empty = ─
bar-used-width = 10
bar-used-foreground-0 = ${colors.fg}
bar-used-foreground-1 = ${colors.yellow}
bar-used-foreground-2 = ${colors.red}
bar-used-empty-foreground = ${colors.fg-alt}

[module/wlan]
type = internal/network
interface-type = wireless
interval = 3.0
label-connected = %essid%
label-connected-foreground = ${colors.accent}
format-connected = <ramp-signal> <label-connected>
format-connected-padding = 2
# format-disconnected = 
format-disconnected = ""
# format-disconnected-padding = 2
# format-disconnected-foreground = ${colors.fg-alt}
; format-disconnected-padding = 0
ramp-signal-0 = ""
ramp-signal-0-foreground = ${colors.fg}
ramp-signal-1 = ""
ramp-signal-1-foreground = ${colors.fg}
ramp-signal-2 = ""
ramp-signal-2-foreground = ${colors.fg}
ramp-signal-3 = ""
ramp-signal-3-foreground = ${colors.fg-alt}
ramp-signal-4 = "!"
ramp-signal-4-foreground = ${colors.fg-alt}

[module/lan]
type = internal/network
interface-type = wired
label-connected = ""
; format-connected-prefix = " "
; format-connected-prefix-foreground = ${colors.accent}
format-connected-foreground = ${colors.fg}
format-connected-background =
format-connected-underline =
format-connected-padding = 1

; label-disconnected = ""
; format-disconnected-prefix = " "
; format-disconnected-prefix-foreground = ${colors.alert}
format-disconnected-foreground = ${colors.alert}

[module/pulseaudio]
type = internal/pulseaudio
; format-volume = <label-volume> <bar-volume>
format-volume = <ramp-volume>
format-volume-foreground = ${colors.fg}
format-volume-padding = 1
; label-volume = " "
; label-volume-foreground = ${colors.accent}
; format-muted-prefix = " "
label-muted = 
label-muted-foreground = ${colors.accent}
format-muted-foreground = ${colors.accent}
format-muted-padding = 1
; bar-volume-width = 8
; bar-volume-foreground-0 = ${colors.magenta}
; bar-volume-foreground-1 = ${colors.magenta}
; bar-volume-foreground-2 = ${colors.magenta}
; bar-volume-foreground-3 = ${colors.magenta}
; bar-volume-foreground-4 = ${colors.magenta}
; bar-volume-foreground-5 = ${colors.magenta}
; bar-volume-foreground-6 = ${colors.magenta}
; bar-volume-gradient = false
; bar-volume-indicator = |
; bar-volume-indicator-font = 1
; bar-volume-indicator-foreground = ${colors.magenta}
; bar-volume-fill = ─
; bar-volume-fill-font = 1
; bar-volume-empty = ─
; bar-volume-empty-font = 1
; bar-volume-empty-foreground = ${colors.fg}
; Only applies if <ramp-volume> is used
ramp-volume-0 = 
ramp-volume-0-foreground = ${colors.accent}
ramp-volume-1 = 
ramp-volume-2 = 
ramp-volume-3 = 
ramp-volume-4 = 
ramp-volume-5 = 
ramp-volume-6 = 
ramp-volume-7 = 
ramp-volume-8 = 
ramp-volume-9 = 
ramp-volume-10 = 
; ramp-volume-0-foreground = ${colors.accent}
; ramp-volume-1-foreground = ${colors.accent}
; ramp-volume-2-foreground = ${colors.accent}

[module/battery]
type = internal/battery
battery = BAT0
adapter = ADP1
full-at = 98
low-at = 5
poll-interval = 5

time-format = "%H:%M"

label-charging = %percentage%%
; label-charging-foreground = ${colors.yellow}
format-charging = <animation-charging> <label-charging>
; format-charging-foreground = ${colors.fg}
; format-charging-underline = #ffb52a
format-charging-padding = 1

label-discharging = %time%
format-discharging = <ramp-capacity> <label-discharging>
format-discharging-foreground = ${colors.fg}
; format-discharging-underline = ${self.format-charging-underline}
format-discharging-padding = 1

label-low = <ramp-capacity>! %time%
format-low-foreground = ${colors.red}

label-full =
label-full-foreground = ${colors.accent}
format-full-padding = 1
; format-full-prefix = " "
; format-full-foreground = ${colors.fg}
; format-full-underline = ${self.format-charging-underline}

ramp-capacity-0 = "%{T4}%{T-}"
ramp-capacity-1 = "%{T4}%{T-}"
ramp-capacity-2 = "%{T4}%{T-}"
ramp-capacity-3 = "%{T4}%{T-}"
ramp-capacity-4 = "%{T4}%{T-}"
ramp-capacity-0-foreground = ${colors.red}
ramp-capacity-1-foreground = ${colors.yellow}
; ramp-capacity-2-foreground = ${colors.fg}
; ramp-capacity-3-foreground = ${colors.fg}
; ramp-capacity-4-foreground = ${colors.fg}

animation-charging-0 = "%{T4}%{T-}"
animation-charging-1 = "%{T4}%{T-}"
animation-charging-2 = "%{T4}%{T-}"
animation-charging-3 = "%{T4}%{T-}"
animation-charging-4 = "%{T4}%{T-}"
animation-charging-framerate = 750

[module/temperature]
type = internal/temperature

; Seconds to sleep between updates
; Default: 1
interval = 1

; Thermal zone to use
; To list all the zone types, run
; $ for i in /sys/class/thermal/thermal_zone*; do echo "$i: $(<$i/type)"; done
; Default: 0
thermal-zone = 0

; Full path of temperature sysfs path
; Use `sensors` to find preferred temperature source, then run
; $ for i in /sys/class/hwmon/hwmon*/temp*_input; do echo "$(<$(dirname $i)/name): $(cat ${i%_*}_label 2>/dev/null || echo $(basename ${i%_*})) $(readlink -f $i)"; done
; to find path to desired file
; Default reverts to thermal zone setting
hwmon-path = /sys/devices/platform/coretemp.0/hwmon/hwmon2/temp1_input

; Base temperature for where to start the ramp (in degrees celsius)
; Default: 0
base-temperature = 20

; Threshold temperature to display warning label (in degrees celsius)
; Default: 80
warn-temperature = 60


;=====================================================
; Custom scripts
;=====================================================

[module/bluetooth]
type = custom/script
exec-if = command -v bluetoothctl
exec = ~/.config/polybar/modules/bluetooth
tail = true
click-left = bluetoothmenu

[module/redshift]
type = custom/script
exec-if = command -v redshift
exec = ~/.config/polybar/modules/redshift
click-left = ~/.config/polybar/modules/redshift toggle
format-padding = 1
interval = 1

[module/pad]
type = custom/text
content = "  · "
content-foreground = ${colors.fg-alt}

; vim:ft=dosini
</file>

<file path="modules/themes/autumnal/config/polybar/run.sh">
#!/usr/bin/env bash

group_a=( clock date date_day )
group_b=( memory cpu fs-root fs-home )

msg() {
  action="module_$1"
  shift
  for mod in "$@"; do
    polybar-msg action "$mod" "$action"
  done
}

if [[ "$1" == "switch" ]]; then
case "$2" in
  0)
    msg hide "${group_b[@]}"
    msg show "${group_a[@]}"
    ;;
  1)
    msg show "${group_b[@]}"
    msg hide "${group_a[@]}"
    ;;
esac
else
  pkill -u $UID -x polybar
  while pgrep -u $UID -x polybar >/dev/null; do sleep 1; done

  echo 'Launching Polybar...'
  {
    sleep 1
    polybardir="$XDG_DATA_HOME/polybar"
    mkdir -p "$polybardir"
    polybar main >"$polybardir/main.log" 2>&1 &
  } &
fi
</file>

<file path="modules/themes/autumnal/config/rofi/icons/linux.svg">
<?xml version="1.0" ?><svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"><title/><g id="Linux"><path d="M29.19,26.93h0a2.27,2.27,0,0,1-.34-.92A1.78,1.78,0,0,0,28.36,25h0a1.15,1.15,0,0,0-.19-.14.82.82,0,0,0-.19-.09A5.42,5.42,0,0,0,27.8,21a12.08,12.08,0,0,0-2.18-3.49,5.21,5.21,0,0,1-1.56-3.37C24.08,12,24.3,8,20.5,8L20,8c-4.24.34-3.11,4.82-3.17,6.32a5.41,5.41,0,0,1-1.06,3,15.08,15.08,0,0,0-2.72,4.53,5.43,5.43,0,0,0-.29,2.5.57.57,0,0,0-.11.11c-.26.27-.45.61-.67.84a2,2,0,0,1-.79.38,1.46,1.46,0,0,0-.87.68h0a1.17,1.17,0,0,0-.13.58,5.11,5.11,0,0,0,0,.55,2.38,2.38,0,0,1,0,1A1.83,1.83,0,0,0,10.2,30a1.26,1.26,0,0,0,.94.58,10,10,0,0,1,2.78.59L14,31l-.07.14a4,4,0,0,0,2.62.48,1.71,1.71,0,0,0,1.22-.94c.58,0,1.23-.26,2.26-.31.7-.06,1.58.25,2.58.19a1.66,1.66,0,0,0,.12.31h0A1.88,1.88,0,0,0,24.61,32a3.36,3.36,0,0,0,2.26-1.31l-.12-.1.12.1a8.13,8.13,0,0,1,2.39-1.5,1.14,1.14,0,0,0,.65-.86A2.1,2.1,0,0,0,29.19,26.93ZM19.83,12.86A1.75,1.75,0,0,1,20,12.1a1.33,1.33,0,0,1,.43-.57,1,1,0,0,1,.6-.21h0a.91.91,0,0,1,.58.2,1.33,1.33,0,0,1,.45.56,1.67,1.67,0,0,1,.16.74v0a1.83,1.83,0,0,1-.16.77,1.55,1.55,0,0,1-.21.36l-.09,0-.29-.12-.22-.07a1,1,0,0,0,.19-.22,1.12,1.12,0,0,0,.08-.42v0a.89.89,0,0,0-.06-.4.71.71,0,0,0-.18-.32.39.39,0,0,0-.27-.12h0a.37.37,0,0,0-.26.1.74.74,0,0,0-.21.3,1.22,1.22,0,0,0-.09.42v0a.93.93,0,0,0,0,.24,3,3,0,0,0-.61-.21,1.64,1.64,0,0,1,0-.22Zm-2.58.07a1.82,1.82,0,0,1,.08-.67,1.1,1.1,0,0,1,.29-.5.63.63,0,0,1,.42-.21h0a.63.63,0,0,1,.41.16,1.18,1.18,0,0,1,.34.46,1.82,1.82,0,0,1,.15.66h0a1.4,1.4,0,0,1,0,.29l-.09,0a1.57,1.57,0,0,0-.39.19,1.13,1.13,0,0,0,0-.26h0a.84.84,0,0,0-.08-.33.67.67,0,0,0-.16-.25.3.3,0,0,0-.19-.07h0a.26.26,0,0,0-.19.11.75.75,0,0,0-.12.27,1.32,1.32,0,0,0,0,.35h0a1.07,1.07,0,0,0,.08.33.69.69,0,0,0,.17.25l0,0-.17.14-.14.1a1.17,1.17,0,0,1-.27-.42,1.94,1.94,0,0,1-.16-.65Zm.19,1.47.48-.36.18-.13h0a2.35,2.35,0,0,1,.84-.59,1.4,1.4,0,0,1,.47-.08,2.3,2.3,0,0,1,1.22.42,7.27,7.27,0,0,0,1.06.44h0a.92.92,0,0,1,.48.38.59.59,0,0,1,0,.47,1.6,1.6,0,0,1-1.06.84h0a4.7,4.7,0,0,0-.77.44,1.7,1.7,0,0,1-1,.26,1.19,1.19,0,0,1-.45-.1,1.32,1.32,0,0,1-.32-.2,4.53,4.53,0,0,0-.61-.5h0a1.32,1.32,0,0,1-.69-.72A.48.48,0,0,1,17.44,14.4Zm.16,15.65h0a1.34,1.34,0,0,1-1.13,1.3,3.65,3.65,0,0,1-2.4-.46h0a9.43,9.43,0,0,0-2.87-.61,1,1,0,0,1-.72-.41,1.67,1.67,0,0,1,.12-1.24h0a2.54,2.54,0,0,0,0-1.13,1.53,1.53,0,0,1,0-.94h0a1.11,1.11,0,0,1,.69-.53,2.05,2.05,0,0,0,.92-.46h0c.26-.27.45-.61.67-.85a.87.87,0,0,1,.66-.33h.17a1.67,1.67,0,0,1,1,.75l.91,1.67h0a11.66,11.66,0,0,0,1.2,1.64,2.76,2.76,0,0,1,.73,1.59Zm-.08-1.22c-.12-.19-.26-.37-.4-.56l-.27-.35a1.08,1.08,0,0,0,.46-.09.61.61,0,0,0,.32-.33,1.34,1.34,0,0,0-.35-1.17,6.24,6.24,0,0,0-1.79-1.52h0a2.58,2.58,0,0,1-1.16-1.4,3.18,3.18,0,0,1,0-1.65A9.47,9.47,0,0,1,15.6,19c.1-.08,0,.15-.41,1s-1.15,2.5-.13,3.86a8.09,8.09,0,0,1,.65-2.88c.57-1.28,1.75-3.51,1.85-5.28a2.94,2.94,0,0,0,.29.19h0a6.22,6.22,0,0,1,.59.48,1.42,1.42,0,0,0,.87.34h.12a2,2,0,0,0,1-.29,4.57,4.57,0,0,1,.74-.42h0a2.07,2.07,0,0,0,1-.71A23.91,23.91,0,0,0,24,19.75a10.52,10.52,0,0,1,1.1,3,2,2,0,0,1,.52.06,4.08,4.08,0,0,0-1.1-4c-.22-.22-.23-.31-.12-.31A5.8,5.8,0,0,1,26,21.33,3.49,3.49,0,0,1,26,23l.21.09c1,.5,1.42.94,1.23,1.54h-.19c.15-.47-.19-.82-1.07-1.22s-1.65-.37-1.78.45c0,.05,0,.09,0,.13l-.21.1a1.72,1.72,0,0,0-.8,1.19,9.74,9.74,0,0,0-.2,1.87h0a8.05,8.05,0,0,1-.32,1.36A4.64,4.64,0,0,1,17.52,28.83Zm11.57.07a7.73,7.73,0,0,0-2.46,1.58,3.17,3.17,0,0,1-2,1.2A1.54,1.54,0,0,1,23,30.77h0a2.57,2.57,0,0,1,.06-1.7,10.62,10.62,0,0,0,.46-1.9h0a10.49,10.49,0,0,1,.2-1.82,1.44,1.44,0,0,1,.64-1l.05,0a1.43,1.43,0,0,0,.88,1.38,2.19,2.19,0,0,0,1.8-.76h.21a1.08,1.08,0,0,1,.85.25h0a1.57,1.57,0,0,1,.39.88A2.49,2.49,0,0,0,29,27.15h0c.49.54.65.91.63,1.15S29.41,28.71,29.09,28.9ZM17.62,15c-.16-.13-.14-.31-.08-.31s.14.17.21.23a4.28,4.28,0,0,0,.36.33,1.88,1.88,0,0,0,1.17.45,3.15,3.15,0,0,0,1.4-.48,6.34,6.34,0,0,0,.65-.45c.16-.12.15-.26.28-.24s0,.15-.15.31a3.85,3.85,0,0,1-.69.48,3.35,3.35,0,0,1-1.49.51A2,2,0,0,1,18,15.3,5,5,0,0,1,17.62,15Z"/></g></svg>
</file>

<file path="modules/themes/autumnal/config/rofi/icons/nixos.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="64" height="64" viewBox="0 0 60 60"><g fill-rule="evenodd"><use xlink:href="#B" fill="#5277c3"/><path d="M23.58 20.214L8.964 45.528 5.55 39.743l3.94-6.78-7.823-.02L0 30.052l1.703-2.956 11.135.035 4.002-6.9zM24.7 40.45h29.23l-3.302 5.85-7.84-.022 3.894 6.785-1.67 2.9-3.412.004-5.537-9.66-7.976-.016zm17.014-11.092L27.1 4.043l6.716-.063 3.902 6.8 3.93-6.765 3.337.002 1.7 2.953-5.598 9.626 3.974 6.916z" fill="#7ebae4"/><g fill="#5277c3"><use xlink:href="#B"/><path d="M35.28 19.486l-29.23-.002 3.303-5.848 7.84.022L13.3 6.873l1.67-2.9 3.412-.004 5.537 9.66 7.976.016zm1.14 20.294l14.616-25.313 3.413 5.785-3.94 6.78 7.823.02 1.668 2.9-1.703 2.956-11.135-.035-4.002 6.9z"/></g></g><defs ><path id="B" d="M18.305 30.642L32.92 55.956l-6.716.063-3.902-6.8-3.93 6.765-3.337-.002-1.71-2.953 5.598-9.626-3.974-6.916z"/></defs></svg>
</file>

<file path="modules/themes/autumnal/config/rofi/icons/windows.svg">
<?xml version="1.0" ?><!DOCTYPE svg  PUBLIC '-//W3C//DTD SVG 1.1//EN'  'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'><svg enable-background="new 0 0 128 128" id="Social_Icons" version="1.1" viewBox="0 0 128 128" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="_x33__stroke"><g id="Windows_Phone_1_"><rect clip-rule="evenodd" fill="none" fill-rule="evenodd" height="128" width="128"/><path clip-rule="evenodd" d="M128,67.591L127.984,128l-69.358-9.759    l-0.097-50.763L128,67.591z M58.626,10.091L127.984,0v60.682l-69.358,0.549V10.091z M52.285,67.118l0.041,50.346l-52.284-7.166    L0.038,66.781L52.285,67.118z M0,18.123l52.31-7.102l0.023,50.301L0.049,61.618L0,18.123z" fill="#00B6F0" fill-rule="evenodd" id="Windows_Phone"/></g></g></svg>
</file>

<file path="modules/themes/autumnal/config/rofi/themes/appmenu.rasi">
/* -*- mode: css; -*- */
@import "config.rasi"

configuration {
  matching: "regex";

  /* drun-categories: ""; */
  /* drun-match-fields: "name,generic,exec,categories,keywords"; */
  drun-display-format: "{name} [<span weight='light' size='small' alpha='40%'>({generic})</span>]";
  /* drun-show-actions: true; */
  /* drun-url-launcher: "xdg-open"; */
  /* drun-use-desktop-cache: false; */
  /* drun-reload-desktop-cache: false; */
  drun {
    /** Parse user desktop files. */
    parse-user:   true;
    /** Parse system desktop files. */
    parse-system: true;
  }
}
</file>

<file path="modules/themes/autumnal/config/rofi/themes/audiomenu.rasi">
/* -*- mode: css; -*- */
@import "config.rasi"

icon {
  filename: "audio-card";
  margin: -3px 0 0 0;
}

entry {
  placeholder: "Change default audio device...";
}
</file>

<file path="modules/themes/autumnal/config/rofi/themes/bookmarkmenu.rasi">
/* -*- mode: css; -*- */
@import "config.rasi"

icon {
  filename: "user-bookmarks-symbolic";
  margin: -3px 0 0 0;
}

entry {
  placeholder: "Search bookmarks...";
}
</file>

<file path="modules/themes/autumnal/config/rofi/themes/calcmenu.rasi">
/** -*- mode: css; -*- **/
@import "config.rasi"

configuration {
  normalize-match: true;
  /* kb-accept-entry: "Return"; */
  /* kb-accept-custom: "Control+Return"; */
}

icon {
  filename: "accessories-calculator-symbolic";
}

entry {
  placeholder: "Enter calculation...";
}
</file>

<file path="modules/themes/autumnal/config/rofi/themes/devmenu.rasi">
/* -*- mode: css; -*- */
@import "config.rasi"

icon {
  filename: "drive-harddisk";
}

entry {
  placeholder: "Manage filesystem...";
}

/* element-icon { */
/*   filename: "ipod_mount"; */
/* } */
</file>

<file path="modules/themes/autumnal/config/rofi/themes/emojimenu.rasi">
/* -*- mode: css; -*- */
@import "config.rasi"

configuration {
  show-icons: false;
}

window {
  columns: 6;
}

icon {
  filename: "insert-emoticon-symbolic";
}
</file>

<file path="modules/themes/autumnal/config/rofi/themes/filemenu.rasi">
/* -*- mode: css; -*- */
@import "config.rasi"

icon {
  filename: "folder";
}

prompt {
  enabled: false;
}
</file>

<file path="modules/themes/autumnal/config/rofi/themes/modal.rasi">
/* -*- mode: css; -*- */
@import "config.rasi"

configuration {
  cycle: true;
  scroll-method: 0;
}

inputbar {
  enabled: false;
}

message {
  background-color: @bg-focus;
  padding: @pad4;
  font: @font-sans-0;
}
</file>

<file path="modules/themes/autumnal/config/rofi/themes/powermenu.rasi">
/** -*- mode: css; -*-
 * This theme is intended for a 5 items wide menu on a 1920x1080 pixels resolution.
 * You may have to tweak values such as the window padding if you have a different resolution.
 */
@import "appmenu.rasi"

icon {
  filename: "preferences-system-power";
}

listview {
  scrollbar: false;
}

entry {
  placeholder: "Power control...";
}

element-icon {
  size: 32px;
}

element {
  padding: 0.6em 2px 0.6em 14px;
}
</file>

<file path="modules/themes/autumnal/config/rofi/themes/timemenu.rasi">
/** -*- mode: css; -*- **/
@import "config.rasi"

icon {
  filename: "accessories-clock";
}

entry {
  placeholder: "Display time in...";
}
</file>

<file path="modules/themes/autumnal/config/rofi/themes/topmenu.rasi">
/* -*- mode: css; -*- */
@import "config.rasi"

configuration {
  /* kb-accept-entry: "Return"; */
  /* kb-accept-custom: "Control+Return"; */
  show-icons: false;
}

window {
  width: 90%;
}

icon {
  enabled: false;
  /* filename: "accessories-calculator-symbolic"; */
}

entry {
  placeholder: "Process list ...";
}

element-text {
  font: @font-mono-0;
}
</file>

<file path="modules/themes/autumnal/config/rofi/themes/vaultmenu.rasi">
/* -*- mode: css; -*- */
@import "config.rasi"

icon {
  filename: "lock";  /* FIXME */
}
</file>

<file path="modules/themes/autumnal/config/rofi/themes/wifimenu.rasi">
/* -*- mode: css; -*- */
@import "config.rasi"

/* configuration { */
/*   show-icons: false; */
/* } */

/* * { font: @font-sans-0; } */
/* entry, prompt { font: @font-sans-2; } */

icon {
  filename: "network-wireless";
}

entry {
  placeholder: "Select network...";
}

element-text {
  tab-stops: [74ch];
}
</file>

<file path="modules/themes/autumnal/config/rofi/themes/windowmenu.rasi">
/* -*- mode: css; -*- */
@import "../config.rasi"

configuration {
  window-format: "{c}\n{t}";
  cycle: true;
  window-thumbnail: true;
  scroll-method: 0;
}

icon {
  filename: "focus-windows-symbolic";
}

entry {
  placeholder: "Switch to window...";
}

listview {
  lines: 8;
}

element {
  spacing: 8px;
  padding: 0.4em 4px 0.4em 6px;
}
element-icon { size: 46px; }
element-text { vertical-align: 0.5; }
</file>

<file path="modules/themes/autumnal/config/rofi/config.rasi">
/** -*- mode: css -*- **/

/* Dark Leaves theme for Rofi */

* {
  accent:   #bd93f9;
  bg:       rgb(29, 31, 33, 0.96);
  bg-alt:   rgba(25, 26, 28, 0.92);
  bg-light: #1a1c1e;
  bg-focus: #333536;
  bg-dark:  #161719;
  border:   #0d0d0d;
  fg:       #c5c8c6;
  fg-alt:   #434547;
  fg-list:  #bbc2cf;
  on:       #b5bd68;
  off:      #cc6666;
  magenta:  #c9b4cf;
  blue:     #81a2be;

  selected: #38292b;
  errors:   #cc6666;
  warnings: #f0c674;

  font-mono-0: "JetBrainsMono 10";
  font-mono-1: "JetBrainsMono 12";
  font-mono-2: "JetBrainsMono 14";
  font-mono-3: "JetBrainsMono 16";
  font-mono-4: "JetBrainsMono 20";
  font-sans-0: "Fira Sans 14";
  font-sans-1: "Fira Sans 16";
  font-sans-2: "Fira Sans 18";
  font-sans-3: "Fira Sans 22";

  pad1: 4px;
  pad2: 8px;
  pad3: 12px;
  pad4: 16px;
  pad5: 20px;
  pad6: 24px;
  pad7: 32px;
}

* { font: @font-mono-1; }
error-message { font: @font-sans-0; }
entry, prompt { font: @font-mono-3; }

configuration {
  show-icons: true;

  run,drun,window {
    fallback-icon: "view-fullscreen-symbolic";
  }
}

window {
  width: 760px;
  anchor: env(ROFI_ANCHOR, north);
  location: north;
  x-offset: env(ROFI_X, 0);
  y-offset: env(ROFI_Y, 2%);
  height: 800px;
}

error-message {
  padding: @pad7;
}

inputbar {
  background-color: @bg;
}
listview {
  expand: false;
  fixed-height: false;
}
listview, inputbar, overlay, message, error-message {
  margin: 0 0 8px 0;
  border: 0 0 2px 0;
  border-color: @border;
  border-radius: 1px;
}
element, overlay, error-message {
  background-color: @bg-alt;
}
element selected {
  background-color: @selected;
}
message {
  background-color: @bg-light;
  margin: -9px 0 8px 0;
  padding: 16px 24px;
}

textbox, prompt, entry, element-text {
  text-color: @fg;
}


/** Icons **/
element-icon { size: 24px; }
icon, icon-current-entry { size: 32px; }



/** Input area **/
inputbar {
  /* children: [ icon, prompt, entry, num-filtered-rows ]; */
  padding: @pad5;
  spacing: @pad3;
}
prompt, entry, num-filtered-rows, element-text {
  vertical-align: 0.65;
}
textbox-current-entry, prompt, num-filtered-rows {
  text-color: @fg;
}
num-filtered-rows {
  text-color: @fg-alt;
}
prompt {
  enabled: false;
  text-transform: bold;
}
entry {
  blink: true;
  placeholder: env(ROFI_PLACEHOLDER, "Search...");
  placeholder-color: @fg-alt;
  placeholder-markup: true;
  cursor: text;
}

/** List **/
listview {
  spacing: 0;
}
overlay {
  text-color: @fg-alt;
  text-transform: italic;
}

element {
  spacing: 18px;
  padding: 0.5em 0em 0.5em 2.5ch;
}

element-text {
  horizontal-align: 0.0;
  highlight: underline bold;
}
</file>

<file path="modules/themes/autumnal/config/spicetify/user.css">
/* Based off of spicetify-theme's BurntSienna 
 *
 * @see https://github.com/spicetify/spicetify-themes/blob/master/BurntSienna/user.css
 */

@import url('https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
* {
	font-family: Montserrat;
}

/* Page titles */
h1 {
	font-weight: 700 !important;
}

/* Song name in player */
.main-nowPlayingWidget-nowPlaying .main-trackInfo-name {
	overflow: unset;
	font-size: 20px !important;
}

/* Artist name in player */
.main-nowPlayingWidget-nowPlaying .main-trackInfo-artists {
	overflow: unset;
	font-size: 15px;
}

.main-type-finale {
	line-height: 17px;
}

/* Icons */
.main-trackList-rowPlayPauseIcon {
	transform: scale(1.3);
}

.x-downloadButton-button svg {
	height: 32px;
	width: 32px;
}

/* Progress and remaining time */
.main-playbackBarRemainingTime-container,
.playback-bar__progress-time-elapsed,
.playback-bar__progress-time {
	font-size: 15px;
	margin-left: 5px;
	margin-right: 5px;
}

/* Player play button */
.main-playPauseButton-button {
	background-color: unset;
	color: var(--spice-subtext);
}

.main-playPauseButton-button svg {
	height: 28px;
	width: 28px;
}

/* Progress bar */
.progress-bar {
	--fg-color: var(--spice-button);
}

.progress-bar__bg,
.progress-bar__fg,
.progress-bar__fg_wrapper {
	height: 5px;
}

.progress-bar-wrapper {
	margin-left: 5px;
	margin-right: 5px;
}

/* Extra controls */
.control-button::before {
	font-size: 20px;
}

.ExtraControls svg {
	height: 20px;
	width: 20px;
}

/* Removing gradients */
.main-entityHeader-backgroundColor,
.main-actionBarBackground-background {
	background-color: unset !important;
	background-image: none;
}

/* Cover shadow */
.main-entityHeader-shadow {
	-webkit-box-shadow: 0 4px 20px rgba(var(--spice-rgb-shadow), 0.5);
	box-shadow: 0 4px 20px rgba(var(--spice-rgb-shadow), 0.5);
}

/* Top bar */
.main-topBar-background {
	background-color: #3a3d42 !important;
}

/* Playing icon */
.main-trackList-playingIcon {
	filter: saturate(0%);
}

/* Playlist like button */
.main-actionBar-ActionBarRow .main-addButton-button .Svg-ulyrgf-0 {
	height: unset;
	width: unset;
}

/* Order button */
.x-sortBox-sortDropdown {
	margin-top: 3px;
}

/* Sidebar playlists menu */
.main-rootlist-rootlistDividerGradient {
	background: unset;
}

.main-rootlist-rootlistDivider {
	background-color: var(--spice-button);
}

/* Search box */
.x-searchInput-searchInputInput {
	font-size: 18px;
}

/* Aritsts names */
.main-type-mesto {
	font-size: 16px;
	line-height: 20px;
}

/* Songs names */
.main-type-ballad {
	font-size: 18px;
}

/* Cards descriptions */
.main-cardSubHeader-root {
	overflow: hidden !important;
}

/* Ad title */
.desktoproutes-homepage-takeover-ad-hptoNativeOriginal-header {
	font-weight: 700 !important;
}

/* Friends names */
.main-buddyFeed-username a {
	color: var(--spice-text) !important;
	font-size: 17px;
	font-weight: 500;
}

/* Friends songs and artists */
.main-buddyFeed-artistAndTrackName a,
.main-buddyFeed-playbackContextLink span {
	font-size: 13px;
}

/* Cover height */
.main-coverSlotExpanded-container {
	height: var(--nav-bar-width) + 8px;
}

/* Scrollbars */
.os-scrollbar-handle {
	background: var(--spice-button) !important;
	border-radius: 8px;
}

/* Making index column wider so that lighter background that 
highlights selected song contains multi-digit song numbers */
/* It looks good up to 4 digits, I figured that no one has playlists with more music than that ;) */
.main-trackList-trackList.main-trackList-indexable .main-trackList-trackListRowGrid {
	grid-template-columns: [index] 48px [first] 6fr [var1] 4fr [var2] 3fr [last] minmax(120px, 1fr) !important;
}

/* Text boxes in settings */
.main-dropDown-dropDown {
	background-color: var(--spice-button-disabled);
}

/* Facebook button */
.x-settings-facebookButton {
	background-color: unset !important;
}

/* Playlist play button color */
.encore-dark-theme .encore-bright-accent-set,
.encore-dark-theme .encore-bright-accent-set:hover {
	--background-base: var(--spice-button-active);
	--background-highlight: var(--spice-player);
	--background-press: var(--spice-player);	
}

/* Volume bar margins */
.volume-bar .progress-bar {
	margin: 0 0.4rem;
}

.volume-bar .playback-progressbar {
	width: 70%;
}


.volume-bar {
	flex: 0 150px;
}

/* Menu hidden under the button with account name - font size and family unification */
.ellipsis-one-line {
	font-family: Montserrat;
}

.ellipsis-one-line.main-type-mesto {
	font-size: 14px;
}

/* Removal of empty space above playlist cover and title on narrow viewports */
.main-entityHeader-container.main-entityHeader-nonWrapped {
	min-height: 325px;
	height: 15vh;
}
</file>

<file path="modules/themes/autumnal/config/waybar/style.css">
/* .config/waybar/styles.css */

/** Variables **/
@define-color fg #c5c8c6;
@define-color bg #1D1F1E;

@define-color highlight #e68183;
@define-color active #b5bd68;
@define-color accent #c9b4cf;
@define-color warning red;


/** Styles **/
* {
    border: none;
    border-radius: 0;
    min-height: 0;
    font-family: "JetBrains Mono";
}

window.main#waybar {
    /* background: alpha(@bg, 0.0); */
    background: linear-gradient(180deg, alpha(@bg, 0.96), alpha(@bg, 0.94));
    color: @fg;
    font-size: 12px;
    /* border-bottom: 1px solid alpha(@bg,0.2); */
}
window.osd#waybar {
    background: none;
}

window.osd #submap {
    font-family: "Font Awesome 6 Free";
    padding: 16px 64px;
    margin: 0;
    font-size: 96px;
    background: rgba(18, 18, 18, 0.8);
    color: @highlight;
    opacity: 0.96;
    border-radius: 24px;
}

label.module {
    padding: 0 6px 0;
    margin: 0 1px;
    text-shadow: 0px 1px 4px @bg;
}

#workspaces {
    /* padding-right: 18px; */
}
#workspaces * {
    font-size: 14px;
}
#workspaces button {
    padding: 0 4px 0;
    background: transparent;
    border-top: 0px solid transparent;
    /* opacity: 0.9; */
    color: @highlight;
    opacity: 1.0;
}

#workspaces button.empty {
    opacity: 0.9;
}

#workspaces button.special {
    color: @accent;
}

#workspaces button.active {
    /* border-top-color: #81a2be; */
    color: @fg;
    opacity: 1.0;
}

#workspaces button:hover, #tags button:hover {
    /* color: @fg; */
}

/* Hyprland */
#clock, #window, #workspaces button, #submap {
    font-weight: bold;
}

#window {
    font-size: 14px;
}

window.main #submap {
    background: @bg;
    color: @highlight;
    padding: 2px 10px;
    margin: 0;
    font-size: 24px;
}


#clock {
    /* margin-right: 14px; */
}

#battery {}
#battery icon {
    color: @warning;
}
#battery.charging {}

@keyframes blink {
    to {
        background-color: @fg;
        color: @bg;
    }
}

#battery.warning:not(.charging) {
    color: @fg;
    animation-name: blink;
    animation-duration: 0.3s;
    animation-timing-function: linear;
    animation-iteration-count: infinite;
    animation-direction: alternate;
}

#cpu {
}

#memory {
}

#network {
}

#network.disconnected {
    color: @warning;
}
#network.ethernet {
}

#pulseaudio {
}

#pulseaudio.muted {
}

#tray {
    margin-left: 8px;
}

#idle_inhibitor.activated {
    background-color: @accent;
    color: @bg;
}
</file>

<file path="modules/themes/autumnal/config/zsh/prompt.zsh">
# Generated by Powerlevel10k configuration wizard on 2021-11-20 at 12:29 CET.
# Based on romkatv/powerlevel10k/config/p10k-lean.zsh.
# Wizard options: awesome-fontconfig + powerline, small icons, unicode, lean, 24h time,
# 2 lines, dotted, no frame, dark-ornaments, sparse, few icons, fluent,
# transient_prompt, instant_prompt=verbose.
# Type `p10k configure` to generate another config.
#
# Config for Powerlevel10k with lean prompt style. Type `p10k configure` to generate
# your own config based on it.
#
# Tip: Looking for a nice color? Here's a one-liner to print colormap.
#
#   for i in {0..255}; do print -Pn "%K{$i}  %k%F{$i}${(l:3::0:)i}%f " ${${(M)$((i%6)):#3}:+$'\n'}; done

# Temporarily change options.
'builtin' 'local' '-a' 'p10k_config_opts'
[[ ! -o 'aliases'         ]] || p10k_config_opts+=('aliases')
[[ ! -o 'sh_glob'         ]] || p10k_config_opts+=('sh_glob')
[[ ! -o 'no_brace_expand' ]] || p10k_config_opts+=('no_brace_expand')
'builtin' 'setopt' 'no_aliases' 'no_sh_glob' 'brace_expand'

() {
  emulate -L zsh -o extended_glob
  unset -m '(POWERLEVEL9K_*|DEFAULT_USER)~POWERLEVEL9K_GITSTATUS_DIR'

  typeset -g POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(
    dir
    prompt_char
  )

  typeset -g POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=(
    status                  # exit code of the last command
    command_execution_time  # duration of the last command
    background_jobs         # presence of background jobs
    direnv                  # direnv status (https://direnv.net/)
    # asdf                  # asdf version manager (https://github.com/asdf-vm/asdf)
    virtualenv              # python virtual environment (https://docs.python.org/3/library/venv.html)
    # anaconda              # conda environment (https://conda.io/)
    pyenv                   # python environment (https://github.com/pyenv/pyenv)
    goenv                   # go environment (https://github.com/syndbg/goenv)
    nodenv                  # node.js version from nodenv (https://github.com/nodenv/nodenv)
    nvm                     # node.js version from nvm (https://github.com/nvm-sh/nvm)
    nodeenv                 # node.js environment (https://github.com/ekalinin/nodeenv)
    # node_version          # node.js version
    # go_version            # go version (https://golang.org)
    # rust_version          # rustc version (https://www.rust-lang.org)
    # dotnet_version        # .NET version (https://dotnet.microsoft.com)
    # php_version           # php version (https://www.php.net/)
    # laravel_version       # laravel php framework version (https://laravel.com/)
    # java_version          # java version (https://www.java.com/)
    # package               # name@version from package.json (https://docs.npmjs.com/files/package.json)
    # rbenv                   # ruby version from rbenv (https://github.com/rbenv/rbenv)
    # rvm                     # ruby version from rvm (https://rvm.io)
    # fvm                     # flutter version management (https://github.com/leoafarias/fvm)
    # luaenv                  # lua version from luaenv (https://github.com/cehoffman/luaenv)
    # jenv                    # java version from jenv (https://github.com/jenv/jenv)
    # plenv                   # perl version from plenv (https://github.com/tokuhirom/plenv)
    # phpenv                  # php version from phpenv (https://github.com/phpenv/phpenv)
    # scalaenv                # scala version from scalaenv (https://github.com/scalaenv/scalaenv)
    # haskell_stack           # haskell version from stack (https://haskellstack.org/)
    # kubecontext             # current kubernetes context (https://kubernetes.io/)
    # terraform             # terraform workspace (https://www.terraform.io)
    # terraform_version     # terraform version (https://www.terraform.io)
    # aws                     # aws profile (https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-profiles.html)
    # aws_eb_env              # aws elastic beanstalk environment (https://aws.amazon.com/elasticbeanstalk/)
    # azure                   # azure account name (https://docs.microsoft.com/en-us/cli/azure)
    # gcloud                  # google cloud cli account and project (https://cloud.google.com/)
    # google_app_cred         # google application credentials (https://cloud.google.com/docs/authentication/production)
    # toolbox                 # toolbox name (https://github.com/containers/toolbox)
    context                 # user@hostname
    # nordvpn                 # nordvpn connection status, linux only (https://nordvpn.com/)
    ranger                  # ranger shell (https://github.com/ranger/ranger)
    nnn                     # nnn shell (https://github.com/jarun/nnn)
    xplr                    # xplr shell (https://github.com/sayanarijit/xplr)
    vim_shell               # vim shell indicator (:sh)
    # midnight_commander      # midnight commander shell (https://midnight-commander.org/)
    nix_shell               # nix shell (https://nixos.org/nixos/nix-pills/developing-with-nix-shell.html)
    # vpn_ip                # virtual private network indicator
    # load                  # CPU load
    # disk_usage            # disk usage
    # ram                   # free RAM
    # swap                  # used swap
    # todo                  # todo items (https://github.com/todotxt/todo.txt-cli)
    # timewarrior           # timewarrior tracking status (https://timewarrior.net/)
    # taskwarrior           # taskwarrior task count (https://taskwarrior.org/)
    time                  # current time
    vcs                     # git status
  )

  # Defines character set used by powerlevel10k. It's best to let `p10k configure` set it for you.
  typeset -g POWERLEVEL9K_MODE=awesome-fontconfig
  # When set to `moderate`, some icons will have an extra space after them. This is meant to avoid
  # icon overlap when using non-monospace fonts. When set to `none`, spaces are not added.
  typeset -g POWERLEVEL9K_ICON_PADDING=none

  # Basic style options that define the overall look of your prompt. You probably don't want to
  # change them.
  typeset -g POWERLEVEL9K_BACKGROUND=                            # transparent background
  typeset -g POWERLEVEL9K_{LEFT,RIGHT}_{LEFT,RIGHT}_WHITESPACE=  # no surrounding whitespace
  typeset -g POWERLEVEL9K_{LEFT,RIGHT}_SUBSEGMENT_SEPARATOR=' '  # separate segments with a space
  typeset -g POWERLEVEL9K_{LEFT,RIGHT}_SEGMENT_SEPARATOR=        # no end-of-line symbol

  # When set to true, icons appear before content on both sides of the prompt. When set
  # to false, icons go after content. If empty or not set, icons go before content in the left
  # prompt and after content in the right prompt.
  #
  # You can also override it for a specific segment:
  #
  #   POWERLEVEL9K_STATUS_ICON_BEFORE_CONTENT=false
  #
  # Or for a specific segment in specific state:
  #
  #   POWERLEVEL9K_DIR_NOT_WRITABLE_ICON_BEFORE_CONTENT=false
  typeset -g POWERLEVEL9K_ICON_BEFORE_CONTENT=true

  # Add an empty line before each prompt.
  typeset -g POWERLEVEL9K_PROMPT_ADD_NEWLINE=true

  # Connect left prompt lines with these symbols.
  typeset -g POWERLEVEL9K_MULTILINE_FIRST_PROMPT_PREFIX=
  typeset -g POWERLEVEL9K_MULTILINE_NEWLINE_PROMPT_PREFIX=
  typeset -g POWERLEVEL9K_MULTILINE_LAST_PROMPT_PREFIX=
  # Connect right prompt lines with these symbols.
  typeset -g POWERLEVEL9K_MULTILINE_FIRST_PROMPT_SUFFIX=
  typeset -g POWERLEVEL9K_MULTILINE_NEWLINE_PROMPT_SUFFIX=
  typeset -g POWERLEVEL9K_MULTILINE_LAST_PROMPT_SUFFIX=

  # The left end of left prompt.
  typeset -g POWERLEVEL9K_LEFT_PROMPT_FIRST_SEGMENT_START_SYMBOL=
  # The right end of right prompt.
  typeset -g POWERLEVEL9K_RIGHT_PROMPT_LAST_SEGMENT_END_SYMBOL=

  # Ruler, a.k.a. the horizontal line before each prompt. If you set it to true, you'll
  # probably want to set POWERLEVEL9K_PROMPT_ADD_NEWLINE=false above and
  # POWERLEVEL9K_MULTILINE_FIRST_PROMPT_GAP_CHAR=' ' below.
  typeset -g POWERLEVEL9K_SHOW_RULER=false
  typeset -g POWERLEVEL9K_RULER_CHAR='─'        # reasonable alternative: '·'
  typeset -g POWERLEVEL9K_RULER_FOREGROUND=242

  # Filler between left and right prompt on the first prompt line. You can set it to '·' or '─'
  # to make it easier to see the alignment between left and right prompt and to separate prompt
  # from command output. It serves the same purpose as ruler (see above) without increasing
  # the number of prompt lines. You'll probably want to set POWERLEVEL9K_SHOW_RULER=false
  # if using this. You might also like POWERLEVEL9K_PROMPT_ADD_NEWLINE=false for more compact
  # prompt.
  typeset -g POWERLEVEL9K_MULTILINE_FIRST_PROMPT_GAP_CHAR=' '
  if [[ $POWERLEVEL9K_MULTILINE_FIRST_PROMPT_GAP_CHAR != ' ' ]]; then
    # The color of the filler.
    typeset -g POWERLEVEL9K_MULTILINE_FIRST_PROMPT_GAP_FOREGROUND=242
    # Add a space between the end of left prompt and the filler.
    typeset -g POWERLEVEL9K_LEFT_PROMPT_LAST_SEGMENT_END_SYMBOL=' '
    # Add a space between the filler and the start of right prompt.
    typeset -g POWERLEVEL9K_RIGHT_PROMPT_FIRST_SEGMENT_START_SYMBOL=' '
    # Start filler from the edge of the screen if there are no left segments on the first line.
    typeset -g POWERLEVEL9K_EMPTY_LINE_LEFT_PROMPT_FIRST_SEGMENT_END_SYMBOL='%{%}'
    # End filler on the edge of the screen if there are no right segments on the first line.
    typeset -g POWERLEVEL9K_EMPTY_LINE_RIGHT_PROMPT_FIRST_SEGMENT_START_SYMBOL='%{%}'
  fi

  #################################[ os_icon: os identifier ]##################################
  # OS identifier color.
  typeset -g POWERLEVEL9K_OS_ICON_FOREGROUND=
  # Custom icon.
  # typeset -g POWERLEVEL9K_OS_ICON_CONTENT_EXPANSION='⭐'

  ################################[ prompt_char: prompt symbol ]################################
  # Green prompt symbol if the last command succeeded.
  typeset -g POWERLEVEL9K_PROMPT_CHAR_OK_{VIINS,VICMD,VIVIS,VIOWR}_FOREGROUND=76
  # Red prompt symbol if the last command failed.
  typeset -g POWERLEVEL9K_PROMPT_CHAR_ERROR_{VIINS,VICMD,VIVIS,VIOWR}_FOREGROUND=196
  # Default prompt symbol.
  typeset -g POWERLEVEL9K_PROMPT_CHAR_{OK,ERROR}_VIINS_CONTENT_EXPANSION='λ'
  # Prompt symbol in command vi mode.
  typeset -g POWERLEVEL9K_PROMPT_CHAR_{OK,ERROR}_VICMD_CONTENT_EXPANSION='N'
  # Prompt symbol in visual vi mode.
  typeset -g POWERLEVEL9K_PROMPT_CHAR_{OK,ERROR}_VIVIS_CONTENT_EXPANSION='V'
  # Prompt symbol in overwrite vi mode.
  typeset -g POWERLEVEL9K_PROMPT_CHAR_{OK,ERROR}_VIOWR_CONTENT_EXPANSION='O'
  typeset -g POWERLEVEL9K_PROMPT_CHAR_OVERWRITE_STATE=true
  # No line terminator if prompt_char is the last segment.
  typeset -g POWERLEVEL9K_PROMPT_CHAR_LEFT_PROMPT_LAST_SEGMENT_END_SYMBOL=''
  # No line introducer if prompt_char is the first segment.
  typeset -g POWERLEVEL9K_PROMPT_CHAR_LEFT_PROMPT_FIRST_SEGMENT_START_SYMBOL=

  ##################################[ dir: current directory ]##################################
  # Default current directory color.
  typeset -g POWERLEVEL9K_DIR_FOREGROUND=4
  # If directory is too long, shorten some of its segments to the shortest possible unique
  # prefix. The shortened directory can be tab-completed to the original.
  typeset -g POWERLEVEL9K_SHORTEN_STRATEGY=truncate_to_unique
  # Replace removed segment suffixes with this symbol.
  typeset -g POWERLEVEL9K_SHORTEN_DELIMITER=
  # Color of the shortened directory segments.
  typeset -g POWERLEVEL9K_DIR_SHORTENED_FOREGROUND=39
  # Color of the anchor directory segments. Anchor segments are never shortened. The first
  # segment is always an anchor.
  typeset -g POWERLEVEL9K_DIR_ANCHOR_FOREGROUND=4
  # Display anchor directory segments in bold.
  typeset -g POWERLEVEL9K_DIR_ANCHOR_BOLD=true
  # Don't shorten directories that contain any of these files. They are anchors.
  local anchor_files=(
    .bzr
    .git
    .hg
    # .node-version
    # .python-version
    # .go-version
    # .ruby-version
    # .lua-version
    # .java-version
    # .perl-version
    # .php-version
    # .tool-version
    # CVS
    # Cargo.toml
    # composer.json
    # go.mod
    # package.json
    # stack.yaml
  )
  typeset -g POWERLEVEL9K_SHORTEN_FOLDER_MARKER="(${(j:|:)anchor_files})"
  # If set to "first" ("last"), remove everything before the first (last) subdirectory that contains
  # files matching $POWERLEVEL9K_SHORTEN_FOLDER_MARKER. For example, when the current directory is
  # /foo/bar/git_repo/nested_git_repo/baz, prompt will display git_repo/nested_git_repo/baz (first)
  # or nested_git_repo/baz (last). This assumes that git_repo and nested_git_repo contain markers
  # and other directories don't.
  #
  # Optionally, "first" and "last" can be followed by ":<offset>" where <offset> is an integer.
  # This moves the truncation point to the right (positive offset) or to the left (negative offset)
  # relative to the marker. Plain "first" and "last" are equivalent to "first:0" and "last:0"
  # respectively.
  typeset -g POWERLEVEL9K_DIR_TRUNCATE_BEFORE_MARKER=false
  # Don't shorten this many last directory segments. They are anchors.
  typeset -g POWERLEVEL9K_SHORTEN_DIR_LENGTH=1
  # Shorten directory if it's longer than this even if there is space for it. The value can
  # be either absolute (e.g., '80') or a percentage of terminal width (e.g, '50%'). If empty,
  # directory will be shortened only when prompt doesn't fit or when other parameters demand it
  # (see POWERLEVEL9K_DIR_MIN_COMMAND_COLUMNS and POWERLEVEL9K_DIR_MIN_COMMAND_COLUMNS_PCT below).
  # If set to `0`, directory will always be shortened to its minimum length.
  typeset -g POWERLEVEL9K_DIR_MAX_LENGTH=80
  # When `dir` segment is on the last prompt line, try to shorten it enough to leave at least this
  # many columns for typing commands.
  typeset -g POWERLEVEL9K_DIR_MIN_COMMAND_COLUMNS=40
  # When `dir` segment is on the last prompt line, try to shorten it enough to leave at least
  # COLUMNS * POWERLEVEL9K_DIR_MIN_COMMAND_COLUMNS_PCT * 0.01 columns for typing commands.
  typeset -g POWERLEVEL9K_DIR_MIN_COMMAND_COLUMNS_PCT=50
  # If set to true, embed a hyperlink into the directory. Useful for quickly
  # opening a directory in the file manager simply by clicking the link.
  # Can also be handy when the directory is shortened, as it allows you to see
  # the full directory that was used in previous commands.
  typeset -g POWERLEVEL9K_DIR_HYPERLINK=false

  # Enable special styling for non-writable and non-existent directories. See POWERLEVEL9K_LOCK_ICON
  # and POWERLEVEL9K_DIR_CLASSES below.
  typeset -g POWERLEVEL9K_DIR_SHOW_WRITABLE=v3

  # The default icon shown next to non-writable and non-existent directories when
  # POWERLEVEL9K_DIR_SHOW_WRITABLE is set to v3.
  # typeset -g POWERLEVEL9K_LOCK_ICON='⭐'

  # POWERLEVEL9K_DIR_CLASSES allows you to specify custom icons and colors for different
  # directories. It must be an array with 3 * N elements. Each triplet consists of:
  #
  #   1. A pattern against which the current directory ($PWD) is matched. Matching is done with
  #      extended_glob option enabled.
  #   2. Directory class for the purpose of styling.
  #   3. An empty string.
  #
  # Triplets are tried in order. The first triplet whose pattern matches $PWD wins.
  #
  # If POWERLEVEL9K_DIR_SHOW_WRITABLE is set to v3, non-writable and non-existent directories
  # acquire class suffix _NOT_WRITABLE and NON_EXISTENT respectively.
  #
  # For example, given these settings:
  #
  #   typeset -g POWERLEVEL9K_DIR_CLASSES=(
  #     '~/work(|/*)'  WORK     ''
  #     '~(|/*)'       HOME     ''
  #     '*'            DEFAULT  '')
  #
  # Whenever the current directory is ~/work or a subdirectory of ~/work, it gets styled with one
  # of the following classes depending on its writability and existence: WORK, WORK_NOT_WRITABLE or
  # WORK_NON_EXISTENT.
  #
  # Simply assigning classes to directories doesn't have any visible effects. It merely gives you an
  # option to define custom colors and icons for different directory classes.
  #
  #   # Styling for WORK.
  #   typeset -g POWERLEVEL9K_DIR_WORK_VISUAL_IDENTIFIER_EXPANSION='⭐'
  #   typeset -g POWERLEVEL9K_DIR_WORK_FOREGROUND=31
  #   typeset -g POWERLEVEL9K_DIR_WORK_SHORTENED_FOREGROUND=103
  #   typeset -g POWERLEVEL9K_DIR_WORK_ANCHOR_FOREGROUND=39
  #
  #   # Styling for WORK_NOT_WRITABLE.
  #   typeset -g POWERLEVEL9K_DIR_WORK_NOT_WRITABLE_VISUAL_IDENTIFIER_EXPANSION='⭐'
  #   typeset -g POWERLEVEL9K_DIR_WORK_NOT_WRITABLE_FOREGROUND=31
  #   typeset -g POWERLEVEL9K_DIR_WORK_NOT_WRITABLE_SHORTENED_FOREGROUND=103
  #   typeset -g POWERLEVEL9K_DIR_WORK_NOT_WRITABLE_ANCHOR_FOREGROUND=39
  #
  #   # Styling for WORK_NON_EXISTENT.
  #   typeset -g POWERLEVEL9K_DIR_WORK_NON_EXISTENT_VISUAL_IDENTIFIER_EXPANSION='⭐'
  #   typeset -g POWERLEVEL9K_DIR_WORK_NON_EXISTENT_FOREGROUND=31
  #   typeset -g POWERLEVEL9K_DIR_WORK_NON_EXISTENT_SHORTENED_FOREGROUND=103
  #   typeset -g POWERLEVEL9K_DIR_WORK_NON_EXISTENT_ANCHOR_FOREGROUND=39
  #
  # If a styling parameter isn't explicitly defined for some class, it falls back to the classless
  # parameter. For example, if POWERLEVEL9K_DIR_WORK_NOT_WRITABLE_FOREGROUND is not set, it falls
  # back to POWERLEVEL9K_DIR_FOREGROUND.
  #
  typeset -g POWERLEVEL9K_DIR_CLASSES=()

  # Custom prefix.
  # typeset -g POWERLEVEL9K_DIR_PREFIX='%fin '

  #####################################[ vcs: git status ]######################################
  # Branch icon. Set this parameter to '\uF126 ' for the popular Powerline branch icon.
  typeset -g POWERLEVEL9K_VCS_BRANCH_ICON=

  # Untracked files icon. It's really a question mark, your font isn't broken.
  # Change the value of this parameter to show a different icon.
  typeset -g POWERLEVEL9K_VCS_UNTRACKED_ICON='?'

  # Formatter for Git status.
  #
  # Example output: master wip ⇣42⇡42 *42 merge ~42 +42 !42 ?42.
  #
  # You can edit the function to customize how Git status looks.
  #
  # VCS_STATUS_* parameters are set by gitstatus plugin. See reference:
  # https://github.com/romkatv/gitstatus/blob/master/gitstatus.plugin.zsh.
  function my_git_formatter() {
    emulate -L zsh

    if [[ -n $P9K_CONTENT ]]; then
      # If P9K_CONTENT is not empty, use it. It's either "loading" or from vcs_info (not from
      # gitstatus plugin). VCS_STATUS_* parameters are not available in this case.
      typeset -g my_git_format=$P9K_CONTENT
      return
    fi

    if (( $1 )); then
      # Styling for up-to-date Git status.
      local       meta='%f'     # default foreground
      local      clean='%2F'    # green foreground
      local   modified='%1F'    # yellow foreground
      local  untracked='%5F'    # blue foreground
      local conflicted='%13F'  # red foreground
    else
      # Styling for incomplete and stale Git status.
      local       meta='%244F'  # grey foreground
      local      clean='%244F'  # grey foreground
      local   modified='%244F'  # grey foreground
      local  untracked='%244F'  # grey foreground
      local conflicted='%244F'  # grey foreground
    fi

    local res

    if [[ -n $VCS_STATUS_LOCAL_BRANCH ]]; then
      local branch=${(V)VCS_STATUS_LOCAL_BRANCH}
      # If local branch name is at most 32 characters long, show it in full.
      # Otherwise show the first 12 … the last 12.
      # Tip: To always show local branch name in full without truncation, delete the next line.
      (( $#branch > 32 )) && branch[13,-13]="…"  # <-- this line
      res+="${clean}${(g::)POWERLEVEL9K_VCS_BRANCH_ICON}${branch//\%/%%}"
    fi

    if [[ -n $VCS_STATUS_TAG
          # Show tag only if not on a branch.
          # Tip: To always show tag, delete the next line.
          && -z $VCS_STATUS_LOCAL_BRANCH  # <-- this line
        ]]; then
      local tag=${(V)VCS_STATUS_TAG}
      # If tag name is at most 32 characters long, show it in full.
      # Otherwise show the first 12 … the last 12.
      # Tip: To always show tag name in full without truncation, delete the next line.
      (( $#tag > 32 )) && tag[13,-13]="…"  # <-- this line
      res+="${meta}#${clean}${tag//\%/%%}"
    fi

    # Display the current Git commit if there is no branch and no tag.
    # Tip: To always display the current Git commit, delete the next line.
    [[ -z $VCS_STATUS_LOCAL_BRANCH && -z $VCS_STATUS_TAG ]] &&  # <-- this line
      res+="${meta}@${clean}${VCS_STATUS_COMMIT[1,8]}"

    # Show tracking branch name if it differs from local branch.
    if [[ -n ${VCS_STATUS_REMOTE_BRANCH:#$VCS_STATUS_LOCAL_BRANCH} ]]; then
      res+="${meta}:${clean}${(V)VCS_STATUS_REMOTE_BRANCH//\%/%%}"
    fi

    # Display "wip" if the latest commit's summary contains "wip" or "WIP".
    if [[ $VCS_STATUS_COMMIT_SUMMARY == (|*[^[:alnum:]])(wip|WIP)(|[^[:alnum:]]*) ]]; then
      res+=" ${modified}wip"
    fi

    # ⇣42 if behind the remote.
    (( VCS_STATUS_COMMITS_BEHIND )) && res+=" ${clean}⇣${VCS_STATUS_COMMITS_BEHIND}"
    # ⇡42 if ahead of the remote; no leading space if also behind the remote: ⇣42⇡42.
    (( VCS_STATUS_COMMITS_AHEAD && !VCS_STATUS_COMMITS_BEHIND )) && res+=" "
    (( VCS_STATUS_COMMITS_AHEAD  )) && res+="${clean}⇡${VCS_STATUS_COMMITS_AHEAD}"
    # ⇠42 if behind the push remote.
    (( VCS_STATUS_PUSH_COMMITS_BEHIND )) && res+=" ${clean}⇠${VCS_STATUS_PUSH_COMMITS_BEHIND}"
    (( VCS_STATUS_PUSH_COMMITS_AHEAD && !VCS_STATUS_PUSH_COMMITS_BEHIND )) && res+=" "
    # ⇢42 if ahead of the push remote; no leading space if also behind: ⇠42⇢42.
    (( VCS_STATUS_PUSH_COMMITS_AHEAD  )) && res+="${clean}⇢${VCS_STATUS_PUSH_COMMITS_AHEAD}"
    # *42 if have stashes.
    (( VCS_STATUS_STASHES        )) && res+=" ${clean}*${VCS_STATUS_STASHES}"
    # 'merge' if the repo is in an unusual state.
    [[ -n $VCS_STATUS_ACTION     ]] && res+=" ${conflicted}${VCS_STATUS_ACTION}"
    # ~42 if have merge conflicts.
    (( VCS_STATUS_NUM_CONFLICTED )) && res+=" ${conflicted}~${VCS_STATUS_NUM_CONFLICTED}"
    # +42 if have staged changes.
    (( VCS_STATUS_NUM_STAGED     )) && res+=" ${modified}+${VCS_STATUS_NUM_STAGED}"
    # !42 if have unstaged changes.
    (( VCS_STATUS_NUM_UNSTAGED   )) && res+=" ${modified}!${VCS_STATUS_NUM_UNSTAGED}"
    # ?42 if have untracked files. It's really a question mark, your font isn't broken.
    # See POWERLEVEL9K_VCS_UNTRACKED_ICON above if you want to use a different icon.
    # Remove the next line if you don't want to see untracked files at all.
    (( VCS_STATUS_NUM_UNTRACKED  )) && res+=" ${untracked}${(g::)POWERLEVEL9K_VCS_UNTRACKED_ICON}${VCS_STATUS_NUM_UNTRACKED}"
    # "─" if the number of unstaged files is unknown. This can happen due to
    # POWERLEVEL9K_VCS_MAX_INDEX_SIZE_DIRTY (see below) being set to a non-negative number lower
    # than the number of files in the Git index, or due to bash.showDirtyState being set to false
    # in the repository config. The number of staged and untracked files may also be unknown
    # in this case.
    (( VCS_STATUS_HAS_UNSTAGED == -1 )) && res+=" ${modified}─"

    typeset -g my_git_format=$res
  }
  functions -M my_git_formatter 2>/dev/null

  # Don't count the number of unstaged, untracked and conflicted files in Git repositories with
  # more than this many files in the index. Negative value means infinity.
  #
  # If you are working in Git repositories with tens of millions of files and seeing performance
  # sagging, try setting POWERLEVEL9K_VCS_MAX_INDEX_SIZE_DIRTY to a number lower than the output
  # of `git ls-files | wc -l`. Alternatively, add `bash.showDirtyState = false` to the repository's
  # config: `git config bash.showDirtyState false`.
  typeset -g POWERLEVEL9K_VCS_MAX_INDEX_SIZE_DIRTY=-1

  # Don't show Git status in prompt for repositories whose workdir matches this pattern.
  # For example, if set to '~', the Git repository at $HOME/.git will be ignored.
  # Multiple patterns can be combined with '|': '~(|/foo)|/bar/baz/*'.
  typeset -g POWERLEVEL9K_VCS_DISABLED_WORKDIR_PATTERN='~'

  # Disable the default Git status formatting.
  typeset -g POWERLEVEL9K_VCS_DISABLE_GITSTATUS_FORMATTING=true
  # Install our own Git status formatter.
  typeset -g POWERLEVEL9K_VCS_CONTENT_EXPANSION='${$((my_git_formatter(1)))+${my_git_format}}'
  typeset -g POWERLEVEL9K_VCS_LOADING_CONTENT_EXPANSION='${$((my_git_formatter(0)))+${my_git_format}}'
  # Enable counters for staged, unstaged, etc.
  typeset -g POWERLEVEL9K_VCS_{STAGED,UNSTAGED,UNTRACKED,CONFLICTED,COMMITS_AHEAD,COMMITS_BEHIND}_MAX_NUM=-1

  # Icon color.
  typeset -g POWERLEVEL9K_VCS_VISUAL_IDENTIFIER_COLOR=76
  typeset -g POWERLEVEL9K_VCS_LOADING_VISUAL_IDENTIFIER_COLOR=244
  # Custom icon.
  typeset -g POWERLEVEL9K_VCS_VISUAL_IDENTIFIER_EXPANSION=
  # Custom prefix.
  # typeset -g POWERLEVEL9K_VCS_PREFIX='%fon '

  # Show status of repositories of these types. You can add svn and/or hg if you are
  # using them. If you do, your prompt may become slow even when your current directory
  # isn't in an svn or hg reposotiry.
  typeset -g POWERLEVEL9K_VCS_BACKENDS=(git)

  # These settings are used for repositories other than Git or when gitstatusd fails and
  # Powerlevel10k has to fall back to using vcs_info.
  typeset -g POWERLEVEL9K_VCS_CLEAN_FOREGROUND=76
  typeset -g POWERLEVEL9K_VCS_UNTRACKED_FOREGROUND=76
  typeset -g POWERLEVEL9K_VCS_MODIFIED_FOREGROUND=178

  ##########################[ status: exit code of the last command ]###########################
  # Enable OK_PIPE, ERROR_PIPE and ERROR_SIGNAL status states to allow us to enable, disable and
  # style them independently from the regular OK and ERROR state.
  typeset -g POWERLEVEL9K_STATUS_EXTENDED_STATES=true

  # Status on success. No content, just an icon. No need to show it if prompt_char is enabled as
  # it will signify success by turning green.
  typeset -g POWERLEVEL9K_STATUS_OK=false
  typeset -g POWERLEVEL9K_STATUS_OK_FOREGROUND=1
  typeset -g POWERLEVEL9K_STATUS_OK_VISUAL_IDENTIFIER_EXPANSION='✔'

  # Status when some part of a pipe command fails but the overall exit status is zero. It may look
  # like this: 1|0.
  typeset -g POWERLEVEL9K_STATUS_OK_PIPE=true
  typeset -g POWERLEVEL9K_STATUS_OK_PIPE_FOREGROUND=4
  typeset -g POWERLEVEL9K_STATUS_OK_PIPE_VISUAL_IDENTIFIER_EXPANSION='✔'

  # Status when it's just an error code (e.g., '1'). No need to show it if prompt_char is enabled as
  # it will signify error by turning red.
  typeset -g POWERLEVEL9K_STATUS_ERROR=false
  typeset -g POWERLEVEL9K_STATUS_ERROR_FOREGROUND=13
  typeset -g POWERLEVEL9K_STATUS_ERROR_VISUAL_IDENTIFIER_EXPANSION='✘'

  # Status when the last command was terminated by a signal.
  typeset -g POWERLEVEL9K_STATUS_ERROR_SIGNAL=true
  typeset -g POWERLEVEL9K_STATUS_ERROR_SIGNAL_FOREGROUND=13
  # Use terse signal names: "INT" instead of "SIGINT(2)".
  typeset -g POWERLEVEL9K_STATUS_VERBOSE_SIGNAME=false
  typeset -g POWERLEVEL9K_STATUS_ERROR_SIGNAL_VISUAL_IDENTIFIER_EXPANSION='✘'

  # Status when some part of a pipe command fails and the overall exit status is also non-zero.
  # It may look like this: 1|0.
  typeset -g POWERLEVEL9K_STATUS_ERROR_PIPE=true
  typeset -g POWERLEVEL9K_STATUS_ERROR_PIPE_FOREGROUND=160
  typeset -g POWERLEVEL9K_STATUS_ERROR_PIPE_VISUAL_IDENTIFIER_EXPANSION='✘'

  ###################[ command_execution_time: duration of the last command ]###################
  # Show duration of the last command if takes at least this many seconds.
  typeset -g POWERLEVEL9K_COMMAND_EXECUTION_TIME_THRESHOLD=3
  # Show this many fractional digits. Zero means round to seconds.
  typeset -g POWERLEVEL9K_COMMAND_EXECUTION_TIME_PRECISION=0
  # Execution time color.
  typeset -g POWERLEVEL9K_COMMAND_EXECUTION_TIME_FOREGROUND=246
  # Duration format: 1d 2h 3m 4s.
  typeset -g POWERLEVEL9K_COMMAND_EXECUTION_TIME_FORMAT='d h m s'
  # Custom icon.
  typeset -g POWERLEVEL9K_COMMAND_EXECUTION_TIME_VISUAL_IDENTIFIER_EXPANSION=
  # Custom prefix.
  # typeset -g POWERLEVEL9K_COMMAND_EXECUTION_TIME_PREFIX='%ftook '

  #######################[ background_jobs: presence of background jobs ]#######################
  # Don't show the number of background jobs.
  typeset -g POWERLEVEL9K_BACKGROUND_JOBS_VERBOSE=false
  # Background jobs color.
  typeset -g POWERLEVEL9K_BACKGROUND_JOBS_FOREGROUND=70
  # Custom icon.
  # typeset -g POWERLEVEL9K_BACKGROUND_JOBS_VISUAL_IDENTIFIER_EXPANSION='⭐'

  #######################[ direnv: direnv status (https://direnv.net/) ]########################
  # Direnv color.
  typeset -g POWERLEVEL9K_DIRENV_FOREGROUND=178
  # Custom icon.
  # typeset -g POWERLEVEL9K_DIRENV_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ##########[ nordvpn: nordvpn connection status, linux only (https://nordvpn.com/) ]###########
  # NordVPN connection indicator color.
  typeset -g POWERLEVEL9K_NORDVPN_FOREGROUND=39
  # Hide NordVPN connection indicator when not connected.
  typeset -g POWERLEVEL9K_NORDVPN_{DISCONNECTED,CONNECTING,DISCONNECTING}_CONTENT_EXPANSION=
  typeset -g POWERLEVEL9K_NORDVPN_{DISCONNECTED,CONNECTING,DISCONNECTING}_VISUAL_IDENTIFIER_EXPANSION=
  # Custom icon.
  # typeset -g POWERLEVEL9K_NORDVPN_VISUAL_IDENTIFIER_EXPANSION='⭐'

  #################[ ranger: ranger shell (https://github.com/ranger/ranger) ]##################
  # Ranger shell color.
  typeset -g POWERLEVEL9K_RANGER_FOREGROUND=178
  # Custom icon.
  # typeset -g POWERLEVEL9K_RANGER_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ######################[ nnn: nnn shell (https://github.com/jarun/nnn) ]#######################
  # Nnn shell color.
  typeset -g POWERLEVEL9K_NNN_FOREGROUND=72
  # Custom icon.
  # typeset -g POWERLEVEL9K_NNN_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ##################[ xplr: xplr shell (https://github.com/sayanarijit/xplr) ]##################
  # xplr shell color.
  typeset -g POWERLEVEL9K_XPLR_FOREGROUND=72
  # Custom icon.
  # typeset -g POWERLEVEL9K_XPLR_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ###########################[ vim_shell: vim shell indicator (:sh) ]###########################
  # Vim shell indicator color.
  typeset -g POWERLEVEL9K_VIM_SHELL_FOREGROUND=34
  # Custom icon.
  # typeset -g POWERLEVEL9K_VIM_SHELL_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ######[ midnight_commander: midnight commander shell (https://midnight-commander.org/) ]######
  # Midnight Commander shell color.
  typeset -g POWERLEVEL9K_MIDNIGHT_COMMANDER_FOREGROUND=178
  # Custom icon.
  # typeset -g POWERLEVEL9K_MIDNIGHT_COMMANDER_VISUAL_IDENTIFIER_EXPANSION='⭐'

  #[ nix_shell: nix shell (https://nixos.org/nixos/nix-pills/developing-with-nix-shell.html) ]##
  # Nix shell color.
  typeset -g POWERLEVEL9K_NIX_SHELL_FOREGROUND=74

  # Tip: If you want to see just the icon without "pure" and "impure", uncomment the next line.
  # typeset -g POWERLEVEL9K_NIX_SHELL_CONTENT_EXPANSION=

  # Custom icon.
  # typeset -g POWERLEVEL9K_NIX_SHELL_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ##################################[ disk_usage: disk usage ]##################################
  # Colors for different levels of disk usage.
  typeset -g POWERLEVEL9K_DISK_USAGE_NORMAL_FOREGROUND=35
  typeset -g POWERLEVEL9K_DISK_USAGE_WARNING_FOREGROUND=220
  typeset -g POWERLEVEL9K_DISK_USAGE_CRITICAL_FOREGROUND=160
  # Thresholds for different levels of disk usage (percentage points).
  typeset -g POWERLEVEL9K_DISK_USAGE_WARNING_LEVEL=90
  typeset -g POWERLEVEL9K_DISK_USAGE_CRITICAL_LEVEL=95
  # If set to true, hide disk usage when below $POWERLEVEL9K_DISK_USAGE_WARNING_LEVEL percent.
  typeset -g POWERLEVEL9K_DISK_USAGE_ONLY_WARNING=false
  # Custom icon.
  # typeset -g POWERLEVEL9K_DISK_USAGE_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ######################################[ ram: free RAM ]#######################################
  # RAM color.
  typeset -g POWERLEVEL9K_RAM_FOREGROUND=66
  # Custom icon.
  # typeset -g POWERLEVEL9K_RAM_VISUAL_IDENTIFIER_EXPANSION='⭐'

  #####################################[ swap: used swap ]######################################
  # Swap color.
  typeset -g POWERLEVEL9K_SWAP_FOREGROUND=96
  # Custom icon.
  # typeset -g POWERLEVEL9K_SWAP_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ######################################[ load: CPU load ]######################################
  # Show average CPU load over this many last minutes. Valid values are 1, 5 and 15.
  typeset -g POWERLEVEL9K_LOAD_WHICH=5
  # Load color when load is under 50%.
  typeset -g POWERLEVEL9K_LOAD_NORMAL_FOREGROUND=66
  # Load color when load is between 50% and 70%.
  typeset -g POWERLEVEL9K_LOAD_WARNING_FOREGROUND=178
  # Load color when load is over 70%.
  typeset -g POWERLEVEL9K_LOAD_CRITICAL_FOREGROUND=166
  # Custom icon.
  # typeset -g POWERLEVEL9K_LOAD_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ###########[ timewarrior: timewarrior tracking status (https://timewarrior.net/) ]############
  # Timewarrior color.
  typeset -g POWERLEVEL9K_TIMEWARRIOR_FOREGROUND=110
  # If the tracked task is longer than 24 characters, truncate and append "…".
  # Tip: To always display tasks without truncation, delete the following parameter.
  # Tip: To hide task names and display just the icon when time tracking is enabled, set the
  # value of the following parameter to "".
  typeset -g POWERLEVEL9K_TIMEWARRIOR_CONTENT_EXPANSION='${P9K_CONTENT:0:24}${${P9K_CONTENT:24}:+…}'

  # Custom icon.
  # typeset -g POWERLEVEL9K_TIMEWARRIOR_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ##############[ taskwarrior: taskwarrior task count (https://taskwarrior.org/) ]##############
  # Taskwarrior color.
  typeset -g POWERLEVEL9K_TASKWARRIOR_FOREGROUND=74

  # Taskwarrior segment format. The following parameters are available within the expansion.
  #
  # - P9K_TASKWARRIOR_PENDING_COUNT   The number of pending tasks: `task +PENDING count`.
  # - P9K_TASKWARRIOR_OVERDUE_COUNT   The number of overdue tasks: `task +OVERDUE count`.
  #
  # Zero values are represented as empty parameters.
  #
  # The default format:
  #
  #   '${P9K_TASKWARRIOR_OVERDUE_COUNT:+"!$P9K_TASKWARRIOR_OVERDUE_COUNT/"}$P9K_TASKWARRIOR_PENDING_COUNT'
  #
  # typeset -g POWERLEVEL9K_TASKWARRIOR_CONTENT_EXPANSION='$P9K_TASKWARRIOR_PENDING_COUNT'

  # Custom icon.
  # typeset -g POWERLEVEL9K_TASKWARRIOR_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ##################################[ context: user@hostname ]##################################
  # Context color when running with privileges.
  typeset -g POWERLEVEL9K_CONTEXT_ROOT_FOREGROUND=178
  # Context color in SSH without privileges.
  typeset -g POWERLEVEL9K_CONTEXT_{REMOTE,REMOTE_SUDO}_FOREGROUND=180
  # Default context color (no privileges, no SSH).
  typeset -g POWERLEVEL9K_CONTEXT_FOREGROUND=180

  # Context format when running with privileges: bold user@hostname.
  typeset -g POWERLEVEL9K_CONTEXT_ROOT_TEMPLATE='%B%n@%2m'
  # Context format when in SSH without privileges: user@hostname.
  typeset -g POWERLEVEL9K_CONTEXT_{REMOTE,REMOTE_SUDO}_TEMPLATE='%n@%2m'
  # Default context format (no privileges, no SSH): user@hostname.
  typeset -g POWERLEVEL9K_CONTEXT_TEMPLATE='%n@%2m'

  # Don't show context unless running with privileges or in SSH.
  # Tip: Remove the next line to always show context.
  typeset -g POWERLEVEL9K_CONTEXT_{DEFAULT,SUDO}_{CONTENT,VISUAL_IDENTIFIER}_EXPANSION=

  # Custom icon.
  # typeset -g POWERLEVEL9K_CONTEXT_VISUAL_IDENTIFIER_EXPANSION='⭐'
  # Custom prefix.
  # typeset -g POWERLEVEL9K_CONTEXT_PREFIX='%fwith '

  ###[ virtualenv: python virtual environment (https://docs.python.org/3/library/venv.html) ]###
  # Python virtual environment color.
  typeset -g POWERLEVEL9K_VIRTUALENV_FOREGROUND=37
  # Don't show Python version next to the virtual environment name.
  typeset -g POWERLEVEL9K_VIRTUALENV_SHOW_PYTHON_VERSION=false
  # If set to "false", won't show virtualenv if pyenv is already shown.
  # If set to "if-different", won't show virtualenv if it's the same as pyenv.
  typeset -g POWERLEVEL9K_VIRTUALENV_SHOW_WITH_PYENV=false
  # Separate environment name from Python version only with a space.
  typeset -g POWERLEVEL9K_VIRTUALENV_{LEFT,RIGHT}_DELIMITER=
  # Custom icon.
  typeset -g POWERLEVEL9K_VIRTUALENV_VISUAL_IDENTIFIER_EXPANSION='🐍'

  #####################[ anaconda: conda environment (https://conda.io/) ]######################
  # Anaconda environment color.
  typeset -g POWERLEVEL9K_ANACONDA_FOREGROUND=37

  # Anaconda segment format. The following parameters are available within the expansion.
  #
  # - CONDA_PREFIX                 Absolute path to the active Anaconda/Miniconda environment.
  # - CONDA_DEFAULT_ENV            Name of the active Anaconda/Miniconda environment.
  # - CONDA_PROMPT_MODIFIER        Configurable prompt modifier (see below).
  # - P9K_ANACONDA_PYTHON_VERSION  Current python version (python --version).
  #
  # CONDA_PROMPT_MODIFIER can be configured with the following command:
  #
  #   conda config --set env_prompt '({default_env}) '
  #
  # The last argument is a Python format string that can use the following variables:
  #
  # - prefix       The same as CONDA_PREFIX.
  # - default_env  The same as CONDA_DEFAULT_ENV.
  # - name         The last segment of CONDA_PREFIX.
  # - stacked_env  Comma-separated list of names in the environment stack. The first element is
  #                always the same as default_env.
  #
  # Note: '({default_env}) ' is the default value of env_prompt.
  #
  # The default value of POWERLEVEL9K_ANACONDA_CONTENT_EXPANSION expands to $CONDA_PROMPT_MODIFIER
  # without the surrounding parentheses, or to the last path component of CONDA_PREFIX if the former
  # is empty.
  typeset -g POWERLEVEL9K_ANACONDA_CONTENT_EXPANSION='${${${${CONDA_PROMPT_MODIFIER#\(}% }%\)}:-${CONDA_PREFIX:t}}'

  # Custom icon.
  typeset -g POWERLEVEL9K_ANACONDA_VISUAL_IDENTIFIER_EXPANSION='🐍'

  ################[ pyenv: python environment (https://github.com/pyenv/pyenv) ]################
  # Pyenv color.
  typeset -g POWERLEVEL9K_PYENV_FOREGROUND=37
  # Hide python version if it doesn't come from one of these sources.
  typeset -g POWERLEVEL9K_PYENV_SOURCES=(shell local global)
  # If set to false, hide python version if it's the same as global:
  # $(pyenv version-name) == $(pyenv global).
  typeset -g POWERLEVEL9K_PYENV_PROMPT_ALWAYS_SHOW=false
  # If set to false, hide python version if it's equal to "system".
  typeset -g POWERLEVEL9K_PYENV_SHOW_SYSTEM=true

  # Pyenv segment format. The following parameters are available within the expansion.
  #
  # - P9K_CONTENT                Current pyenv environment (pyenv version-name).
  # - P9K_PYENV_PYTHON_VERSION   Current python version (python --version).
  #
  # The default format has the following logic:
  #
  # 1. Display just "$P9K_CONTENT" if it's equal to "$P9K_PYENV_PYTHON_VERSION" or
  #    starts with "$P9K_PYENV_PYTHON_VERSION/".
  # 2. Otherwise display "$P9K_CONTENT $P9K_PYENV_PYTHON_VERSION".
  typeset -g POWERLEVEL9K_PYENV_CONTENT_EXPANSION='${P9K_CONTENT}${${P9K_CONTENT:#$P9K_PYENV_PYTHON_VERSION(|/*)}:+ $P9K_PYENV_PYTHON_VERSION}'

  # Custom icon.
  typeset -g POWERLEVEL9K_PYENV_VISUAL_IDENTIFIER_EXPANSION='🐍'

  ################[ goenv: go environment (https://github.com/syndbg/goenv) ]################
  # Goenv color.
  typeset -g POWERLEVEL9K_GOENV_FOREGROUND=37
  # Hide go version if it doesn't come from one of these sources.
  typeset -g POWERLEVEL9K_GOENV_SOURCES=(shell local global)
  # If set to false, hide go version if it's the same as global:
  # $(goenv version-name) == $(goenv global).
  typeset -g POWERLEVEL9K_GOENV_PROMPT_ALWAYS_SHOW=false
  # If set to false, hide go version if it's equal to "system".
  typeset -g POWERLEVEL9K_GOENV_SHOW_SYSTEM=true
  # Custom icon.
  # typeset -g POWERLEVEL9K_GOENV_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ##########[ nodenv: node.js version from nodenv (https://github.com/nodenv/nodenv) ]##########
  # Nodenv color.
  typeset -g POWERLEVEL9K_NODENV_FOREGROUND=70
  # Hide node version if it doesn't come from one of these sources.
  typeset -g POWERLEVEL9K_NODENV_SOURCES=(shell local global)
  # If set to false, hide node version if it's the same as global:
  # $(nodenv version-name) == $(nodenv global).
  typeset -g POWERLEVEL9K_NODENV_PROMPT_ALWAYS_SHOW=false
  # If set to false, hide node version if it's equal to "system".
  typeset -g POWERLEVEL9K_NODENV_SHOW_SYSTEM=true
  # Custom icon.
  # typeset -g POWERLEVEL9K_NODENV_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ##############[ nvm: node.js version from nvm (https://github.com/nvm-sh/nvm) ]###############
  # Nvm color.
  typeset -g POWERLEVEL9K_NVM_FOREGROUND=70
  # Custom icon.
  # typeset -g POWERLEVEL9K_NVM_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ############[ nodeenv: node.js environment (https://github.com/ekalinin/nodeenv) ]############
  # Nodeenv color.
  typeset -g POWERLEVEL9K_NODEENV_FOREGROUND=70
  # Don't show Node version next to the environment name.
  typeset -g POWERLEVEL9K_NODEENV_SHOW_NODE_VERSION=false
  # Separate environment name from Node version only with a space.
  typeset -g POWERLEVEL9K_NODEENV_{LEFT,RIGHT}_DELIMITER=
  # Custom icon.
  # typeset -g POWERLEVEL9K_NODEENV_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ##############################[ node_version: node.js version ]###############################
  # Node version color.
  typeset -g POWERLEVEL9K_NODE_VERSION_FOREGROUND=70
  # Show node version only when in a directory tree containing package.json.
  typeset -g POWERLEVEL9K_NODE_VERSION_PROJECT_ONLY=true
  # Custom icon.
  # typeset -g POWERLEVEL9K_NODE_VERSION_VISUAL_IDENTIFIER_EXPANSION='⭐'

  #######################[ go_version: go version (https://golang.org) ]########################
  # Go version color.
  typeset -g POWERLEVEL9K_GO_VERSION_FOREGROUND=37
  # Show go version only when in a go project subdirectory.
  typeset -g POWERLEVEL9K_GO_VERSION_PROJECT_ONLY=true
  # Custom icon.
  # typeset -g POWERLEVEL9K_GO_VERSION_VISUAL_IDENTIFIER_EXPANSION='⭐'

  #################[ rust_version: rustc version (https://www.rust-lang.org) ]##################
  # Rust version color.
  typeset -g POWERLEVEL9K_RUST_VERSION_FOREGROUND=37
  # Show rust version only when in a rust project subdirectory.
  typeset -g POWERLEVEL9K_RUST_VERSION_PROJECT_ONLY=true
  # Custom icon.
  # typeset -g POWERLEVEL9K_RUST_VERSION_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ###############[ dotnet_version: .NET version (https://dotnet.microsoft.com) ]################
  # .NET version color.
  typeset -g POWERLEVEL9K_DOTNET_VERSION_FOREGROUND=134
  # Show .NET version only when in a .NET project subdirectory.
  typeset -g POWERLEVEL9K_DOTNET_VERSION_PROJECT_ONLY=true
  # Custom icon.
  # typeset -g POWERLEVEL9K_DOTNET_VERSION_VISUAL_IDENTIFIER_EXPANSION='⭐'

  #####################[ php_version: php version (https://www.php.net/) ]######################
  # PHP version color.
  typeset -g POWERLEVEL9K_PHP_VERSION_FOREGROUND=99
  # Show PHP version only when in a PHP project subdirectory.
  typeset -g POWERLEVEL9K_PHP_VERSION_PROJECT_ONLY=true
  # Custom icon.
  # typeset -g POWERLEVEL9K_PHP_VERSION_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ##########[ laravel_version: laravel php framework version (https://laravel.com/) ]###########
  # Laravel version color.
  typeset -g POWERLEVEL9K_LARAVEL_VERSION_FOREGROUND=161
  # Custom icon.
  # typeset -g POWERLEVEL9K_LARAVEL_VERSION_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ####################[ java_version: java version (https://www.java.com/) ]####################
  # Java version color.
  typeset -g POWERLEVEL9K_JAVA_VERSION_FOREGROUND=32
  # Show java version only when in a java project subdirectory.
  typeset -g POWERLEVEL9K_JAVA_VERSION_PROJECT_ONLY=true
  # Show brief version.
  typeset -g POWERLEVEL9K_JAVA_VERSION_FULL=false
  # Custom icon.
  # typeset -g POWERLEVEL9K_JAVA_VERSION_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ###[ package: name@version from package.json (https://docs.npmjs.com/files/package.json) ]####
  # Package color.
  typeset -g POWERLEVEL9K_PACKAGE_FOREGROUND=117
  # Package format. The following parameters are available within the expansion.
  #
  # - P9K_PACKAGE_NAME     The value of `name` field in package.json.
  # - P9K_PACKAGE_VERSION  The value of `version` field in package.json.
  #
  # typeset -g POWERLEVEL9K_PACKAGE_CONTENT_EXPANSION='${P9K_PACKAGE_NAME//\%/%%}@${P9K_PACKAGE_VERSION//\%/%%}'
  # Custom icon.
  # typeset -g POWERLEVEL9K_PACKAGE_VISUAL_IDENTIFIER_EXPANSION='⭐'

  #############[ rbenv: ruby version from rbenv (https://github.com/rbenv/rbenv) ]##############
  # Rbenv color.
  typeset -g POWERLEVEL9K_RBENV_FOREGROUND=168
  # Hide ruby version if it doesn't come from one of these sources.
  typeset -g POWERLEVEL9K_RBENV_SOURCES=(shell local global)
  # If set to false, hide ruby version if it's the same as global:
  # $(rbenv version-name) == $(rbenv global).
  typeset -g POWERLEVEL9K_RBENV_PROMPT_ALWAYS_SHOW=false
  # If set to false, hide ruby version if it's equal to "system".
  typeset -g POWERLEVEL9K_RBENV_SHOW_SYSTEM=true
  # Custom icon.
  # typeset -g POWERLEVEL9K_RBENV_VISUAL_IDENTIFIER_EXPANSION='⭐'

  #######################[ rvm: ruby version from rvm (https://rvm.io) ]########################
  # Rvm color.
  typeset -g POWERLEVEL9K_RVM_FOREGROUND=168
  # Don't show @gemset at the end.
  typeset -g POWERLEVEL9K_RVM_SHOW_GEMSET=false
  # Don't show ruby- at the front.
  typeset -g POWERLEVEL9K_RVM_SHOW_PREFIX=false
  # Custom icon.
  # typeset -g POWERLEVEL9K_RVM_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ###########[ fvm: flutter version management (https://github.com/leoafarias/fvm) ]############
  # Fvm color.
  typeset -g POWERLEVEL9K_FVM_FOREGROUND=38
  # Custom icon.
  # typeset -g POWERLEVEL9K_FVM_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ##########[ luaenv: lua version from luaenv (https://github.com/cehoffman/luaenv) ]###########
  # Lua color.
  typeset -g POWERLEVEL9K_LUAENV_FOREGROUND=32
  # Hide lua version if it doesn't come from one of these sources.
  typeset -g POWERLEVEL9K_LUAENV_SOURCES=(shell local global)
  # If set to false, hide lua version if it's the same as global:
  # $(luaenv version-name) == $(luaenv global).
  typeset -g POWERLEVEL9K_LUAENV_PROMPT_ALWAYS_SHOW=false
  # If set to false, hide lua version if it's equal to "system".
  typeset -g POWERLEVEL9K_LUAENV_SHOW_SYSTEM=true
  # Custom icon.
  # typeset -g POWERLEVEL9K_LUAENV_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ###############[ jenv: java version from jenv (https://github.com/jenv/jenv) ]################
  # Java color.
  typeset -g POWERLEVEL9K_JENV_FOREGROUND=32
  # Hide java version if it doesn't come from one of these sources.
  typeset -g POWERLEVEL9K_JENV_SOURCES=(shell local global)
  # If set to false, hide java version if it's the same as global:
  # $(jenv version-name) == $(jenv global).
  typeset -g POWERLEVEL9K_JENV_PROMPT_ALWAYS_SHOW=false
  # If set to false, hide java version if it's equal to "system".
  typeset -g POWERLEVEL9K_JENV_SHOW_SYSTEM=true
  # Custom icon.
  # typeset -g POWERLEVEL9K_JENV_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ###########[ plenv: perl version from plenv (https://github.com/tokuhirom/plenv) ]############
  # Perl color.
  typeset -g POWERLEVEL9K_PLENV_FOREGROUND=67
  # Hide perl version if it doesn't come from one of these sources.
  typeset -g POWERLEVEL9K_PLENV_SOURCES=(shell local global)
  # If set to false, hide perl version if it's the same as global:
  # $(plenv version-name) == $(plenv global).
  typeset -g POWERLEVEL9K_PLENV_PROMPT_ALWAYS_SHOW=false
  # If set to false, hide perl version if it's equal to "system".
  typeset -g POWERLEVEL9K_PLENV_SHOW_SYSTEM=true
  # Custom icon.
  # typeset -g POWERLEVEL9K_PLENV_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ############[ phpenv: php version from phpenv (https://github.com/phpenv/phpenv) ]############
  # PHP color.
  typeset -g POWERLEVEL9K_PHPENV_FOREGROUND=99
  # Hide php version if it doesn't come from one of these sources.
  typeset -g POWERLEVEL9K_PHPENV_SOURCES=(shell local global)
  # If set to false, hide php version if it's the same as global:
  # $(phpenv version-name) == $(phpenv global).
  typeset -g POWERLEVEL9K_PHPENV_PROMPT_ALWAYS_SHOW=false
  # If set to false, hide php version if it's equal to "system".
  typeset -g POWERLEVEL9K_PHPENV_SHOW_SYSTEM=true
  # Custom icon.
  # typeset -g POWERLEVEL9K_PHPENV_VISUAL_IDENTIFIER_EXPANSION='⭐'

  #######[ scalaenv: scala version from scalaenv (https://github.com/scalaenv/scalaenv) ]#######
  # Scala color.
  typeset -g POWERLEVEL9K_SCALAENV_FOREGROUND=160
  # Hide scala version if it doesn't come from one of these sources.
  typeset -g POWERLEVEL9K_SCALAENV_SOURCES=(shell local global)
  # If set to false, hide scala version if it's the same as global:
  # $(scalaenv version-name) == $(scalaenv global).
  typeset -g POWERLEVEL9K_SCALAENV_PROMPT_ALWAYS_SHOW=false
  # If set to false, hide scala version if it's equal to "system".
  typeset -g POWERLEVEL9K_SCALAENV_SHOW_SYSTEM=true
  # Custom icon.
  # typeset -g POWERLEVEL9K_SCALAENV_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ##########[ haskell_stack: haskell version from stack (https://haskellstack.org/) ]###########
  # Haskell color.
  typeset -g POWERLEVEL9K_HASKELL_STACK_FOREGROUND=172
  # Hide haskell version if it doesn't come from one of these sources.
  #
  #   shell:  version is set by STACK_YAML
  #   local:  version is set by stack.yaml up the directory tree
  #   global: version is set by the implicit global project (~/.stack/global-project/stack.yaml)
  typeset -g POWERLEVEL9K_HASKELL_STACK_SOURCES=(shell local)
  # If set to false, hide haskell version if it's the same as in the implicit global project.
  typeset -g POWERLEVEL9K_HASKELL_STACK_ALWAYS_SHOW=true
  # Custom icon.
  # typeset -g POWERLEVEL9K_HASKELL_STACK_VISUAL_IDENTIFIER_EXPANSION='⭐'

  #############[ kubecontext: current kubernetes context (https://kubernetes.io/) ]#############
  # Show kubecontext only when the the command you are typing invokes one of these tools.
  # Tip: Remove the next line to always show kubecontext.
  typeset -g POWERLEVEL9K_KUBECONTEXT_SHOW_ON_COMMAND='kubectl|helm|kubens|kubectx|oc|istioctl|kogito|k9s|helmfile|flux|fluxctl|stern'

  # Kubernetes context classes for the purpose of using different colors, icons and expansions with
  # different contexts.
  #
  # POWERLEVEL9K_KUBECONTEXT_CLASSES is an array with even number of elements. The first element
  # in each pair defines a pattern against which the current kubernetes context gets matched.
  # More specifically, it's P9K_CONTENT prior to the application of context expansion (see below)
  # that gets matched. If you unset all POWERLEVEL9K_KUBECONTEXT_*CONTENT_EXPANSION parameters,
  # you'll see this value in your prompt. The second element of each pair in
  # POWERLEVEL9K_KUBECONTEXT_CLASSES defines the context class. Patterns are tried in order. The
  # first match wins.
  #
  # For example, given these settings:
  #
  #   typeset -g POWERLEVEL9K_KUBECONTEXT_CLASSES=(
  #     '*prod*'  PROD
  #     '*test*'  TEST
  #     '*'       DEFAULT)
  #
  # If your current kubernetes context is "deathray-testing/default", its class is TEST
  # because "deathray-testing/default" doesn't match the pattern '*prod*' but does match '*test*'.
  #
  # You can define different colors, icons and content expansions for different classes:
  #
  #   typeset -g POWERLEVEL9K_KUBECONTEXT_TEST_FOREGROUND=28
  #   typeset -g POWERLEVEL9K_KUBECONTEXT_TEST_VISUAL_IDENTIFIER_EXPANSION='⭐'
  #   typeset -g POWERLEVEL9K_KUBECONTEXT_TEST_CONTENT_EXPANSION='> ${P9K_CONTENT} <'
  typeset -g POWERLEVEL9K_KUBECONTEXT_CLASSES=(
      # '*prod*'  PROD    # These values are examples that are unlikely
      # '*test*'  TEST    # to match your needs. Customize them as needed.
      '*'       DEFAULT)
  typeset -g POWERLEVEL9K_KUBECONTEXT_DEFAULT_FOREGROUND=134
  # typeset -g POWERLEVEL9K_KUBECONTEXT_DEFAULT_VISUAL_IDENTIFIER_EXPANSION='⭐'

  # Use POWERLEVEL9K_KUBECONTEXT_CONTENT_EXPANSION to specify the content displayed by kubecontext
  # segment. Parameter expansions are very flexible and fast, too. See reference:
  # http://zsh.sourceforge.net/Doc/Release/Expansion.html#Parameter-Expansion.
  #
  # Within the expansion the following parameters are always available:
  #
  # - P9K_CONTENT                The content that would've been displayed if there was no content
  #                              expansion defined.
  # - P9K_KUBECONTEXT_NAME       The current context's name. Corresponds to column NAME in the
  #                              output of `kubectl config get-contexts`.
  # - P9K_KUBECONTEXT_CLUSTER    The current context's cluster. Corresponds to column CLUSTER in the
  #                              output of `kubectl config get-contexts`.
  # - P9K_KUBECONTEXT_NAMESPACE  The current context's namespace. Corresponds to column NAMESPACE
  #                              in the output of `kubectl config get-contexts`. If there is no
  #                              namespace, the parameter is set to "default".
  # - P9K_KUBECONTEXT_USER       The current context's user. Corresponds to column AUTHINFO in the
  #                              output of `kubectl config get-contexts`.
  #
  # If the context points to Google Kubernetes Engine (GKE) or Elastic Kubernetes Service (EKS),
  # the following extra parameters are available:
  #
  # - P9K_KUBECONTEXT_CLOUD_NAME     Either "gke" or "eks".
  # - P9K_KUBECONTEXT_CLOUD_ACCOUNT  Account/project ID.
  # - P9K_KUBECONTEXT_CLOUD_ZONE     Availability zone.
  # - P9K_KUBECONTEXT_CLOUD_CLUSTER  Cluster.
  #
  # P9K_KUBECONTEXT_CLOUD_* parameters are derived from P9K_KUBECONTEXT_CLUSTER. For example,
  # if P9K_KUBECONTEXT_CLUSTER is "gke_my-account_us-east1-a_my-cluster-01":
  #
  #   - P9K_KUBECONTEXT_CLOUD_NAME=gke
  #   - P9K_KUBECONTEXT_CLOUD_ACCOUNT=my-account
  #   - P9K_KUBECONTEXT_CLOUD_ZONE=us-east1-a
  #   - P9K_KUBECONTEXT_CLOUD_CLUSTER=my-cluster-01
  #
  # If P9K_KUBECONTEXT_CLUSTER is "arn:aws:eks:us-east-1:123456789012:cluster/my-cluster-01":
  #
  #   - P9K_KUBECONTEXT_CLOUD_NAME=eks
  #   - P9K_KUBECONTEXT_CLOUD_ACCOUNT=123456789012
  #   - P9K_KUBECONTEXT_CLOUD_ZONE=us-east-1
  #   - P9K_KUBECONTEXT_CLOUD_CLUSTER=my-cluster-01
  typeset -g POWERLEVEL9K_KUBECONTEXT_DEFAULT_CONTENT_EXPANSION=
  # Show P9K_KUBECONTEXT_CLOUD_CLUSTER if it's not empty and fall back to P9K_KUBECONTEXT_NAME.
  POWERLEVEL9K_KUBECONTEXT_DEFAULT_CONTENT_EXPANSION+='${P9K_KUBECONTEXT_CLOUD_CLUSTER:-${P9K_KUBECONTEXT_NAME}}'
  # Append the current context's namespace if it's not "default".
  POWERLEVEL9K_KUBECONTEXT_DEFAULT_CONTENT_EXPANSION+='${${:-/$P9K_KUBECONTEXT_NAMESPACE}:#/default}'

  # Custom prefix.
  # typeset -g POWERLEVEL9K_KUBECONTEXT_PREFIX='%fat '

  ################[ terraform: terraform workspace (https://www.terraform.io) ]#################
  # Don't show terraform workspace if it's literally "default".
  typeset -g POWERLEVEL9K_TERRAFORM_SHOW_DEFAULT=false
  # POWERLEVEL9K_TERRAFORM_CLASSES is an array with even number of elements. The first element
  # in each pair defines a pattern against which the current terraform workspace gets matched.
  # More specifically, it's P9K_CONTENT prior to the application of context expansion (see below)
  # that gets matched. If you unset all POWERLEVEL9K_TERRAFORM_*CONTENT_EXPANSION parameters,
  # you'll see this value in your prompt. The second element of each pair in
  # POWERLEVEL9K_TERRAFORM_CLASSES defines the workspace class. Patterns are tried in order. The
  # first match wins.
  #
  # For example, given these settings:
  #
  #   typeset -g POWERLEVEL9K_TERRAFORM_CLASSES=(
  #     '*prod*'  PROD
  #     '*test*'  TEST
  #     '*'       OTHER)
  #
  # If your current terraform workspace is "project_test", its class is TEST because "project_test"
  # doesn't match the pattern '*prod*' but does match '*test*'.
  #
  # You can define different colors, icons and content expansions for different classes:
  #
  #   typeset -g POWERLEVEL9K_TERRAFORM_TEST_FOREGROUND=28
  #   typeset -g POWERLEVEL9K_TERRAFORM_TEST_VISUAL_IDENTIFIER_EXPANSION='⭐'
  #   typeset -g POWERLEVEL9K_TERRAFORM_TEST_CONTENT_EXPANSION='> ${P9K_CONTENT} <'
  typeset -g POWERLEVEL9K_TERRAFORM_CLASSES=(
      # '*prod*'  PROD    # These values are examples that are unlikely
      # '*test*'  TEST    # to match your needs. Customize them as needed.
      '*'         OTHER)
  typeset -g POWERLEVEL9K_TERRAFORM_OTHER_FOREGROUND=38
  # typeset -g POWERLEVEL9K_TERRAFORM_OTHER_VISUAL_IDENTIFIER_EXPANSION='⭐'

  #############[ terraform_version: terraform version (https://www.terraform.io) ]##############
  # Terraform version color.
  typeset -g POWERLEVEL9K_TERRAFORM_VERSION_FOREGROUND=38
  # Custom icon.
  # typeset -g POWERLEVEL9K_TERRAFORM_VERSION_VISUAL_IDENTIFIER_EXPANSION='⭐'

  #[ aws: aws profile (https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-profiles.html) ]#
  # Show aws only when the the command you are typing invokes one of these tools.
  # Tip: Remove the next line to always show aws.
  typeset -g POWERLEVEL9K_AWS_SHOW_ON_COMMAND='aws|awless|terraform|pulumi|terragrunt'

  # POWERLEVEL9K_AWS_CLASSES is an array with even number of elements. The first element
  # in each pair defines a pattern against which the current AWS profile gets matched.
  # More specifically, it's P9K_CONTENT prior to the application of context expansion (see below)
  # that gets matched. If you unset all POWERLEVEL9K_AWS_*CONTENT_EXPANSION parameters,
  # you'll see this value in your prompt. The second element of each pair in
  # POWERLEVEL9K_AWS_CLASSES defines the profile class. Patterns are tried in order. The
  # first match wins.
  #
  # For example, given these settings:
  #
  #   typeset -g POWERLEVEL9K_AWS_CLASSES=(
  #     '*prod*'  PROD
  #     '*test*'  TEST
  #     '*'       DEFAULT)
  #
  # If your current AWS profile is "company_test", its class is TEST
  # because "company_test" doesn't match the pattern '*prod*' but does match '*test*'.
  #
  # You can define different colors, icons and content expansions for different classes:
  #
  #   typeset -g POWERLEVEL9K_AWS_TEST_FOREGROUND=28
  #   typeset -g POWERLEVEL9K_AWS_TEST_VISUAL_IDENTIFIER_EXPANSION='⭐'
  #   typeset -g POWERLEVEL9K_AWS_TEST_CONTENT_EXPANSION='> ${P9K_CONTENT} <'
  typeset -g POWERLEVEL9K_AWS_CLASSES=(
      # '*prod*'  PROD    # These values are examples that are unlikely
      # '*test*'  TEST    # to match your needs. Customize them as needed.
      '*'       DEFAULT)
  typeset -g POWERLEVEL9K_AWS_DEFAULT_FOREGROUND=208
  # typeset -g POWERLEVEL9K_AWS_DEFAULT_VISUAL_IDENTIFIER_EXPANSION='⭐'

  # AWS segment format. The following parameters are available within the expansion.
  #
  # - P9K_AWS_PROFILE  The name of the current AWS profile.
  # - P9K_AWS_REGION   The region associated with the current AWS profile.
  typeset -g POWERLEVEL9K_AWS_CONTENT_EXPANSION='${P9K_AWS_PROFILE//\%/%%}${P9K_AWS_REGION:+ ${P9K_AWS_REGION//\%/%%}}'

  #[ aws_eb_env: aws elastic beanstalk environment (https://aws.amazon.com/elasticbeanstalk/) ]#
  # AWS Elastic Beanstalk environment color.
  typeset -g POWERLEVEL9K_AWS_EB_ENV_FOREGROUND=70
  # Custom icon.
  # typeset -g POWERLEVEL9K_AWS_EB_ENV_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ##########[ azure: azure account name (https://docs.microsoft.com/en-us/cli/azure) ]##########
  # Show azure only when the the command you are typing invokes one of these tools.
  # Tip: Remove the next line to always show azure.
  typeset -g POWERLEVEL9K_AZURE_SHOW_ON_COMMAND='az|terraform|pulumi|terragrunt'
  # Azure account name color.
  typeset -g POWERLEVEL9K_AZURE_FOREGROUND=32
  # Custom icon.
  # typeset -g POWERLEVEL9K_AZURE_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ##########[ gcloud: google cloud account and project (https://cloud.google.com/) ]###########
  # Show gcloud only when the the command you are typing invokes one of these tools.
  # Tip: Remove the next line to always show gcloud.
  typeset -g POWERLEVEL9K_GCLOUD_SHOW_ON_COMMAND='gcloud|gcs'
   # Google cloud color.
  typeset -g POWERLEVEL9K_GCLOUD_FOREGROUND=32

  # Google cloud format. Change the value of POWERLEVEL9K_GCLOUD_PARTIAL_CONTENT_EXPANSION and/or
  # POWERLEVEL9K_GCLOUD_COMPLETE_CONTENT_EXPANSION if the default is too verbose or not informative
  # enough. You can use the following parameters in the expansions. Each of them corresponds to the
  # output of `gcloud` tool.
  #
  #   Parameter                | Source
  #   -------------------------|--------------------------------------------------------------------
  #   P9K_GCLOUD_CONFIGURATION | gcloud config configurations list --format='value(name)'
  #   P9K_GCLOUD_ACCOUNT       | gcloud config get-value account
  #   P9K_GCLOUD_PROJECT_ID    | gcloud config get-value project
  #   P9K_GCLOUD_PROJECT_NAME  | gcloud projects describe $P9K_GCLOUD_PROJECT_ID --format='value(name)'
  #
  # Note: ${VARIABLE//\%/%%} expands to ${VARIABLE} with all occurrences of '%' replaced with '%%'.
  #
  # Obtaining project name requires sending a request to Google servers. This can take a long time
  # and even fail. When project name is unknown, P9K_GCLOUD_PROJECT_NAME is not set and gcloud
  # prompt segment is in state PARTIAL. When project name gets known, P9K_GCLOUD_PROJECT_NAME gets
  # set and gcloud prompt segment transitions to state COMPLETE.
  #
  # You can customize the format, icon and colors of gcloud segment separately for states PARTIAL
  # and COMPLETE. You can also hide gcloud in state PARTIAL by setting
  # POWERLEVEL9K_GCLOUD_PARTIAL_VISUAL_IDENTIFIER_EXPANSION and
  # POWERLEVEL9K_GCLOUD_PARTIAL_CONTENT_EXPANSION to empty.
  typeset -g POWERLEVEL9K_GCLOUD_PARTIAL_CONTENT_EXPANSION='${P9K_GCLOUD_PROJECT_ID//\%/%%}'
  typeset -g POWERLEVEL9K_GCLOUD_COMPLETE_CONTENT_EXPANSION='${P9K_GCLOUD_PROJECT_NAME//\%/%%}'

  # Send a request to Google (by means of `gcloud projects describe ...`) to obtain project name
  # this often. Negative value disables periodic polling. In this mode project name is retrieved
  # only when the current configuration, account or project id changes.
  typeset -g POWERLEVEL9K_GCLOUD_REFRESH_PROJECT_NAME_SECONDS=60

  # Custom icon.
  # typeset -g POWERLEVEL9K_GCLOUD_VISUAL_IDENTIFIER_EXPANSION='⭐'

  #[ google_app_cred: google application credentials (https://cloud.google.com/docs/authentication/production) ]#
  # Show google_app_cred only when the the command you are typing invokes one of these tools.
  # Tip: Remove the next line to always show google_app_cred.
  typeset -g POWERLEVEL9K_GOOGLE_APP_CRED_SHOW_ON_COMMAND='terraform|pulumi|terragrunt'

  # Google application credentials classes for the purpose of using different colors, icons and
  # expansions with different credentials.
  #
  # POWERLEVEL9K_GOOGLE_APP_CRED_CLASSES is an array with even number of elements. The first
  # element in each pair defines a pattern against which the current kubernetes context gets
  # matched. More specifically, it's P9K_CONTENT prior to the application of context expansion
  # (see below) that gets matched. If you unset all POWERLEVEL9K_GOOGLE_APP_CRED_*CONTENT_EXPANSION
  # parameters, you'll see this value in your prompt. The second element of each pair in
  # POWERLEVEL9K_GOOGLE_APP_CRED_CLASSES defines the context class. Patterns are tried in order.
  # The first match wins.
  #
  # For example, given these settings:
  #
  #   typeset -g POWERLEVEL9K_GOOGLE_APP_CRED_CLASSES=(
  #     '*:*prod*:*'  PROD
  #     '*:*test*:*'  TEST
  #     '*'           DEFAULT)
  #
  # If your current Google application credentials is "service_account deathray-testing x@y.com",
  # its class is TEST because it doesn't match the pattern '* *prod* *' but does match '* *test* *'.
  #
  # You can define different colors, icons and content expansions for different classes:
  #
  #   typeset -g POWERLEVEL9K_GOOGLE_APP_CRED_TEST_FOREGROUND=28
  #   typeset -g POWERLEVEL9K_GOOGLE_APP_CRED_TEST_VISUAL_IDENTIFIER_EXPANSION='⭐'
  #   typeset -g POWERLEVEL9K_GOOGLE_APP_CRED_TEST_CONTENT_EXPANSION='$P9K_GOOGLE_APP_CRED_PROJECT_ID'
  typeset -g POWERLEVEL9K_GOOGLE_APP_CRED_CLASSES=(
      # '*:*prod*:*'  PROD    # These values are examples that are unlikely
      # '*:*test*:*'  TEST    # to match your needs. Customize them as needed.
      '*'             DEFAULT)
  typeset -g POWERLEVEL9K_GOOGLE_APP_CRED_DEFAULT_FOREGROUND=32
  # typeset -g POWERLEVEL9K_GOOGLE_APP_CRED_DEFAULT_VISUAL_IDENTIFIER_EXPANSION='⭐'

  # Use POWERLEVEL9K_GOOGLE_APP_CRED_CONTENT_EXPANSION to specify the content displayed by
  # google_app_cred segment. Parameter expansions are very flexible and fast, too. See reference:
  # http://zsh.sourceforge.net/Doc/Release/Expansion.html#Parameter-Expansion.
  #
  # You can use the following parameters in the expansion. Each of them corresponds to one of the
  # fields in the JSON file pointed to by GOOGLE_APPLICATION_CREDENTIALS.
  #
  #   Parameter                        | JSON key file field
  #   ---------------------------------+---------------
  #   P9K_GOOGLE_APP_CRED_TYPE         | type
  #   P9K_GOOGLE_APP_CRED_PROJECT_ID   | project_id
  #   P9K_GOOGLE_APP_CRED_CLIENT_EMAIL | client_email
  #
  # Note: ${VARIABLE//\%/%%} expands to ${VARIABLE} with all occurrences of '%' replaced by '%%'.
  typeset -g POWERLEVEL9K_GOOGLE_APP_CRED_DEFAULT_CONTENT_EXPANSION='${P9K_GOOGLE_APP_CRED_PROJECT_ID//\%/%%}'

  ##############[ toolbox: toolbox name (https://github.com/containers/toolbox) ]###############
  # Toolbox color.
  typeset -g POWERLEVEL9K_TOOLBOX_FOREGROUND=178
  # Don't display the name of the toolbox if it matches fedora-toolbox-*.
  typeset -g POWERLEVEL9K_TOOLBOX_CONTENT_EXPANSION='${P9K_TOOLBOX_NAME:#fedora-toolbox-*}'
  # Custom icon.
  # typeset -g POWERLEVEL9K_TOOLBOX_VISUAL_IDENTIFIER_EXPANSION='⭐'
  # Custom prefix.
  # typeset -g POWERLEVEL9K_TOOLBOX_PREFIX='%fin '

  ###############################[ public_ip: public IP address ]###############################
  # Public IP color.
  typeset -g POWERLEVEL9K_PUBLIC_IP_FOREGROUND=94
  # Custom icon.
  # typeset -g POWERLEVEL9K_PUBLIC_IP_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ########################[ vpn_ip: virtual private network indicator ]#########################
  # VPN IP color.
  typeset -g POWERLEVEL9K_VPN_IP_FOREGROUND=81
  # When on VPN, show just an icon without the IP address.
  # Tip: To display the private IP address when on VPN, remove the next line.
  typeset -g POWERLEVEL9K_VPN_IP_CONTENT_EXPANSION=
  # Regular expression for the VPN network interface. Run `ifconfig` or `ip -4 a show` while on VPN
  # to see the name of the interface.
  typeset -g POWERLEVEL9K_VPN_IP_INTERFACE='(gpd|wg|(.*tun)|tailscale)[0-9]*'
  # If set to true, show one segment per matching network interface. If set to false, show only
  # one segment corresponding to the first matching network interface.
  # Tip: If you set it to true, you'll probably want to unset POWERLEVEL9K_VPN_IP_CONTENT_EXPANSION.
  typeset -g POWERLEVEL9K_VPN_IP_SHOW_ALL=false
  # Custom icon.
  # typeset -g POWERLEVEL9K_VPN_IP_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ###########[ ip: ip address and bandwidth usage for a specified network interface ]###########
  # IP color.
  typeset -g POWERLEVEL9K_IP_FOREGROUND=38
  # The following parameters are accessible within the expansion:
  #
  #   Parameter             | Meaning
  #   ----------------------+-------------------------------------------
  #   P9K_IP_IP             | IP address
  #   P9K_IP_INTERFACE      | network interface
  #   P9K_IP_RX_BYTES       | total number of bytes received
  #   P9K_IP_TX_BYTES       | total number of bytes sent
  #   P9K_IP_RX_BYTES_DELTA | number of bytes received since last prompt
  #   P9K_IP_TX_BYTES_DELTA | number of bytes sent since last prompt
  #   P9K_IP_RX_RATE        | receive rate (since last prompt)
  #   P9K_IP_TX_RATE        | send rate (since last prompt)
  typeset -g POWERLEVEL9K_IP_CONTENT_EXPANSION='$P9K_IP_IP${P9K_IP_RX_RATE:+ %70F⇣$P9K_IP_RX_RATE}${P9K_IP_TX_RATE:+ %215F⇡$P9K_IP_TX_RATE}'
  # Show information for the first network interface whose name matches this regular expression.
  # Run `ifconfig` or `ip -4 a show` to see the names of all network interfaces.
  typeset -g POWERLEVEL9K_IP_INTERFACE='[ew].*'
  # Custom icon.
  # typeset -g POWERLEVEL9K_IP_VISUAL_IDENTIFIER_EXPANSION='⭐'

  #########################[ proxy: system-wide http/https/ftp proxy ]##########################
  # Proxy color.
  typeset -g POWERLEVEL9K_PROXY_FOREGROUND=68
  # Custom icon.
  # typeset -g POWERLEVEL9K_PROXY_VISUAL_IDENTIFIER_EXPANSION='⭐'

  ################################[ battery: internal battery ]#################################
  # Show battery in red when it's below this level and not connected to power supply.
  typeset -g POWERLEVEL9K_BATTERY_LOW_THRESHOLD=20
  typeset -g POWERLEVEL9K_BATTERY_LOW_FOREGROUND=160
  # Show battery in green when it's charging or fully charged.
  typeset -g POWERLEVEL9K_BATTERY_{CHARGING,CHARGED}_FOREGROUND=70
  # Show battery in yellow when it's discharging.
  typeset -g POWERLEVEL9K_BATTERY_DISCONNECTED_FOREGROUND=178
  # Battery pictograms going from low to high level of charge.
  typeset -g POWERLEVEL9K_BATTERY_STAGES=('%K{232}▁' '%K{232}▂' '%K{232}▃' '%K{232}▄' '%K{232}▅' '%K{232}▆' '%K{232}▇' '%K{232}█')
  # Don't show the remaining time to charge/discharge.
  typeset -g POWERLEVEL9K_BATTERY_VERBOSE=false

  #####################################[ wifi: wifi speed ]#####################################
  # WiFi color.
  typeset -g POWERLEVEL9K_WIFI_FOREGROUND=68
  # Custom icon.
  # typeset -g POWERLEVEL9K_WIFI_VISUAL_IDENTIFIER_EXPANSION='⭐'

  # Use different colors and icons depending on signal strength ($P9K_WIFI_BARS).
  #
  #   # Wifi colors and icons for different signal strength levels (low to high).
  #   typeset -g my_wifi_fg=(68 68 68 68 68)                           # <-- change these values
  #   typeset -g my_wifi_icon=('WiFi' 'WiFi' 'WiFi' 'WiFi' 'WiFi')     # <-- change these values
  #
  #   typeset -g POWERLEVEL9K_WIFI_CONTENT_EXPANSION='%F{${my_wifi_fg[P9K_WIFI_BARS+1]}}$P9K_WIFI_LAST_TX_RATE Mbps'
  #   typeset -g POWERLEVEL9K_WIFI_VISUAL_IDENTIFIER_EXPANSION='%F{${my_wifi_fg[P9K_WIFI_BARS+1]}}${my_wifi_icon[P9K_WIFI_BARS+1]}'
  #
  # The following parameters are accessible within the expansions:
  #
  #   Parameter             | Meaning
  #   ----------------------+---------------
  #   P9K_WIFI_SSID         | service set identifier, a.k.a. network name
  #   P9K_WIFI_LINK_AUTH    | authentication protocol such as "wpa2-psk" or "none"; empty if unknown
  #   P9K_WIFI_LAST_TX_RATE | wireless transmit rate in megabits per second
  #   P9K_WIFI_RSSI         | signal strength in dBm, from -120 to 0
  #   P9K_WIFI_NOISE        | noise in dBm, from -120 to 0
  #   P9K_WIFI_BARS         | signal strength in bars, from 0 to 4 (derived from P9K_WIFI_RSSI and P9K_WIFI_NOISE)

  ####################################[ time: current time ]####################################
  # Current time color.
  typeset -g POWERLEVEL9K_TIME_FOREGROUND=66
  # Format for the current time: 09:51:02. See `man 3 strftime`.
  typeset -g POWERLEVEL9K_TIME_FORMAT='%D{%H:%M:%S}'
  # If set to true, time will update when you hit enter. This way prompts for the past
  # commands will contain the start times of their commands as opposed to the default
  # behavior where they contain the end times of their preceding commands.
  typeset -g POWERLEVEL9K_TIME_UPDATE_ON_COMMAND=false
  # Custom icon.
  typeset -g POWERLEVEL9K_TIME_VISUAL_IDENTIFIER_EXPANSION=
  # Custom prefix.
  # typeset -g POWERLEVEL9K_TIME_PREFIX='%fat '

  # Example of a user-defined prompt segment. Function prompt_example will be called on every
  # prompt if `example` prompt segment is added to POWERLEVEL9K_LEFT_PROMPT_ELEMENTS or
  # POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS. It displays an icon and orange text greeting the user.
  #
  # Type `p10k help segment` for documentation and a more sophisticated example.
  function prompt_example() {
    p10k segment -f 208 -i '⭐' -t 'hello, %n'
  }

  # User-defined prompt segments may optionally provide an instant_prompt_* function. Its job
  # is to generate the prompt segment for display in instant prompt. See
  # https://github.com/romkatv/powerlevel10k/blob/master/README.md#instant-prompt.
  #
  # Powerlevel10k will call instant_prompt_* at the same time as the regular prompt_* function
  # and will record all `p10k segment` calls it makes. When displaying instant prompt, Powerlevel10k
  # will replay these calls without actually calling instant_prompt_*. It is imperative that
  # instant_prompt_* always makes the same `p10k segment` calls regardless of environment. If this
  # rule is not observed, the content of instant prompt will be incorrect.
  #
  # Usually, you should either not define instant_prompt_* or simply call prompt_* from it. If
  # instant_prompt_* is not defined for a segment, the segment won't be shown in instant prompt.
  function instant_prompt_example() {
    # Since prompt_example always makes the same `p10k segment` calls, we can call it from
    # instant_prompt_example. This will give us the same `example` prompt segment in the instant
    # and regular prompts.
    prompt_example
  }

  # User-defined prompt segments can be customized the same way as built-in segments.
  # typeset -g POWERLEVEL9K_EXAMPLE_FOREGROUND=208
  # typeset -g POWERLEVEL9K_EXAMPLE_VISUAL_IDENTIFIER_EXPANSION='⭐'

  # Transient prompt works similarly to the builtin transient_rprompt option. It trims down prompt
  # when accepting a command line. Supported values:
  #
  #   - off:      Don't change prompt when accepting a command line.
  #   - always:   Trim down prompt when accepting a command line.
  #   - same-dir: Trim down prompt when accepting a command line unless this is the first command
  #               typed after changing current working directory.
  typeset -g POWERLEVEL9K_TRANSIENT_PROMPT=off

  # Instant prompt mode.
  #
  #   - off:     Disable instant prompt. Choose this if you've tried instant prompt and found
  #              it incompatible with your zsh configuration files.
  #   - quiet:   Enable instant prompt and don't print warnings when detecting console output
  #              during zsh initialization. Choose this if you've read and understood
  #              https://github.com/romkatv/powerlevel10k/blob/master/README.md#instant-prompt.
  #   - verbose: Enable instant prompt and print a warning when detecting console output during
  #              zsh initialization. Choose this if you've never tried instant prompt, haven't
  #              seen the warning, or if you are unsure what this all means.
  typeset -g POWERLEVEL9K_INSTANT_PROMPT=off

  # Hot reload allows you to change POWERLEVEL9K options after Powerlevel10k has been initialized.
  # For example, you can type POWERLEVEL9K_BACKGROUND=red and see your prompt turn red. Hot reload
  # can slow down prompt by 1-2 milliseconds, so it's better to keep it turned off unless you
  # really need it.
  typeset -g POWERLEVEL9K_DISABLE_HOT_RELOAD=true

  # If p10k is already loaded, reload configuration.
  # This works even with POWERLEVEL9K_DISABLE_HOT_RELOAD=true.
  (( ! $+functions[p10k] )) || p10k reload
}

# Tell `p10k configure` which file it should overwrite.
# typeset -g POWERLEVEL9K_CONFIG_FILE=${${(%):-%x}:a}

(( ${#p10k_config_opts} )) && setopt ${p10k_config_opts[@]}
'builtin' 'unset' 'p10k_config_opts'
</file>

<file path="modules/themes/autumnal/config/bspwmrc">
#!/usr/bin/env sh

bspc config borderless_monocle true
bspc config gapless_monocle true

bspc config normal_border_color "#0d0f11"
bspc config active_border_color "#16181a"
bspc config focused_border_color "#5c5e5e"
bspc config presel_feedback_color "#bd93f9" # TODO

bspc config border_width 1
bspc config window_gap -1

bspc config top_padding 1
bspc config bottom_padding 1
bspc config left_padding 1
bspc config right_padding 1
bspc config -m "$MONITOR" top_padding 31
</file>

<file path="modules/themes/autumnal/config/tmux.conf">
# -- THEME -------------------------------

# The statusbar
# only show status bar if there is more then one window
set -g status off
set-hook -g after-new-window      'if "[ #{session_windows} -gt 1 ]" "set status on"'
set-hook -g after-kill-pane       'if "[ #{session_windows} -lt 2 ]" "set status off"'
set-hook -g pane-exited           'if "[ #{session_windows} -lt 2 ]" "set status off"'
set-hook -g window-layout-changed 'if "[ #{session_windows} -lt 2 ]" "set status off"'

set -g status-position bottom
set -g status-justify right
set -g status-bg default
set -g status-fg colour5
# set -g status-left '#{prefix_highlight}#[bg=colour238]|―――――――――――――――――|'
# set -g status-right '#[bg=colour238]|―――――――――――――――――――――――|'
set -g status-left '#{prefix_highlight}'
set -g status-right ''
set -g status-right-length 30
set -g status-left-length 30

# The messages
set -g message-style fg=magenta,bg=colour236
set -g message-command-style fg=blue,bg=black

# loud or quiet?
set-option -g visual-activity off
set-option -g visual-bell off
set-option -g visual-silence off
set-window-option -g monitor-activity on
set-option -g bell-action none

# The modes
setw -g clock-mode-colour colour135
# setw -g mode-attr bold
# setw -g mode-fg colour196
# setw -g mode-bg colour238

# The panes
set -g pane-border-style fg=colour235
set -g pane-active-border-style fg=colour5

# setw -g window-status-current-fg colour2
# setw -g window-status-current-bg default
# setw -g window-status-current-attr none
# setw -g window-status-current-format ' #W '

# setw -g window-status-fg colour236
# setw -g window-status-bg default
# setw -g window-status-attr none
# setw -g window-status-format '#[bg=colour238] #I #[bg=default]#W '
setw -g window-status-format ' #[bg=colour238] #W #[bg=default] '

# setw -g window-status-activity-bg default
# setw -g window-status-activity-fg colour240
# setw -g window-status-activity-attr none

# setw -g window-status-bell-attr bold
# setw -g window-status-bell-fg colour255
# setw -g window-status-bell-bg colour1


# -- PLUGINS -----------------------------

# tmux-prefix-highlight
set -g @prefix_highlight_fg 'colour0'
set -g @prefix_highlight_bg 'colour5'
set -g @prefix_highlight_copy_mode_attr 'fg=colour0,bg=color4'
set -g @prefix_highlight_prefix_prompt 'C-c'
set -g @prefix_highlight_show_copy_mode 'on'
</file>

<file path="modules/themes/autumnal/config/Xresources">
!! Colors
*.cursorColor: mag
! greys
*.color234: #1E2029
*.color235: #282a36
*.color236: #373844
*.color237: #44475a
*.color239: #565761
*.color240: #6272a4
*.color241: #b6b6b2

!! xst
st.font: monospace:size=9.5
st.scratch.font: monospace:size=12.5
st.borderpx: 10
</file>

<file path="modules/themes/autumnal/bspwm.nix">
{ hey, lib, config, pkgs, ... } @ args:

with lib;
with hey.lib;
let cfg = config.modules.theme;
in {
  services.picom = {
    shadow = true;
    shadowOffsets = [ (-10) (-10) ];
    shadowOpacity = 0.23;
    settings = {
      shadow-radius = 14;
      blur-kern = "7x7box";
      blur-strength = 320;
    };
  };

  # Login screen theme
  services.xserver.displayManager.lightdm.greeters.mini.extraConfig = ''
    [greeter]
    show-password-label = false

    [greeter-theme]
    text-color = "${cfg.colors.magenta}"
    password-background-color = "${cfg.colors.black}"
    window-color = "${cfg.colors.types.border}"
    border-color = "${cfg.colors.types.border}"
    password-border-radius = 0.01em
    font = "${cfg.fonts.sans.name}"
    font-size = 1.4em
  '';

  modules.services.dunst.settings = {
    global = {
      font = "${cfg.fonts.sans.name} ${toString cfg.fonts.sans.size}";
      follow = "none";
      alignment = "left";
      width = 440;
      height = 300;
      origin = "bottom-center";
      offset = "0x80";
      scale = 0;
      transparency = 2;
      corner_radius = 2;
      format = "<b>%s</b>\\n%b";
      frame_color = cfg.colors.types.border;
      frame_width = 1;
      horizontal_padding = 18;
      padding = 16;
      notification_limit = 10;
      indicate_hidden = "yes";
      icon_position = "left";
      icon_theme = cfg.gtk.iconTheme.name;
      icon_path =
        let iconDir = "/etc/profiles/per-user/${config.user.name}/share/icons";
            iconSizes = [ 8 16 22 24 32 48 64 128 256 512 "scalable" ];
            folders = [
              "actions" "animations" "apps" "categories" "devices" "emblems"
              "emotes" "mimetypes" "notifications" "panel" "places" "status"
              "web"
            ];
            mkDirs = themeName:
              map (dir:
                (map (size:
                  if isString size
                  then "${iconDir}/${themeName}/${size}/${dir}"
                  else [
                    "${iconDir}/${themeName}/${toString size}x${toString size}/${dir}"
                    "${iconDir}/${themeName}/${toString size}x${toString size}@2x/${dir}"
                  ]) iconSizes))
                folders;
        in concatStringsSep ":" (flatten (map mkDirs [ cfg.gtk.iconTheme.name "gnome" ]));
      ignore_newline = false;
      line_height = 0;
      max_icon_size = 24;
      separator_color = "auto";
      separator_height = 4;
      show_age_threshold = 60;
      show_indicators = true;
      shrink = false;
      word_wrap = true;
      # Includes the frame, should be at least 2x as big as the frame width.
      progress_bar_height = 6;
      progress_bar_frame_width = 0;
      progress_bar_min_width = 150;
      progress_bar_max_width = 440;
      # Not in current version of dunst
      # progress_bar_corner_radius = 0;  # disable rounded corners
    };
    urgency_low = {
      background = cfg.colors.types.bg;
      foreground = cfg.colors.types.fg;
      timeout = 8;
      icon = "";
    };
    urgency_normal = {
      background = cfg.colors.types.panelbg;
      foreground = cfg.colors.types.fg;
      timeout = 14;
      icon = "";
      script = "hey .play-sound notify";
    };
    urgency_critical = {
      background = cfg.colors.types.bg;
      foreground = cfg.colors.types.warning;
      frame_color = cfg.colors.types.warning;
      timeout = 0;
      script = "hey .play-sound notify-critical";
    };
    osd = {
      stack_tag = "osd";
      max_icon_size = 512;
      format = "%b";
      timeout = 2;
      icon_position = "top";
      history_ignore = "yes";
      fullscreen = "show";
      hide_text = "true";
      script = "hey .play-sound blip";
    };
    low_battery = {
      stack_tag = "battery";
      icon = "battery-empty-charging";
      format = "<b>%s</b> %b";
      script = "hey .play-sound notify-critical";
    };
    # spotify = {
    #   appname = "Spotify";
    #   max_icon_size = 64;
    # };
  };

  home.configFile = with config.modules; mkMerge [
    {
      # Sourced from sessionCommands in modules/themes/default.nix
      "xtheme/90-theme".source = ./config/Xresources;
    }
    (mkIf desktop.bspwm.enable {
      "bspwm/rc.d/00-theme".source = ./config/bspwmrc;
      "bspwm/rc.d/95-polybar".source = ./config/polybar/run.sh;
    })
    (mkIf desktop.bspwm.enable {
      "polybar" = {
        source = ./config/polybar;
        recursive = true;
      };
      # "Dracula-purple-solid-kvantum" = {
      #   recursive = true;
      #   source = "${pkgs.dracula-theme}/share/themes/Dracula/kde/kvantum/Dracula-purple-solid";
      #   target = "Kvantum/Dracula-purple-solid";
      # };
      # "kvantum.kvconfig" = {
      #   text = "theme=Dracula-purple-solid";
      #   target = "Kvantum/kvantum.kvconfig";
      # };
    })
  ];
}
</file>

<file path="modules/themes/autumnal/default.nix">
# modules/themes/autumnal/default.nix --- a dark, pastel theme

{ hey, heyBin, lib, config, pkgs, ... } @ args:

with lib;
with hey.lib;
let cfg = config.modules.theme;
in mkIf (cfg.active == "autumnal") (mkMerge [
  {
    user.packages = [ pkgs.tela-circle-icon-theme ];

    modules = {
      theme = {
        fonts = with pkgs; {
          sans.name = "Fira Sans";
          sans.package = fira;
          mono.name = "JetBrains Mono";
          mono.package = jetbrains-mono;
          packages = [
            fira-code
            fira-code-symbols
            open-sans
            montserrat
          ];
        };
        gtk = with pkgs; {
          theme = {
            name = "Graphite-pink-Dark";
            package = pkgs.graphite-gtk-theme.override {
              themeVariants = [ "pink" ];
              colorVariants = [ "dark" ];
              # sizeVariants = [ "compact" ];
              tweaks = [
                "normal"
                "rimless"
                "darker"
              ];
            };
          };
          iconTheme = {
            name = "Papirus-Dark";
            package = pkgs.catppuccin-papirus-folders.override {
              flavor = "mocha";
              accent = "maroon";
            };
          };
          cursorTheme = {
            name = "catppuccin-mocha-dark-cursors";
            package = catppuccin-cursors.mochaDark;
            size = 32;
          };
        };
        colors = {
          black         = "#1d1f21";
          red           = "#cc6666";
          green         = "#b5bd68";
          yellow        = "#f0c674";
          blue          = "#81a2be";
          magenta       = "#c9b4cf";
          cyan          = "#8abeb7";
          silver        = "#e2e2dc";
          grey          = "#5B6268";
          brightred     = "#de935f";
          brightgreen   = "#0189cc";
          brightyellow  = "#f9a03f";
          brightblue    = "#8be9fd";
          brightmagenta = "#ff79c6";
          brightcyan    = "#0189cc";
          white         = "#C18E76";
          types.fg      = "#c5c8c6";
          types.panelfg = "#e2e2dc";
          types.panelbg = "#161719";
          types.border  = "#0d0d0d";
        };
      };

      shell.zsh.rcFiles  = [ ./config/zsh/prompt.zsh ];
      shell.tmux.rcFiles = [ ./config/tmux.conf ];
      desktop.browsers = {
        librewolf = {
          settings."devtools.theme" = "dark";
          userChrome = concatMapStringsSep "\n" readFile [
            ./config/librewolf/userChrome.css
          ];
        };
      };
    };
  }

  (mkIf (config.modules.desktop.type != null) {
    # modules.desktop.apps.spotify.theme = cfg.active;

    # programs.spicetify =
    #   let spkgs = hey.inputs.spicetify-nix.legacyPackages.${pkgs.system};
    #   in { theme = spkgs.themes.burntSienna; };

    home.configFile = with config.modules; mkMerge [
      (mkIf desktop.media.graphics.vector.enable {
        "inkscape/templates/default.svg".source = ./config/inkscape/default-template.svg;
      })
      (mkIf desktop.apps.rofi.enable {
        "rofi/config.theme.rasi".source = ./config/rofi/config.rasi;
        "rofi/themes" = {
          source = ./config/rofi/themes;
          recursive = true;
        };
        "rofi/icons" = {
          source = ./config/rofi/icons;
          recursive = true;
        };
      })
    ];
  })

  (mkIf config.modules.desktop.bspwm.enable    (import ./bspwm.nix args))
  (mkIf config.modules.desktop.hyprland.enable (import ./hyprland.nix args))
])
</file>

<file path="modules/themes/autumnal/hyprland.nix">
{ hey, heyBin, lib, config, pkgs, ... } @ args:

with lib;
with hey.lib;
let cfg = config.modules.theme;
    hCfg = config.modules.desktop.hyprland;
in {
  modules.desktop.hyprland.extraConfig = ''
    env = HYPRCURSOR_THEME,${cfg.gtk.cursorTheme.name}
    env = HYPRCURSOR_SIZE,${toString cfg.gtk.cursorTheme.size}

    general {
      gaps_in = 0
      gaps_out = 0
      border_size = 1
      col.active_border = rgba(e6818388) rgba(363637ff) 45deg
      col.inactive_border = rgba(161617ff)
    }
    decoration {
      rounding = 0
      dim_strength = 0.2
      dim_inactive = true
      dim_special = 0.4
      dim_around = 0.4
      shadow {
        enabled = true
        range = 10
        render_power = 4
        color = rgba(0f0f0f88)
      }
      blur {
        enabled = true
        size = 4
        passes = 1
      }
    }

    # Since we can't focus anything with rofi up anyway, convey this visually.
    layerrule = dimaround, rofi
    layerrule = animation slide top, rofi
  '';

  home.configFile."doom/config.local.el".text = ''
    ;; -*- lexical-binding: t -*-
    (add-to-list 'default-frame-alist '(alpha-background . 95))
    (setq doom-theme 'doom-tomorrow-night)
    (custom-theme-set-faces! 'doom-tomorrow-night
      '(default :background "#1d1f21")
      '(solaire-default-face :background "#191B1A"))
  '';

  home.configFile."waybar/style.css".source = ./config/waybar/style.css;
  modules.services.waybar.settings = {
    main = {
      layer = "top";
      position = "top";
      height = 35;
      margin-bottom = 0;
      modules-left = [
        "clock"
        "tray"
      ];
      modules-center = [
        "hyprland/workspaces"
      ];
      modules-right = [
        "custom/spacer"
        "cpu"
        (let hw = config.modules.profiles.hardware; in
         if any (s: hasPrefix "gpu/nvidia" s) hw
         then "custom/gpu-nvidia"
         else "-")
        "memory"
        "bluetooth"
        "network"
        "battery"
        "backlight"
        "pulseaudio"
        "idle_inhibitor"
        # "privacy"
      ];
      "tray" = {
        "icon-size" = 16;
        "spacing" = 4;
        "show-passive-items" = true;
      };
      # TODO: "custom/gpu-amd" = {}
      # TODO: "custom/gpu-intel" = {}
      "custom/gpu-nvidia" = {
        "exec" = "${heyBin} exec nvidia-smi --query-gpu=utilization.gpu --format=csv,noheader,nounits";
        "format" = " {}%";
        "return-type" = "";
        "interval" = 4;
      };
      "custom/spacer" = { "format" = " "; };
      "idle_inhibitor" = {
        "format" = "{icon}";
        "format-icons" = {
          "activated" = "";
          "deactivated" = "";
        };
      };
      "bluetooth" = {
        "format" = "";
        "format-disabled" = "";
        "format-connected" = " {num_connections}";
        "tooltip-format" = "{controller_alias}\t{controller_address}";
        "tooltip-format-connected" = "{controller_alias}\t{controller_address}\n\n{device_enumerate}";
        "tooltip-format-enumerate-connected" = "{device_alias}\t{device_address}";
      };
      "hyprland/window" = {
        "format" = "{title}";
        "separate-outputs" = true;
      };
      "hyprland/workspaces" = {
        "active-only" = false;
        "all-outputs" = false;
        "disable-scroll" = true;
        "on-click" = "activate";
        "show-special" = false;
        "format" = "{icon}";
        "format-icons" = {
          "active" = "";
          "default" = "";
          "empty" = "";
          "urgent" = "";
          "special" = "";
        };
        "persistent-workspaces" = {
          "1" = [];
          "2" = [];
          "3" = [];
          "4" = [];
          "5" = [];
          "6" = [];
        };
      };
      "clock" = {
        "format" = "{:%H:%M - %a %d/%b}";
        "tooltip-format" = "<big>{:%Y %B}</big>\n<tt><small>{calendar}</small></tt>";
        "calendar" = {
          "mode"          = "year";
          "mode-mon-col"  = 3;
          "weeks-pos"     = "right";
          "on-scroll"     = 0;
          "format" = {
            "months"   = "<span color  ='#ffead3'><b>{}</b></span>";
            "days"     = "<span color='#ecc6d9'><b>{}</b></span>";
            "weeks"    = "<span color ='#99ffdd'><b>W{}</b></span>";
            "weekdays" = "<span color    ='#ffcc66'><b>{}</b></span>";
            "today"    = "<span color ='#ff6699'><b><u>{}</u></b></span>";
          };
        };
        "actions" = {
          "on-click-right" = "mode";
        };
      };
      "backlight" = {
        "device" = "intel_backlight";
        "format" = "{icon}";
        "format-icons" = ["" "" ""];
        "on-scroll-up" = "brightnessctl set 1%+";
        "on-scroll-down" = "brightnessctl set 1%-";
        "min-length" = 6;
      };
      "cpu" = {
        "format" = "<span weight='bold'></span> {usage}%";
      };
      "memory" = {
        "format" = "<span weight='bold'></span> {}%";
      };
      "battery" = {
        "bat" = "BAT0";
        "states" = {
          # "good" = 95;
          "warning" = 30;
          "critical" = 15;
        };
        "format" = "<span weight='bold'>{icon}</span> {capacity}%";
        # "format-good" = ""; // An empty format will hide the module
        # "format-full" = "";
        "format-icons" = ["" "" "" "" ""];
      };
      "pulseaudio" = {
        # "scroll-step" = 1;
        "format" = "<span weight='bold'>{icon}</span>";
        "format-bluetooth" = "<span weight='bold'>{icon}</span> {volume}%";
        "format-muted" = "<span weight='bold'></span>";
        "format-icons" = {
          "headphones" = "";
          "handsfree" = "";
          "headset" = "";
          "phone" = "";
          "portable" = "";
          "car" = "";
          "default" = ["" ""];
        };
        "on-click" = "pavucontrol";
      };
      "network" = {
        "format-disconnected" = "<span weight='bold'>⚠</span>";
        "format-ethernet" = "";
        "format-linked" = "";
        "format-wifi" = "<span weight='bold'></span> {signalStrength}%";
        "tooltip-format-ethernet" = " {ifname} via {gwaddr}";
        "tooltip-format-wifi" = " {essid}: {ifname} via {gwaddr}";
      };
    };
    osd = {
      mode = "overlay";
      layer = "top";
      position = "bottom";
      width = 512;
      height = 200;
      margin-bottom = 220;
      "hyprland/submap".format = "{}";
      modules-center = [ "hyprland/submap" ];
    };
  };

  modules.desktop.hyprland.mako.settings = {
    background-color = "${cfg.colors.types.panelbg}f2";
    border-color = "${cfg.colors.types.border}ee";
    border-radius = 6;
    border-size = 1;
    default-timeout = 10000;
    font = "${cfg.fonts.sans.name} ${toString cfg.fonts.sans.size}";
    height = 300;
    icon-path =
      let iconDir = "/etc/profiles/per-user/${config.user.name}/share/icons";
      in concatStringsSep ":" [
        "${iconDir}/${cfg.gtk.iconTheme.name}"
        "${iconDir}/gnome"
      ];
    layer = "top";
    max-history = 10;
    max-visible = 10;
    padding = 20;
    progress-color = "${cfg.colors.red}2f";
    sort = "-time";
    text-color = cfg.colors.types.fg;
    width = 420;

    "urgency=high" = {
      background-color = "${cfg.colors.types.border}ee";
      # border-color = "${cfg.colors.types.error}66";
      default-timeout = 0;
      text-color = "#ffffff";
    };
    "urgency=low" = {
      background-color = "${cfg.colors.types.panelbg}dd";
      # border-color = "${cfg.colors.types.border}BB";
      # text-color = cfg.colors.types.panelfg;
      default-timeout = 6000;
    };

    # "app-name=Spotify" = {
    #   # background-color = "${cfg.colors.types.border}DD";
    #   group-by = "app-name";
    #   max-icon-size = 150;
    #   padding = "0,0,0,18";
    #   icon-location = "right";
    # };

    "category=preview" = {
      group-by = "app-name";
      max-icon-size = 150;
      padding = "0,0,0,20";
      icon-location = "right";
    };

    # For 'hey .osd ...' notifications
    "app-name=OSD" = {
      anchor = "bottom-center";
      border-color = "${cfg.colors.types.border}99";
      border-radius = 48;
      border-size = 1;
      default-timeout = 1750;
      font = "${cfg.fonts.icons.name} 32";
      format = "%b";
      group-by = "app-name";
      height = 512;
      on-button-left = "none";
      outer-margin = "0,0,256,0";
      padding = "18,0";
      progress-color = "${cfg.colors.red}66";
      text-alignment = "center";
      width = 512;
    };
    "app-name=OSD category=mic" = {
      progress-color = "${cfg.colors.red}44";
    };
    "app-name=OSD category=lcd" = {
      progress-color = "${cfg.colors.brightred}99";
    };
    "app-name=OSD category=indicator" = {
      width = 150;
      padding = "32,0";
      font = "${cfg.fonts.icons.name} 48";
    };
  };

  modules.desktop.hyprland.hyprlock.settings =
    let monitor = (findFirst (x: x.primary) {} hCfg.monitors).output or "";
    in {
      backgrounds =
        map (m: {
          monitor = m.output;
          path = if cfg.wallpapers ? m.output
                 then cfg.wallpapers."${m.output}".path
                 else if cfg.wallpapers ? "*"
                 then cfg.wallpapers."*".path
                 else "/does/not/exist";
          color = "rgb(000000)";
          blur_size = 4;
          blur_passes = 3;
          noise = 0.0117;
          contrast = 1.3;  # Vibrant!!!
          brightness = if m.primary then 0.75 else 0.40;
          vibrancy = 0.2100;
          vibrancy_darkness = 0.0;
        }) hCfg.monitors;
      input-field = {
        inherit monitor;
        size = "250, 60";
        outline_thickness = 6;
        dots_size = 0.4; # Scale of input-field height, 0.2 - 0.8
        dots_spacing = 0.25; # Scale of dots' absolute size, 0.0 - 1.0
        dots_center = "true";
        dots_rounding = "-2"; # -1 default circle, -2 follow input-field rounding
        outer_color = "rgba(29, 31, 30, 0.65)";
        inner_color = "rgba(0, 0, 0, 0)";
        font_color = "rgb(${removePrefix "#" cfg.colors.types.fg})";
        fade_on_empty = "true";
        fade_timeout = 1000; # Milliseconds before fade_on_empty is triggered.
        placeholder_text = "<i>Enter password...</i>"; # Text rendered in the input box when it's empty.
        hide_input = "false";
        rounding = "-1";  # -1 means complete rounding (circle/oval)
        check_color = "rgb(${removePrefix "#" cfg.colors.magenta})";
        fail_color = "rgb(${removePrefix "#" cfg.colors.red})"; # if authentication failed, changes outer_color and fail message color
        fail_text = "<i>$FAIL <b>($ATTEMPTS)</b></i>"; # can be set to empty
        fail_transition = 300; # transition time in ms between normal outer_color and fail_color
        swap_font_color = "false";
        position = "0, 130";
        halign = "center";
        valign = "bottom";
      };
      labels = [
        { # time
          inherit monitor;
          text = ''cmd[update:60000] echo "<b><big> $(date +"%H:%M") </big></b>"'';
          color = "rgb(${removePrefix "#" cfg.colors.types.fg})";
          font_size = 130;
          font_family = "${cfg.fonts.sans.name} 12";
          shadow_passes = 1;
          shadow_size = 4;
          position = "0, 100";
          halign = "center";
          valign = "center";
        }
        { # date
          inherit monitor;
          text = ''cmd[update:18000000] echo "<b> "$(date +'%A, %-d %B %Y')" </b>"'';
          color = "rgb(${removePrefix "#" cfg.colors.red})";
          font_size = 32;
          font_family = "${cfg.fonts.sans.name} 12";
          shadow_passes = 1;
          shadow_size = 3;
          position = "0, -5";
          halign = "center";
          valign = "center";
        }
      ];
      shapes = [
        {
          inherit monitor;
          size = "540, 540";
          color = "rgba(29, 31, 30, 0.85)";
          rounding = "-1";
          rotate = 0;
          position = "0, 75";
          halign = "center";
          valign = "center";
        }
      ];
    };

  modules.desktop.term.foot.settings = {
    main = {
      font = "${cfg.fonts.terminal.name}:size=${toString cfg.fonts.terminal.size}";
      dpi-aware = "yes";
      pad = "9x9";
    };
    colors = mapAttrs (_: v: if isString v then removePrefix "#" v else v) {
      alpha = 0.95;
      background = cfg.colors.types.bg;
      foreground = cfg.colors.types.fg;
      selection-foreground = cfg.colors.types.panelfg;
      selection-background = cfg.colors.types.panelbg;
      urls = cfg.colors.types.highlight;
      regular0 = cfg.colors.black;
      regular1 = cfg.colors.red;
      regular2 = cfg.colors.green;
      regular3 = cfg.colors.yellow;
      regular4 = cfg.colors.blue;
      regular5 = cfg.colors.magenta;
      regular6 = cfg.colors.cyan;
      regular7 = cfg.colors.white;
      bright0 = cfg.colors.grey;
      bright1 = cfg.colors.brightred;
      bright2 = cfg.colors.brightgreen;
      bright3 = cfg.colors.brightyellow;
      bright4 = cfg.colors.brightblue;
      bright5 = cfg.colors.brightmagenta;
      bright6 = cfg.colors.brightcyan;
      bright7 = cfg.colors.silver;
    };
  };
}
</file>

<file path="modules/themes/autumnal/README.md">
# Autumnal (2024-06)

TODO
</file>

<file path="modules/themes/default.nix">
# Theme modules are a special beast. They're the only modules that are deeply
# intertwined with others, and are solely responsible for aesthetics. Disabling
# a theme module should never leave a system non-functional.

args @ { hey, heyBin, lib, options, config, pkgs, home-manager, ... }:

with lib;
with hey.lib;
let cfg = config.modules.theme;
in {
  imports = mapModules' ./. import;

  options.modules.theme = with types; {
    active = mkOption {
      type = nullOr str;
      default = null;
      apply = v: let theme = builtins.getEnv "THEME"; in
                 if theme != "" then theme else v;
      description = ''
        Name of the theme to enable. Can be overridden by the THEME environment
        variable. Themes can also be hot-swapped with 'hey theme $THEME'.
      '';
    };

    # TODO: Make attrsOf submodule
    wallpapers = mkOpt attrs {
      "*" = {
        mode = "center";
        path = "${hey.themesDir}/${toString cfg.active}/wallpaper.png";
      };
    };

    gtk = mkOpt attrs {};

    preferDark = mkOpt bool true;

    # TODO Use submodules
    fonts = {
      mono = {
        name = mkOpt str "Monospace";
        size = mkOpt float 12.0;
        package = mkOpt package null;
      };
      sans = {
        name = mkOpt str "Sans";
        size = mkOpt float 12.0;
        package = mkOpt package null;
      };
      terminal = {
        name = mkOpt str cfg.fonts.mono.name;
        size = mkOpt float (cfg.fonts.mono.size - 2.5);
        package = mkOpt package cfg.fonts.mono.package;
      };
      icons = {
        name = mkOpt str "Font Awesome 6 Free";
        size = mkOpt float cfg.fonts.sans.size;
        package = mkOpt package pkgs.font-awesome;
      };
      packages = mkOpt (listOf package) [];
    };

    colors = {
      black         = mkOpt str "#000000"; # 0
      red           = mkOpt str "#FF0000"; # 1
      green         = mkOpt str "#00FF00"; # 2
      yellow        = mkOpt str "#FFFF00"; # 3
      blue          = mkOpt str "#0000FF"; # 4
      magenta       = mkOpt str "#FF00FF"; # 5
      cyan          = mkOpt str "#00FFFF"; # 6
      silver        = mkOpt str "#BBBBBB"; # 7
      grey          = mkOpt str "#888888"; # 8
      brightred     = mkOpt str "#FF8800"; # 9
      brightgreen   = mkOpt str "#00FF80"; # 10
      brightyellow  = mkOpt str "#FF8800"; # 11
      brightblue    = mkOpt str "#0088FF"; # 12
      brightmagenta = mkOpt str "#FF88FF"; # 13
      brightcyan    = mkOpt str "#88FFFF"; # 14
      white         = mkOpt str "#FFFFFF"; # 15

      # base0  = mkOpt str "";
      # base1  = mkOpt str "";
      # base2  = mkOpt str "";
      # base3  = mkOpt str "";
      # base4  = mkOpt str "";
      # base5  = mkOpt str "";
      # base6  = mkOpt str "";
      # base7  = mkOpt str "";
      # base8  = mkOpt str "";
      # base9  = mkOpt str "";
      # base10 = mkOpt str "";
      # base11 = mkOpt str "";
      # base12 = mkOpt str "";
      # base13 = mkOpt str "";
      # base14 = mkOpt str "";
      # base15 = mkOpt str "";

      # Color classes
      types = {
        bg        = mkOpt str cfg.colors.black;
        fg        = mkOpt str cfg.colors.white;
        panelbg   = mkOpt str cfg.colors.types.bg;
        panelfg   = mkOpt str cfg.colors.types.fg;
        border    = mkOpt str cfg.colors.types.bg;
        error     = mkOpt str cfg.colors.red;
        warning   = mkOpt str cfg.colors.yellow;
        highlight = mkOpt str cfg.colors.white;
        cursor    = mkOpt str cfg.colors.types.highlight;
      };
    };
  };

  config = mkIf (cfg.active != null) (mkMerge [
    {
      hey.info.theme = {
        inherit (cfg) active colors;
        fonts = mapAttrs
          (_: v: removeAttrs v ["package"])
          (removeAttrs cfg.fonts ["packages"]);
        gtk = {
          theme = { inherit (cfg.gtk.theme) name; };
          iconTheme = { inherit (cfg.gtk.iconTheme) name; };
          cursorTheme = { inherit (cfg.gtk.cursorTheme) name size; };
        };
        wallpapers = cfg.wallpapers;
      };

      home-manager.users.${config.user.name} = {
        gtk = mkAliasDefinitions options.modules.theme.gtk;
        dconf.settings."org/gnome/desktop/interface".color-scheme = "prefer-dark";
      };
    }

    # GTK support
    (mkIf (config.modules.desktop.type != null) {
      modules.theme.gtk = {
        enable = true;
        font = mkAliasDefinitions options.modules.theme.fonts.sans;
        gtk2 = {
          extraConfig = "gtk-application-prefer-dark-theme=${boolToStr cfg.preferDark}";
          # Keep $HOME clean, damn it! (Writes to ~/.gtkrc-2.0 otherwise)
          configLocation = "${config.user.home}/.config/gtk-2.0/gtkrc";
        };
        gtk3.extraConfig.gtk-application-prefer-dark-theme = true;
        gtk4.extraConfig.gtk-application-prefer-dark-theme = true;
      };

      environment.sessionVariables.GTK2_RC_FILES = [ "$HOME/.config/gtk-2.0/gtkrc" ];
      environment.etc."gtk-2.0/gtkrc".source = config.modules.theme.gtk.gtk2.configLocation;

      # home-manager's home.pointerCursor writes to $HOME/.icons for "backwards
      # compatibility", but I don't use any software that needs this, and I'd
      # rather $HOME be tidy, so I do this manually to avoid its creation.
      environment.sessionVariables.XCURSOR_PATH = mkForce [ "/etc/profiles/per-user/${config.user.name}" "${config.home.dataDir}/icons" ];
      environment.sessionVariables.XCURSOR_THEME = cfg.gtk.cursorTheme.name;
      environment.sessionVariables.XCURSOR_SIZE = toString cfg.gtk.cursorTheme.size;
      home.dataFile = {
        "icons/default/index.theme".source =
          "${cfg.gtk.iconTheme.package}/share/icons/default/index.theme";
        "icons/${cfg.gtk.iconTheme.name}".source =
          "${cfg.gtk.iconTheme.package}/share/icons/${cfg.gtk.iconTheme.name}";
      };

      fonts.packages = [
        cfg.fonts.sans.package
        cfg.fonts.mono.package
        cfg.fonts.terminal.package
        cfg.fonts.icons.package
      ] ++ cfg.fonts.packages;

      fonts.fontconfig.defaultFonts = {
        sansSerif = [ cfg.fonts.sans.name ];
        monospace = [ cfg.fonts.mono.name ];
      };
    })

    (mkIf (config.modules.desktop.type == "x11") (mkMerge [
      {
        # Read xresources files in ~/.config/xtheme/* to allow modular
        # configuration of Xresources.
        hey.hooks.reload."10-xtheme" = ''
          cat "$XDG_CONFIG_HOME"/xtheme/* | ${pkgs.xorg.xrdb}/bin/xrdb -load
        '';

        home.configFile = {
          "xtheme/00-init".text = with cfg.colors; ''
            #define blk  ${black}
            #define red  ${red}
            #define grn  ${green}
            #define ylw  ${yellow}
            #define blu  ${blue}
            #define mag  ${magenta}
            #define cyn  ${cyan}
            #define wht  ${white}
            #define bblk ${grey}
            #define bred ${brightred}
            #define bgrn ${brightgreen}
            #define bylw ${brightyellow}
            #define bblu ${brightblue}
            #define bmag ${brightmagenta}
            #define bcyn ${brightcyan}
            #define bwht ${silver}
            #define bg   ${types.bg}
            #define fg   ${types.fg}
            #define cursor ${types.cursor}

            Xcursor.theme: ${cfg.gtk.cursorTheme.name}
            Xcursor.size: ${toString cfg.gtk.cursorTheme.size}
          '';
          "xtheme/05-colors".text = ''
            *.foreground: fg
            *.background: bg
            *.cursor: cursor
            *.color0:  blk
            *.color1:  red
            *.color2:  grn
            *.color3:  ylw
            *.color4:  blu
            *.color5:  mag
            *.color6:  cyn
            *.color7:  wht
            *.color8:  bblk
            *.color9:  bred
            *.color10: bgrn
            *.color11: bylw
            *.color12: bblu
            *.color13: bmag
            *.color14: bcyn
            *.color15: bwht
          '';
          "xtheme/05-fonts".text = with cfg.fonts.mono; ''
            *.font: xft:${name}:size=${toString size}
            Emacs.font: ${name}:size=${toString size}
          '';
        };
      }

      (mkIf config.modules.desktop.bspwm.enable {
        # To avoid polluting $HOME with .Xresources, I have
        # $XDG_CONFIG_HOME/xtheme/* read while starting up bspwm.
        home.configFile."bspwm/rc.d/05-init" = {
          text = "$XDG_DATA_HOME/dotfiles/10.xtheme.reload";
          executable = true;
        };
      })
    ]))
  ]);
}
</file>

<file path="modules/virt/lxd.nix">
# Inspired by https://www.srid.ca/2012301.html

{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.virt.lxd;
in {
  options.modules.virt.lxd = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    virtualisation.lxd.enable = true;

    user.packages = [
      (pkgs.writeScriptBin "lxc-build-nixos-image" ''
        #!/usr/bin/env nix-shell
        #!nix-shell -i bash -p nixos-generators
        set -xe
        config=$1
        metaimg=`nixos-generate -f lxc-metadata \
          | xargs -r cat \
          | awk '{print $3}'`
        img=`nixos-generate -c $config -f lxc \
          | xargs -r cat \
          | awk '{print $3}'`
        lxc image import --alias nixos $metaimg $img
      '')
    ];
  };
}
</file>

<file path="modules/virt/qemu.nix">
{ hey, lib, config, options, pkgs, ... }:

with lib;
with hey.lib;
let cfg = config.modules.virt.qemu;
in {
  options.modules.virt.qemu = {
    enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable {
    environment.systemPackages = with pkgs; [
      qemu
    ];

    # I will always update the microcode for my CPUs, so this is safe heuristic
    # for what CPU to cater to.
    boot.kernelModules =
      if config.hardware.cpu.amd.updateMicrocode
      then [ "kvm-amd" ]
      else [ "kvm-intel" ];
  };
}

# Creating an image:
#   qemu-img create -f qcow2 disk.img
# Creating a snapshot (don't tamper with disk.img):
#   qemu-img create -f qcow2 -b disk.img snapshot.img
</file>

<file path="modules/agenix.nix">
# modules/agenix.nix -- encrypt secrets in nix store

{ hey, lib, options, config, pkgs, ... }:

with builtins;
with lib;
with hey.lib;
let hostKey = "/etc/ssh/host_ed25519";
in {
  imports = [ hey.modules.agenix.age ];

  options.modules.agenix = with types; {
    dirs = mkOpt (listOf (either str path)) [
      "${hey.hostDir}/secrets"
      "${hey.configDir}/secrets"
    ];
  };

  config = {
    assertions = [
      {
        assertion =
          config.age.secrets == {} || (pathExists hostKey);
        message = "Secrets provided, but no host key was found";
      }
    ];

    # Each system gets a host key, used for decrypting Agenix secrets and as a
    # deployment key via Git. It's expected to be provisioned before the system
    # is initially installe (presumably with 'hey ops push-keys $HOST' from a
    # system with bitwarden set up).
    programs.ssh.extraConfig = ''
      Host *
        IdentityFile ${hostKey}
    '';

    # Ensure this hostkey is the default key used by agenix.
    environment.systemPackages = with pkgs; [
      # Respect XDG, damn it!
      (writeShellScriptBin "agenix" ''
        ARGS=( "$@" )
        ${optionalString config.modules.xdg.ssh.enable ''
          if [[ "''${ARGS[*]}" != *"--identity"* && "''${ARGS[*]}" != *"-i"* ]]; then
            for hostkey in "${hostKey}"; do
              if [[ -f "$hostkey" ]]; then
                ARGS=( --identity "$hostkey" "''${ARGS[@]}" )
              fi
            done
          fi
        ''}
        exec ${hey.inputs.agenix.packages.${system}.default}/bin/agenix "''${ARGS[@]}"
      '')
    ];

    age = {
      identityPaths = [ hostKey ];
      secrets = foldl (a: b: a // b) {}
        (map (dir: mapAttrs'
          (n: v: nameValuePair (removeSuffix ".age" n) {
            file = "${dir}/${n}";
            owner = mkDefault config.user.name;
          })
          (import "${dir}/secrets.nix"))
          (filter (dir: pathExists "${dir}/secrets.nix")
            config.modules.agenix.dirs));
    };
  };
}
</file>

<file path="modules/hey.nix">
# modules/hey.nix -- powering my binscripts
#
# ZSH and Janet are the powerhouses of my dotfiles. This module configures both
# for my scripting needs (particularly by bin/hey).

{ hey, lib, options, config, pkgs, ... }:

with builtins;
with lib;
with hey.lib;
let cfg = config.hey;

    janet = pkgs.janet;
    jpm = mkWrapper pkgs.jpm ''
      wrapProgram $out/bin/jpm --add-flags '--tree="$JANET_TREE" --binpath="$XDG_BIN_HOME" --headerpath=${janet}/include --libpath=${janet}/lib --ldflags=-L${pkgs.glibc}/lib '
    '';
    janetTreeDir = "${config.home.dataDir}/janet/jpm_tree";
in {
  options = with types; {
    hey = {
      info = mkOpt (attrsOf attrs) {};
      hooks = mkOpt (attrsOf (attrsOf lines)) {};
    };
  };

  config = {
    # So systemd services in downstream modules/profiles can call hey without
    # dealing with PATH shenanigans.
    _module.args.heyBin = "${janet}/bin/janet ${hey.binDir}/hey";

    environment.systemPackages = with pkgs; [
      gcc
      janet
      jpm
      jq
      bind
      cached-nix-shell
      nix-prefetch-git
      dash
      file
      git
      wget
      zsh
    ];

    environment.sessionVariables = {
      JANET_PATH = "${janetTreeDir}/lib";
      JANET_TREE = janetTreeDir;
    };

    # Setting PATH in both environment.{variables,sessionVariables} causes
    # merge-conflict errors, so do these separately.
    environment.extraInit = mkAfter ''
      export PATH="${janetTreeDir}/bin:${hey.binDir}:$PATH"
    '';

    # Compile bin/hey to trivialize janet startup time
    # TODO: Include gcc for 'jpm deps'
    system.userActivationScripts.initHey = ''
      ${pkgs.zsh}/bin/zsh -c 'echo $PATH' >"$XDG_DATA_HOME/hey/path"

      export JANET_PATH="${janetTreeDir}/lib"
      export JANET_TREE="${janetTreeDir}"
      ${pkgs.zsh}/bin/zsh -c "cd '${hey.dir}'; jpm deps"
      ${pkgs.zsh}/bin/zsh -c "cd '${hey.dir}'; jpm run deploy"
    '';

    programs.zsh.shellInit = mkBefore ''
      export DOTFILES_HOME="${hey.dir}"
      export fpath=( "${hey.libDir}/zsh" "''${fpath[@]}" )
      autoload -Uz "''${fpath[1]}"/hey.*(.:t)
    '';

    systemd.user.tmpfiles.rules = [
      "d %h/.local/share/janet/jpm_tree 755 - - - -"
    ];

    home.dataFile = {
      # This file is intended as a reference for shell scripts to peek into to
      # do cheap feature-detection (using `hey vars ...`)
      "hey/info.json".text = toJSON cfg.info;
    } //
    # FIXME: Refactor me?
    (listToAttrs
      (flatten
        (mapAttrsToList
          (hook: hooks: mapAttrsToList
            (n: v: nameValuePair
              (let filename =
                     if (match "^[0-9]{2}-.+" n) == null
                     then "50-${n}"
                     else n;
               in "hey/hooks.d/${hook}.d/${filename}") {
                 text = ''
                   #!/usr/bin/env zsh
                   ${v}
                 '';
                 executable = true;
               }) hooks)
          config.hey.hooks)));
  };
}
</file>

<file path="modules/home.nix">
# modules/home.nix -- the $HOME manager
#
# This is NOT a home-manager home.nix file. This NixOS module does two things:
#
# 1. Sets up home-manager to be used as NixOS module (exposing only a subset of
#    its API).
#
# 2. Enforce XDG compliance, whether programs want to or not. #
#
# I'm sure I'm reinventing wheels by not using more of home-manager's
# capabilities, but it's already an ordeal to maintain this config on top of
# nixpkgs and its rapidly-shifting idiosynchrosies (though it's still better
# than what I had before NixOS). home-manager is one black box too many for my
# liking.

{ hey, lib, config, options, home-manager, pkgs, ... }:

with builtins;
with lib;
with hey.lib;
let cfg = config.home;
in {
  imports = [
    hey.modules.home-manager.default
  ];

  options.home = with types; {
    file       = mkOpt' attrs {} "Files to place directly in $HOME";
    configFile = mkOpt' attrs {} "Files to place in $XDG_CONFIG_HOME";
    dataFile   = mkOpt' attrs {} "Files to place in $XDG_DATA_HOME";
    fakeFile   = mkOpt' attrs {} "Files to place in $XDG_FAKE_HOME";

    dir        = mkOpt str "${config.user.home}";
    binDir     = mkOpt str "${cfg.dir}/.local/bin";
    cacheDir   = mkOpt str "${cfg.dir}/.cache";
    configDir  = mkOpt str "${cfg.dir}/.config";
    dataDir    = mkOpt str "${cfg.dir}/.local/share";
    stateDir   = mkOpt str "${cfg.dir}/.local/state";
    fakeDir    = mkOpt str "${cfg.dir}/.local/user";
  };

  config = {
    environment.localBinInPath = true;

    environment.sessionVariables = mkOrder 10 {
      # These are the defaults, and xdg.enable does set them, but due to load
      # order, they're not set before environment.variables are set, which
      # could cause race conditions.
      XDG_BIN_HOME    = cfg.binDir;
      XDG_CACHE_HOME  = cfg.cacheDir;
      XDG_CONFIG_HOME = cfg.configDir;
      XDG_DATA_HOME   = cfg.dataDir;
      XDG_STATE_HOME  = cfg.stateDir;

      # This is not in the XDG standard. It's my jail for stubborn programs,
      # like Firefox, Steam, and LMMS.
      XDG_FAKE_HOME = cfg.fakeDir;
      XDG_DESKTOP_DIR = cfg.fakeDir;
    };

    home.file =
      mapAttrs' (k: v: nameValuePair "${config.home.fakeDir}/${k}" v)
        config.home.fakeFile;

    # Install user packages to /etc/profiles instead. Necessary for
    # nixos-rebuild build-vm to work.
    home-manager = {
      useUserPackages = true;

      # I only need a subset of home-manager's capabilities. That is, access to
      # its home.file, home.xdg.configFile and home.xdg.dataFile so I can deploy
      # files easily to my $HOME, but 'home-manager.users.hlissner.home.file.*'
      # is much too long and harder to maintain, so I've made aliases in:
      #
      #   home.file        ->  home-manager.users.hlissner.home.file
      #   home.configFile  ->  home-manager.users.hlissner.home.xdg.configFile
      #   home.dataFile    ->  home-manager.users.hlissner.home.xdg.dataFile
      users.${config.user.name} = {
        home = {
          file = mkAliasDefinitions options.home.file;
          # Necessary for home-manager to work with flakes, otherwise it will
          # look for a nixpkgs channel.
          stateVersion = config.system.stateVersion;
        };
        xdg = {
          # enable = true;
          configFile = mkAliasDefinitions options.home.configFile;
          dataFile   = mkAliasDefinitions options.home.dataFile;

          # Force these, since it'll be considered an abstraction leak to use
          # home-manager's API anywhere outside this module.
          cacheHome  = mkForce cfg.cacheDir;
          configHome = mkForce cfg.configDir;
          dataHome   = mkForce cfg.dataDir;
          stateHome  = mkForce cfg.stateDir;
        };
      };
    };
  };
}
</file>

<file path="modules/security.nix">
{ lib, config, ... }:

{
  ## System security tweaks
  # tmpfs = /tmp is mounted in ram. Doing so makes temp file management speedy
  # on ssd systems and more secure (and volatile!) because it's wiped on reboot.
  boot.tmp.useTmpfs = lib.mkDefault true;
  # If not using tmpfs, which is naturally purged on reboot, we must clean it
  # /tmp ourselves. /tmp should be volatile storage!
  boot.tmp.cleanOnBoot = lib.mkDefault (!config.boot.tmp.useTmpfs);

  # Fix a security hole in place for backwards compatibility. See desc in
  # nixpkgs/nixos/modules/system/boot/loader/systemd-boot/systemd-boot.nix
  boot.loader.systemd-boot.editor = lib.mkDefault false;

  boot.kernel.sysctl = {
    # The Magic SysRq key is a key combo that allows users connected to the
    # system console of a Linux kernel to perform some low-level commands.
    # Disable it, since we don't need it, and is a potential security concern.
    "kernel.sysrq" = 0;

    ## TCP hardening
    # Prevent bogus ICMP errors from filling up logs.
    "net.ipv4.icmp_ignore_bogus_error_responses" = 1;
    # Reverse path filtering causes the kernel to do source validation of
    # packets received from all interfaces. This can mitigate IP spoofing.
    "net.ipv4.conf.default.rp_filter" = 1;
    "net.ipv4.conf.all.rp_filter" = 1;
    # Do not accept IP source route packets (we're not a router)
    "net.ipv4.conf.all.accept_source_route" = 0;
    "net.ipv6.conf.all.accept_source_route" = 0;
    # Don't send ICMP redirects (again, we're not a router)
    "net.ipv4.conf.all.send_redirects" = 0;
    "net.ipv4.conf.default.send_redirects" = 0;
    # Refuse ICMP redirects (MITM mitigations)
    "net.ipv4.conf.all.accept_redirects" = 0;
    "net.ipv4.conf.default.accept_redirects" = 0;
    "net.ipv4.conf.all.secure_redirects" = 0;
    "net.ipv4.conf.default.secure_redirects" = 0;
    "net.ipv6.conf.all.accept_redirects" = 0;
    "net.ipv6.conf.default.accept_redirects" = 0;
    # Protects against SYN flood attacks
    "net.ipv4.tcp_syncookies" = 1;
    # Incomplete protection again TIME-WAIT assassination
    "net.ipv4.tcp_rfc1337" = 1;

    ## TCP optimization
    # TCP Fast Open is a TCP extension that reduces network latency by packing
    # data in the sender’s initial TCP SYN. Setting 3 = enable TCP Fast Open for
    # both incoming and outgoing connections:
    "net.ipv4.tcp_fastopen" = 3;
    # Bufferbloat mitigations + slight improvement in throughput & latency
    "net.ipv4.tcp_congestion_control" = "bbr";
    "net.core.default_qdisc" = "cake";
  };
  boot.kernelModules = [ "tcp_bbr" ];

  # Change me later!
  user.initialPassword = "nixos";
  users.users.root.initialPassword = "nixos";

  # Harden SSH client
  programs.ssh = {
    # Known vulnerability. See
    # https://security.stackexchange.com/questions/110639/how-exploitable-is-the-recent-useroaming-ssh-vulnerability
    extraConfig = ''
      Host *
        UseRoaming no
    '';
  };

  # So we don't have to do this later...
  security.acme.acceptTerms = true;
}
</file>

<file path="modules/xdg.nix">
# xdg.nix --- enforcing XDG compliance
#
# This module tries to enforce XDG compliance, whether programs want to or not,
# relegating the most stubborn programs to a fake $HOME (i.e. in ~/.local/user).
# But I hate that all this is necessary. There are a few (albeit important)
# projects that staunchly refuse these conventions, and never with good reason,
# so it's a lost cause. Best to just deal with it quickly so I can move on to
# more important things...
#
# PS. ValveSoftware/steam-for-linux#1890 is a gold mine.

{ hey, lib, config, options, pkgs, ... }:

with builtins;
with lib;
with hey.lib;
let cfg = config.modules.xdg;
    home = config.home;
in {
  imports = [
    hey.modules.home-manager.default
  ];

  options.modules.xdg = {
    enable = mkBoolOpt true;
    ssh.enable = mkBoolOpt false;
  };

  config = mkIf cfg.enable (mkMerge [
    {
      # Get Nix (2.14+) itself to respect XDG. I.e.
      # ~/.nix-defexpr -> $XDG_DATA_HOME/nix/defexpr
      # ~/.nix-profile -> $XDG_DATA_HOME/nix/profile
      # ~/.nix-channels -> $XDG_DATA_HOME/nix/channels
      nix.settings.use-xdg-base-directories = true;
      # nix.extraOptions = ''
      #   use-xdg-base-directories = true
      # '';

      ### A tidy $HOME is a tidy mind
      # home-manager.users.${config.user.name}.xdg.enable = true;

      environment = {
        # Some GUI programs consult this, ignoring XDG conventions if it isn't
        # available (sigh).
        systemPackages = [ pkgs.xdg-user-dirs ];

        # These are set early in the login process by PAM; much sooner than
        # environment.variables, so the important variables go here. The actual
        # XDG_*_HOME variables are defined in home-manager.nix.
        sessionVariables = {
          __GL_SHADER_DISK_CACHE_PATH = "/tmp/nv";

          # X11 systems only: prevents creation of ~/.compose-cache, and must be
          # set especially early to intercept this silliness:
          # https://github.com/NixOS/nixpkgs/blob/25865a40d14b3f9cf19f19b924e2ab4069b09588/nixos/modules/services/x11/display-managers/default.nix#L98-L105,
          XCOMPOSECACHE = "/tmp/xcompose";
        };

        # Conform common programs to XDG conventions, leaving the rest to their
        # respective modules.
        variables = {
          # Common shells
          BASH_COMPLETION_USER_FILE = "$XDG_CONFIG_HOME/bash/completion";
          ENV             = "$XDG_CONFIG_HOME/shell/shrc";  # sh, ksh
          # Common databases
          MYSQL_HISTFILE  = "$XDG_STATE_HOME/mysql/history";
          PGPASSFILE      = "$XDG_CONFIG_HOME/pg/pgpass";
          PGSERVICEFILE   = "$XDG_CONFIG_HOME/pg";
          PSQLRC          = "$XDG_CONFIG_HOME/pg/psqlrc";
          PSQL_HISTORY    = "$XDG_STATE_HOME/psql_history";
          SQLITE_HISTORY  = "$XDG_STATE_HOME/sqlite/history";
          # Misc
          ASPELL_CONF     = ''per-conf $XDG_CONFIG_HOME/aspell/aspell.conf; personal $XDG_CONFIG_HOME/aspell/en_US.pws; repl $XDG_CONFIG_HOME/aspell/en.prepl;'';
          BZRPATH         = "$XDG_CONFIG_HOME/bazaar";
          BZR_HOME        = "$XDG_CACHE_HOME/bazaar";
          BZR_PLUGIN_PATH = "$XDG_DATA_HOME/bazaar";
          DVDCSS_CACHE    = "$XDG_CACHE_HOME/dvdcss";
          ICEAUTHORITY    = "$XDG_CACHE_HOME/ICEauthority";
          INPUTRC         = "$XDG_CONFIG_HOME/readline/inputrc";
          LESSHISTFILE    = "$XDG_STATE_HOME/less/history";
          LESSKEY         = "$XDG_CONFIG_HOME/less/keys";
          SUBVERSION_HOME = "$XDG_CONFIG_HOME/subversion";
          WGETRC          = "$XDG_CONFIG_HOME/wgetrc";
        };

        # For programs that don't expose an envvar or for whom XDG compliance is
        # only relevant during interactive shell use.
        shellAliases = {
          sqlite3 = ''sqlite3 -init "$XDG_CONFIG_HOME/sqlite3/sqliterc"'';
          wget = ''wget --hsts-file="$XDG_CACHE_HOME/wget-hsts"'';
        };

        # Don't recreate the $HOME/*/ XDG directories on login (in some desktop
        # environments).
        etc."xdg/user-dirs.conf".text = ''
          enabled=False
        '';
      };

      # Different (GUI) programs have competing opinions about what should go
      # where. Some ignore the envvars and only listen to xdg-user-dirs (thus
      # necessitating a user-dirs.dirs file), others (that may otherwise support
      # the convention) barrel on ahead and create files in $HOME anyway before
      # doing the right thing, and a few decide to pop a dotfile subfolder into
      # $HOME (like Documents or Videos). War. War never changes.
      home.configFile."user-dirs.dirs".text = ''
        XDG_DESKTOP_DIR="${home.fakeDir}/Desktop"
        XDG_DOCUMENTS_DIR="${home.fakeDir}/Documents"
        XDG_DOWNLOAD_DIR="${home.fakeDir}/Downloads"
        XDG_MUSIC_DIR="${home.fakeDir}/Music"
        XDG_PICTURES_DIR="${home.fakeDir}/Pictures"
        XDG_PUBLICSHARE_DIR="${home.fakeDir}/Share"
        XDG_TEMPLATES_DIR="${home.fakeDir}/Templates"
        XDG_VIDEOS_DIR="${home.fakeDir}/Videos"
      '';

      # Auto-create XDG directories, ensure correct permissions, and generate a
      # fake $HOME in XDG_DATA_HOME for jailing silly programs and their even
      # sillier developers for resisting XDG conventions. Some tools may
      # auto-create them with overly permissive defaults OR may not create them
      # at all when trying to write them, causing errors. Best to do it right
      # from the start.
      system.userActivationScripts.initXDG = ''
        for dir in "$XDG_DESKTOP_DIR" "$XDG_STATE_HOME" "$XDG_DATA_HOME" "$XDG_CACHE_HOME" "$XDG_BIN_HOME" "$XDG_CONFIG_HOME"; do
          mkdir -p "$dir" -m 700
        done

        # Populate the fake home with .local and .config, so certain things are
        # still in scope for the jailed programs, like fonts, data, and files,
        # should they choose to use them at all.
        fakehome="${home.fakeDir}"
        mkdir -p "$fakehome" -m 755
        [ -e "$fakehome/.local" ]  || ln -sf ~/.local  "$fakehome/.local"
        [ -e "$fakehome/.config" ] || ln -sf ~/.config "$fakehome/.config"

        # Avoid the creation of ~/.pki (typically by Firefox), by ensuring NSS
        # finds this directory.
        rm -rf "$HOME/.pki"
        mkdir -p "$XDG_DATA_HOME/pki/nssdb"
      '';

      # dbus-broker doesn't produce a $HOME/.dbus like the dbus daemon does.
      services.dbus.implementation = "broker";

      # Ensures .Xauthority is written (by the display manager or X11-compatible
      # programs) to $XDG_RUNTIME_DIR and /run/lightdm/*/, instead of $HOME.
      services.xserver.displayManager.lightdm.extraConfig = "user-authority-in-system-dir = true\n";
      services.displayManager.environment.XAUTHORITY = "$XDG_RUNTIME_DIR/xauthority";

      # See https://kdemonkey.blogspot.com/2008/04/magic-trick.html, then
      # https://github.com/NixOS/nixpkgs/blob/25865a40d14b3f9cf19f19b924e2ab4069b09588/nixos/modules/services/x11/display-managers/default.nix#L98-L105,
      # which creates $HOME/.compose-cache without this.
      services.displayManager.environment.XCOMPOSECACHE =
        config.environment.sessionVariables.XCOMPOSECACHE;
    }

    ## Forcing SSH to respect XDG.
    # HACK: This could break tools that rely on openssh (and even openssh
    #   itself), like DropBear. None of my tools/workflows on my workstations
    #   are broken by this, so I can ignore it, but it's opt-in for a reason.
    #
    #   Only issue I've found, so far, is that ssh-keygen writes to ~/.ssh by
    #   default (use -f to overwrite).
    (let keyFiles = [ "id_dsa" "id_ecdsa" "id_ecdsa_sk" "id_ed25519" "id_ed25519_sk" "id_rsa" ];
         keyFilesStr = concatStringsSep " " keyFiles;
         sshConfigDir = "$XDG_CONFIG_HOME/ssh";
     in mkIf cfg.ssh.enable {
       # To spare us passing the extra options to the executables, we set these
       # in the system config file.
       programs.ssh.extraConfig = ''
         Host *
           ${concatMapStringsSep "\n" (key: "IdentityFile ~/.config/ssh/${key}") keyFiles}
           UserKnownHostsFile ~/.config/ssh/known_hosts
       '';

       environment.systemPackages = with pkgs; with hey.lib.pkgs; [
         (mkWrapper openssh ''
           dir='${sshConfigDir}'
           cfg="$dir/config"
           wrapProgram "$out/bin/ssh" \
             --run "[ -s \"$cfg\" ] && opts='-F \"$cfg\"'" \
             --add-flags '$opts'
           wrapProgram "$out/bin/scp" \
             --run "[ -s \"$cfg\" ] && opts='-F \"$cfg\"'" \
             --add-flags '$opts'
           wrapProgram "$out/bin/ssh-add" \
             --run "dir=\"$dir\"" \
             --run 'args=()' \
             --run '[ $# -eq 0 ] && for f in ${keyFilesStr}; do [ -f "$dir/$f" ] && args+="$dir/$f"; done' \
             --add-flags '-H "$dir/known_hosts"' \
             --add-flags '-H "/etc/ssh/ssh_known_hosts"' \
             --add-flags '"''${args[@]}"'
         '')
         (mkWrapper ssh-copy-id ''
           wrapProgram "$out/bin/ssh-copy-id" \
             --run 'dir="${sshConfigDir}"' \
             --run 'opts=(); for f in ${keyFilesStr}; do [ -f "$dir/$f" ] && opts+="-i '$dir/$f'"; done' \
             --append-flags '"''${opts[@]}"'
         '')
       ];
     })
  ]);
}
</file>

<file path="packages/rofi-blocks/0001-Patch-plugindir-to-output.patch">
diff --git a/configure.ac b/configure.ac
index 1ca2cc6..078001b 100644
--- a/configure.ac
+++ b/configure.ac
@@ -57,7 +57,7 @@ PKG_CHECK_MODULES([glib],     [glib-2.0 >= 2.40 gio-unix-2.0 gmodule-2.0 json-gl
 PKG_CHECK_MODULES([cairo],    [cairo])
 PKG_CHECK_MODULES([rofi],     [rofi])
 
-[rofi_PLUGIN_INSTALL_DIR]="`$PKG_CONFIG --variable=pluginsdir rofi`"
+[rofi_PLUGIN_INSTALL_DIR]="`echo $out/lib/rofi`"
 AC_SUBST([rofi_PLUGIN_INSTALL_DIR])
 
 LT_INIT([disable-static])
</file>

<file path="packages/rofi-blocks/default.nix">
# rofi-blocks: a plugin for Rofi that enables more dynamic interaction between
# Rofi's state and an arbitrary process. It's not on nixpkgs so...

{ self, lib, stdenv
, fetchFromGitHub
, autoreconfHook
, pkg-config
, json-glib
, rofi-unwrapped
, pango
, glib
, cairo
, gobject-introspection
, wrapGAppsHook }:

stdenv.mkDerivation rec {
  name = "rofi-blocks";

  src = fetchFromGitHub {
    owner = "OmarCastro";
    repo = name;
    rev = "1708f2cb50e593e06cc22eedeecbb4b41584668d";
    sha256 = "0rg007iwws4x6057y28rrkfm931z75x82prms3jzk8q14xxlvvcc";
  };

  nativeBuildInputs = [
    autoreconfHook
    pkg-config
    gobject-introspection
    wrapGAppsHook
  ];

  buildInputs = [
    rofi-unwrapped
    pango
    glib
    cairo
    json-glib
  ];

  patches = [ ./0001-Patch-plugindir-to-output.patch ];

  meta = with lib; {
    description = "Control rofi content through an external process.";
    homepage = "https://github.com/OmarCastro/rofi-blocks";
    license = licenses.gpl3;
    maintainers = [];
    platforms = with platforms; linux;
  };
}
</file>

<file path="test/hey/mock.d/sub.d/deeper.d/.docs">
Test #2
</file>

<file path="test/hey/mock.d/sub.d/.docs">
Hello world
</file>

<file path="test/hey/mock.d/vars.zsh">
#!/usr/bin/env zsh
# TODO

# Setup
export HEYSTORE="$XDG_DATA_HOME/hey/env.test.d"
rm -rf $HEYSTORE
trap "rm -rf $HEYSTORE" EXIT
mkdir -p ${HEYSTORE}
local -A vars=( [__test_varA]=123 [__test_varB]=321 )

# Tests
for key val in ${(kv)vars}; do
  @test -z '$(hey vars get '$key')'
  @test -z '$(hey vars get '$key')'
  @test '$(hey vars set '$key' '$val') == '$val''
  @test '$(hey vars get '$key') == '$val''
  @test '$(echo "XYZ" | hey vars set -i '$key') == XYZ'
  @test '$(hey vars get '$key') == XYZ'
done
@test '$(hey vars) == "'${(kj. .)vars[@]}'"'

# Cleanup
for key val in ${(kv)vars}; do
  @test '$(hey vars set '$key' nil) == '$key''
  @test -z '$(hey vars get '$key')'
done
@test -z '$(hey vars)'
</file>

<file path="test/hey/glob.janet">
#!/usr/bin/env janet

(use judge)
(use hey)
(import hey/glob)

# TODO (deftest to-peg)

# TODO (deftest match*)

# TODO (deftest match)

# TODO (deftest case)
</file>

<file path="test/hey/hey.janet">
#!/usr/bin/env janet

(use judge)
(import hey)
(import spork/path)

(def- dir (slice (path/dirname (dyn :current-file)) 0 -2))

(defmacro* resolve= [type args &opt exp]
  (let [form ~(,(case type :f hey/resolve :d hey/resolve-dir)
                ,(path/join dir (string (first args)))
                ,;(map string (slice args 1)))]
  ~(test ,(if exp form ~(nil? ,form))
         ,(if exp ~[,(path/join dir (first exp)) ,;(slice exp 1)] true))))

(deftest hey/resolve
  (resolve= :f [mock.d sub deeper]               ["mock.d/sub.d/deeper.zsh"])
  (resolve= :f [mock.d sub deeper foo]           ["mock.d/sub.d/deeper.zsh" "foo"])
  (resolve= :f [mock.d sub deeper deep foo]      ["mock.d/sub.d/deeper.d/deep.zsh" "foo"])

  # Invalid/404
  (deftest "Invalid paths"
    (resolve= :f [mock sub deeper])
    (resolve= :f [does not exist]))

  (deftest "Forwarding options"
    (resolve= :f [mock.d sub deeper -b]            ["mock.d/sub.d/deeper.zsh" "-b"])
    (resolve= :f [mock.d sub deeper --foo]         ["mock.d/sub.d/deeper.zsh" "--foo"])
    (resolve= :f [mock.d sub deeper -b deep]       ["mock.d/sub.d/deeper.zsh" "-b" "deep"])
    (resolve= :f [mock.d sub deeper --foo deep]    ["mock.d/sub.d/deeper.zsh" "--foo" "deep"])
    (resolve= :f [mock.d sub deeper deep --foo -b] ["mock.d/sub.d/deeper.d/deep.zsh" "--foo" "-b"])
    (resolve= :f [mock.d sub deeper deep -b]       ["mock.d/sub.d/deeper.d/deep.zsh" "-b"])))

# (deftest hey/help)

# (deftest hey/dispatcher-for)
</file>

<file path="test/hey/lib.janet">
#!/usr/bin/env janet

(use judge)
(use hey)

(deftest atom?
  (test (all atom? [true false 0 1 1.5 "string" :keyword 'symbol])
        true)
  (test (all |(not (atom? $))
             [[1 2 3] @[1 2 3] {:foo 1 :bar 2} @{:foo 1 :bar 2} (fn (&)) atom?])
        true))

(deftest array/remove-elt
  (let [values @[1 2 3]]
    (test (array/remove-elt values 3) @[1 2])
    (test (array/remove-elt values 1) @[2])
    (test values @[2])))

(deftest macros
  (deftest with-envvars
    (test (os/getenv "TEST") nil)
    (with-envvars ["TEST" "123"]
      (test (os/getenv "TEST") "123")
      (os/setenv "TEST" "321")
      (test (os/getenv "TEST") "321"))
    (test (os/getenv "TEST") nil))

  # TODO (deftest with-umask)
  )

(deftest string
  (deftest chomp
    (test (string/chomp "foo") "foo")
    (test (string/chomp "foo\n") "foo")
    (test (string/chomp "foo\nbar\n\nbaz") "foo\nbar\n\nbaz"))

  # TODO (deftest no-suffix)
  # TODO (deftest no-prefix)
  )

(deftest path
  (deftest find
    (test (truthy? (path/find "janet")) true)
    (test (path/find "janet" []) nil)
    (test (path/find "does-not-exist") nil))

  # TODO (deftest sibling)
  # TODO (deftest files-in)
  # TODO (deftest abbrev)
  )
</file>

<file path="test/hey/vars.janet">
#1/usr/bin/env janet

(use judge)
(use hey)
(import hey/vars)

(def- vars (vars/new (:dir vars/temp :test)))

(defn- setup []
  ($ rm -rf ,(:dir vars)))  # Always start from scratch

(deftest get/set
  (setup)
  (test (:get vars :does-not-exist) nil)
  (test (:set vars :key 123) 123)
  (test (:get vars :key) 123)
  (test (:set vars :key nil) :key))

(deftest list
  (setup)
  (:set vars :foo 1)
  (:set vars :bar 2)
  (:set vars :baz 3)
  (test (length (:list vars)) 3)
  (:clear vars)
  (test (length (:list vars)) 0))

# TODO
# (deftest cache)
</file>

<file path="test/hey/zsh.janet">
#!/usr/bin/env janet

(use judge)
(use sh)
(import hey)

(defmacro zsh [& args]
  ~(,(first args) zsh ,(hey/path :lib "zsh" (get args 1)) ,;(slice args 2)))

(def- null (file/open "/dev/null"))

(deftest hey.requires
  (test (zsh $? hey.requires zsh bash sh) true)
  (test (zsh $? hey.requires zsh bash doesnotexist > [stderr null]) false)
  (test (zsh $? hey.requires doesnotexist > [stderr null]) false))

(deftest hey.do
  (test (zsh $<_ hey.do echo 10) "10")
  (hey/with-envvars ["HEYDRYRUN" "1"]
    (let [out @"" err @""]
      (zsh $<_ hey.do echo 10 > ,out > [stderr err])
      (test (deep-not= err @"") true)
      (test out @""))))
</file>

<file path=".editorconfig">
[{bin/*,**/*.zsh,.zshrc,.zshenv}]
indent_style = space
indent_size = 2
</file>

<file path=".gitignore">
/build/
/result
*.zwc
*.janet.tested
</file>

<file path="default.nix">
# default.nix

{ hey, lib, options, config, pkgs, ... }:

with lib;
with hey.lib;
{
  imports = mapModulesRec' ./modules import;

  options = with types; {
    modules = {};

    # Creates a simpler, polymorphic alias for users.users.$USER.
    user = mkOpt attrs { name = ""; };
  };

  config = {
    assertions = [{
      assertion = config.user ? name;
      message = "config.user.name is not set!";
    }];

    environment.sessionVariables = mkOrder 10 {
      DOTFILES_HOME = hey.dir;
      NIXPKGS_ALLOW_UNFREE = "1";   # Forgive me Stallman-senpai.
    };

    # FIXME: Make this optional
    user = {
      description = mkDefault "The primary user account";
      extraGroups = [ "wheel" ];
      isNormalUser = true;
      home = "/home/${config.user.name}";
      group = "users";
      uid = 1000;
    };
    users.users.${config.user.name} = mkAliasDefinitions options.user;


    ## Core, universal configuration for all NixOS machines.
    # This is here to appease 'nix flake check' for generic hosts with no
    # hardware-configuration.nix or fileSystem config.
    fileSystems."/".device = mkDefault "/dev/disk/by-label/nixos";

    nix =
      let filteredInputs = filterAttrs (_: v: v ? outputs) hey.inputs;
          nixPathInputs  = mapAttrsToList (n: v: "${n}=${v}") filteredInputs;
      in {
        extraOptions = ''
          warn-dirty = false
          http2 = true
          experimental-features = nix-command flakes
        '';
        nixPath = nixPathInputs ++ [
          "nixpkgs-overlays=${hey.dir}/overlays"
          "dotfiles=${hey.dir}"
        ];
        registry = mapAttrs (_: v: { flake = v; }) filteredInputs;
        settings = {
          substituters = [
            "https://nix-community.cachix.org"
            "https://hyprland.cachix.org"
          ];
          trusted-public-keys = [
            "nix-community.cachix.org-1:mB9FSh9qf2dCimDSUo8Zy7bkq5CX+/rkCWyvRCYg3Fs="
            "hyprland.cachix.org-1:a7pgxzMz7+chwVL3/pzj6jIBMioiJM7ypFP8PwtkuGc="
          ];
          trusted-users = [ "root" config.user.name ];
          allowed-users = [ "root" config.user.name ];
          auto-optimise-store = true;
        };
      };

    system = {
      configurationRevision = with hey.inputs; mkIf (hey ? rev) hey.rev;
      stateVersion = "23.11";
    };

    boot = {
      # initrd.systemd.enable = true;
      # Prefer the latest kernel; this will be overridden on more security
      # conscious systems, among other settings in modules/security.nix.
      kernelPackages = mkDefault pkgs.linuxKernel.packages.linux_6_12;
      loader = {
        efi.canTouchEfiVariables = mkDefault true;
        # To not overwhelm the boot screen.
        systemd-boot.configurationLimit = mkDefault 10;
      };
    };

    # For unfree hardware my laptops/refurbed systems will likely have.
    hardware.enableRedistributableFirmware = true;

    # For `hey sync build-vm` (or `nixos-rebuild build-vm`)
    virtualisation.vmVariant.virtualisation = {
      memorySize = 2048;  # default: 1024
      cores = 2;          # default: 1
    };
  };
}
</file>

<file path="flake.lock">
{
  "nodes": {
    "agenix": {
      "inputs": {
        "darwin": "darwin",
        "home-manager": "home-manager",
        "nixpkgs": [
          "nixpkgs"
        ],
        "systems": "systems"
      },
      "locked": {
        "lastModified": 1754433428,
        "narHash": "sha256-NA/FT2hVhKDftbHSwVnoRTFhes62+7dxZbxj5Gxvghs=",
        "owner": "ryantm",
        "repo": "agenix",
        "rev": "9edb1787864c4f59ae5074ad498b6272b3ec308d",
        "type": "github"
      },
      "original": {
        "owner": "ryantm",
        "repo": "agenix",
        "type": "github"
      }
    },
    "blender-bin": {
      "inputs": {
        "nixpkgs": [
          "nixpkgs-unstable"
        ]
      },
      "locked": {
        "dir": "blender",
        "lastModified": 1755896146,
        "narHash": "sha256-JAVIWAMG3imYamhxvx94FtvHt17pC/z2fCHDiwla45I=",
        "owner": "edolstra",
        "repo": "nix-warez",
        "rev": "8ae661516ca53314cfad8a8d3ab41e2274fdc168",
        "type": "github"
      },
      "original": {
        "dir": "blender",
        "owner": "edolstra",
        "repo": "nix-warez",
        "type": "github"
      }
    },
    "darwin": {
      "inputs": {
        "nixpkgs": [
          "agenix",
          "nixpkgs"
        ]
      },
      "locked": {
        "lastModified": 1744478979,
        "narHash": "sha256-dyN+teG9G82G+m+PX/aSAagkC+vUv0SgUw3XkPhQodQ=",
        "owner": "lnl7",
        "repo": "nix-darwin",
        "rev": "43975d782b418ebf4969e9ccba82466728c2851b",
        "type": "github"
      },
      "original": {
        "owner": "lnl7",
        "ref": "master",
        "repo": "nix-darwin",
        "type": "github"
      }
    },
    "disko": {
      "inputs": {
        "nixpkgs": [
          "nixpkgs"
        ]
      },
      "locked": {
        "lastModified": 1756115622,
        "narHash": "sha256-iv8xVtmLMNLWFcDM/HcAPLRGONyTRpzL9NS09RnryRM=",
        "owner": "nix-community",
        "repo": "disko",
        "rev": "bafad29f89e83b2d861b493aa23034ea16595560",
        "type": "github"
      },
      "original": {
        "owner": "nix-community",
        "repo": "disko",
        "type": "github"
      }
    },
    "emacs-overlay": {
      "inputs": {
        "nixpkgs": [
          "nixpkgs"
        ],
        "nixpkgs-stable": "nixpkgs-stable"
      },
      "locked": {
        "lastModified": 1756398784,
        "narHash": "sha256-NDN9nhjuZj8ezwaKik3oDf3z1Q8rqu1vHloXkzmaSCE=",
        "owner": "nix-community",
        "repo": "emacs-overlay",
        "rev": "e6284e769bcc1beb81b35f56fc0598ad613ac51f",
        "type": "github"
      },
      "original": {
        "owner": "nix-community",
        "repo": "emacs-overlay",
        "type": "github"
      }
    },
    "home-manager": {
      "inputs": {
        "nixpkgs": [
          "agenix",
          "nixpkgs"
        ]
      },
      "locked": {
        "lastModified": 1745494811,
        "narHash": "sha256-YZCh2o9Ua1n9uCvrvi5pRxtuVNml8X2a03qIFfRKpFs=",
        "owner": "nix-community",
        "repo": "home-manager",
        "rev": "abfad3d2958c9e6300a883bd443512c55dfeb1be",
        "type": "github"
      },
      "original": {
        "owner": "nix-community",
        "repo": "home-manager",
        "type": "github"
      }
    },
    "home-manager_2": {
      "inputs": {
        "nixpkgs": [
          "nixpkgs"
        ]
      },
      "locked": {
        "lastModified": 1756245065,
        "narHash": "sha256-aAZNbGcWrVRZgWgkQbkabSGcDVRDMgON4BipMy69gvI=",
        "owner": "nix-community",
        "repo": "home-manager",
        "rev": "54b2879ce622d44415e727905925e21b8f833a98",
        "type": "github"
      },
      "original": {
        "owner": "nix-community",
        "ref": "release-25.05",
        "repo": "home-manager",
        "type": "github"
      }
    },
    "nixos-hardware": {
      "locked": {
        "lastModified": 1756245047,
        "narHash": "sha256-9bHzrVbjAudbO8q4vYFBWlEkDam31fsz0J7GB8k4AsI=",
        "owner": "nixos",
        "repo": "nixos-hardware",
        "rev": "a65b650d6981e23edd1afa1f01eb942f19cdcbb7",
        "type": "github"
      },
      "original": {
        "owner": "nixos",
        "repo": "nixos-hardware",
        "type": "github"
      }
    },
    "nixpkgs": {
      "locked": {
        "lastModified": 1756217674,
        "narHash": "sha256-TH1SfSP523QI7kcPiNtMAEuwZR3Jdz0MCDXPs7TS8uo=",
        "owner": "NixOS",
        "repo": "nixpkgs",
        "rev": "4e7667a90c167f7a81d906e5a75cba4ad8bee620",
        "type": "github"
      },
      "original": {
        "id": "nixpkgs",
        "ref": "nixos-25.05",
        "type": "indirect"
      }
    },
    "nixpkgs-stable": {
      "locked": {
        "lastModified": 1751274312,
        "narHash": "sha256-/bVBlRpECLVzjV19t5KMdMFWSwKLtb5RyXdjz3LJT+g=",
        "owner": "NixOS",
        "repo": "nixpkgs",
        "rev": "50ab793786d9de88ee30ec4e4c24fb4236fc2674",
        "type": "github"
      },
      "original": {
        "owner": "NixOS",
        "ref": "nixos-24.11",
        "repo": "nixpkgs",
        "type": "github"
      }
    },
    "nixpkgs-unstable": {
      "locked": {
        "lastModified": 1756266583,
        "narHash": "sha256-cr748nSmpfvnhqSXPiCfUPxRz2FJnvf/RjJGvFfaCsM=",
        "owner": "NixOS",
        "repo": "nixpkgs",
        "rev": "8a6d5427d99ec71c64f0b93d45778c889005d9c2",
        "type": "github"
      },
      "original": {
        "id": "nixpkgs",
        "ref": "nixos-unstable",
        "type": "indirect"
      }
    },
    "root": {
      "inputs": {
        "agenix": "agenix",
        "blender-bin": "blender-bin",
        "disko": "disko",
        "emacs-overlay": "emacs-overlay",
        "home-manager": "home-manager_2",
        "nixos-hardware": "nixos-hardware",
        "nixpkgs": "nixpkgs",
        "nixpkgs-unstable": "nixpkgs-unstable"
      }
    },
    "systems": {
      "locked": {
        "lastModified": 1681028828,
        "narHash": "sha256-Vy1rq5AaRuLzOxct8nz4T6wlgyUR7zLU309k9mBC768=",
        "owner": "nix-systems",
        "repo": "default",
        "rev": "da67096a3b9bf56a91d16901293e51ba5b49a27e",
        "type": "github"
      },
      "original": {
        "owner": "nix-systems",
        "repo": "default",
        "type": "github"
      }
    }
  },
  "root": "root",
  "version": 7
}
</file>

<file path="flake.nix">
# flake.nix --- the heart of my dotfiles
#
# Author:  Henrik Lissner <contact@henrik.io>
# URL:     https://github.com/hlissner/dotfiles
# License: MIT
#
# Welcome to ground zero. Where the whole flake gets set up and all its modules
# are loaded.

{
  description = "A grossly incandescent nixos config.";

  inputs = 
    {
      # Core dependecies
      nixpkgs.url = "nixpkgs/nixos-25.05";
      nixpkgs-unstable.url = "nixpkgs/nixos-unstable";
      home-manager.url = "github:nix-community/home-manager/release-25.05";
      home-manager.inputs.nixpkgs.follows = "nixpkgs";
      agenix.url = "github:ryantm/agenix";
      agenix.inputs.nixpkgs.follows = "nixpkgs";
      disko.url = "github:nix-community/disko";
      disko.inputs.nixpkgs.follows = "nixpkgs";

      # Extras (imported directly by modules/hosts that need them)
      # spicetify-nix.url = "github:Gerg-L/spicetify-nix";
      # spicetify-nix.inputs.nixpkgs.follows = "nixpkgs-unstable";
      # hyprpicker.url = "github:hyprwm/hyprpicker";
      # hyprpicker.inputs.nixpkgs.follows = "nixpkgs-unstable";
      blender-bin.url = "github:edolstra/nix-warez?dir=blender";
      blender-bin.inputs.nixpkgs.follows = "nixpkgs-unstable";
      emacs-overlay.url = "github:nix-community/emacs-overlay";
      emacs-overlay.inputs.nixpkgs.follows = "nixpkgs";
      nixos-hardware.url = "github:nixos/nixos-hardware";
    };

  outputs = inputs @ { self, nixpkgs, nixpkgs-unstable, nixos-hardware, ... }:
    let
      args = {
        inherit self;
        inherit (nixpkgs) lib;
        pkgs = import nixpkgs {};
      };
      lib = import ./lib args;
    in
      with builtins; with lib; mkFlake inputs {
        systems = [ "x86_64-linux" "aarch64-linux" ];
        inherit lib;

        hosts = mapHosts ./hosts;
        modules.default = import ./.;

        apps.install = mkApp ./install.zsh;
        devShells.default = import ./shell.nix;
        checks = mapModules ./test import;
        overlays = mapModules ./overlays import;
        packages = mapModules ./packages import;
        # templates = import ./templates args;
      };
}
</file>

<file path="install.zsh">
#!/usr/bin/env zsh
# Deploy and install this nixos system.

function main() {
  zparseopts -E -D -F -- -flake:=flake -user:=user -host:=host -dest:=dest -root:=root || exit 1

  local root="${${root[2]}:-/mnt}"
  local flake="${${flake[2]}:-/etc/dotfiles}"
  local host="${${host[2]}:-$(hostname)}"
  local user="${${user[2]}:-hlissner}"
  local dest="${dest[2]:-$root/home/$user/.config/dotfiles}"

  if [[ "$USER" == nixos ]]; then
    >&2 echo "Error: not in the nixos installer"
    exit 1
  elif [[ -z "$host" ]]; then
    >&2 echo "Error: no --host set"
    exit 2
  fi
  
  if [[ ! -d "$flake" ]]; then
    local url=https://github.com/hlissner/dotfiles
    [[ "$user" == hlissner ]] && url="git@github.com:hlissner/dotfiles.git"
    rm -rf "$flake"
    git clone --recursive "$url" "$flake"
  fi
  
  export HEYENV="{\"user\":\"$user\",\"host\":\"$host\",\"path\":\"$flake\",\"theme\":\"$THEME\"}"
  nixos-install \
      --impure \
      --show-trace \
      --root "$root" \
      --flake "${root}${flake}#${host}"
}

set -e
main $*
</file>

<file path="LICENSE">
The MIT License (MIT)

Copyright (c) 2016-2024 Henrik Lissner.

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
</file>

<file path="project.janet">
(declare-project
 :name "hey"
 :author "Henrik Lissner <contact@henrik.io>"
 :description "A control center for my dotfiles"
 :license "MIT"
 :url "https://github.com/hlissner/dotfiles"
 :repo "git+https://github.com/hlissner/dotfiles"
 :dependencies [
   {:url "https://github.com/andrewchambers/janet-posix-spawn.git"}
   {:url "https://github.com/andrewchambers/janet-sh.git"}
   {:url "https://github.com/janet-lang/spork.git"}
   {:url "https://github.com/ianthehenry/judge.git"}
   {:url "https://github.com/janet-lang/sqlite3.git"}
 ])

(declare-executable
 :name "hey"
 :entry "bin/hey"
 :install true)

(def *heypath* (string (dyn :modpath) "/hey"))
(def *heybuildpath* (string (dyn :tree) "/build"))

(os/setenv "JANET_BUILDPATH" *heybuildpath*)
(os/mkdir *heybuildpath*)

(task "deploy" ["uninstall" "clean"]
  # jpm won't deploy declared sources before building the executable, so I have
  # to do it manually.
  (def mode (os/stat *heypath* :mode))
  (unless mode
    (shell "ln" "-sv" (abspath "lib/hey") *heypath*))
  (when (or (not mode) (os/getenv "HEYBUILDDEPS"))
    (shell "jpm" "deps"))
  (shell "jpm" "install"
         "--build-type=release"
         "--optimize=3"))

# Default clean rule doesn't seem to see the non-standard JANET_BUILDPATH, so I
# have to reinvent the wheel:
(put-in (getrules) ["clean" :recipe] @[]) # Disable build-in rule
(task "clean" []
  (shell "rm" "-rfv" *heybuildpath* (string (dyn :binpath) "/hey")))

(put-in (getrules) ["test" :recipe] @[]) # Disable build-in tests
(task "test" []
  (protect (shell "judge" "test/hey")))
</file>

<file path="README.md">
[![Made with Doom Emacs](https://img.shields.io/badge/Made_with-Doom_Emacs-blueviolet.svg?style=flat-square&logo=GNU%20Emacs&logoColor=white)](https://github.com/doomemacs)
[![NixOS Unstable](https://img.shields.io/badge/NixOS-24.05-blue.svg?style=flat-square&logo=NixOS&logoColor=white)](https://nixos.org)

**Hey,** you. You're finally awake. You were trying to configure your OS
declaratively, right? Walked right into that NixOS ambush, same as us, and those
dotfiles over there.

> [!IMPORTANT]
> **Disclaimer:** _This is not a "community framework" or "NixOS distribution"._
> Please do not use it like one. It is an ongoing and haphazard experiment to
> feel out NixOS and the Nix language for my own purposes, and is home to all
> manner of unspeakable, over-engineered hackery that make the other 9 circles
> of hell look like tropical beach resorts.
>
> Until I can bend spoons with my Nix-fu, please divert your Nix(OS) questions
> [to the NixOS discourse][nixos-discourse] instead of my issue tracker. That
> said, I'm more than happy [to hear input and discuss ideas](/discussions), but
> be warned: I'm awful at staying on top of my Github notifications.

(screenshots coming soon)

------

|               | Wayland                 | X11                                              |
|---------------|-------------------------|--------------------------------------------------|
| **Shell:**    | zsh + zgenom            | "                                                |
| **WM:**       | hyprland + waybar       | lightdm + lightdm-mini-greeter + bspwm + polybar |
| **Editor:**   | [Doom Emacs][doomemacs] | "                                                |
| **Terminal:** | foot                    | st                                               |
| **Launcher:** | rofi                    | "                                                |
| **Browser:**  | firefox                 | "                                                |

-----

## Quick start

1. Acquire or build a NixOS 24.05+ image:
   ```sh
   # Yoink nixos-unstable from upstream
   $ wget -O nixos.iso https://channels.nixos.org/nixos-unstable/latest-nixos-minimal-x86_64-linux.iso
   ```

2. Write it to a USB drive:
   ```sh
   # Replace /dev/sdX with the correct partition!
   $ cp nixos.iso /dev/sdX
   ```
   
3. Restart and boot into the installer.

4. Do your partitions and mount your root to `/mnt` ([for
   example](hosts/udon/README.org)).

5. Clone these dotfiles somewhere:
   ```sh
   $ git clone --recursive https://github.com/hlissner/dotfiles
   ```
   
6. Create a host config in `hosts/` (see [existing ones](hosts/) for examples).

7. Run the installer:
   ```sh
   # The options are optional, but these are their default values, if you omit them.
   $ dotfiles/install.zsh \ 
         --root /mnt \
         --flake /mnt/etc/dotfiles \
         --user "$USER" \
         --host "$HOST" \
         --dest /mnt/home/$USER/.config/dotfiles
   ```

8. Then reboot and you're good to go!

> [!WARNING]
> Don't forget to change your `root` and `$USER` passwords! They are set to
> `nixos` by default.


## Management

And I say, `bin/hey`, [what's going on?](https://youtu.be/ZZ5LpwO-An4).

```
SYNOPSIS:
  hey [-?|-??|-???|-!] [-h|--help] COMMAND [ARGS...]

OPTIONS:
  -!           -- Do a dry run. WARNING: It's up to called scripts to obey!
  -?,-??,-???  -- Enable debug (verbose) mode.
  -h,--help    -- Display the documentation embedded in a target script's
                  header.

COMMANDS:
  - build|b    -- Build nix images or recompile bin/hey
  - exec       -- Dispatch to $DOTFILES_HOME/{,hosts/$HOST,config/$WM}/bin/shim.d $PATH
  - get|set    -- Alias for hey vars {get,set} ...
  - gc         -- Run garbage collection on the user's/system's profile
  - help|h     -- Display documentation for the command
  - hook       -- Trigger scripts associated with an event
  - host       -- Dispatch to $DOTFILES_HOME/hosts/$HOST/bin
  - info       -- Display information about current system (JSON)
  - path       -- Display path to area of my dotfiles
  - profile    -- Manage or analyze a system or user nix profile
  - pull       -- Update flake inputs
  - reload     -- Run reload hooks
  - repl       -- Open a Janet, Nix, or nix-develop REPL
  - swap       -- Swap nix-store symlinks with copies (and back)
  - sync|s     -- Rebuild this flake (using nixos-rebuild)
  - test       -- Run Hey and/or Nix test suites
  - which      -- Print out the script's path (with arguments) w/o executing it
  - wm         -- Dispatch to $DOTFILES_HOME/config/$WM/bin
  - vars       -- Get or set session or persistent state in userspace.
  - @*         -- Dispatch to $DOTFILES_HOME/config/${1#@}/bin
  - .*         -- Tries to be smart. Looks for any executable under host, wm,
                  then $DOTFILES_HOME/bin.
```

## Frequently asked questions

+ **Why NixOS?**

  Because managing a fleet of servers, a hundred strong, is the tenth circle of
  hell without a declarative, generational, and immutable single-source-of-truth
  configuration framework like NixOS.
  
  Sure beats the nightmare of brittle capistrano/chef/puppet/ansible/shell
  scripts I left behind.

+ **Should I use NixOS?**

  **Short answer:** no.
  
  **Long answer:** no really. Don't.
  
  **Long long answer:** I'm not kidding. Don't.
  
  **Unsigned long long answer:** Alright alright. Here's why not:

  - Its learning curve is steep.
  - You _will_ trial and error your way to enlightenment, if you survive the
    frustration long enough.
  - NixOS is unlike other Linux distros. Your issues will be unique and
    difficult to google. A decent grasp of Linux and your chosen services is a
    must, if only to distinguish Nix(OS) issues from Linux (or upstream) issues
    -- as well as to debug them or report them to the correct authority (and
    coherently).
  - If words like "declarative", "generational", and "immutable" don't put your
    sexuality in jeopardy, you're considering NixOS for the wrong reasons.
  - The overhead of managing a NixOS config will rarely pay for itself with 3
    systems or fewer (perhaps another distro with nix on top would suit you
    better?).
  - Official documentation for Nix(OS) is vast, but shallow. Unofficial
    resources and example configs are sparse and tend toward too simple or too
    complex (and most are outdated). Case in point: this repo.
  - The Nix language is obtuse and its toolchain is not intuitive. Your
    experience will be infinitely worse if functional languages are alien to
    you, however, learning Nix is a must to do even a fraction of what makes
    NixOS worth the trouble.
  - If you need somebody else to tell you whether or not you need NixOS, you
    don't need NixOS.

  If you're not discouraged by this, then you didn't need my advice in the first
  place. Stop procrastinating and try NixOS!
  
+ **How do you manage secrets?**

  With [agenix].

+ **Why did you write bin/hey?**

  I envy Guix's CLI and want similar for NixOS, whose toolchain is spread across
  many commands, none of which are as intuitive: `nix`, `nix-collect-garbage`,
  `nixos-rebuild`, `nix-env`, `nix-shell`, etc.
  
  I don't claim `hey` is the answer, but who doesn't like their own brew?

+ **How 2 flakes?**

  Would it be the NixOS experience if I gave you all the answers in one,
  convenient place?
  
  No. Suffer my pain:
  
  - [A three-part tweag article that everyone's read.](https://www.tweag.io/blog/2020-05-25-flakes/)
  - [An overengineered config to scare off beginners.](https://github.com/divnix/devos)
  - [A minimalistic config for scared beginners.](https://github.com/colemickens/nixos-flake-example)
  - [A nixos wiki page that spells out the format of flake.nix.](https://wiki.nixos.org/wiki/Flakes)
  - [Official documentation that nobody reads.](https://nixos.org/learn.html)
  - [Some great videos on general nixOS tooling and hackery.](https://www.youtube.com/channel/UC-cY3DcYladGdFQWIKL90SQ)
  - A couple flake configs that I 
    [may](https://github.com/LEXUGE/nixos) 
    [have](https://github.com/bqv/nixrc)
    [shamelessly](https://git.sr.ht/~dunklecat/nixos-config/tree)
    [rummaged](https://github.com/utdemir/dotfiles)
    [through](https://github.com/purcell/dotfiles).
  - [Some notes about using Nix](https://github.com/justinwoo/nix-shorts)
  - [What helped me figure out generators (for npm, yarn, python and haskell)](https://myme.no/posts/2020-01-26-nixos-for-development.html)
  - [Learn from someone else's descent into madness; this journals his
    experience digging into the NixOS
    ecosystem](https://www.ianthehenry.com/posts/how-to-learn-nix/introduction/)
  - [What y'all will need when Nix drives you to drink.](https://www.youtube.com/watch?v=Eni9PPPPBpg)

  And if all else fails, ask for help on [the NixOS Discourse][nixos-discourse].


[nixos-discourse]: https://discourse.nixos.org
[doomemacs]: https://github.com/doomemacs/doomemacs
[agenix]: https://github.com/ryantm/agenix
</file>

<file path="shell.nix">
{ mkShell, writeShellScriptBin, nixVersions, git, nix-zsh-completions, ... }:

let nixConfig = builtins.toFile "nix.conf" ''
      warn-dirty = false
      http2 = true
      experimental-features = nix-command flakes
      use-xdg-base-directories = true
    '';
in mkShell {
  buildInputs = [
    git
    nix-zsh-completions
    nixVersions.nix_2_19
  ];
  shellHook = ''
    export NIX_USER_CONF_FILES="${nixConfig}"
    export PATH="$(pwd)/bin:$PATH"
  '';
}
</file>

</files>
