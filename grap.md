# Graphite Agent Configuration for Python 3.13

Below is a ready-to-paste, modular set of Graphite Agent **comment
exclusions** and **custom prompt rules** for a Python 3.13 codebase, written in
the "Rule → Bad example → Good example → Reasoning" style Graphite
recommends.[1]

## How to use

Graphite AI reviews support two primary customization mechanisms: **Exclusions**
(to reduce noise) and **Custom rules** (to enforce standards).[1]
For best results, Graphite recommends writing custom prompts that are focused
(one concern per rule) and structured as "Rule → Bad example → Good example →
Reasoning," while avoiding vague guidance, praise, or non-prescriptive verbs
like "comment on/flag."[1]

## Comment exclusions

> Add each of the following as a separate **Comment exclusion** in Graphite;
> keep scopes narrow to avoid suppressing legitimate review findings.[1]

- Do not leave comments on files under `**/generated/**`, `**/_generated/**`,
  or `**/vendor/**` (generated or vendored code is not hand-edited).
- Do not leave comments on `**/*.min.py`, `**/*.lock`, `**/*-lock.json`, or
  `**/poetry.lock` (autogenerated dependency lockfiles/minified artifacts).
- Do not leave comments on `**/migrations/**` and `**/alembic/versions/**`
  unless the change introduces raw SQL strings or disables constraints
  (migration diffs are often noisy).
- Do not leave comments on snapshot/golden test artifacts under
  `**/snapshots/**`, `**/goldens/**`, or `**/__snapshots__/**` (review the
  generator/source instead).
- Do not leave comments on large data fixtures under `**/testdata/**`,
  `**/fixtures/**`, or `**/*.csv` unless credentials/keys/secrets appear in
  plaintext (data diffs are typically not actionable).
- Do not leave style-only comments (formatting/whitespace) in
  repositories/directories that are auto-formatted in CI (e.g.,
  `**/third_party/**`), unless it changes semantics.

## Custom rules

> Add each block below as a separate **Custom rule (custom prompt)**; Graphite
> recommends small, focused rules that are easy to iterate on.[1]

### Python 3.13 + typing

**Rule: Require type annotations on public APIs, and keep them consistent with
runtime behavior.**[2, 1]

**Bad example:**

```py
def parse_payload(payload):
    return json.loads(payload)
```

**Good example:**

```py
def parse_payload(payload: str) -> dict[str, object]:
    return json.loads(payload)
```

**Reasoning:** Google's Python style guide encourages adding type annotations
and enabling type checking, especially when adding/modifying public APIs.[2]

**Rule: Prefer modern generic/type-alias syntax where it improves
readability (PEP 695).**[2, 1]

**Bad example:**

```py
from typing import TypeVar, Generic

T = TypeVar("T")

class Box(Generic[T]):
    def __init__(self, value: T) -> None:
        self.value = value
```

**Good example:**

```py
class Box[T]:
    def __init__(self, value: T) -> None:
        self.value = value
```

**Reasoning:** PEP 695 defines a dedicated type-parameter syntax for generics
to make type parameter declaration clearer and more directly associated with
the class/function.[2]

### Style + docstrings (PEP 8 + Google)

**Rule: Follow PEP 8 layout conventions for readability (indentation, line
length, whitespace).**[3, 1]

**Bad example:**

```py
def f(x,y): return(x+y)
```

**Good example:**

```py
def f(x: int, y: int) -> int:
    return x + y
```

**Reasoning:** PEP 8 emphasizes readability and specifies conventions like
4-space indentation and line-length guidance (including shorter limits for
docstrings/comments).[3]

**Rule: Use Google-style docstrings with clear sections (Args/Returns/Raises)
for public functions/classes.**[2, 1]

**Bad example:**

```py
def connect(port: int) -> str:
    """Connect."""
    ...
```

**Good example:**

```py
def connect(port: int) -> str:
    """Connects to the service.

    Args:
        port: The TCP port to connect to.

    Returns:
        The connection ID.

    Raises:
        ConnectionError: If the connection cannot be established.
    """
    ...
```

**Reasoning:** Google's Python style guide shows structured docstrings and
explicitly uses triple-double-quotes for docstrings consistent with common
Python docstring conventions.[2]

### Security

**Rule: Never expose detailed internal error information to external callers;
log details internally and return a generic error.**[1]

**Bad example:**

```py
except Exception as e:
    return {"error": repr(e), "trace": traceback.format_exc()}
```

**Good example:**

```py
except Exception:
    logger.exception("Unhandled error while processing request")
    return {"error": "Internal Server Error"}
```

**Reasoning:** Graphite's own examples of strong security rules focus on
preventing leakage of stack traces/internal details while still enabling
internal debugging.[1]

**Rule: Treat any use of `eval`, `exec`, or dynamic imports based on user
input as a security issue; require a safer alternative.**[1]

**Bad example:**

```py
result = eval(user_expression)
```

**Good example:**

```py
# Parse with an explicit grammar / safe parser, or map allowed operations.
result = safe_eval(user_expression)
```

**Reasoning:** This enforces an explicit "do X instead of Y" remediation style
that Graphite recommends for prescriptive custom rules.[1]

### Performance

**Rule: Avoid O(n²) string concatenation in loops; require `''.join(...)` (or
a streaming approach) for many pieces.**[3, 1]

**Bad example:**

```py
s = ""
for part in parts:
    s += part
```

**Good example:**

```py
s = "".join(parts)
```

**Reasoning:** PEP 8 specifically calls out `''.join()` as the preferred
approach for performance-sensitive concatenation across Python
implementations.[3]

**Rule: For large iterations, do not materialize lists unless needed; prefer
iterators/generators.**[2, 1]

**Bad example:**

```py
lines = f.readlines()
for line in lines:
    ...
```

**Good example:**

```py
for line in f:
    ...
```

**Reasoning:** Google's Python style guide recommends using default
iterators/operators (e.g., iterating directly over files) rather than
list-producing methods like `readlines()` when not necessary.[2]

## Optional repo config

If the repo contains generated artifacts that frequently appear in PRs, mark
them as generated using `.gitattributes` with `linguist-generated=true` so
they're collapsed in GitHub PRs and skipped/discounted by Graphite AI review
heuristics.[1]

If helpful, share the directory structure (or a glob list of where generated
code and migrations live), and these exclusions can be tightened to match your
repo precisely.

## Sources

[1]: Customization - Graphite <https://graphite.com/docs/ai-review-customization>
[2]: PEP 695 – Type Parameter Syntax - Python Enhancement Proposals
<https://peps.python.org/pep-0695/>
[3]: Python Documentation contents — Python 3.13.9 documentation
<https://docs.python.org/3.13/contents.html>
[4]: PEP 695: Type Parameter Syntax - Page 6 - Python Discussions
<https://discuss.python.org/t/pep-695-type-parameter-syntax/21646?page=6>
[5]: Implementing PEP 695 - Jelle Zijlstra
<https://jellezijlstra.github.io/pep695.html>
[6]: PEP 695: Type Parameter Syntax - #22 by AlexWaygood
<https://discuss.python.org/t/pep-695-type-parameter-syntax/21646/22>
[7]: PEP 695: Type Parameter Syntax - Page 2 - Python Discussions
<https://discuss.python.org/t/pep-695-type-parameter-syntax/21646?page=2>
[8]: How to Write Beautiful Python Code With PEP 8
<https://realpython.com/python-pep8/>
[9]: How to Write Docstrings in Python
<https://realpython.com/how-to-write-docstrings-in-python/>
[10]: Pydantic v2 + Python 3.13: PEP 695 type-alias of a generic model ...
<https://stackoverflow.com/questions/79675294/pydantic-v2-python-3-13-pep-695-type-alias-of-a-generic-model-returns-typeali>
[11]: PEP 8 – Style Guide for Python Code
<https://peps.python.org/pep-0008/>
[12]: Example Google Style Python Docstrings
<https://iw3.math.rutgers.edu/solutions/example_google.html>
[13]: Please consider delaying, or even rejecting, PEP 695
<https://discuss.python.org/t/please-consider-delaying-or-even-rejecting-pep-695/26408/2>
[14]: What is PEP8 in Python : r/learnpython - Reddit
<https://www.reddit.com/r/learnpython/comments/r6n9j9/what_is_pep8_in_python/>
[15]: Google style Python docstrings — Doc guidance documentation
<https://docs.idmod.org/projects/doc-guidance/en/latest/docstrings.html>
[16]: PEP 695 – Type Parameter Syntax : r/Python - Reddit
<https://www.reddit.com/r/Python/comments/vz06yc/pep_695_type_parameter_syntax/>
[17]: PEP-8: Python Naming Conventions & Code Standards - DataCamp
<https://www.datacamp.com/tutorial/pep8-tutorial-python-code>
[18]: Google Style Python Docstrings - GitHub Gist
<https://gist.github.com/redlotus/3bc387c2591e3e908c9b63b97b11d24e>
[19]: non-pep695-generic-class (UP046) | Ruff - Astral Docs
<https://docs.astral.sh/ruff/rules/non-pep695-generic-class/>
[20]: Python Style Basics - PEP8 - Stanford Computer Science
<https://cs.stanford.edu/people/nick/py/python-style-basics.html>
[21]: Google Python Style Guide
<https://google.github.io/styleguide/pyguide.html>
[22]: 8 PEP 8 Rules That Will Instantly Improve Your Python Code
<https://python.plainenglish.io/8-pep-8-rules-that-will-instantly-improve-your-python-code-934567aa4b0d>
